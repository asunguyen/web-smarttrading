(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[25142,1650],{345350:e=>{e.exports={"nav-button":"nav-button-znwuaSC1",link:"link-znwuaSC1",background:"background-znwuaSC1",icon:"icon-znwuaSC1","flip-icon":"flip-icon-znwuaSC1","size-large":"size-large-znwuaSC1","preserve-paddings":"preserve-paddings-znwuaSC1","size-medium":"size-medium-znwuaSC1","size-small":"size-small-znwuaSC1","size-xsmall":"size-xsmall-znwuaSC1","size-xxsmall":"size-xxsmall-znwuaSC1","visually-hidden":"visually-hidden-znwuaSC1"}},744633:e=>{e.exports={separator:"separator-gVkHdN_4"}},2537:e=>{e.exports={icon:"icon-VykdSzLO",button:"button-VykdSzLO",wrapper:"wrapper-VykdSzLO",infoContainer:"infoContainer-VykdSzLO",title:"title-VykdSzLO",link:"link-VykdSzLO",text:"text-VykdSzLO"}},867838:e=>{e.exports={delayedDataTitleColor:"#F57C00",batsQuotesTitleColor:"#D81B60",header:"header-W5uTS8cc",wrapper:"wrapper-W5uTS8cc",statusLine:"statusLine-W5uTS8cc",informer:"informer-W5uTS8cc",text:"text-W5uTS8cc",button:"button-W5uTS8cc",settingsButton:"settingsButton-W5uTS8cc button-W5uTS8cc",settingsPopupMenu:"settingsPopupMenu-W5uTS8cc",delayedDataIcon:"delayedDataIcon-W5uTS8cc",batsQuotesIcon:"batsQuotesIcon-W5uTS8cc"}},483830:e=>{e.exports={"trading-panel-content":"trading-panel-content-LlInYWMC","trading-panel-spinner":"trading-panel-spinner-LlInYWMC","trading-panel-header":"trading-panel-header-LlInYWMC","trading-panel-tabs":"trading-panel-tabs-LlInYWMC","trading-panel-handle":"trading-panel-handle-LlInYWMC"}},966076:e=>{e.exports={"default-drawer-min-top-distance":"100px",wrap:"wrap-_HnK0UIN",positionBottom:"positionBottom-_HnK0UIN",backdrop:"backdrop-_HnK0UIN",drawer:"drawer-_HnK0UIN",positionLeft:"positionLeft-_HnK0UIN"}},345719:e=>{e.exports={separator:"separator-Pf4rIzEt"}},354583:e=>{e.exports={checkbox:"checkbox-aOSYFxuH"}},671986:e=>{e.exports={"tablet-small-breakpoint":"screen and (max-width: 430px)",item:"item-jFqVJoPk",hovered:"hovered-jFqVJoPk",isDisabled:"isDisabled-jFqVJoPk",isActive:"isActive-jFqVJoPk",shortcut:"shortcut-jFqVJoPk",toolbox:"toolbox-jFqVJoPk",withIcon:"withIcon-jFqVJoPk","round-icon":"round-icon-jFqVJoPk",icon:"icon-jFqVJoPk",labelRow:"labelRow-jFqVJoPk",label:"label-jFqVJoPk",showOnHover:"showOnHover-jFqVJoPk","disclosure-item-circle-logo":"disclosure-item-circle-logo-jFqVJoPk",showOnFocus:"showOnFocus-jFqVJoPk"}},934587:e=>{e.exports={icon:"icon-WB2y0EnP",dropped:"dropped-WB2y0EnP"}},496302:e=>{e.exports={container:"container-zLVm6B4t",content:"content-zLVm6B4t",arrowHolder:"arrowHolder-zLVm6B4t","arrowHolder--below":"arrowHolder--below-zLVm6B4t","arrowHolder--above":"arrowHolder--above-zLVm6B4t","arrowHolder--before":"arrowHolder--before-zLVm6B4t","arrowHolder--after":"arrowHolder--after-zLVm6B4t","arrowHolder--above-fix":"arrowHolder--above-fix-zLVm6B4t","arrowHolder--before-rtl-fix":"arrowHolder--before-rtl-fix-zLVm6B4t","arrowHolder--after-ltr-fix":"arrowHolder--after-ltr-fix-zLVm6B4t",label:"label-zLVm6B4t",closeButton:"closeButton-zLVm6B4t"}},4908:(e,t,i)=>{"use strict";i.d(t,{CloseButton:()=>u})
;var s=i(50959),r=i(897782),n=i(117105),o=i(315130),a=i(238822),l=i(663346),c=i(534983);function d(e="large"){switch(e){case"large":return n;case"medium":default:return o;case"small":return a;case"xsmall":return l;case"xxsmall":return c}}const u=s.forwardRef(((e,t)=>s.createElement(r.NavButton,{...e,ref:t,icon:d(e.size)})))},897782:(e,t,i)=>{"use strict";i.d(t,{NavButton:()=>c});var s=i(50959),r=i(497754),n=i(83436),o=i(345350);function a(e){const{size:t="large",preservePaddings:i,isLink:s,flipIconOnRtl:n,className:a}=e;return r(o["nav-button"],o[`size-${t}`],i&&o["preserve-paddings"],n&&o["flip-icon"],s&&o.link,a)}function l(e){const{children:t,icon:i}=e;return s.createElement(s.Fragment,null,s.createElement("span",{className:o.background}),s.createElement(n.Icon,{icon:i,className:o.icon,"aria-hidden":!0}),t&&s.createElement("span",{className:o["visually-hidden"]},t))}const c=(0,s.forwardRef)(((e,t)=>{const{icon:i,type:r="button",preservePaddings:n,flipIconOnRtl:o,size:c,"aria-label":d,...u}=e;return s.createElement("button",{...u,className:a({...e,children:d}),ref:t,type:r},s.createElement(l,{icon:i},d))}));c.displayName="NavButton";var d=i(14388),u=i(551080);(0,s.forwardRef)(((e,t)=>{const{icon:i,renderComponent:r,"aria-label":n,...o}=e,c=null!=r?r:d.CustomComponentDefaultLink;return s.createElement(c,{...o,className:a({...e,children:n,isLink:!0}),reference:(0,u.isomorphicRef)(t)},s.createElement(l,{icon:i},n))})).displayName="NavAnchorButton"},834995:(e,t,i)=>{"use strict";function s(e){const{reference:t,...i}=e;return{...i,ref:t}}i.d(t,{renameRef:()=>s})},14388:(e,t,i)=>{"use strict";i.d(t,{CustomComponentDefaultLink:()=>n});var s=i(50959),r=i(834995);function n(e){return s.createElement("a",{...(0,r.renameRef)(e)})}s.PureComponent},267521:(e,t,i)=>{"use strict";i.d(t,{useFunctionalRefObject:()=>n});var s=i(50959),r=i(774218);function n(e){const t=(0,s.useMemo)((()=>function(e){const t=i=>{e(i),t.current=i};return t.current=null,t}((e=>{a.current(e)}))),[]),i=(0,s.useRef)(null),n=t=>{if(null===t)return o(i.current,t),void(i.current=null);i.current!==e&&(i.current=e,o(i.current,t))},a=(0,s.useRef)(n);return a.current=n,(0,r.useIsomorphicLayoutEffect)((()=>{if(null!==t.current)return a.current(t.current),()=>a.current(null)}),[e]),t}function o(e,t){null!==e&&("function"==typeof e?e(t):e.current=t)}},774218:(e,t,i)=>{"use strict";i.d(t,{useIsomorphicLayoutEffect:()=>r});var s=i(50959);function r(e,t){("undefined"==typeof window?s.useEffect:s.useLayoutEffect)(e,t)}},444530:(e,t,i)=>{"use strict";i.d(t,{useResizeObserver:()=>a});var s=i(50959),r=i(159255),n=i(774218),o=i(267521);function a(e,t=[]){const{callback:i,ref:a=null}=function(e){return"function"==typeof e?{callback:e}:e}(e),l=(0,s.useRef)(null),c=(0,s.useRef)(i);c.current=i;const d=(0,o.useFunctionalRefObject)(a),u=(0,s.useCallback)((e=>{d(e),null!==l.current&&(l.current.disconnect(),null!==e&&l.current.observe(e))}),[d,l]);return(0,n.useIsomorphicLayoutEffect)((()=>(l.current=new r.default(((e,t)=>{c.current(e,t)})),d.current&&u(d.current),()=>{var e
;null===(e=l.current)||void 0===e||e.disconnect()})),[d,...t]),u}},818612:(e,t,i)=>{"use strict";i.d(t,{Spinner:()=>o});var s=i(50959),r=i(497754),n=i(685023);i(683135);function o(e){const t=r(e.className,"tv-spinner","tv-spinner--shown",`tv-spinner--size_${n.spinnerSizeMap[e.size||n.DEFAULT_SIZE]}`);return s.createElement("div",{className:t,style:e.style,role:"progressbar"})}},746326:(e,t,i)=>{"use strict";function s(e){const{paddingTop:t,paddingBottom:i}=window.getComputedStyle(e);return[t,i].reduce(((e,t)=>e-Number((t||"").replace("px",""))),e.clientHeight)}function r(e,t=!1){const i=getComputedStyle(e),s=[i.height];return"border-box"!==i.boxSizing&&s.push(i.paddingTop,i.paddingBottom,i.borderTopWidth,i.borderBottomWidth),t&&s.push(i.marginTop,i.marginBottom),s.reduce(((e,t)=>e+(parseFloat(t)||0)),0)}function n(e,t=!1){const i=getComputedStyle(e),s=[i.width];return"border-box"!==i.boxSizing&&s.push(i.paddingLeft,i.paddingRight,i.borderLeftWidth,i.borderRightWidth),t&&s.push(i.marginLeft,i.marginRight),s.reduce(((e,t)=>e+(parseFloat(t)||0)),0)}i.d(t,{contentHeight:()=>s,outerHeight:()=>r,outerWidth:()=>n})},58407:(e,t,i)=>{"use strict";i.d(t,{OutsideEvent:()=>r});var s=i(385806);function r(e){const{children:t,...i}=e;return t((0,s.useOutsideEvent)(i))}},254601:(e,t,i)=>{"use strict";function s(e,t){c().then((i=>i.signInAndRunReviewWorkflow(e,t)))}function r(){return c().then((e=>e.getStatusOrShowError()))}function n(){return c().then((e=>e.getReviewOrShowError()))}function o(e,t,i){c().then((s=>s.openCreateDialog(e,t,i)))}function a(e){c().then((t=>t.openEditDialog(e)))}function l(e){c().then((t=>t.openUpdateDialog(e)))}function c(){return i.e(89125).then(i.bind(i,209583))}i.d(t,{getBrokerReviewOrShowError:()=>n,getBrokerReviewStatusOrShowError:()=>r,openCreateBrokerReviewDialog:()=>o,openEditBrokerReviewDialog:()=>a,openUpdateBrokerReviewDialog:()=>l,signInAndRunReviewWorkflow:()=>s})},711803:(e,t,i)=>{"use strict";var s,r;function n(e){return!e.hasOwnProperty("errors")}function o(e){return e.hasOwnProperty("errors")}function a(e){const t=[];for(const i of e)void 0!==i.detail&&t.push(i.detail);return t}i.d(t,{BrokerReviewBaseErrorType:()=>s,BrokerReviewStatus:()=>r,getErrorListFromResponse:()=>a,isErrorResponse:()=>o,isSuccessResponse:()=>n}),function(e){e[e.Unknown=0]="Unknown",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.Conflict=409]="Conflict",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.RateLimit=429]="RateLimit"}(s||(s={})),function(e){e.Forbidden="forbidden",e.NonExists="non-exists",e.Exists="exists",e.Hidden="hidden"}(r||(r={}))},653501:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BrokerReviewPageData:()=>r});var s,r,n=i(129025),o=i(120780),a=i(711803),l=i(501437);async function c(e,t){try{const i=await(0,o.fetch)(`/api/v1/brokers/${e}/reviews/${function(e){const t=(0,l.createUrlParams)({rating:(null==e?void 0:e.rating)||null,ordering:(null==e?void 0:e.ordering)||null,page:(null==e?void 0:e.page)||null});return t?`?${t}`:""}(t)}`,{method:"GET"});if(!i.ok){return{errors:[{
code:a.BrokerReviewBaseErrorType.Unknown}]}}const{results:s}=await i.json();return{data:s}}catch(e){return{errors:[{code:a.BrokerReviewBaseErrorType.Unknown,detail:e}]}}}!function(e){e.CreatedAsc="created",e.CreatedDesc="-created",e.RatingAsc="rating",e.RatingDesc="-rating"}(s||(s={})),function(e){let t=null;const i=new n.WatchedValue([]);let r=null,o=null;e.setBrokerData=function(e){t=e},e.getBrokerData=function(){return t},e.setReviews=function(e){i.setValue(e)},e.setReviewsFromBackend=async function(){if(null===t)return;const e=await c(t.brokerId,{rating:r||void 0,ordering:s.CreatedDesc,page:o||void 0});(0,a.isSuccessResponse)(e)&&i.setValue(e.data)},e.reviewsSubscription=function(){return i},e.setRatingFilter=function(e){r=e},e.setPageNumber=function(e){o=e}}(r||(r={}))},581713:(e,t,i)=>{"use strict";i.d(t,{HeaderControlsSeparator:()=>n});var s=i(50959),r=i(744633);function n(e){return s.createElement("span",{className:r.separator})}},628532:(e,t,i)=>{"use strict";i.d(t,{BracketDefaultPips:()=>o,BracketSubControlType:()=>a,CalculatorDecKeyCodes:()=>d,CalculatorIncKeyCodes:()=>u,Context:()=>g,OrderEditorDisplayMode:()=>n,OrderPanelStatus:()=>s,OrderPlacingStatus:()=>r,PriceSubControlType:()=>c,QuantitySubControlType:()=>l,orderTypes:()=>_});var s,r,n,o,a,l,c,d,u,h=i(50959),p=i(444372);!function(e){e[e.Wait=0]="Wait",e[e.Active=1]="Active",e[e.Editing=2]="Editing",e[e.Preview=3]="Preview"}(s||(s={})),function(e){e[e.Creating=0]="Creating",e[e.Placed=1]="Placed"}(r||(r={})),function(e){e.Popup="popup",e.Panel="panel"}(n||(n={})),function(e){e[e.TakeProfit=75]="TakeProfit",e[e.StopLoss=25]="StopLoss"}(o||(o={})),function(e){e.Price="Price",e.Pips="Pips",e.Money="Money",e.Percent="Percent"}(a||(a={})),function(e){e.Units="Units",e.RiskInCurrency="RiskInCurrency",e.RiskInPercent="RiskInPercent",e.BaseCurrency="BaseCurrency",e.QuoteCurrency="QuoteCurrency"}(l||(l={})),function(e){e.Absolute="Absolute",e.Relative="Relative"}(c||(c={})),function(e){e[e.Minus=189]="Minus",e[e.NumMinus=109]="NumMinus",e[e.FirefoxMinus=173]="FirefoxMinus"}(d||(d={})),function(e){e[e.Plus=187]="Plus",e[e.NumPlus=107]="NumPlus",e[e.FirefoxPlus=61]="FirefoxPlus"}(u||(u={}));const g=h.createContext({resizerWidth:null,mode:n.Panel,supportTrailingStop:!1}),_={1:p.t(null,void 0,i(398157)),2:p.t(null,void 0,i(359758)),3:p.t(null,void 0,i(905023)),4:p.t(null,void 0,i(802654))}},98470:(e,t,i)=>{"use strict";i.d(t,{Button:()=>o,ButtonType:()=>s});var s,r=i(50959),n=i(915812);function o(e){const{value:t,buttonType:i,className:o,icon:a,onClick:l}=e;let c;switch(i){case s.PlusValue:case s.IncDec:c=t;break;case s.Clear:c="clear";break;case s.Default:c="default"}return r.createElement(n.SquareButton,{className:o,"data-value":c,"data-name":`qtyButtonCalculator-${c}`,onClick:()=>{l(t,i)},size:"xsmall",variant:"secondary",color:"gray",onMouseDown:e=>e.preventDefault()},a||t)}!function(e){e[e.PlusValue=0]="PlusValue",e[e.IncDec=1]="IncDec",e[e.Clear=2]="Clear",e[e.Default=3]="Default"}(s||(s={}))},575658:(e,t,i)=>{"use strict";i.d(t,{setFixedBodyState:()=>a})
;var s=i(76107),r=i(531327);let n=0,o=!1;function a(e){const{body:t}=document,i=t.querySelector(".widgetbar-wrap");if(e&&1==++n){const e=(0,s.getCSSProperty)(t,"overflow"),r=(0,s.getCSSPropertyNumericValue)(t,"padding-right");"hidden"!==e.toLowerCase()&&t.scrollHeight>t.offsetHeight&&((0,s.setStyle)(i,"right",`${(0,s.getScrollbarWidth)()}px`),t.style.paddingRight=`${r+(0,s.getScrollbarWidth)()}px`,o=!0),t.classList.add("i-no-scroll")}else if(!e&&n>0&&0==--n&&(t.classList.remove("i-no-scroll"),o)){(0,s.setStyle)(i,"right","0px");let e=0;e=i?(0,r.getWidgetBarPadding)((0,s.getContentWidth)(i)):0,t.scrollHeight<=t.clientHeight&&(e-=(0,s.getScrollbarWidth)()),t.style.paddingRight=(e<0?0:e)+"px",o=!1}}},421448:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEFAULT_SOUNDS:()=>k,alertSounds:()=>C,availableSounds:()=>S,enableAlertSoundsForMobile:()=>I,enableForMobile:()=>x,isPlaying:()=>O,onStopped:()=>E,play:()=>B,stop:()=>T});var s=i(444372),r=i(314802),n=i(201089),o=i(129025);const a=i.p+"alarm_clock.ba219c712b5dce956b08.mp3",l=i.p+"beep_beep.cddbb5d281594d0b4b8d.mp3",c=i.p+"alert_calling.205c6b5ccb0a10decbc1.mp3",d=i.p+"chat_calling.067c844a001001872f78.mp3",u=i.p+"call.6d2888370f40fbb8cd8d.mp3",h=i.p+"chirpy.bcc136ad76d4496efe29.mp3",p=i.p+"fault.ca1f77478c28a528be67.mp3",g=i.p+"fired.aaee45a643068df3a94b.mp3",_=i.p+"hand_bell.bd1c77bbd21a64aa4fe8.mp3",m=i.p+"hangup.0a486c8d934145d68c11.mp3",b=i.p+"message.c44275a460737d0d50ff.mp3",v=i.p+"notification.01a81746825289ed9423.mp3",y=i.p+"popup.184287feaec7efccbb27.mp3",f=i.p+"3_notes_reverb.dc905347b1eda03c1db2.mp3",w=(0,n.getLogger)("Lib.Sound",{color:"#dea433"}),k={sound:"notification/notification",alert:"alert/fired"},S=[{title:s.t(null,void 0,i(792586)),path:"alert/alarm_clock",soundForAlerts:!0,filePath:a}];S.unshift({path:k.sound,title:s.t(null,void 0,i(204329)),common:!0,filePath:v},{title:s.t(null,void 0,i(274471)),path:"chat/message",filePath:b,common:!0},{title:s.t(null,void 0,i(307769)),path:"chat/popup",filePath:y,common:!0},{title:s.t(null,void 0,i(514561)),path:"chat/call",filePath:u},{title:s.t(null,void 0,i(74210)),path:"chat/calling",filePath:d},{title:s.t(null,void 0,i(719791)),path:"chat/hangup",filePath:m},{title:s.t(null,void 0,i(7246)),path:k.alert,filePath:g,soundForAlerts:!0},{title:s.t(null,void 0,i(829406)),path:"alert/3_notes_reverb",filePath:f,soundForAlerts:!0}),S.push({title:s.t(null,void 0,i(476002)),path:"alert/beep_beep",filePath:l,soundForAlerts:!0},{title:s.t(null,void 0,i(115390)),path:"alert/calling",filePath:c,soundForAlerts:!0},{title:s.t(null,void 0,i(114579)),path:"alert/chirpy",filePath:h,soundForAlerts:!0},{title:s.t(null,void 0,i(926559)),path:"alert/fault",filePath:p,soundForAlerts:!0},{title:s.t(null,void 0,i(120021)),path:"alert/hand_bell",filePath:_,soundForAlerts:!0});const P={};function C(){return S.filter((e=>!!e.soundForAlerts))}function B(e=k.sound,t){if((0,r.isOnMobileAppPage)("any"))return Promise.resolve();w.logNormal(`Sound play attempt for "${e}" duration-${t||0}s;`);return N(e).play(t)}function T(e,t=!1){if((0,
r.isOnMobileAppPage)("any"))return;let i=[];e?i.push(N(e)):i=Object.values(P),i.forEach((e=>{e.stop(t)}))}function E(e,t){(0,r.isOnMobileAppPage)("any")||N(e).playing.subscribe((e=>{e||t()}),{once:!0})}function O(e){return!(0,r.isOnMobileAppPage)("any")&&N(e).playing.value()}function I(){x(C().map((e=>e.path)))}function x(e){if((0,r.isOnMobileAppPage)("any"))return;if(!e)return;if(!/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(window.navigator.userAgent))return;if(Array.isArray(e)||(e=[e]),0===(e=e.filter((e=>{const t=N(e);return!(!t||!t.el.load||t._mobilePreloadActive)&&(t._mobilePreloadActive=!0,!0)}))).length)return void w.logNormal("enableForMobile no sounds passed");const t=()=>{const s=[];Array.isArray(e)&&e.forEach((e=>{const t=N(e);t.el.load();const i=t.play().catch((e=>{if("AbortError"!==e.name)throw w.logError(`enableForMobile for "${t.el.src}" preload error: - ${e.message}`),e}));t.el.pause(),s.push(i)})),Promise.all(s).then((()=>{w.logNormal("enableForMobile sounds initialized")})),i.forEach((e=>{document.removeEventListener(e,t,!0)}))},i=["click","touchend","keydown"];i.forEach((e=>{document.addEventListener(e,t,!0)}))}const N=e=>{if(e in P)return P[e];w.logNormal(`requested sound  ${e} not cached, building a new audio element`);const t=S.find((t=>t.path===e));if(void 0===t)throw new Error(`Cannot find sound "${e}"`);const i=new Audio(t.filePath),s={el:i,playing:new o.WatchedValue(!1),play:(t=0)=>s.playing.value()?(w.logNormal("sound already playing"),Promise.reject("already playing")):(s.playing.setValue(!0),new Promise(((i,r)=>{let n=t>0;const o=()=>{const t=function(e){try{w.logNormal(`"${e.el.src}" triggering html5 play method, readyState - ${e.el.readyState}; muted - ${e.el.muted}; volume - ${e.el.volume}; currentTime - ${e.el.currentTime}`);let t=e.el.play();return t||(t=Promise.resolve()),t}catch(t){return w.logError(`play method for "${e.el.src}" catch error - ${t.message}`),Promise.reject(t)}}(s);t.catch((t=>{w.logNormal(`stop counting sound "${e}"; as playing due to an error: ${t.message}`),s.stop(),r(t)}))};s._onEnded=()=>{n?o():(s.stop(),i())},s.el.addEventListener("ended",s._onEnded),n&&setTimeout((()=>{w.logNormal(`"${e}" repeat timeout - ${t}s off`),n=!1}),1e3*t),o()}))),stop:(e=!1)=>{s.el.pause(),e&&(s.el.currentTime=0),s.playing.setValue(!1),s._onEnded&&s.el.removeEventListener("ended",s._onEnded)}};P[e]=s;return["canplaythrough","error"].forEach((t=>{i.addEventListener(t,(()=>{w.logNormal(`for sound "${e}", event - ${t} is fired`)}),!1)})),w.logNormal(`canPlayType - ${i.canPlayType("audio/mp3")}`),P[e]};x(S.filter((e=>!!e.common)).map((e=>e.path)))},939680:(e,t,i)=>{"use strict";i.d(t,{batsToRealtimeCrucialHtml:()=>I,batsToRealtimeHtml1:()=>C,batsToRealtimeHtml2WithExchange:()=>O,batsToRealtimeHtml2WithoutExchange:()=>E,batsToRealtimeHtmlPart1:()=>B,batsToRealtimeHtmlPart2:()=>T,continuousHtml:()=>N,continuousTitle:()=>x,delayHtml:()=>m,delayNoRealtimeHtml:()=>y,delayToRealtimeHtml:()=>v,delayTooltip:()=>n,delayWithoutMarketAgreement:()=>P,derivedHtml:()=>p,
derivedTitle:()=>h,eodHtml:()=>f,eodTooltip:()=>o,exchangeByOriginalExchangeTooltip:()=>c,halalHtml:()=>_,halalTitle:()=>g,notAccurate1PerSecondTooltip:()=>a,notAccurateCboeTooltip:()=>l,primaryHtml:()=>u,primaryTitle:()=>d,tFEXorMOEXorLSEorChixauHtml:()=>b,tickByTickHtml1:()=>k,tickByTickHtml1FullInfo:()=>w,tickByTickHtml2:()=>S});var s=i(444372),r=i(919476);const n=s.t(null,void 0,i(257310)),o=s.t(null,void 0,i(659315)),a=s.t(null,void 0,i(215815)),l=s.t(null,void 0,i(345e3)),c=s.t(null,void 0,i(107435)),d=s.t(null,void 0,i(624680)),u=s.t(null,void 0,i(999214)),h=s.t(null,void 0,i(6044)),p=s.t(null,void 0,i(831461)),g=s.t(null,void 0,i(332960)),_=s.t(null,void 0,i(152449)),m=(0,r.htmlEscape)(s.t(null,void 0,i(538611))),b=(0,r.htmlEscape)(s.t(null,void 0,i(301084))),v=(0,r.htmlEscape)(s.t(null,void 0,i(652984))),y=(0,r.htmlEscape)(s.t(null,void 0,i(689022))),f=(0,r.htmlEscape)(s.t(null,void 0,i(52916))),w=(0,r.htmlEscape)(s.t(null,void 0,i(449321))),k=(0,r.htmlEscape)(s.t(null,void 0,i(425978))),S=(0,r.htmlEscape)(s.t(null,void 0,i(28412))),P=(0,r.htmlEscape)(s.t(null,void 0,i(791459))),C=s.t(null,void 0,i(806667)),B=s.t(null,{context:'Part of: "Real-time data for {symbolName} is provided by {exchange} exchange."'},i(712978)),T=s.t(null,{context:'Part of: "Real-time data for {symbolName} is provided by {exchange} exchange."'},i(864565)),E=s.t(null,void 0,i(102310)),O=s.t(null,void 0,i(729512)),I=s.t(null,void 0,i(886753)),x=s.t(null,void 0,i(353205)),N=s.t(null,void 0,i(115993))},734410:(e,t,i)=>{"use strict";i.d(t,{BATS_TO_REALTIME_SOLUTION_ID:()=>r,CONTINUOUS_SOLUTION_ID:()=>n,FEATURED_PARTNER_ID:()=>o,HALAL_SOLUTION_ID:()=>s});const s=43000700852,r=43000473924,n=43000483493,o=43000701943},763532:(e,t,i)=>{"use strict";i.d(t,{escapeCSVValue:()=>l,saveTextFile:()=>r});var s=i(638456);function r(e,t,i="text/plain"){const r=new Blob([t],{type:i});if(s.CheckMobile.iOS()){const t=new FileReader;return t.onload=()=>{t.result&&n(e,t.result.toString())},void t.readAsDataURL(r)}const o=window.URL.createObjectURL(r);navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(r,e):window.navigator.msSaveBlob?window.navigator.msSaveBlob(r,e):(n(e,o),window.URL.revokeObjectURL(o))}function n(e,t){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=t,i.download=e,i.click(),document.body.removeChild(i)}const o=/[",\r\n]/,a=/"/g;function l(e){return o.test(e)?`"${e.replace(a,'""')}"`:e}},176006:(e,t,i)=>{"use strict";function s(e,t){null===e.firstChild?e.textContent=t:e.firstChild.nodeValue=t}i.d(t,{updateTextNode:()=>s})},332585:(e,t,i)=>{"use strict";i.d(t,{DrawerContext:()=>o,DrawerManager:()=>n});var s=i(50959),r=i(575658);class n extends s.PureComponent{constructor(e){super(e),this._isBodyFixed=!1,this._addDrawer=e=>{this.setState((t=>({stack:[...t.stack,e]})))},this._removeDrawer=e=>{this.setState((t=>({stack:t.stack.filter((t=>t!==e))})))},this.state={stack:[]}}componentDidUpdate(e,t){!t.stack.length&&this.state.stack.length&&((0,r.setFixedBodyState)(!0),this._isBodyFixed=!0),
t.stack.length&&!this.state.stack.length&&this._isBodyFixed&&((0,r.setFixedBodyState)(!1),this._isBodyFixed=!1)}componentWillUnmount(){this.state.stack.length&&this._isBodyFixed&&(0,r.setFixedBodyState)(!1)}render(){return s.createElement(o.Provider,{value:{addDrawer:this._addDrawer,removeDrawer:this._removeDrawer,currentDrawer:this.state.stack.length?this.state.stack[this.state.stack.length-1]:null}},this.props.children)}}const o=s.createContext(null)},762852:(e,t,i)=>{"use strict";i.d(t,{Drawer:()=>h});var s=i(50959),r=i(650151),n=i(497754),o=i(541558),a=i(636098),l=i(332585),c=i(320116),d=i(150881),u=i(966076);function h(e){const{position:t="Bottom",onClose:i,children:d,className:h,theme:g=u}=e,_=(0,r.ensureNotNull)((0,s.useContext)(l.DrawerContext)),[m]=(0,s.useState)((()=>(0,o.randomHash)())),b=(0,s.useRef)(null),v=(0,s.useContext)(c.CloseDelegateContext);return(0,s.useLayoutEffect)((()=>((0,r.ensureNotNull)(b.current).focus({preventScroll:!0}),v.subscribe(_,i),_.addDrawer(m),()=>{_.removeDrawer(m),v.unsubscribe(_,i)})),[]),s.createElement(a.Portal,null,s.createElement("div",{className:n(u.wrap,u[`position${t}`])},m===_.currentDrawer&&s.createElement("div",{className:u.backdrop,onClick:i}),s.createElement(p,{className:n(g.drawer,u[`position${t}`],h),ref:b,"data-name":e["data-name"]},d)))}const p=(0,s.forwardRef)(((e,t)=>{const{className:i,...r}=e;return s.createElement(d.TouchScrollContainer,{className:n(u.drawer,i),tabIndex:-1,ref:t,...r})}))},903535:(e,t,i)=>{"use strict";i.d(t,{useIsOpenedOnes:()=>r});var s=i(50959);const r=e=>{const[t,i]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{!t&&e&&i(!0)}),[e]),t}},546606:(e,t,i)=>{"use strict";i.d(t,{useObservable:()=>n,useObservableSubscription:()=>r});var s=i(50959);function r(e,t){(0,s.useEffect)((()=>{const i=e.subscribe(t);return()=>i.unsubscribe()}),[e,t])}function n(e,t){const i=(0,s.useCallback)(void 0!==t?()=>t:()=>{let t;return e.subscribe((e=>{t=e})).unsubscribe(),t},[t,e]),[n,o]=(0,s.useState)(i),a=(0,s.useCallback)((e=>o((()=>e))),[o]);return r(e,a),n}},221155:(e,t,i)=>{"use strict";i.d(t,{Separator:()=>o});var s=i(50959),r=i(497754),n=i(345719);function o(e){return s.createElement("div",{className:r(n.separator,e.className)})}},368337:(e,t,i)=>{"use strict";i.d(t,{makeOverlapable:()=>n});var s=i(50959),r=i(636098);function n(e){return class extends s.PureComponent{render(){const{isOpened:t,root:i}=this.props;if(!t)return null;const n=s.createElement(e,{...this.props,zIndex:150});return"parent"===i?n:s.createElement(r.Portal,null,n)}}}},45219:(e,t,i)=>{"use strict";i.d(t,{PopupMenuItemToggle:()=>l});var s=i(50959),r=i(497754),n=i(634993),o=i(182120),a=i(354583);function l(e){const{isDisabled:t,hint:i,label:l,isChecked:c,checkboxClassName:d,labelClassName:u,indeterminate:h,isActive:p,checkboxTabIndex:g,checkboxReference:_,checkboxDataRole:m,...b}=e;return s.createElement(n.PopupMenuItem,{...b,isDisabled:t,shortcut:i,dontClosePopup:!0,labelRowClassName:u,label:s.createElement(o.Checkbox,{reference:_,disabled:t,label:l,checked:c,indeterminate:h,
className:r(a.checkbox,d),tabIndex:g,"data-role":m})})}},634993:(e,t,i)=>{"use strict";i.d(t,{DEFAULT_POPUP_MENU_ITEM_THEME:()=>c,PopupMenuItem:()=>u});var s=i(50959),r=i(497754),n=i(345848),o=i(224743),a=i(495217),l=i(671986);const c=l;function d(e){e.stopPropagation()}function u(e){const{id:t,role:i,className:c,title:u,labelRowClassName:h,labelClassName:p,toolboxClassName:g,shortcut:_,forceShowShortcuts:m,icon:b,iconClassname:v,isActive:y,isDisabled:f,isHovered:w,appearAsDisabled:k,label:S,link:P,showToolboxOnHover:C,showToolboxOnFocus:B,target:T,rel:E,toolbox:O,reference:I,onMouseOut:x,onMouseOver:N,onKeyDown:V,suppressToolboxClick:L=!0,theme:A=l,tabIndex:M,tagName:D,renderComponent:R,roundedIcon:W,iconAriaProps:F,circleLogo:H,dontClosePopup:q,onClick:$,onClickArg:z,trackEventObject:U,trackMouseWheelClick:Q,trackRightClick:j,...G}=e,K=(0,s.useRef)(null),J=(0,s.useMemo)((()=>function(e){function t(t){const{reference:i,...r}=t,n=null!=e?e:r.href?"a":"div",o="a"===n?r:function(e){const{download:t,href:i,hrefLang:s,media:r,ping:n,rel:o,target:a,type:l,referrerPolicy:c,...d}=e;return d}(r);return s.createElement(n,{...o,ref:i})}return t.displayName=`DefaultComponent(${e})`,t}(D)),[D]),Z=null!=R?R:J;return s.createElement(Z,{...G,id:t,role:i,className:r(c,A.item,b&&A.withIcon,{[A.isActive]:y,[A.isDisabled]:f||k,[A.hovered]:w}),title:u,href:P,target:T,rel:E,reference:function(e){K.current=e,"function"==typeof I&&I(e);"object"==typeof I&&(I.current=e)},onClick:function(e){if(f)return;U&&(0,n.trackEvent)(U.category,U.event,U.label);$&&$(z,e);q||(0,o.globalCloseMenu)()},onContextMenu:function(e){U&&j&&(0,n.trackEvent)(U.category,U.event,`${U.label}_rightClick`)},onMouseUp:function(e){if(1===e.button&&P&&U){let e=U.label;Q&&(e+="_mouseWheelClick"),(0,n.trackEvent)(U.category,U.event,e)}},onMouseOver:N,onMouseOut:x,onKeyDown:V,tabIndex:M},H&&s.createElement(a.CircleLogo,{...F,className:l["disclosure-item-circle-logo"],size:"xxxsmall",logoUrl:H.logoUrl,placeholderLetter:H.placeholderLetter}),b&&s.createElement("span",{"aria-label":F&&F["aria-label"],"aria-hidden":F&&Boolean(F["aria-hidden"]),className:r(A.icon,W&&l["round-icon"],v),dangerouslySetInnerHTML:{__html:b}}),s.createElement("span",{className:r(A.labelRow,h)},s.createElement("span",{className:r(A.label,p)},S)),(void 0!==_||m)&&s.createElement("span",{className:A.shortcut},(X=_)&&X.split("+").join(" + ")),void 0!==O&&s.createElement("span",{onClick:L?d:void 0,className:r(g,A.toolbox,{[A.showOnHover]:C,[A.showOnFocus]:B})},O));var X}},443549:(e,t,i)=>{"use strict";i.d(t,{Spinner:()=>s.Spinner});var s=i(818612)},239401:(e,t,i)=>{"use strict";var s,r,n;i.d(t,{CloseTrigger:()=>s,ToastAnimationStage:()=>r,ToastPriority:()=>n}),function(e){e.Swipe="swipe",e.Click="click"}(s||(s={})),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.None=2]="None"}(r||(r={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(n||(n={}))},416293:(e,t,i)=>{"use strict";i.d(t,{ToolWidgetCaret:()=>l});var s=i(50959),r=i(497754),n=i(83436),o=i(934587),a=i(100578)
;function l(e){const{dropped:t,className:i}=e;return s.createElement(n.Icon,{className:r(i,o.icon,{[o.dropped]:t}),icon:a})}},12173:(e,t,i)=>{"use strict";i.d(t,{TooltipWidget:()=>d,TooltipWizard:()=>c});var s=i(50959),r=i(497754),n=i(83436),o=i(636098),a=i(333765),l=i(496302);class c extends s.PureComponent{render(){const{children:e,popperChildrenProps:t,onClose:i,reference:n,containerClassName:a,arrowClassName:c}=this.props;return s.createElement(o.Portal,null,s.createElement("div",{ref:n},s.createElement(d,{reference:t.ref,style:t.style,arrowClassName:r(l.arrowHolder,this._getArrowDirectionClass(),c),arrowReference:t.arrowProps.ref,arrowStyle:t.arrowProps.style,"data-placement":t.placement,onClose:i,containerClassName:a},e)))}_getArrowDirectionClass(){const{popperChildrenProps:e}=this.props;switch(e.placement){case"left":case"left-start":return r(l["arrowHolder--after"],l["arrowHolder--after-ltr-fix"]);case"top":return r(l["arrowHolder--above"],l["arrowHolder--above-fix"]);case"bottom":case"bottom-start":case"bottom-end":return l["arrowHolder--below"];default:return r(l["arrowHolder--before"],l["arrowHolder--before-rtl-fix"])}}}function d(e){const{className:t,containerClassName:i,contentClassName:o,reference:c,style:d,arrow:u=!0,arrowClassName:h,arrowReference:p,onClose:g,arrowStyle:_,children:m,...b}=e;return s.createElement("div",{...b,className:t,ref:c,style:d},u&&s.createElement("div",{className:h,ref:p,style:_}),s.createElement("div",{className:r(l.container,i)},s.createElement("div",{className:r(l.content,o)},m),g&&s.createElement(n.Icon,{className:l.closeButton,icon:a,onClick:g})))}},150881:(e,t,i)=>{"use strict";i.d(t,{TouchScrollContainer:()=>a});var s=i(50959),r=i(259142),n=i(650151),o=i(638456);const a=(0,s.forwardRef)(((e,t)=>{const{children:i,...n}=e,a=(0,s.useRef)(null);return(0,s.useImperativeHandle)(t,(()=>a.current)),(0,s.useLayoutEffect)((()=>{if(o.CheckMobile.iOS())return null!==a.current&&(0,r.disableBodyScroll)(a.current,{allowTouchMove:l(a)}),()=>{null!==a.current&&(0,r.enableBodyScroll)(a.current)}}),[]),s.createElement("div",{ref:a,...n},i)}));function l(e){return t=>{const i=(0,n.ensureNotNull)(e.current),s=document.activeElement;return!i.contains(t)||null!==s&&i.contains(s)&&s.contains(t)}}},502869:e=>{e.exports={button:"button-xNqEcuN2"}},707488:e=>{e.exports={blockHidden:"blockHidden-e6PF69Df","pane-button":"pane-button-e6PF69Df"}},607850:e=>{e.exports={button:"button-nNl43yCT"}},623549:e=>{e.exports={toggleContentWrapper:"toggleContentWrapper-i9xADy_f",checkBoxWrapper:"checkBoxWrapper-i9xADy_f"}},844012:e=>{e.exports={"css-value-padding":"4px"}},199056:e=>{e.exports={"css-value-padding":"4px",container:"container-hw_3o_pb",informerWrapper:"informerWrapper-hw_3o_pb",notAvailableOnMobile:"notAvailableOnMobile-hw_3o_pb",column:"column-hw_3o_pb",touchMode:"touchMode-hw_3o_pb",buttonsWrapper:"buttonsWrapper-hw_3o_pb",button:"button-hw_3o_pb",sellButton:"sellButton-hw_3o_pb",buyButton:"buyButton-hw_3o_pb",brokerButton:"brokerButton-hw_3o_pb",highButtons:"highButtons-hw_3o_pb",
withoutBg:"withoutBg-hw_3o_pb",lastCharSup:"lastCharSup-hw_3o_pb",spreadQtyWrapper:"spreadQtyWrapper-hw_3o_pb",spread:"spread-hw_3o_pb",withoutQty:"withoutQty-hw_3o_pb",qty:"qty-hw_3o_pb",loader:"loader-hw_3o_pb",circleLoader:"circleLoader-hw_3o_pb",loading:"loading-hw_3o_pb",buttonText:"buttonText-hw_3o_pb",brokerButtonIconWrap:"brokerButtonIconWrap-hw_3o_pb",brokerButtonDefault:"brokerButtonDefault-hw_3o_pb",buttons:"buttons-hw_3o_pb"}},312282:e=>{e.exports={mobile:"screen and (max-width: 567px)"}},396789:e=>{e.exports={tabs:"tabs-oqHzGqN1",divider:"divider-oqHzGqN1"}},90141:e=>{e.exports={"small-height-breakpoint":"screen and (max-height: 360px)",wrapper:"wrapper-yhHWNAs1",buttonWrapper:"buttonWrapper-yhHWNAs1"}},640712:e=>{e.exports={popupWrapper:"popupWrapper-sxxSUmLh"}},517516:e=>{e.exports={"small-height-breakpoint":"screen and (max-height: 360px)",moreButton:"moreButton-LjodxXHh",header:"header-LjodxXHh",brokerSelectScreenWrapper:"brokerSelectScreenWrapper-LjodxXHh"}},886495:e=>{e.exports={content:"content-iSoiahCU",contentInner:"contentInner-iSoiahCU"}},354496:e=>{e.exports={wrapper:"wrapper-RHzTMHJQ",button:"button-RHzTMHJQ"}},316909:(e,t,i)=>{"use strict";i.d(t,{ToolWidgetIconButton:()=>a});var s=i(50959),r=i(497754),n=i(444072),o=i(502869);const a=s.forwardRef((function(e,t){const{className:i,id:a,...l}=e;return s.createElement(n.ToolWidgetButton,{id:a,"data-name":a,...l,ref:t,className:r(i,o.button)})}))},146111:(e,t,i)=>{"use strict";i.d(t,{reactLoaderRendererCreator:()=>o});var s=i(265742),r=i(50959),n=i(707488);function o(e,t){return(i,o)=>function(e,t,i,o){const a=document.createElement("span"),l=(0,s.createRoot)(a);function c(e){a.classList.toggle(n.blockHidden,!e)}c(!1);const{className:d}=null!=o?o:{};return d&&a.classList.add(d),l.render((0,r.createElement)(t,i)),e.appendChild(a),{toggleVisibility:c,destroy:function(){l.unmount()}}}(i,e,t,o)}},486029:(e,t,i)=>{"use strict";i.d(t,{createPointsLoaderRenderer:()=>r});var s=i(265005);const r=(0,i(146111).reactLoaderRendererCreator)(s.Loader,{staticPosition:!0,size:"small"})},156836:(e,t,i)=>{"use strict";i.d(t,{trackingModeIsAvailable:()=>s});const s=i(638456).CheckMobile.any()},308481:(e,t,i)=>{"use strict";i.d(t,{AccountSettingsButton:()=>m});var s=i(284849),r=i(50959),n=i(444072),o=i(500962),a=i(605587);const l=r.lazy((async()=>({default:(await Promise.all([i.e(34465),i.e(69121),i.e(88194),i.e(87845),i.e(13152),i.e(84281),i.e(542),i.e(60123),i.e(47047),i.e(8052),i.e(21813),i.e(58431),i.e(75587),i.e(8613)]).then(i.bind(i,472330))).AccountSettingsDialog}))),c=(0,a.withDialogLazyLoad)(l);var d=i(546606),u=i(191035),h=i(634369),p=i(607850);const g="Account Settings Dialog",_=s.t(null,void 0,i(911297));function m(e){const{currentAccount$:t,resetAccount:i,changeAccountSettings:s,deleteAccount:a,accountSettingsInfo:l,trackEvent:m,showErrorNotification:b,bigIcon:v}=e,y=(0,d.useObservable)(t),f=(0,r.useCallback)((e=>{if(void 0===y)return;e.preventDefault(),e.stopPropagation(),m("Account Settings Button","Open account settings");const t=y.isDefault?void 0:a
;!function(e){const t=document.createElement("div");o.render(r.createElement(c,{isOpen:!0,onClose:function(){o.unmountComponentAtNode(t)},...e}),t)}({accountId:y.id,accountName:y.name,deleteAccountHandler:void 0!==t?e=>(m(g,"Click Remove account"),t(e)):void 0,changeAccountSettingsHandler:s,resetAccountHandler:void 0!==i?e=>(m(g,"Click Reset account"),i(e)):void 0,accountSettingsInfoHandler:l,trackEvent:m,showErrorNotification:b})}),[m,b,a,i,s,l,y]);return r.createElement(n.ToolWidgetButton,{icon:v?h:u,className:p.button,onClick:f,title:_,"aria-label":_,"data-name":"trading-account-settings"})}},269089:(e,t,i)=>{"use strict";i.d(t,{makeAccountManagerHeaderDropdownsProps:()=>g});var s=i(275734),r=i(757604),n=i(650151),o=i(18808),a=i(480802),l=i(763532),c=i(201089),d=i(17980);const u=(0,c.getLogger)("Trading.DataExport");class h{constructor(e,t){this._prefix=t,this._getDataExporters=e}tabs(){return[...this._getDataExporters()].map((([e,t])=>({value:e,content:t.title})))}async exportData(e){const{exporters:t,title:i}=(0,n.ensureDefined)(this._getDataExporters().get(e),"data exporter");try{const e=await Promise.all(t.map((({exportData:e})=>e())));e.forEach(((s,r)=>{const n=t[r].name,o=void 0===n||""===n?`${(0,a.default)(i)}${e.length>1?`-${r+1}`:""}`:(0,a.default)(n);let c="";if(0!==s.length){const e=[p(Object.keys(s[0]))];for(const t of s)e.push(p(Object.values(t)));c=e.join("\n")}(0,l.saveTextFile)(`${(0,a.default)(this._prefix)}-${o}-${(new Date).toISOString()}.csv`,c,"text/csv")}))}catch(e){u.logError((0,d.getLoggerMessage)(e))}}}function p(e){return e.map((e=>"number"==typeof e?e:(0,l.escapeCSVValue)(e))).join(",")}async function g(e,t,i,a){const l=(await e.brokersMetainfo()).filter((e=>!e.configFlags.isSuspended)),c=l.length>=1?e.brokersPlans():Promise.resolve(void 0),d=(0,n.ensureNotNull)(e.activeBroker()),u=await c,p=await d.accountsMetainfo(),g=d.accountManagerInfo();if(0===p.length)return;const _=p.map((e=>{var t;return{id:e.id,name:e.name,currency:""===e.currency?void 0:null!==(t=e.currency)&&void 0!==t?t:void 0,isDefault:e.isDefault,selectAccount:async()=>{e.id!==d.currentAccount()&&d.setCurrentAccount(e.id)}}})),m=e=>(0,n.ensureDefined)(_.find((t=>t.id===e))),b=(0,s.fromEventPattern)((e=>d.currentAccountUpdate.subscribe(null,e)),(e=>d.currentAccountUpdate.unsubscribe(null,e)),m).pipe((0,r.startWith)(m(d.currentAccount()))),v=d.metainfo(),y=void 0!==u?(0,o.brokersListFromPlans)(l,u):void 0,f=void 0!==y?{title:g.accountTitle,brokerName:v.title,brokerId:v.id,logo:v.logoMiniUrl,logoBlack:v.logoMiniBlackUrl,actions:d.buttonDropdownActions(),trading:e,brokers:y,mode:i,isBeta:v.isBeta,realtimeDataPermissionsConfig:v.realtimeDataPermissionsToggleConfig}:void 0,w={dataExportController:void 0!==a?new h(a,v.title):void 0,initialSummaryFieldsVisibilityInfo:t.fieldsVisibilityInfo(),summaryFieldsVisibilityInfo$:t.fieldsVisibilityInfo$,summaryFieldToggler:t.toggleField};return{brokerDropdownProps:f,accountDropdownProps:{currentAccount$:b,accountsList:_,removeMargins:void 0===f,trackEvent:e.trackEvent,
showErrorNotification:e.showErrorNotification,mode:i,createAccount:d.config.supportCreateAccount?d.createAccount:void 0,deleteAccount:d.config.supportDeleteAccount?d.deleteAccount:void 0,resetAccount:d.config.supportResetAccount?d.resetAccount:void 0,changeAccountSettings:d.config.supportChangeAccountSettings?d.changeAccountSettings:void 0,accountSettingsInfo:d.config.supportCreateAccount||d.config.supportResetAccount||d.config.supportChangeAccountSettings?d.accountSettingsInfo:void 0},commonDropdownProps:w}}},71741:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SummaryFieldsVisibilityManager:()=>r});var s=i(947488);class r{constructor(e,t){var i;this.toggleField=e=>{var t;const i=this._fieldsVisibilityInfo$.getValue(),s=new Map(i),r=s.get(e);void 0!==r&&(r.visible=!r.visible,this._fieldsVisibilityInfo$.next(s),null===(t=this._settingsGetter())||void 0===t||t.setSummaryFieldsVisibilityInfo(s))},this._settingsGetter=t;const r=null===(i=this._settingsGetter())||void 0===i?void 0:i.summaryFieldsVisibilityInfo();this._fieldsVisibilityInfo$=new s.BehaviorSubject(new Map(e.map((({text:e,isDefault:t})=>{var i,s,n;return[e,{id:e,visible:null===(n=null!==(s=null===(i=null==r?void 0:r.get(e))||void 0===i?void 0:i.visible)&&void 0!==s?s:t)||void 0===n||n}]})))),this.fieldsVisibilityInfo$=this._fieldsVisibilityInfo$.asObservable()}fieldsVisibilityInfo(){return this._fieldsVisibilityInfo$.getValue()}}},969561:(e,t,i)=>{"use strict";i.d(t,{HeaderContainer:()=>W,mountHeader:()=>F,unmountHeader:()=>H});var s=i(50959),r=i(500962),n=i(345848),o=i(83436),a=i(546606),l=i(444372),c=i(18182),d=i(70829),u=i(316909),h=i(642709),p=i(919476),g=i(734410),_=i(939680),m=i(628532),b=i(936755),v=i(497754),y=i.n(v),f=i(355589),w=i(312420),k=i(860037),S=i(2537);function P(e){const{icon:t,iconClassName:r,title:n,titleColor:a,text:c,solutionId:u}=e,h=void 0!==u;return s.createElement(d.ToolWidgetMenu,{arrow:!1,content:s.createElement(o.Icon,{icon:t}),className:y()(S.icon,S.button,r),drawerBreakpoint:f.TradingLayoutBreakpoint.Mobile,title:n,horizontalAttachEdge:w.HorizontalAttachEdge.Right,horizontalDropDirection:w.HorizontalDropDirection.FromRightToLeft},s.createElement("div",{className:S.wrapper},s.createElement(o.Icon,{icon:t,className:y()(S.icon,r)}),s.createElement("div",{className:S.infoContainer},s.createElement("span",{className:S.title,style:{color:a}},n),s.createElement("span",{className:S.text},c),h&&s.createElement("span",{className:S.link,onClick:function(){if(!h)return;(0,k.showSupportDialog)({solutionId:u})}},l.t(null,void 0,i(718429))))))}var C=i(643959),B=i(966883),T=i(513729),E=i(29834),O=i(512646),I=i(552828),x=i(867838);const N=l.t(null,void 0,i(398316));function V(e){const{settingsItems:t,title:r,description:n,symbol:a,hasDelayedWarning:v,hasBatsQuotes:y,informerMessage:f,back:w,close:k,cancel:S}=e;let V;if(v&&(V={icon:O,iconClassName:x.delayedDataIcon,title:l.t(null,void 0,i(675649)),titleColor:x.delayedDataTitleColor,text:N}),y){
const[e,t]=a.split(":"),i=`${_.batsToRealtimeHtml1.replace("{symbolName}",t).replace("{exchange}",_.notAccurateCboeTooltip)} ${_.batsToRealtimeHtml2WithExchange.replace("{exchange}",e)}`;V={icon:I,iconClassName:x.batsQuotesIcon,title:(0,p.htmlEscape)(_.exchangeByOriginalExchangeTooltip).format({exchange:e,originalExchange:_.notAccurateCboeTooltip}),titleColor:x.batsQuotesTitleColor,text:i,solutionId:g.BATS_TO_REALTIME_SOLUTION_ID}}const L=s.useContext(m.Context).mode===m.OrderEditorDisplayMode.Popup?{"data-dragg-area":!0}:{};return s.createElement("div",{className:x.header},void 0!==w&&s.createElement(u.ToolWidgetIconButton,{title:l.t(null,void 0,i(762592)),onClick:w,className:x.button,"data-name":"button-back",icon:C}),s.createElement("div",{className:x.wrapper,...L},s.createElement("span",{className:x.text},r,n&&`, ${n}`),(void 0!==f||void 0!==V)&&s.createElement("div",{className:x.statusLine},void 0!==f&&s.createElement(b.TradingInformer,{informerMessage:f}),void 0!==V&&s.createElement(P,{...V}))),void 0!==S&&s.createElement(u.ToolWidgetIconButton,{title:l.t(null,void 0,i(620036)),onClick:S,className:x.button,"data-name":"button-cancel",icon:B}),0!==s.Children.count(t)&&s.createElement(c.MatchMedia,{rule:h.DialogBreakpoints.TabletSmall},(e=>s.createElement(d.ToolWidgetMenu,{className:x.settingsButton,content:s.createElement(o.Icon,{icon:E}),menuClassName:x.settingsPopupMenu,children:t,isDrawer:e,title:l.t(null,void 0,i(389517)),arrow:!1,closeOnClickOutside:!0,"data-name":"order-ticket-settings"}))),void 0!==k&&s.createElement(u.ToolWidgetIconButton,{title:l.t(null,{context:"action"},i(768508)),onClick:k,className:x.button,"data-name":"button-close",icon:T}))}var L=i(45219),A=i(634993),M=i(623549);function D(e){const{label:t,value$:i,dataName:r,onClick:n}=e,o=(0,a.useObservable)(i);return s.createElement(L.PopupMenuItemToggle,{"data-name":r,labelClassName:M.checkBoxWrapper,label:t,isChecked:!!o,onClick:n})}function R(e){const{onIcon:t,offIcon:i,onLabel:r,offLabel:n,value$:l,dataName:c,onClick:d}=e,u=(0,a.useObservable)(l);return s.createElement(A.PopupMenuItem,{onClick:d,"data-name":c,label:s.createElement("div",{className:M.toggleContentWrapper},s.createElement(o.Icon,{icon:u?t:i}),s.createElement("span",null,u?r:n))})}function W(e){const{title$:t,description$:i,backFunction$:r,closeFunction$:o,cancelFunction$:l,informerMessage$:c,symbol$:d,hasBatsQuotes$:u,hasDelayedQuotes$:h,isTradable$:p,settings$:g}=e,_=(0,a.useObservable)(t),m=(0,a.useObservable)(i),b=(0,a.useObservable)(r),v=(0,a.useObservable)(o),y=(0,a.useObservable)(l),f=(0,a.useObservable)(d),w=(0,a.useObservable)(u),k=(0,a.useObservable)(h),S=(0,a.useObservable)(p),P=(0,a.useObservable)(c),C=(0,a.useObservable)(g),B=(0,s.useMemo)((()=>void 0!==C&&S?C.map((e=>0===e.settingType?s.createElement(D,{key:e.label,...e}):s.createElement(R,{key:e.onLabel,...e}))):null),[C,S]),T=(0,s.useMemo)((()=>void 0!==v?()=>{(0,n.trackEvent)("GUI","Close Order Panel from panel"),v()}:void 0),[v]),E=(0,s.useMemo)((()=>void 0!==y?()=>{(0,
n.trackEvent)("GUI","Reset Order Panel"),y()}:void 0),[y]),O=S;return s.createElement(V,{title:_||"",description:m,symbol:null!=f?f:"",settingsItems:B,hasDelayedWarning:k,hasBatsQuotes:w,isTradable:S,informerMessage:O?P:void 0,back:b,close:T,cancel:E})}function F(e,t){r.render(s.createElement(W,{...t}),e)}function H(e){r.unmountComponentAtNode(e)}},518075:(e,t,i)=>{"use strict";i.d(t,{makeObservableFromWatchedValue:()=>r});var s=i(275734);function r(e){return(0,s.fromEventPattern)((t=>e.subscribe(t,{callWithLast:!0})),(t=>e.unsubscribe(t)))}},272127:(e,t,i)=>{"use strict";i.d(t,{alignQuotesToMinTick:()=>E,calculatePipValue:()=>y,calculateQty:()=>w,calculateTradeValue:()=>f,calculateTradeValueByBigPointValue:()=>k,calculateUsedMargin:()=>S,calculatedMarginRatio:()=>P,checkPriceByOrderType:()=>O,comparator:()=>m,convertToBaseMonetaryUnit:()=>V,createCustomFieldModels:()=>x,displayedLeverage:()=>v,formatInfoValue:()=>C,formatRiskReward:()=>T,makeSubjectFromWatchedValue:()=>_,prepareCalculatorEventText:()=>I,prepareTradableSolution:()=>N,shouldShowTotal:()=>b});var s=i(444372),r=i(583912),n=i(947488),o=i(960521),a=i(707957),l=i(129025),c=i(389137),d=i(18808),u=i(333730),h=i(943994),p=i(98470),g=i(217504);function _(e){const t=new n.BehaviorSubject(e.value()),i=e=>{t.next(e)};return e.subscribe(i),{subject:t,unsubscribe:()=>e.unsubscribe(i)}}function m(e,t){return(0,c.deepEquals)(e,t)[0]}function b(e){return void 0!==e&&Boolean(e.showTotal)}function v(e,t){if(void 0!==e)return e;if(void 0!==t){const e=Math.round(1/t);return String(e)+":1"}return null}function y(e,t,i){return null!==e?(void 0!==i?e*i:e)*t:0}function f(e,t,i,s,r){return k(e,t,i/s,r)}function w(e,t,i,s,r){return(0,o.Big)(e).mul(s).div(i).div(t).div(r||1).toNumber()}function k(e,t,i,s){return e*t*i*(s||1)}function S(e,t){return void 0!==t?e*t:0}function P(e,t){const i=0!==t?100*e/t:0;return i>100?100:i}function C(e){if("number"==typeof e){const t=(0,u.splitThousands)((e||0).toFixed(2)," ");return Number.isInteger(e)||e>=1?t:function(e){if(Number.isInteger(e))return e+"";return e<1?function(e){const t=(e+"").split(".")[1]||"";let i=t.length;for(let e=0;e<t.length;e++)if("0"!==t[e]){i=e+1;break}return e.toFixed(i)}(e):e.toFixed(2)}(e)}return(0,u.splitThousands)(e," ")}const B=new h.VolumeFormatter(2);function T(e,t){return null!==e&&null!==t&&e/t>0?B.format(e/t):""}function E(e,t,i){const s=Object.assign({},e);return["trade","ask","bid"].forEach((e=>{const r=s[e];if(void 0!==r){const n=(0,g.getMinTick)({minTick:t,price:r,variableMinTickData:i});s[e]=(0,d.alignToMinTick)(r,n)}})),s}function O(e,t,i){return 4===e?null===t||null===i:3===e?null===i:null===t}function I(e,t){switch(t){case p.ButtonType.IncDec:return e<0?"-":"+";case p.ButtonType.PlusValue:return String(e);case p.ButtonType.Clear:return"Clear";default:return"Default"}}function x(e){const{modifyMode:t,alwaysShowAttachedErrors$:i,tradingDialogOptions:s,existedValues:r}=e,o=[];return void 0!==s&&Array.isArray(s.customFields)&&s.customFields.forEach((e=>{if("TextWithCheckBox"===e.inputType){
const t=new n.BehaviorSubject(e.value.text),i=new n.BehaviorSubject(e.value.checked),s=new l.WatchedValue(!0),r=new l.WatchedValue,c=e.validator,d=void 0!==c?e=>{const t=c(e);s.setValue(t.valid),r.setValue(t.valid?void 0:t.errorMessage)}:void 0,u=void 0!==d?t.subscribe(d):void 0;o.push({id:e.id,type:e.inputType,inputType:e.customInfo.asterix?"password":"text",placeholder:e.placeHolder||"",title:e.title||"",checkboxTitle:e.customInfo.checkboxTitle,text$:t.asObservable(),getText:t.getValue.bind(t),setText:t.next.bind(t),checked$:i.asObservable(),getChecked:i.getValue.bind(i),setChecked:i.next.bind(i),onControlFocused:new a.Delegate,isValid:s,errorMessage:r,destroy:()=>null==u?void 0:u.unsubscribe()})}if("Checkbox"===e.inputType){let i;const s=null==r?void 0:r[e.id];try{i=JSON.parse(s)}catch(e){i=s}const c=new n.BehaviorSubject(null!=i?i:e.value);o.push({id:e.id,type:e.inputType,title:e.title,help:e.help,checked$:c.asObservable(),getChecked:c.getValue.bind(c),setChecked:c.next.bind(c),onControlFocused:new a.Delegate,disabled:t&&!e.supportModify,saveToSettings:e.saveToSettings,isValid:new l.WatchedValue(!0),errorMessage:new l.WatchedValue,destroy:()=>{}})}if("ComboBox"===e.inputType&&Array.isArray(e.items)){let s=e.items[0];if(r&&e.id in r){const t=r[e.id],i=e.items.find((e=>e.value===t));void 0!==i&&(s=i)}else e.forceUserEnterInitialValue&&!t&&(s=void 0);const c=new n.BehaviorSubject(null==s?void 0:s.value);o.push({id:e.id,type:e.inputType,title:e.title,items:e.preventModify&&t&&s?[s]:e.items,selectedItem$:c.asObservable(),getSelectedItem:c.getValue.bind(c),setSelectedItem:c.next.bind(c),onControlFocused:new a.Delegate,saveToSettings:e.saveToSettings,alwaysShowAttachedErrors$:i,isValid:new l.WatchedValue(!0),errorMessage:new l.WatchedValue,destroy:()=>{}})}})),o}async function N(e,t){if(void 0===e.solutions)return;if("changeSymbol"in e.solutions){const t=e.solutions.changeSymbol;return{title:s.t(null,void 0,i(562030)),apply:()=>r.linking.setSymbolAndLogInitiator(t,"order ticket")}}if("changeAccount"in e.solutions){const r=e.solutions.changeAccount,n=(await t.accountsMetainfo()).filter((e=>e.id===r))[0].name;return{title:s.t(null,void 0,i(134542)).replace("{accountName}",n),apply:()=>t.setCurrentAccount(r)}}const n=e.solutions.openUrl.url;return{title:e.solutions.openUrl.text,apply:()=>window.open(n,"_blank")}}function V(e,t){return void 0===t?e:(0,o.Big)(e).div(t).toNumber()}},793814:(e,t,i)=>{"use strict";i.d(t,{OrdersService:()=>g,cropOrderData:()=>p,isBracketOrderRawData:()=>u});var s=i(650151),r=i(707957),n=i(389137),o=i(201089),a=i(842741),l=i(18808),c=i(767162);const d=(0,o.getLogger)("Trading.OrderService");function u(e){return"parentId"in e&&void 0!==e.parentId&&"parentType"in e&&void 0!==e.parentType}function h(e){return 1===e.type?(0,s.ensureDefined)(e.limitPrice):(0,s.ensureDefined)(e.stopPrice)}function p(e){return{id:e.id,parentId:e.parentId,parentType:e.parentType,symbol:e.symbol,type:e.type,side:e.side,avgPrice:e.avgPrice,limitPrice:e.limitPrice,stopPrice:e.stopPrice,price:e.price,stopLoss:e.stopLoss,
trailingStopPips:e.trailingStopPips,stopType:e.stopType,takeProfit:e.takeProfit,status:e.status,qty:e.qty}}class g extends a.BrokerService{constructor(){super(...arguments),this._existingOrdersIds=new Set,this._activeOrders=new Map,this._activeOrderUpdate=new r.Delegate,this._activeOrdersRemoved=new r.Delegate,this._ordersRejected=new r.Delegate}destroy(){this.stopService()}async getCurrency(){const e=(0,s.ensureNotNull)(this.activeBroker()),t=await e.accountMetainfo();return(0,l.getCurrency)(t,!0)||"USD"}orders(){return(0,s.ensureNotNull)(this.activeBroker()).orders()}find(e){return this._activeOrders.get(e)||null}activeOrders(){return Array.from(this._activeOrders.values())}activeOrdersUpdated(){return this._activeOrderUpdate}activeOrdersRemoved(){return this._activeOrdersRemoved}orderRejected(){return this._ordersRejected}stopService(){this._clearOrders();(0,s.ensureNotNull)(this.activeBroker()).orderUpdate.unsubscribeAll(this)}startService(){this._clearOrders(),this._requestOrders()}_clearOrders(){const e=Array.from(this._activeOrders.keys());this._activeOrders.clear(),this._existingOrdersIds.clear(),e.length>0&&d.logNormal(`All orders removed, id's: ${e}`),this._activeOrdersRemoved.fire(e)}async _requestOrders(){const e=this.activeBroker();if(!e)return;const t=await e.orders();for(const e of t)this._addActiveOrder(e);e.orderUpdate.unsubscribeAll(this),e.orderUpdate.subscribe(this,this._addActiveOrder)}_addActiveOrder(e){this._logOrderUpdate(e);const t=e.id,i=this._activeOrders.has(t),s=5===e.status,r=6!==e.status&&3!==e.status,n=2===e.type;if(i){if(r||n)return this._activeOrders.delete(t),void this._activeOrdersRemoved.fire([t])}else{if(n||r&&!s)return;if(s)return void this._ordersRejected.fire(h(e))}const o=this._getOrderData(e);this._activeOrders.set(t,o),this._activeOrderUpdate.fire(o)}_logOrderUpdate(e){const t=e.id;let i="update";this._existingOrdersIds.has(t)||(i="add",this._existingOrdersIds.add(t)),function(e,t){t(JSON.stringify(p(e)))}(e,(e=>{d.logNormal(`Order ${i}: ${e}`)}))}_getOrderData(e){const t=h(e);(0,n.isNumber)(t)||d.logError("order price is not defined");const i=(0,s.ensureNotNull)(this.activeBroker()).metainfo().configFlags;return(0,n.merge)((0,n.clone)(e),{price:t,considerFilledQty:!0,supportModify:(0,l.isModifyOrderSupported)(e,i),supportMove:(0,l.isMoveOrderSupported)(e,i),supportCancel:!0,supportModifyOrderPrice:Boolean(i.supportModifyOrderPrice),supportTrailingStop:(0,c.checkTrailingStopAvailability)(i)})}}},441919:(e,t,i)=>{"use strict";i.d(t,{PositionsService:()=>h,PositionsUpdateType:()=>d,cropPositionData:()=>u});var s=i(650151),r=i(707957),n=i(389137),o=i(201089),a=i(842741),l=i(767162);const c=(0,o.getLogger)("Trading.PositionService");var d;function u(e){const t=e;return{id:t.id,symbol:t.symbol,side:t.side,avgPrice:t.avgPrice,pl:t.pl,price:t.price,qtyBySide:t.qtyBySide,stopType:t.stopType,takeProfit:t.takeProfit,stopLoss:t.stopLoss,trailingStopPips:t.trailingStopPips}}!function(e){e[e.Full=0]="Full",e[e.Partial=1]="Partial"}(d||(d={}));class h extends a.BrokerService{
constructor(){super(...arguments),this._existingPositionIds=new Set,this._positions=new Map,this._positionUpdate=new r.Delegate,this._positionsRemoved=new r.Delegate,this._displayMode=1,this._updatePositionPLHandler=this._updatePositionPL.bind(this)}destroy(){this.stopService()}positions(){return Array.from(this._positions.values())}find(e){return this._positions.get(e)||null}async realIdFromBroker(e){const t=(0,s.ensureNotNull)(this.activeBroker());if(1===this._displayMode){const i=await t.positionById(e);if(void 0!==i)return i.id}else{const i=await t.individualPositionById(e);if(void 0!==i)return i.id}return null}positionUpdate(){return this._positionUpdate}positionsRemoved(){return this._positionsRemoved}isDisplayModeIndividualPositions(){return 0===this._displayMode}async getCurrency(e){return await(0,s.ensureNotNull)(this.activeBroker()).getPositionCurrency(e)||""}supportBrackets(e){return Boolean(this.isDisplayModeIndividualPositions()?e.supportIndividualPositionBrackets:e.supportPositionBrackets)}supportReverse(e){return Boolean(!this.isDisplayModeIndividualPositions()&&e.supportReversePosition)}stopService(){this._clearPositions();const e=(0,s.ensureNotNull)(this.activeBroker());this.isDisplayModeIndividualPositions()?e.individualPositionUpdate.unsubscribeAll(this):e.positionUpdate.unsubscribeAll(this)}startService(){this._clearPositions(),this._displayMode=function(e){if(null===e)return 1;const t=e.metainfo().configFlags;return t.supportPositionNetting?t.supportPositionBrackets?1:t.supportCloseIndividualPosition?0:1:1}(this.activeBroker()),this._requestPositions()}_clearPositions(){const e=(0,s.ensureNotNull)(this.activeBroker()),t=Array.from(this._positions.keys());for(const i of t)this.isDisplayModeIndividualPositions()?e.unsubscribeIndividualPositionPL(i,this._updatePositionPLHandler):e.unsubscribePL(i,this._updatePositionPLHandler);this._positions.clear(),this._existingPositionIds.clear(),t.length>0&&c.logNormal(`All positions removed, id's: ${t}`),this._positionsRemoved.fire(t)}async _requestPositions(){const e=this.activeBroker();if(!e)return;const t=this.isDisplayModeIndividualPositions(),i=await(t?e.individualPositions():e.positions());for(const e of i)this._addPosition(e);t?e.individualPositionUpdate.subscribe(this,this._addPosition):e.positionUpdate.subscribe(this,this._addPosition)}_addPosition(e){const t=e.id,i=this._positions.has(t),r=(0,s.ensureNotNull)(this.activeBroker()),n=this.isDisplayModeIndividualPositions();if(!e.qty)return i&&(n?r.unsubscribeIndividualPositionPL(t,this._updatePositionPLHandler):r.unsubscribePL(t,this._updatePositionPLHandler),this._positions.delete(t),this._positionsRemoved.fire([t])),void this._logPositionUpdate(e,!0);const o=this._getPositionData(e),a=this._updateType(o);this._logPositionUpdate(o,a===d.Full),this._positions.set(t,o),this._firePositionUpdate(o,a),i||(n?r.subscribeIndividualPositionPL(t,this._updatePositionPLHandler):r.subscribePL(t,this._updatePositionPLHandler))}_updatePositionPL(e,t){const i=(0,s.ensureDefined)(this._positions.get(e));i.pl=(0,
n.isNumber)(t)?t:null,this._firePositionUpdate(i,d.Partial)}_getPositionData(e){var t,i;const r=(0,s.ensureNotNull)(this.activeBroker()).metainfo().configFlags,n=this._positions.get(e.id),o=this.isDisplayModeIndividualPositions(),a=Boolean(o?r.supportIndividualPositionBrackets:r.supportPositionBrackets);let c,d=!1,u=null;if(o){const t=e;c=t.price,d=Boolean(t.canBeClosed)}else{const s=e;c=s.avgPrice,u=null!==(i=null!==(t=s.pl)&&void 0!==t?t:null==n?void 0:n.pl)&&void 0!==i?i:null}return{...e,pl:u,plBasedOnLast:r.calculatePLUsingLast||!1,price:Math.abs((0,s.ensureDefined)(c)),qtyBySide:Math.abs(e.qty)*(1===e.side?1:-1),supportClose:Boolean(o?r.supportCloseIndividualPosition&&d:r.supportClosePosition),supportReverse:Boolean(!o&&r.supportReversePosition),supportBrackets:a,supportOnlyPairBrackets:Boolean(r.supportOnlyPairPositionBrackets),supportTrailingStop:(0,l.checkTrailingStopAvailability)(r)}}_firePositionUpdate(e,t){this._positionUpdate.fire({data:e,type:t})}_updateType(e){const t=this._positions.get(e.id);if(void 0===t)return d.Full;for(const i of Object.keys(t)){const s=i;if("pl"!==s&&"unrealizedPl"!==s&&t[s]!==e[s])return d.Full}return d.Partial}_logPositionUpdate(e,t){if(!t)return;const i=e.id;let s="update";this._existingPositionIds.has(i)||(s="add",this._existingPositionIds.add(i)),function(e,t){t(JSON.stringify(u(e)))}(e,(e=>{c.logNormal(`Position  ${s}: ${e}`)}))}}},767162:(e,t,i)=>{"use strict";function s(e){return Boolean(e.supportTrailingStop&&e.supportAddBracketsToExistingOrder)}function r(e,t=!0){const i=null!=e?e:0,s=t?Math.round(100*i)/100:i;return s>0?"positive":s<0?"negative":"neutral"}function n(e,t,i=!0){switch(r(t,i)){case"negative":return e.negativePlColor;case"positive":return e.positivePlColor;default:return e.text.textColor}}i.d(t,{checkTrailingStopAvailability:()=>s,profitLossTextColor:()=>n,profitStateByPL:()=>r})},936755:(e,t,i)=>{"use strict";i.d(t,{TradingInformer:()=>a,renderTradingInformer:()=>c});var s=i(50959),r=i(500962),n=i(546606);const o=s.lazy((async()=>({default:(await Promise.all([i.e(68992),i.e(81643),i.e(6937),i.e(54010)]).then(i.bind(i,898169))).TradingInformerImpl})));function a(e){const{informerMessage:t,className:i}=e;return s.createElement(s.Suspense,{fallback:null},s.createElement(o,{className:i,informerMessage:t}))}function l(e){const{informerMessage$:t}=e,i=(0,n.useObservable)(t);return s.createElement(a,{informerMessage:i})}function c(e,t){r.render(s.createElement(l,{informerMessage$:t}),e)}},355589:(e,t,i)=>{"use strict";i.d(t,{TradingLayoutBreakpoint:()=>r});var s=i(312282);const r={Mobile:s.mobile}},646417:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TradingToolipRenderer:()=>_,TradingWizardHintType:()=>c});var s=i(444372),r=i(500962),n=i(50959),o=i(12173),a=i(401387);function l(e){const{rootReference:t,onClose:i,placement:s}=e;return n.createElement(a.Popper,{placement:s||"top",strategy:"fixed",referenceElement:t,modifiers:[{name:"offset",options:{offset:[0,5]}},{name:"preventOverflow",options:{rootBoundary:"viewport"}}]},(t=>n.createElement(o.TooltipWizard,{
popperChildrenProps:t,onClose:i},e.children)))}var c,d=i(915812),u=i(385806),h=i(354496);function p(e){const t=(0,u.useOutsideEvent)({mouseDown:!0,touchStart:!0,handler:e.hide});return n.createElement("div",{className:h.wrapper,ref:t},e.text,e.action&&n.createElement(d.SquareButton,{className:h.button,size:"small",onClick:e.action.action},e.action.text))}!function(e){e[e.NeedBrokerSignIn=0]="NeedBrokerSignIn",e[e.NeedSignIn=1]="NeedSignIn",e[e.AboutFavoritesBrokers=2]="AboutFavoritesBrokers"}(c||(c={}));const g={loginAttention:s.t(null,void 0,i(566977)),needSignIn:s.t(null,void 0,i(224949)),aboutFavoritesBrokers:s.t(null,void 0,i(688117))};class _{constructor(){this._wrap=document.createElement("div"),this.hide=()=>{r.unmountComponentAtNode(this._wrap)}}show(e,t,i,s){this.hide();r.render(n.createElement(l,{rootReference:e,onClose:i?void 0:()=>{this.hide()},placement:s},this._generateHintContent(t,i)),this._wrap)}destroy(){this.hide()}_generateHintContent(e,t){let i="";switch(e){case c.NeedSignIn:i=g.needSignIn;break;case c.NeedBrokerSignIn:i=g.loginAttention;break;case c.AboutFavoritesBrokers:i=g.aboutFavoritesBrokers}return n.createElement(p,{hide:this.hide,text:i,action:t})}}},160405:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Trading:()=>Rs,showSellBuyButtonsDefault:()=>Vs});var s=i(650151),r=i(444372),n=i(62802),o=i(799786),a=i(470316),l=i(421448),c=i(150335),d=i(947488),u=i(323002),h=i(997345),p=i(586639),g=i(275734),_=i(757604),m=i(357590),b=i(114501),v=i(839874),y=i(196573),f=i(423869),w=i(199356),k=i(18808),S=i(593804),P=i(217504),C=i(17980),B=i(201089),T=i(167975),E=i(261926),O=i(77122),I=i(941838),x=i(66732),N=i(129025),V=i(707957),L=i(794349);var A=i(266325),M=i(863626),D=i(803374),R=i(862963),W=i(866193),F=i(890466),H=i(454984);const q=(0,B.getLogger)("Trading.RealtimeProvider");class ${constructor(e){this._results={},this._getter=e}get(e){return this._results[e]||(this._results[e]=this._getter(e)),this._results[e]}}class z{constructor(e){this._stopped=!1,this._subscribed=!1,this._provider=null,this._formatters=null;const{symbol:t,callback:i,providersCache:s,formattersCache:r,subscriptionType:n,actualSymbolGetter:o}=e;this._symbol=t,this._subscriptionType=n,this._callback=i,this._providersCache=s,this._formattersCache=r,this._getActualSymbol=o,"Realtime"===this._subscriptionType?this._handler=(e,t)=>{this._stopped||i(e,t,this._formatters)}:this._handler=(e,t)=>{this._stopped||i(e,t)},this._start().catch((e=>{}))}symbol(){return this._symbol}type(){return this._subscriptionType}callback(){return this._callback}destroy(){this._ensureNotStopped(),this._subscribed&&void 0!==this._actualSymbol&&("Realtime"===this._subscriptionType?(0,s.ensureNotNull)(this._provider).unsubscribeRealtime(this._actualSymbol,this._handler):(0,s.ensureNotNull)(this._provider).unsubscribeDOM(this._actualSymbol,this._handler)),this._stopped=!0}async _start(){const{symbol:e}=await this._getActualSymbol(this._symbol);this._ensureNotStopped(),this._provider=await this._providersCache.get(e),this._ensureNotStopped(),
this._formatters=await this._formattersCache.get(e),(0,s.ensure)(this._formatters),this._ensureNotStopped(),this._actualSymbol=e,this._subscribed=!0,"Realtime"===this._subscriptionType?this._provider.subscribeRealtime(e,this._handler):this._provider.subscribeDOM(e,this._handler)}_ensureNotStopped(){(0,s.assert)(!this._stopped,"Should not be stopped")}}class U{constructor(e,t,i,s){this.onStatusChanged=new V.Delegate,this._subscriptions=[],this._currentBroker=null,this._activeBrokerGetter=e,this._actualSymbolGetter=s,t.subscribe(this,this._connectionStatusChanged),i.subscribe(this,this._connectionStatusChanged),this._tvProvider=new F.BrokerRealtimeAdapter("RealtimeProvider"),this._connectionStatusChanged()}isTradable(e){return this._tradableCache.get(e)}subscribeRealtime(e,t){this._subscriptions.some((i=>i.symbol()===e&&i.callback()===t&&"Realtime"===i.type()))||this._subscriptions.push(new z({symbol:e,callback:t,providersCache:this._providersCache,formattersCache:this._formattersCache,subscriptionType:"Realtime",actualSymbolGetter:this._actualSymbolGetter}))}unsubscribeRealtime(e,t){const i=this._subscriptions.findIndex((i=>i.symbol()===e&&i.callback()===t&&"Realtime"===i.type()));if(-1===i)return;this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)}subscribeDOM(e,t){this._subscriptions.some((i=>i.symbol()===e&&i.callback()===t&&"DOM"===i.type()))||this._subscriptions.push(new z({symbol:e,callback:t,providersCache:this._providersCache,formattersCache:this._formattersCache,subscriptionType:"DOM",actualSymbolGetter:this._actualSymbolGetter}))}unsubscribeDOM(e,t){const i=this._subscriptions.findIndex((i=>i.symbol()===e&&i.callback()===t&&"DOM"===i.type()));if(-1===i)return void q.logWarn("Subscription not found");this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)}formatter(e){return this._formattersCache.get(e).then((e=>e.formatter))}spreadFormatter(e){return this._formattersCache.get(e).then((e=>e.spreadFormatter))}quantityFormatter(e){return this._formattersCache.get(e).then((e=>e.quantityFormatter))}symbolInfo(e){if(!e){const e={minTick:NaN,qty:{min:NaN,max:NaN,step:NaN},pipValue:NaN,pipSize:NaN,description:"no symbol"};return Promise.resolve(e)}return this._providersCache.get(e).then((t=>t!==this._tvProvider?t.symbolInfo(e).then((t=>t||this._tvProvider.symbolInfo(e))).catch((t=>this._tvProvider.symbolInfo(e))):this._tvProvider.symbolInfo(e)))}quotesSnapshot(e){return this._providersCache.get(e).then((t=>t.quotesSnapshot(e)))}activeBroker(){return null!==this._currentBroker&&this._currentBroker!==this._tvProvider?this._currentBroker:null}_isTradable(e){if(null===this._currentBroker||this._currentBroker===this._tvProvider)return Promise.resolve({tradable:!1});try{return(0,H.makeTimeLimited)(this._currentBroker.isTradable(e),6e4,"isTradable Promise Timeout").catch((()=>Promise.resolve({tradable:!1})))}catch(e){return Promise.resolve({tradable:!1})}}_haveRealtime(e){return this._tradableCache.get(e)||Promise.resolve(null===this._currentBroker)}_connectionStatusChanged(){
const e=this._activeBrokerGetter(),t=this._currentBroker,i=e&&1===e.connectionStatus()?e:null;if(this._createCaches(),t!==i){const e=this._subscriptions.map((e=>({symbol:e.symbol(),callback:e.callback(),type:e.type()})));this._unsubscribeAll(),this._currentBroker=i,this._subscribeAll(e),this.onStatusChanged.fire()}}_createCaches(){this._providersCache=new $((e=>this._provider(e))),this._tradableCache=new $((e=>this._isTradable(e))),this._formattersCache=new $((e=>this._providersCache.get(e).then((t=>Promise.all([t.formatter(e,!1),t.spreadFormatter(e),t.quantityFormatter(e)]))).then((([e,t,i])=>({formatter:e,spreadFormatter:t,quantityFormatter:i})))))}_provider(e){return this._haveRealtime(e).then((e=>e.tradable&&this._currentBroker&&1===this._currentBroker.connectionStatus()?this._currentBroker:this._tvProvider))}_unsubscribeAll(){this._subscriptions.forEach((e=>{e.destroy()})),this._subscriptions=[]}_subscribeAll(e){e.forEach((e=>{this._subscriptions.push(new z({symbol:e.symbol,callback:e.callback,providersCache:this._providersCache,formattersCache:this._formattersCache,subscriptionType:e.type,actualSymbolGetter:this._actualSymbolGetter}))}))}}var Q=i(776734),j=i(842741);class G extends j.BrokerService{constructor(e){super(e),this._userId=(window.user.id||"").toString(),window.loginStateChange&&window.loginStateChange.subscribe(this,this._onLoginStateChange)}trackOrderPlaced(e){this._trackOrderEvent("Placed",e)}trackOrderModified(e){this._trackOrderEvent("Modified",e)}startService(){(0,s.ensure)(this.activeBroker()).orderUpdate.subscribe(this,this._orderUpdate),this._trackTradingBrokerConnnected()}stopService(){(0,s.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)}_orderUpdate(e,t){t||(5===e.status?this._trackOrderEvent("Rejected",e):2===e.status?this._trackOrderEvent("Executed",e):1===e.status&&this._trackOrderEvent("Canceled",e))}async _trackOrderEvent(e,t){var i;const s=this.trading().linking().value(),r=this.activeBroker();if(void 0===t||null===r)return;const n=await r.symbolInfo(t.symbol),o=t.qty*(n.lotSize||1),a="Placed"===e&&void 0!==s.continuous&&s.symbol===t.symbol?"continuous":n.type,l={amount:o,orderId:t.id,instrumentType:a,eventName:"Order "+e,userId:this._userId,symbol:t.symbol,currency:null!==(i=n.currency)&&void 0!==i?i:null};this._trackTradingOrder(l)}_trackTradingOrder(e){const t=this.activeBroker();if(!t)throw new Error("no active broker");const i=t.metainfo().id,s=t.currentAccountType()||"";(0,Q.getTracker)().then((t=>{var r;if(null===t)return;const n=e.instrumentType||"",o=String(null!==(r=e.orderId)&&void 0!==r?r:"");t.trackTradingOrder({event:e.eventName,broker_id:i,symbol_name:e.symbol,instrument_type:"bitcoin"===n?"crypto":n,amount:Math.min(e.amount,1e15),account_type:s,user_id:e.userId,order_id:o,currency:e.currency})}))}_trackTradingBrokerConnnected(){const e=this.activeBroker(),t=null!==e&&"Paper"===e.metainfo().id;if(!e)throw new Error("no active broker");if(!e.loggedInManually()&&t)return;const i=e.metainfo().id,s=e.currentAccountType()||"",r=this._userId;(0,
Q.getTracker)().then((e=>{null!==e&&this._lastBrokerId!==i&&(this._lastBrokerId=i,e.trackTradingBrokerConnnected(i,s,r))}))}_onLoginStateChange(){this._userId=(window.user.id||"").toString()}}var K=i(410864),J=i(239401),Z=i(5488),X=i(824851),Y=i(345848),ee=i(125226);function te(e="default"){switch(e){case"danger":return K.ToastIntent.Danger;case"attention":return K.ToastIntent.Warning;case"success":return K.ToastIntent.Success;default:return K.ToastIntent.Default}}class ie{constructor(e){this._chartWidgetCollection=e}showTradingProperties(){this._chartWidgetCollection.activeChartWidget.value().showGeneralChartProperties(L.TabNames.trading)}async closeAllNotifications(){const e=await this._chartWidgetCollection.getToasts();null!==e&&e.reset()}async showNotification(e,t,i,s){const r=await this._chartWidgetCollection.getToasts();if(null===r)return;let n="";"string"==typeof t&&(n=t),r.showSimpleToast({text:n,time:s,title:e,intent:te(i),priority:J.ToastPriority.Low})}showMaintenance(e){Z.maintenance.show(e)}showBrokerSideMaintenance(e){X.brokerSideMaintenance.show(e)}trackEvent(e,t,i){!async function(e,t,i){if((0,ee.isFeatureEnabled)("trading_general_events_ga_tracking")&&(0,Y.trackEvent)(e,t,i),(0,ee.isFeatureEnabled)("trading_general_events_snowplow_tracking")){const s=await(0,Q.getTracker)();null==s||s.trackTradingEvent(e,t,i)}}(e,t,i)}showReplayConfirmationDialog(){return this._chartWidgetCollection.activeChartWidget.value().showReplayOrderConfirmationDialog()}reconnectChartApi(e){this._chartWidgetCollection.reconnectChartApi(e)}setBroker(e){const t=(null==e?void 0:e.metainfo().backendBrokerName)||(null==e?void 0:e.metainfo().id.toLowerCase())||"";this._chartWidgetCollection.setBroker(t)}}var se=i(588929),re=(i(586463),i(460670));async function ne(e){const{showErrorNotification:t,handler:s,message:n,onOpen:o,onClose:a,abortSignal:l}=e;if(!await(0,re.showConfirmDialog)({title:r.t(null,void 0,i(424356)),content:n,mainButtonText:r.t(null,void 0,i(424356)),cancelButtonText:r.t(null,void 0,i(620036)),onOpen:o,onClose:a,abortSignal:l,showErrorNotification:t}))return!1;try{return await s()}catch(e){return t(r.t(null,void 0,i(791401)),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(e)),!1}}var oe=i(941012),ae=i(158432),le=i(627181),ce=i(919346),de=i(909740),ue=i(272127),he=i(627687),pe=i(816105);async function ge(e,t,s,n){const o=await async function(e,t){const{PartiallyClosingDialogRenderer:s}=await i.e(63168).then(i.bind(i,522419)),r=new s;return new Promise(((i,s)=>{(null==t?void 0:t.aborted)?i({status:!1}):(r.open({...e,dialogActionHandler:i}),null==t||t.addEventListener("abort",(()=>{r.close(),i({status:!1})}),{once:!0}))}))}(e,n);if(!o.status)return!1;try{return await t(o.qty)}catch(e){return s(r.t(null,void 0,i(791401)),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(e)),!1}}var _e=i(321873);const me={async show(e){const t=r.t(null,{replace:{symbol:e}},i(97929)),s=r.t(null,{replace:{symbol:e}
},i(469497));return(0,_e.showSimpleConfirmDialog)({title:s,text:t})}},be={async show(e){const t=r.t(null,{replace:{symbol:e}},i(965603)),s=r.t(null,{replace:{symbol:e}},i(447600));return(0,_e.showSimpleConfirmDialog)({title:s,text:t})}};var ve=i(50959),ye=i(333730);function fe(e){const{symbol:t,side:s,qty:n,price:o,id:a,closePositionCancelsOrders:l}=e,c=(0,ye.splitThousands)(n," "),d=(0,ye.splitThousands)(o," ");return ve.createElement(ve.Fragment,null,ve.createElement("div",null,void 0!==a?r.t(null,void 0,i(170392)).replace("{id}",a):r.t(null,void 0,i(381617))),ve.createElement("div",null,ve.createElement("b",null,t)),ve.createElement("div",null,ve.createElement("b",null,`${s} ${c} @ ${d}`)),ve.createElement("div",null,l&&` ${r.t(null,void 0,i(218329))}`))}var we=i(675295);const ke=(0,B.getLogger)("Trading.BrokerCommandsUI"),Se={symbol:1,qty:1,side:1,type:1,seenPrice:1};class Pe{constructor({activeBroker:e,guiAccessor:t,noConfirmEnabled:i,orderViewController:s,showErrorNotification:r,trackEvent:n,tradingLinking:o,abortSignalGetter:a}){this._closePositionDialogVisibility=new M.DialogVisibility,this._isClosePositionDialogLoading=!1,this._isCloseIndividualPositionDialogLoading=!1,this._onClosePositionDialogOpen=e=>{this._closePositionDialogVisibility.setValue({isVisible:!0,isFullScreen:e})},this._onClosePositionDialogClose=()=>{this._closePositionDialogVisibility.setValue({isVisible:!1})},this._tradingLinking=o,this._activeBroker=e,this._guiAccessor=t,this._orderViewController=s,this._showErrorNotification=r,this._noConfirmEnabled=i,this._trackEvent=n,this._getAbortSignal=a,this.closePositionDialogVisibility=this._closePositionDialogVisibility.value$}async placeOrder(e,t,s){const n=t&&this._noConfirmEnabled.value(),o=this._guiAccessor&&n?this._guiAccessor.showReplayConfirmationDialog():Promise.resolve(!1);try{await o}catch(e){Promise.resolve(!1)}const a=await this._activeBroker.isTradable(e.symbol);if(!(n&&a.tradable&&function(e){for(const t in Se)if(!(t in e))return!1;return!0}(e)))return a.tradable?this._orderViewController().then((t=>this._activeBroker?t.showOrderView({order:e,focus:void 0,forceOrderDialog:s}):Promise.reject("Broker connection adapter is null"))):(async function(e){var t;const{isTradableResult:s,activeBroker:n,abortSignal:o}=e,a=await(0,ue.prepareTradableSolution)(s,n),[{showSimpleDialog:l},{SimpleConfirmDialog:c}]=await Promise.all([Promise.all([i.e(22666),i.e(34465),i.e(32109),i.e(9817),i.e(69121),i.e(92108),i.e(66639),i.e(88194),i.e(93502),i.e(36884),i.e(5145),i.e(38669),i.e(30006),i.e(25190),i.e(26855),i.e(43610),i.e(96899),i.e(24215),i.e(67118),i.e(82601),i.e(745),i.e(45553),i.e(3566)]).then(i.bind(i,32386)),Promise.all([i.e(22666),i.e(34465),i.e(32109),i.e(9817),i.e(69121),i.e(92108),i.e(66639),i.e(88194),i.e(93502),i.e(36884),i.e(5145),i.e(38669),i.e(30006),i.e(25190),i.e(26855),i.e(43610),i.e(96899),i.e(24215),i.e(67118),i.e(82601),i.e(745),i.e(45553),i.e(3566)]).then(i.bind(i,594821))]);if(null==o?void 0:o.aborted)return;const d=l({
text:null!==(t=s.reason)&&void 0!==t?t:r.t(null,void 0,i(265914)),title:r.t(null,void 0,i(69208)),titleIcon:de.watchedTheme.value()===ce.StdTheme.Light?he:pe,mainButtonText:void 0!==a?a.title:r.t(null,void 0,i(468988)),mainButtonIntent:"primary",showCancelButton:!1,onConfirm:e=>{void 0!==a&&a.apply(),e.dialogClose()}},c);null==o||o.addEventListener("abort",(()=>d()),{once:!0})}({isTradableResult:a,activeBroker:this._activeBroker,abortSignal:this._getAbortSignal()}),!1);{const t=await this._activeBroker.createPlaceOrderContext(e,"instant");try{return await t.send()}finally{t.destroy()}}}async modifyOrder(e,t,i,s){if(t&&this._noConfirmEnabled.value()&&1===e.parentType){const t=await this._activeBroker.createEditOrderContext(e,"instant");try{return await t.send()}finally{t.destroy()}}return this._modifyOrder(e,t,i,s)}async closePosition(e){var t,i;if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),!1;if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),!1;if(this._makeSureBrokerIsConnected(),this._isClosePositionDialogLoading)return!1;let s,r;this._isClosePositionDialogLoading=!0;try{if(s=await this._activeBroker.positionById(e),void 0===s)return!1;const{tradable:t}=await this._activeBroker.isTradable(s.symbol);if(await this._assertPositionExistsAndNotClosed(s.id),!t)return this._closePositionForNonTradableSymbol(s);if(this._noConfirmEnabled.value())return this._activeBroker.closePosition(e);r=await this._obtainPositionClosingData(s)}finally{this._isClosePositionDialogLoading=!1}if(void 0===r)return!1;const{supportPartialClosePosition:n,...o}=r,a=this._activeBroker.metainfo();if(void 0!==(null===(t=a.customUI)||void 0===t?void 0:t.showClosePositionDialog))return null===(i=a.customUI)||void 0===i?void 0:i.showClosePositionDialog(s);if(n){const t=t=>(t!==(null==s?void 0:s.qty)?this._trackEvent("","Close Position Dialog","partial"):this._trackEvent("","Close Position Dialog","full"),this._activeBroker.closePosition(e,t));return ge({...o,positionOrIndividualPosition:s,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose},t,this._showErrorNotification,this._getAbortSignal())}{const t=()=>this._activeBroker.closePosition(e);return ne({showErrorNotification:this._showErrorNotification,handler:t,message:r.message,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose,abortSignal:this._getAbortSignal()})}}async closeIndividualPosition(e){if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),!1;if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),!1;if(this._makeSureBrokerIsConnected(),(0,s.assert)(!!this._activeBroker.config.supportPositionNetting,"Broker doesn`t support individual positions"),this._noConfirmEnabled.value())return this._activeBroker.closeIndividualPosition(e);{if(this._isCloseIndividualPositionDialogLoading)return!1
;const t=await this._obtainIndividualPositionClosingData(e);if(void 0===t)return!1;const{supportPartialCloseIndividualPosition:i,individualPosition:s,...r}=t;if(i){const t=async t=>(t!==s.qty?this._trackEvent("","Close Individual Position Dialog","partial"):this._trackEvent("","Close Individual Position Dialog","full"),this._activeBroker.closeIndividualPosition(e,t));return ge({...r,positionOrIndividualPosition:s,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose},t,this._showErrorNotification,this._getAbortSignal())}return ne({showErrorNotification:this._showErrorNotification,handler:()=>this._activeBroker.closeIndividualPosition(e),message:t.message,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose,abortSignal:this._getAbortSignal()})}}editPositionBrackets(e,t,i,r){return this._isMaintenance()?(this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):this._isBrokerSideMaintenance()?(this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):(this._makeSureBrokerIsConnected(),(0,s.assert)(!!this._activeBroker.config.supportPositionBrackets,"Broker doesn`t support brackets on positions"),r&&this._noConfirmEnabled.value()?this._activeBroker.editPositionBrackets(e,null!=t?t:{}):this._activeBroker.positionById(e).then((e=>this._activeBroker?this._showPositionDialog((0,s.ensureDefined)(e),t,i):Promise.reject("Broker connection adapter is null"))))}editIndividualPositionBrackets(e,t,i,r){return r&&this._noConfirmEnabled.value()?this._activeBroker.editIndividualPositionBrackets(e,null!=t?t:{}):this._activeBroker.individualPositionById(e).then((e=>this._activeBroker?this._showIndividualPositionDialog((0,s.ensureDefined)(e),t,i):Promise.reject("Broker connection adapter is null")))}reversePosition(e){return this._isMaintenance()?(this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):this._isBrokerSideMaintenance()?(this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):(this._makeSureBrokerIsConnected(),this._activeBroker.metainfo().configFlags.supportMultiposition&&!this._activeBroker.config.supportNativeReversePosition?Promise.reject("Cannot reverse position on multiposition acount"):this._noConfirmEnabled.value()?this._activeBroker.reversePosition(e):this._activeBroker.positionById(e).then((t=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const i=this._activeBroker.reversePosition.bind(this._activeBroker,e);return(0,oe.reversePositionDialog)({positionId:e,showErrorNotification:this._showErrorNotification,handler:i,closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders,abortSignal:this._getAbortSignal()})})))}async cancelOrder(e){var t,i;if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)
;if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);this._makeSureBrokerIsConnected();const s=await this._activeBroker.orderById(e);if(void 0===s)return Promise.reject("Failed to find order");const{tradable:r}=await this._activeBroker.isTradable(s.symbol);if(await this._assertOrderExistsAndNotCanceled(s.id),!r)return this._cancelOrderForNonTradableSymbol(s.symbol,s.id);if(this._noConfirmEnabled.value())return this._activeBroker.cancelOrder(e);{const r=this._activeBroker.cancelOrder.bind(this._activeBroker,e),n=this._activeBroker.metainfo();if(void 0!==(null===(t=n.customUI)||void 0===t?void 0:t.showCancelOrderDialog))return null===(i=n.customUI)||void 0===i?void 0:i.showCancelOrderDialog(s);if(s.parentId){const e=(await this._activeBroker.orders()).filter((e=>e.refNumber===s.refNumber));return n.configFlags.supportCancellingBothBracketsOnly&&e.length>1?this._showCancelMultipleBracketsDialog(s.parentId,r):this._showCancelBracketsDialog(s.id,r)}return this._showCancelOrderDialog(s.id,r)}}cancelOrders(e,t){return this._isMaintenance()?(this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):this._isBrokerSideMaintenance()?(this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):(this._makeSureBrokerIsConnected(),this._activeBroker.orders().then((i=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const s=i.filter((i=>i.symbol===e&&(!t||i.side===t)&&function(e){return 4===e.status||3===e.status||6===e.status}(i)));if(!s.length)return Promise.resolve(!1);if(1===s.length)return this.cancelOrder(s[0].id);const r=s.map((e=>e.id));if(this._noConfirmEnabled.value())return this._activeBroker.cancelOrders(e,t,r);{const i=this._activeBroker.cancelOrders.bind(this._activeBroker);return this._showCancelMultipleOrdersDialog(e,t,r,i)}})))}async _modifyOrder(e,t,s,n){const o=this._activeBroker.metainfo();if(this._isMaintenance())return this._guiAccessor.showMaintenance(o.title),Promise.resolve(!1);if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(o.title),Promise.resolve(!1);if(!o.configFlags.supportModifyTrailingStop){const t=(await this._activeBroker.orders()).find((t=>t.id===e.id));void 0!==t&&void 0!==t.trailingStopPips?e.hasTrailingStopBracket=!0:e.hasTrailingStopBracket=!1}if(this._makeSureBrokerIsConnected(),e.flags&&e.flags.trailingStop)return ke.logError("Attempt to modify trailing stop loss order"+e.id),this._showErrorNotification(r.t(null,void 0,i(292559)),r.t(null,void 0,i(507214))),Promise.resolve(!1);await this._setSymbol(e.symbol);const a=await this._activeBroker.symbolInfo(e.symbol);e.limitPrice=void 0!==a.limitPriceStep&&void 0!==e.limitPrice?(0,C.roundToStepByPriceTypeAndSide)(e.limitPrice,a.limitPriceStep,1,e.side):e.limitPrice,e.stopPrice=void 0!==a.stopPriceStep&&void 0!==e.stopPrice?(0,C.roundToStepByPriceTypeAndSide)(e.stopPrice,a.stopPriceStep,2,e.side):e.stopPrice
;const l=e.limitPrice,c=e.stopPrice,d=e.stopType,u=t&&this._noConfirmEnabled.value();let h=s||(1===e.type?1:2);if(e.parentId&&!O.enabled("always_pass_called_order_to_modify")){let t,i=this._activeBroker.orderById.bind(this._activeBroker);2===e.parentType&&(i=this._activeBroker.positionById.bind(this._activeBroker)),3===e.parentType&&(i=this._activeBroker.individualPositionById.bind(this._activeBroker));try{t=await i(e.parentId)}catch(e){t=void 0}if(t){h=s||(1===e.type?3:4);const i={takeProfit:l};if(d===se.StopType.TrailingStop?i.trailingStopPips=e.trailingStopPips:i.stopLoss=c,u&&(i.takeProfit=i.takeProfit||t.takeProfit,i.stopLoss=i.stopLoss||t.stopLoss,i.trailingStopPips=i.trailingStopPips||t.trailingStopPips),3===e.parentType)return u?this._activeBroker.editIndividualPositionBrackets(t.id,i):this._showIndividualPositionDialog(t,i,h);if(2===e.parentType&&e.qty===Math.abs(t.qty))return u?this._activeBroker.editPositionBrackets(t.id,i):this._showPositionDialog(t,i,h);const r=t;(0,k.isOrderActive)(r.status)&&(e=Object.assign({},r),l&&(e.takeProfit=l),c&&(d===se.StopType.TrailingStop?e.trailingStopPips=i.trailingStopPips||e.trailingStopPips:e.stopLoss=c))}}return u?this._activeBroker.modifyOrder(e):this._orderViewController().then((t=>this._activeBroker?t.showOrderView({order:e,focus:h,forceOrderDialog:n}):Promise.reject("Broker connection adapter is null")))}async _setSymbol(e){this._tradingLinking.value().symbol!==e&&await this._tradingLinking.setSymbol(e)}_makeSureBrokerIsConnected(){(0,s.assert)(1===this._activeBroker.connectionStatus(),"Broker is not connected")}async _showPositionDialog(e,t={},s){await this._setSymbol(e.symbol);const n=await this._activeBroker.isTradable(e.symbol);if(!n.tradable){const t=void 0!==n.reason?n.reason:(0,C.makeNonTradableSymbolText)(e.symbol,this._activeBroker.metainfo().title);return this._showErrorNotification(r.t(null,void 0,i(326704)),t),Promise.resolve(!1)}return this._orderViewController().then((i=>this._activeBroker?i.showPositionView(e,{stopLoss:t.stopLoss,takeProfit:t.takeProfit,trailingStopPips:t.trailingStopPips},s||e.limitPrice&&3||e.stopPrice&&4):Promise.reject("Broker connection adapter is null")))}async _showIndividualPositionDialog(e,t={},i){return await this._setSymbol(e.symbol),this._orderViewController().then((s=>this._activeBroker?s.showIndividualPositionView(e,{stopLoss:t.stopLoss,takeProfit:t.takeProfit,trailingStopPips:t.trailingStopPips},i||e.limitPrice&&3||e.stopPrice&&4):Promise.reject("Broker connection adapter is null")))}_isMaintenance(){return(0,ee.isFeatureEnabled)((0,k.makeMaintananceFeatureToggleName)(this._activeBroker.metainfo().id))}_isBrokerSideMaintenance(){return(0,ee.isFeatureEnabled)((0,k.makeBrokerSideMaintananceFeatureToggleName)(this._activeBroker.metainfo().id))}_showCancelOrderDialog(e,t){return ae.ConfirmOrderCancelDialog.get().open(e,this._getAbortSignal()).then((i=>i?t(e):Promise.resolve(!1)))}_showCancelMultipleOrdersDialog(e,t,i,s){const r=i.length
;return ae.ConfirmOrderCancelDialog.get().multiple(e,t,r,this._getAbortSignal()).then((r=>r?s(e,t,i):Promise.resolve(!1)))}async _showCancelBracketsDialog(e,t){return le.ConfirmBracketsCancelDialog.get().open(e,this._getAbortSignal()).then((i=>i?t(e):Promise.resolve(!1)))}_showCancelMultipleBracketsDialog(e,t){return le.ConfirmBracketsCancelDialog.get().multiple(e,this._getAbortSignal()).then((i=>i?t(e):Promise.resolve(!1)))}async _obtainPositionClosingData(e){try{const{supportLots:t,qtyStep:s,uiQtyStep:n,minQty:o,qtyLabel:a,qtyFormatter:l,priceFormatter:c}=await this._obtainPositionOrIndividualPositionClosingCommonData(e),d=this._activeBroker.metainfo().configFlags.supportPartialClosePosition,u=fe({symbol:e.symbol,side:1===e.side?r.t(null,void 0,i(273064)):r.t(null,void 0,i(777851)),qty:l.format(e.qty),price:c.format(e.avgPrice),closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders});return{position:e,supportLots:t,qtyStep:s,uiQtyStep:n,minQty:o,qtyLabel:a,supportPartialClosePosition:d,qtyFormatter:l,message:u}}catch(e){return}}async _obtainIndividualPositionClosingData(e){try{this._isCloseIndividualPositionDialogLoading=!0;const t=(0,s.ensureDefined)(await this._activeBroker.individualPositionById(e)),{supportLots:n,qtyStep:o,uiQtyStep:a,minQty:l,qtyLabel:c,qtyFormatter:d,priceFormatter:u}=await this._obtainPositionOrIndividualPositionClosingCommonData(t),h=this._activeBroker.metainfo().configFlags.supportPartialCloseIndividualPosition,p=fe({symbol:t.symbol,side:1===t.side?r.t(null,void 0,i(273064)):r.t(null,void 0,i(777851)),qty:d.format(t.qty),price:u.format(t.price),id:e,closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders});return this._isCloseIndividualPositionDialogLoading=!1,{individualPosition:t,supportLots:n,qtyStep:o,uiQtyStep:a,minQty:l,qtyLabel:c,supportPartialCloseIndividualPosition:h,qtyFormatter:d,message:p}}catch(e){return void(this._isCloseIndividualPositionDialogLoading=!1)}}async _obtainPositionOrIndividualPositionClosingCommonData(e){const t=await this._activeBroker.symbolInfo(e.symbol),i=void 0!==t.lotSize,s=t.qty.step,r=t.qty.uiStep,n=t.qty.min,o=t.units;return{supportLots:i,qtyStep:s,uiQtyStep:r,minQty:n,qtyFormatter:await this._activeBroker.quantityFormatter(e.symbol),priceFormatter:await this._activeBroker.formatter(e.symbol,!1),qtyLabel:o}}async _closePositionForNonTradableSymbol(e){const{supportClosePositionForNonTradableSymbol:t,supportClosePosition:s}=this._activeBroker.metainfo().configFlags;if(!t||!s){const t=r.t(null,{replace:{symbol:e.symbol}},i(946305));return this._showErrorNotification(t,r.t(null,void 0,i(348434))),!1}return!!await me.show(e.symbol)&&this._activeBroker.closePosition(e.id)}async _cancelOrderForNonTradableSymbol(e,t){if(!this._activeBroker.metainfo().configFlags.supportCancelOrderForNonTradableSymbol){const t=r.t(null,{replace:{symbol:e}},i(993545));return this._showErrorNotification(t,r.t(null,void 0,i(30665))),!1}return!!await be.show(e)&&this._activeBroker.cancelOrder(t)}
async _assertPositionExistsAndNotClosed(e){const t=await this._activeBroker.positionById(e);if(!(0,k.checkIsExistingPosition)(t))throw new we.UserFriendlyError({userFriendlyMessage:r.t(null,{replace:{positionId:e}},i(969233)),detailedErrorMessage:`Position ${e} doesn't exist or has already been closed`})}async _assertOrderExistsAndNotCanceled(e){const t=await this._activeBroker.orderById(e);if(void 0===t||1===t.status)throw new we.UserFriendlyError({userFriendlyMessage:r.t(null,{replace:{orderId:e}},i(579287)),detailedErrorMessage:`Order ${e} doesn't exist or has already been canceled`})}}class Ce{constructor(e,t,i,s,r,n){this._domPanel=null,this._resizerBridge=e,this._trading=i,this._qtySuggester=s,this._tradingLinking=r,this._headerState=n,this._getDOMPanel=(0,E.sequentialize)(this._getDOMPanel),this._close=()=>{this.unmount(),t()}}mount(){return this._getDOMPanel().then((e=>{e.setVisibility(!0)}))}unmount(){this._getDOMPanel().then((e=>{e.setVisibility(!1)}))}headerStateValue(){return this._headerState}async _getDOMPanel(){if(null!==this._domPanel)return this._domPanel;const{DOMPanel:e}=await Promise.all([i.e(23993),i.e(34465),i.e(72639),i.e(69121),i.e(88194),i.e(87845),i.e(13152),i.e(84281),i.e(45896),i.e(6209),i.e(60123),i.e(47047),i.e(89434),i.e(18511),i.e(50075),i.e(40155),i.e(79244),i.e(88992),i.e(68985),i.e(58431),i.e(41850),i.e(2595),i.e(44627)]).then(i.bind(i,879865)),t=this._domPanel=new e(this._trading,this._resizerBridge,this._qtySuggester,this._tradingLinking,this._headerState);return t.setCloseHandler(this._close),t}}class Be{constructor(e){this._headerState=e}mount(){return Promise.resolve()}unmount(){}headerStateValue(){return this._headerState}}var Te=i(834075),Ee=i(969561),Oe=i(500962),Ie=i(319796),xe=i(94021),Ne=i(546606),Ve=i(31341),Le=i(396789);function Ae(e){const{items:t,activeTabId:i,isVisible$:s,onSelect:r}=e,n=(0,Ne.useObservable)(s),o=(0,ve.useCallback)((e=>e.id===i),[i]),a=(0,ve.useCallback)((e=>{const t=e.id;r(t),(0,Y.trackEvent)("GUI",t===D.TradingPage.OrderPanel?"Select Order Tab":"Select DOM Tab")}),[r]);return n?ve.createElement(ve.Fragment,null,ve.createElement(xe.LightTabs,{id:"trading-panel-page-tabs",classNameWrap:Le.tabs,items:t,isRtl:Ve.isRtl,isActive:o,onActivate:a}),ve.createElement(Ie.Divider,{className:Le.divider,size:"xsmall"})):ve.createElement(ve.Fragment,null)}var Me=i(483830);const De=O.enabled("show_order_panel_on_start");class Re{constructor(e,t){this.isOpened=new N.WatchedValue(!1),this.isOpeningAvailable=new N.WatchedValue(!1),this.isLoading=new N.WatchedValue(!1),this._pageTabs=null,this._pages={},this._panelWidth=D.minPanelWidth,this.setPage=e=>{this.isOpened.value()&&this.activePage.value()!==e&&this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),this.activePage.setValue(e),n.setValue(W.settingsKeys.TRADING_PANEL_ACTIVE_PAGE,e)},this.openPage=e=>{this.setPage(e),this.open()},this.open=()=>{const e=this._pages[this.activePage.value()];if(this.isOpeningAvailable.value()&&e){this._togglePanel(!0),this.isOpened.setValue(!0)
;const s=e.headerStateValue();(0,Ee.mountHeader)(this._header,s),null!==this._tabsConfig&&null!==this._pageTabs&&(t=this._pageTabs,i={items:this._tabsConfig.items,activeTabId:this.activePage.value(),isVisible$:s.backFunction$.pipe((0,h.map)((e=>void 0===e))),onSelect:this._tabsConfig.onSelect},Oe.render(ve.createElement(Ae,{...i}),t)),e.mount()}var t,i},this.close=()=>{this.isOpened.setValue(!1),this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),(0,Ee.unmountHeader)(this._header),this._togglePanel(!1)},this._onLayoutResizeHandleMousedown=e=>{if(e.defaultPrevented||!e.cancelable)return;e.preventDefault();const t=Math.max(this._resizerBridge.width.value(),0);let i;i="touches"in e?e.touches[0].clientX:e.clientX;const s=e=>{let s;e.preventDefault(),s="touches"in e?e.touches[0].clientX:e.clientX;let r=t-(s-i);r<D.minPanelWidth?r=D.minPanelWidth:r>D.maxPanelWidth&&(r=D.maxPanelWidth),this._requestWidth(r)},r=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("touchmove",s),document.removeEventListener("mouseup",r),document.removeEventListener("touchend",r),n.setValue(W.settingsKeys.PANEL_WIDTH,this._panelWidth)};document.addEventListener("mousemove",s),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("mouseup",r),document.addEventListener("touchend",r,{passive:!1})};const i=n.getValue(W.settingsKeys.TRADING_PANEL_ACTIVE_PAGE,O.enabled("order_panel")?D.TradingPage.OrderPanel:D.TradingPage.DOMPanel);if(this.activePage=new N.WatchedValue(i),window.is_authenticated&&!(0,Te.isMobileTradingAvailable)()){const e=n.getBool(W.settingsKeys.TRADING_PANEL_OPENED,De);this.isOpened.setValue(e)}this._tabsConfig=t,this._resizerBridge=e,this._rootContainer=this._resizerBridge.container.value(),this.container=document.createElement("div"),this.container.classList.add(Me["trading-panel-content"],"trading-panel-content"),this._header=document.createElement("div"),this._header.classList.add(Me["trading-panel-header"]),this._rootContainer.appendChild(this._header),null!==this._tabsConfig&&(this._pageTabs=document.createElement("div"),this._pageTabs.classList.add(Me["trading-panel-tabs"]),this._rootContainer.appendChild(this._pageTabs)),this._rootContainer.appendChild(this.container),this._addSpinner(),this._addResizeHandler(),this._subscribeVisibility(),this.isLoading.subscribe(this._setLoading.bind(this)),this._rootContainer.style.overflow=this.isOpened.value()?"":"hidden"}addPage(e,t){this._pages[e]=t}isPageOpened(e){return this.isOpened.value()&&this.activePage.value()===e}_setLoading(e){e?(this._header.style.display="none",null!==this._pageTabs&&(this._pageTabs.style.display="none"),this.container.style.visibility="hidden",this.container.style.opacity="0",this._rootContainer.appendChild(this._spinnerContainer)):(this._header.style.removeProperty("display"),null!==this._pageTabs&&this._pageTabs.style.removeProperty("display"),this.container.style.removeProperty("visibility"),this.container.style.removeProperty("opacity"),
this._rootContainer.contains(this._spinnerContainer)&&this._rootContainer.removeChild(this._spinnerContainer))}_addSpinner(){this._spinnerContainer=document.createElement("div"),this._spinnerContainer.classList.add(Me["trading-panel-spinner"]),i.e(57102).then(i.bind(i,972717)).then((e=>{e.render(this._spinnerContainer)}))}_addResizeHandler(){this._handle=document.createElement("div"),this._handle.classList.add(Me["trading-panel-handle"]),this._rootContainer.appendChild(this._handle),this._handle.addEventListener("mousedown",this._onLayoutResizeHandleMousedown,{passive:!1}),this._handle.addEventListener("touchstart",this._onLayoutResizeHandleMousedown,{passive:!1}),this._panelWidth=n.getInt(W.settingsKeys.PANEL_WIDTH)||D.minPanelWidth}_togglePanel(e){this._resizerBridge.negotiateWidth(e?this._panelWidth:0),this._resizerBridge.negotiateHeight(e?D.panelHeight:0),this._rootContainer.style.overflow=e?"":"hidden",n.setValue(W.settingsKeys.TRADING_PANEL_OPENED,e)}_updateOpeningAvailability(){const e="visible"!==document.visibilityState||this._resizerBridge.visible.value();this.isOpeningAvailable.setValue(Boolean(e&&this._resizerBridge.availHeight.value()>=D.panelHeight&&this._resizerBridge.availWidth.value()>=this._panelWidth))}_subscribeVisibility(){this._updateOpeningAvailability(),this._resizerBridge.visible.subscribe((()=>{this._updateOpeningAvailability()})),this._resizerBridge.availHeight.subscribe((()=>{this._updateOpeningAvailability()})),this._resizerBridge.availWidth.subscribe((()=>{this._updateOpeningAvailability()}))}_requestWidth(e){this._canResizeWidth(e)&&this._resizerBridge.width.value()!==e&&(this._resizerBridge.negotiateWidth([{min:D.minPanelWidth,max:e}]),this._panelWidth=e)}_canResizeWidth(e){return e+45<=this._resizerBridge.availWidth.value()}}var We=i(12481),Fe=i(103221);const He=["qty","stopPrice","limitPrice","status","filledQty","stopType"];function qe(e,t,i){if(void 0===e||void 0===t)return!1;const s=i.indexOf(".");if(-1!==s){const r=i.substring(0,s);return qe(e[r],t[r],i.substring(s+1))}return e[i]===t[i]}function $e(e,t){return e.enabled.value()&&(t.soundPath=e.path.value()),t}function ze(e){return 6===e||3===e}class Ue extends j.BrokerService{constructor(e){super(e),this._orders=[],this._playSound=(0,We.default)(this._playSoundImpl,50),l.enableAlertSoundsForMobile()}startService(){const e=(0,s.ensure)(this.activeBroker());e.orders().then((e=>this._orders=(0,Fe.deepCopy)(e))),e.orderUpdate.subscribe(this,this._orderUpdate),this._shouldHidePriceInOrderExecutedNotifications=e.metainfo().configFlags.showAvgFillPriceColumnAsLastFillPrice}stopService(){(0,s.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)}_showNotification(e,t,i){O.enabled("trading_notifications")&&("error"===i?this.trading().showErrorNotification(e,t):this.trading().showSuccessNotification(e,t))}_formatter(e){return(0,s.ensureNotNull)(this.activeBroker()).formatter(e,!0)}_checkOrderModified(e,t){const i=this.activeBroker(),s=i&&i.metainfo().customNotificationFields||[],r=He.concat(s);let n=!1
;return r.forEach((i=>{n||qe(e,t,i)||(n=!0)})),n}_generateNotificationsInfo(e,t){const s=[],n=e.statusMessage?": "+e.statusMessage:"",o=(1===e.side?r.t(null,void 0,i(32241)):r.t(null,void 0,i(185631))).toUpperCase();const a=this.trading().orderExecutedSoundParams;return t?(this._checkOrderModified(e,t)&&(1===e.status?s.push({text:r.t(null,void 0,i(767207)),notificationType:1}):5===e.status?s.push({text:r.t(null,void 0,i(442060))+n,type:"error",notificationType:2}):2===e.status?s.push($e(a,{side:o,text:r.t(null,void 0,i(499577)),notificationType:5})):t.filledQty!==e.filledQty?s.push($e(a,{side:o,text:r.t(null,void 0,i(23750)),notificationType:3})):ze(e.status)&&s.push({text:r.t(null,void 0,i(164105)),notificationType:4})),Object.assign(t,e)):ze(e.status)?(this._orders.push(e),s.push({text:r.t(null,void 0,i(912301)),notificationType:0}),this.trading().trackEvent("","Order placed symbol",e.symbol)):1===e.status?s.push({text:r.t(null,void 0,i(767207)),notificationType:1}):5===e.status?(this._orders.push(e),s.push({text:r.t(null,void 0,i(442060))+n,type:"error",notificationType:2})):2===e.status&&(this._orders.push(e),s.push({text:r.t(null,void 0,i(912301)),notificationType:0},$e(a,{side:o,text:r.t(null,void 0,i(499577)),emptyOrderType:!0,notificationType:5})),this.trading().trackEvent("","Order placed symbol",e.symbol)),s}_orderUpdate(e,t){const s=(0,Fe.deepCopy)(e),n=this._orders.find((e=>e.id===s.id));if(t)return void(void 0===n&&this._orders.push(s));if(n&&(0,C.isFinalOrderStatus)(n.status))return;const o=this._generateNotificationsInfo(s,n);0!==o.length&&this._formatter(s.symbol).then((e=>{const t=(0,C.sideToText)(s.side,!0),n=s.qty,a=void 0!==s.filledQty&&s.filledQty>0?s.filledQty:void 0;let l="",c="";switch(s.type){case 2:l=s.avgPrice?" ("+(0,C.orderTypeToText)({orderType:s.type})+")":"",c=s.avgPrice?e.format(s.avgPrice):(0,C.orderTypeToText)({orderType:s.type});break;case 4:l=" "+r.t(null,void 0,i(916322)).format({price:e.format(s.stopPrice)}),c=e.format(s.avgPrice||s.limitPrice);break;default:l=" ("+(0,C.orderTypeToText)({orderType:s.type})+")",c=e.format(s.avgPrice||s.limitPrice||s.stopPrice)}const d=void 0!==s.message?`${s.message.text.charAt(0).toUpperCase()}${s.message.text.substring(1)}`:"";o.forEach((({text:e,type:o,side:u,emptyOrderType:h,soundPath:p,notificationType:g})=>{const _=3===g&&void 0!==a?a:n;let m=(0,ye.splitThousands)(Math.abs(_)," ")+" "+(s.brokerSymbol||s.symbol);(!this._shouldHidePriceInOrderExecutedNotifications||5!==g&&3!==g)&&(m+=" "+r.t(null,void 0,i(492903))+" "+c);const b=`${r.t(null,void 0,i(922541))} ${s.id} ${e}`,v=`${u||t} ${m} ${h?"":l}\n${d}`;void 0!==p&&this._playSound(p),this._showNotification(b,v,o)}))}))}_playSoundImpl(e){if(this._playingSound){if(this._playingSound===e)return;l.stop(this._playingSound)}this._playingSound=e,l.play(e),l.onStopped(e,(()=>{delete this._playingSound}))}}var Qe=i(731042);const je=(0,B.getLogger)("Chart.PointsetManager");let Ge=0;class Ke{constructor(e,t,i,s,r){this._currentPointsetId=null,this._onUpdate=new V.Delegate,this._requestPoints=[],
this._gateway=e,this._pointsetSuffix=t,this._isGatewayConnected=this._gateway.isConnected().spawn(),this._isGatewayConnected.subscribe(this._updateByGatewayConnection.bind(this)),this._addPoints(i,s,r)}onUpdate(){return this._onUpdate}destroy(){this._isGatewayConnected.value()&&null!==this._currentPointsetId&&this._gateway.removePointset(this._currentPointsetId),this._requestPoints=[],this._currentPointsetId=null,this._isGatewayConnected.destroy()}_updateByGatewayConnection(e){e||(this._currentPointsetId=null,this._requestPoints=[])}_addPoints(e,t,i){var r,n;this._isGatewayConnected.value()&&((0,s.assert)(e.length>0,"Can't possible create point set for empty array of time points"),this._requestPoints=e.map((e=>[e.time_t,e.offset])),this._currentPointsetId=(r=this._pointsetSuffix,n=++Ge,`pointset_${r}_${n}`),this._gateway.createPointset(this._currentPointsetId,"turnaround",t,(0,Qe.getServerInterval)(i),this._requestPoints,this._onMessage.bind(this)))}_onMessage(e){switch(e.method){case"pointset_error":je.logNormal(`Pointset error with id ${e.params[0]} turnaround ${e.params[1]}`);break;case"data_update":{const t=[];for(const i of e.params.plots)t.push({time_t:this._requestPoints[i.index][0],index:i.value[0],barTime:i.value[1]});this._onUpdate.fire(t);break}}}}var Je=i(837032);function Ze(e){const t=e.mainSeries().data().first();return null===t?null:t.value[0]}async function Xe(e,t,s){const[r,n,o]=await Promise.all([Promise.all([i.e(91033),i.e(73534),i.e(28345),i.e(42650)]).then(i.bind(i,960622)),Promise.all([i.e(91033),i.e(73534),i.e(28345),i.e(42650)]).then(i.bind(i,953289)),Promise.all([i.e(91033),i.e(73534),i.e(28345),i.e(42650)]).then(i.bind(i,840492))]);e.addCustomSource("executions",((e,i)=>{const a=i.mainSeries(),l=a.dataEvents(),c=(0,Je.createPrimitivePropertyFromGetterAndSubscription)(i.isInReplay.bind(i),i.onInReplayStateChanged()),d=(0,Je.createPrimitivePropertyFromGetterAndSubscription)((()=>a.isConvertedToOtherCurrency()||a.isConvertedToOtherUnit()),a.symbolResolved()),u={arrowVisibility:(0,Je.combineProperty)(((e,t,i)=>(i=i&&!e)&&!t),c.ownership(),d.ownership(),i.properties().childs().tradingProperties.childs().showExecutions.weakReference()),labelVisibility:i.properties().childs().tradingProperties.childs().showExecutionsLabels},h=function(e,t,i){return s=>{const r=i.seriesSource().symbolInstanceId(),n=i.interval();return null===r?null:new Ke(e,t,s,r,n)}}(i.chartApi(),"executions",a),p=(0,Je.createWVFromGetterAndSubscription)(Ze.bind(null,i),l.barReceived()),g=new r.ExecutionsService(t,l,function(e){return()=>{const t=e.symbolInfo();return null!==t?t.pro_name||t.full_name:e.proSymbol()}}(a)),_=new n.ExecutionsPointsManager(g,h,p);return new o.ExecutionsSource(e,i,u,s,_)}))}var Ye=i(441919),et=i(793814),tt=i(938550),it=i(402084),st=i(389137),rt=i(518075);const nt=r.t(null,void 0,i(799559)),ot=r.t(null,void 0,i(435312)),at=r.t(null,void 0,i(703396)),lt=r.t(null,void 0,i(538386)),ct=r.t(null,void 0,i(893966)),dt=r.t(null,void 0,i(422540)),ut=r.t(null,void 0,i(400241)),ht=r.t(null,void 0,i(766596)),pt=(0,
Te.isMobileTradingAvailable)();class gt{constructor({dataEvents:e,getSymbolName:t,isNonTradableInstrument:i,qtySuggester:r,tradingCommands:n,settings:o,isInReplay:a,hibernated:l}){this.ask=new N.WatchedValue(null),this.askTooltip=new N.WatchedValue(nt),this.bid=new N.WatchedValue(null),this.bidTooltip=new N.WatchedValue(ot),this.spread=new N.WatchedValue(null),this.spreadTooltip=new N.WatchedValue(dt),this.qty=new N.WatchedValue(null),this.qtyTooltip=new N.WatchedValue(""),this.brokerIconVisible=new N.WatchedValue(!1),this.brokerIconLoading=new N.WatchedValue(!1),this.brokerIconUrl=new N.WatchedValue(null),this.isQtyVisible=new N.WatchedValue(!1),this.hasAskBidAdditionalPrecision=new N.WatchedValue(!1),this.canTrade=new N.WatchedValue(!0),this._globalVisibility=null,this._isSymbolTradableResult=new tt.WatchedObject(null),this._formatter=null,this._spreadFormatter=null,this._symbol=null,this._abortController=new AbortController,this.setQty=e=>{this.qty.setValue(String(e))},this._createTradedSymbol=()=>{var e;const t=this._getSymbolName();if(null===(e=this._symbolChangeSubscription)||void 0===e||e.unsubscribe(),this._clearTradedSymbol(),t.length>0){const e=({symbol:e,message:t})=>{(0,s.ensureDefined)(this._informerMessage$,"Informer message").next(t),e!==this._symbol&&(this._clearTradedSymbol(),this._initTradedSymbol(e))};this._symbolChangeSubscription=this._makeActualTradingSymbolObservable(t).subscribe(e)}},this._onSuggestedQtyChange=e=>{this._lastSuggestedQty=e,this.setQty(e)},this._updateIsSymbolTradable=async e=>{if(null===this._symbol)return void this._isSymbolTradableResult.setValue(null);const t=await this._realtimeProvider.isTradable(this._symbol);(null==e?void 0:e.aborted)||this._isSymbolTradableResult.setValue((0,st.clone)(t))},this._updateIsSymbolTradable=(0,A.respectLatest)(this._updateIsSymbolTradable);const{noConfirmEnabled:c,showSellBuyButtons:u,themeName:p}=o;this._isInstantMode=c,this._informerMessage$=new d.BehaviorSubject(void 0),this.informerMessage$=(0,m.combineLatest)({informerMessage:this._informerMessage$,isInstantMode:(0,rt.makeObservableFromWatchedValue)(this._isInstantMode)}).pipe((0,h.map)((e=>e.isInstantMode?e.informerMessage:void 0))),this._dataEvents=e,this._getSymbolName=t,this._qtySuggester=r,this._realtimeProvider=n.realtimeProvider,this._onNeedSelectBroker=n.onNeedSelectBroker,this._toggleTradingWidget=n.toggleTradingWidget,this._toggleTradingPanelPopup=n.toggleTradingPanelPopup,this._brokerCommandsUI=n.brokerCommandsUI,this._makeActualTradingSymbolObservable=n.makeActualSymbolObservable,this._updateRealtimeDataHandler=this._updateRealtimeData.bind(this),this._isBrokerConnected=(0,Je.createWVFromGetterAndSubscription)((()=>null!==this._realtimeProvider.activeBroker()),this._realtimeProvider.onStatusChanged),this._isBrokerConnected.subscribe(this._updateQtyTooltip.bind(this),{callWithLast:!0}),this._isBrokerConnected.subscribe(this._updateBrokerIcon.bind(this)),this._isBrokerConnected.subscribe(this._createTradedSymbol),this._isBrokerConnecting=(0,
Je.createWVFromGetterAndSubscription)((()=>2===n.brokerConnectionStatus()),n.onBrokerConnectionStatusChange),this._isBrokerConnecting.subscribe(this._updateBrokerIcon.bind(this)),this.visible=new N.WatchedValue(!1),this._enabled=(0,x.combine)(((e,t)=>e&&!t),this.visible.weakReference(),l.ownership()),this._enabled.subscribe(this._toggleState.bind(this),{callWithLast:!0}),this._showSellBuyButtons=u,this._isInReplay=a,this._isNonTradableInstrument=i,this._showSellBuyButtons.subscribe(this._updateVisibility.bind(this)),this._isInReplay.subscribe(this._updateVisibility.bind(this)),this._isNonTradableInstrument.subscribe(this._updateVisibility.bind(this)),this._updateVisibility(),this._themeName=p,this._themeName.subscribe(this._updateBrokerIcon.bind(this),{callWithLast:!0}),this._tradePossibilityComputedWV=(0,x.combine)((()=>({})),this._isBrokerConnected.weakReference(),this._isSymbolTradableResult.weakReference(),this.ask.weakReference(),this.bid.weakReference()),this._tradePossibilityComputedWV.subscribe(this._updateTradePossibilityAndTooltip.bind(this),{callWithLast:!0}),this._isQtyVisibleComputedWV=(0,x.combine)((()=>({})),this.canTrade.weakReference(),this._isInstantMode.weakReference()),this._isQtyVisibleComputedWV.subscribe(this._updateIsQtyVisible.bind(this),{callWithLast:!0})}destroy(){var e;this._abortController.abort(),this._stop(),this._isBrokerConnected.destroy(),this._showSellBuyButtons.release(),this._isInReplay.release(),this._isNonTradableInstrument.release(),null===(e=this._globalVisibility)||void 0===e||e.release(),this._isInstantMode.release(),this._tradePossibilityComputedWV.destroy(),this._isQtyVisibleComputedWV.destroy(),this._themeName.release(),this._isBrokerConnecting.destroy(),this._enabled.destroy()}setGlobalVisibility(e){(0,s.assert)(null===this._globalVisibility,"GlobalVisibility can be set only once"),this._globalVisibility=e,this._globalVisibility.subscribe(this._updateVisibility.bind(this),{callWithLast:!0})}async tryToPlaceSellOrder(){await this._tryToPlaceOrder(parseFloat((0,s.ensureNotNull)(this.bid.value())),-1)}async tryToPlaceBuyOrder(){await this._tryToPlaceOrder(parseFloat((0,s.ensureNotNull)(this.ask.value())),1)}async getQtyInfo(){return null!==this._symbol&&this.canTrade.value()?(await this._realtimeProvider.symbolInfo(this._symbol)).qty:null}applyQty(){if(null===this._symbol||!this.canTrade.value())return;const e=this.qty.value(),t=null!==e?Number(e):null;null!==t&&this._qtySuggester.setQty(this._symbol,t),void 0!==this._lastSuggestedQty&&t!==this._lastSuggestedQty&&this.qty.setValue(String(this._lastSuggestedQty))}canShowMobileTrading(){var e;return(0,Te.isMobileTradingAvailable)()&&!(null===(e=window.TradingView.bottomWidgetBar)||void 0===e?void 0:e.isVisible().value())}_updateVisibility(){const e=(null===this._globalVisibility||this._globalVisibility.value())&&this._showSellBuyButtons.value()&&!this._isInReplay.value()&&!this._isNonTradableInstrument.value();this.visible.setValue(e)}async _tryToPlaceOrder(e,t){var i,r
;if(null===this._realtimeProvider.activeBroker())return this.canShowMobileTrading()?this._toggleTradingPanelPopup():await this._toggleTradingWidget(),void this._onNeedSelectBroker.fire();const n=Number(this.qty.value())||1,o=this._isMarketOrderSupported()?2:1,a=1===t?null===(i=this._currentQuotes)||void 0===i?void 0:i.ask:null===(r=this._currentQuotes)||void 0===r?void 0:r.bid,l={symbol:(0,s.ensureNotNull)(this._symbol),qty:n,side:t,type:o,seenPrice:null!=a?a:null,currentQuotes:this._currentQuotes};1===o&&(l.limitPrice=e),await(0,s.ensureNotNull)(this._brokerCommandsUI()).placeOrder(l,!0)}_toggleState(e){e?this._start():this._stop()}_start(){this._dataEvents.symbolResolved().subscribe(this,this._createTradedSymbol),this._dataEvents.symbolError().subscribe(this,this._createTradedSymbol),this._createTradedSymbol()}_stop(){var e;null===(e=this._symbolChangeSubscription)||void 0===e||e.unsubscribe(),this._clearTradedSymbol(),this._symbol=null,this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this)}_initTradedSymbol(e){this._symbol=e,this._updateIsSymbolTradable(this._abortController.signal),this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler),this._resubscribeQtySuggester()}_clearTradedSymbol(){var e;this._currentQuotes=void 0,this.ask.setValue(null),this.bid.setValue(null),this.spread.setValue(null),this.qty.setValue(null),null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(this._symbol,this._updateRealtimeDataHandler),null===(e=this._qtySuggesterSubscription)||void 0===e||e.unsubscribe(),this._symbol=null,this._updateIsSymbolTradable(this._abortController.signal))}async _resubscribeQtySuggester(){var e;const t=this._symbol;if(null===t)return;null===(e=this._qtySuggesterSubscription)||void 0===e||e.unsubscribe();const i=this._suggestedQtyPromise=this._qtySuggester.getQty(t),s=await i;i===this._suggestedQtyPromise&&t===this._symbol&&(this._lastSuggestedQty=s,this.setQty(s),this._qtySuggesterSubscription=this._qtySuggester.suggestedQtyChanged(t).subscribe(this._onSuggestedQtyChange))}_isMarketOrderSupported(){const e=this._realtimeProvider.activeBroker();return null===e||Boolean(e.metainfo().configFlags.supportMarketOrders)}_updateTradePossibilityAndTooltip(){this._updateCanTrade(),this._updateSellBuyTooltip()}_updateCanTrade(){const e=this._isSymbolTradableResult.value(),t=this._isBrokerConnected.value()&&null!==e&&e.tradable;this.canTrade.setValue(t)}_updateSellBuyTooltip(){var e,t;const i=this._getNonTradedTooltip();this.askTooltip.setValue(null!==(e=null!=i?i:this._getAskTooltip())&&void 0!==e?e:nt),this.bidTooltip.setValue(null!==(t=null!=i?i:this._getBidTooltip())&&void 0!==t?t:ot)}_getNonTradedTooltip(){const e=this._isSymbolTradableResult.value();if(this._isBrokerConnected.value()&&null!==e&&!e.tradable)return void 0!==e.solutions?"":void 0!==e.shortReason&&""!==e.shortReason?e.shortReason:at}_getAskTooltip(){return null===this.ask.value()?ct:void 0}_getBidTooltip(){return null===this.bid.value()?lt:void 0}
_updateRealtimeData(e,t,i){this._formatter=i.formatter,this._spreadFormatter=i.spreadFormatter;const s=t.ask,r=t.bid,n=(0,c.isNumber)(s),o=(0,c.isNumber)(r),a=n?this._formatter.format(s):null,l=o?this._formatter.format(r):null;this.ask.setValue(a),this.bid.setValue(l),n&&o&&(this._currentQuotes={ask:s,bid:r});const d=t.spread||(0,c.isNumber)(s)&&(0,c.isNumber)(r)&&s-r||0,u=(0,c.isNumber)(t.spread)?this._spreadFormatter:this._formatter;this.spread.setValue(u.format(d));let h=!1;(0,it.isFormatterHasForexAdditionalPrecision)(this._formatter)&&(h=this._formatter.hasForexAdditionalPrecision()),this.hasAskBidAdditionalPrecision.setValue(h)}_updateIsQtyVisible(){const e=this._isInstantMode.value()&&this.canTrade.value();this.isQtyVisible.setValue(e)}_updateQtyTooltip(){this.qtyTooltip.setValue(this._getQtyTooltip())}_getQtyTooltip(){const e=this._realtimeProvider.activeBroker();return null!==e&&e.metainfo().configFlags.showQuantityInsteadOfAmount?ht:ut}_updateBrokerIcon(){if(!pt)return;let e;const t=this._realtimeProvider.activeBroker();if(null!==t){const i=t.metainfo();e="dark"===this._themeName.value()&&i.logoMiniBlackUrl?i.logoMiniBlackUrl:i.logoMiniUrl}this.brokerIconVisible.setValue(this._isBrokerConnected.value()),this.brokerIconLoading.setValue(this._isBrokerConnecting.value()),this.brokerIconUrl.setValue(e||null)}}var _t=i(373571),mt=i(159255),bt=i(343370),vt=i(499994),yt=i(312420),ft=i(486029),wt=i(818612);const kt=(0,i(146111).reactLoaderRendererCreator)(wt.Spinner,{size:"xxsmall"});var St=i(156836),Pt=i(779514),Ct=i(176006),Bt=i(936755),Tt=i(199056),Et=i(707488),Ot=i(844012),It=i(829883);const xt=parseInt(Ot["css-value-padding"]),Nt=!(0,Te.isMobileTradingAvailable)();function Vt(e,t,i,r){let n=e.querySelector(`.${r}`);if(!i)return null!==n&&n.remove(),void(0,Ct.updateTextNode)(e,t);null===n&&(n=document.createElement("span"),n.classList.add(r),e.appendChild(n)),(0,Ct.updateTextNode)((0,s.ensureNotNull)(n),t.slice(-1)),(0,Ct.updateTextNode)(e,t.slice(0,-1))}class Lt{constructor({model:e,highButtonsMode:t,trackEvent:i,toggleMinimizeBottomWidgetBar:s}){this.element=document.createElement("div"),this._buttonsWrapperEl=document.createElement("div"),this._informerWrapperEl=null,this._sellButtonEl=document.createElement("div"),this._sellButtonTextEl=document.createElement("span"),this._buyButtonEl=document.createElement("div"),this._buyButtonTextEl=document.createElement("span"),this._spreadQtyWrapper=document.createElement("div"),this._spreadEl=document.createElement("div"),this._qtyEl=document.createElement("div"),this._qtyTextEl=document.createElement("span"),this._brokerButtonEl=document.createElement("div"),this._brokerIconWrapEl=document.createElement("div"),this._isCalcOpened=!1,this._calcContainer=document.createElement("div"),this._sellLoader=(0,ft.createPointsLoaderRenderer)(this._sellButtonEl,{className:Tt.loader}),this._buyLoader=(0,ft.createPointsLoaderRenderer)(this._buyButtonEl,{className:Tt.loader}),this._brokerLoader=kt(this._brokerButtonEl,{className:Tt.circleLoader}),
this._windowResizeHandlerThrottle=(0,bt.default)(this._windowResizeHandler.bind(this),100),this._isHiddenByViewport=!1,this._mode=2,this._height=new N.WatchedValue(0),this._resizeObserver=null,this._cachedBreakPoints={},this._parentWidth=0,this._getCurrentQty=()=>{const e=this._qty.value();return null!==e?Number(e):null},this._model=e,this._toggleMinimizeBottomWidgetBar=s,this._ask=this._model.ask.spawn(),this._ask.subscribe(this._updateBuyButton.bind(this)),this._bid=this._model.bid.spawn(),this._bid.subscribe(this._updateSellButton.bind(this)),this._spread=this._model.spread.spawn(),this._spread.subscribe(this._updateSpread.bind(this)),this._qty=this._model.qty.spawn(),this._qty.subscribe(this._updateQty.bind(this)),this._brokerIconVisible=this._model.brokerIconVisible.spawn(),this._brokerIconVisible.subscribe(this._updateBrokerIconImage.bind(this)),this._brokerIconLoading=this._model.brokerIconLoading.spawn(),this._brokerIconLoading.subscribe(this._updateBrokerIconImage.bind(this)),this._brokerIconUrl=this._model.brokerIconUrl.spawn(),this._brokerIconUrl.subscribe(this._updateBrokerIconImage.bind(this),{callWithLast:!0}),this._trackEvent=i,this._render(),this._askTooltip=this._model.askTooltip.spawn(),this._askTooltip.subscribe(this._updateButtonTooltip.bind(this,this._buyButtonEl),{callWithLast:!0}),this._bidTooltip=this._model.bidTooltip.spawn(),this._bidTooltip.subscribe(this._updateButtonTooltip.bind(this,this._sellButtonEl),{callWithLast:!0}),this._spreadTooltip=this._model.spreadTooltip.spawn(),this._spreadTooltip.subscribe(this._updateButtonTooltip.bind(this,this._spreadEl),{callWithLast:!0}),this._qtyTooltip=this._model.qtyTooltip.spawn(),this._qtyTooltip.subscribe(this._updateButtonTooltip.bind(this,this._qtyEl),{callWithLast:!0}),this._canTrade=this._model.canTrade.spawn(),this._canTrade.subscribe(this._updateBgButtonsMode.bind(this),{callWithLast:!0}),this._isVisible=this._model.visible.spawn(),this._isVisible.subscribe(this._updateVisibility.bind(this),{callWithLast:!0}),this._isQtyVisible=this._model.isQtyVisible.spawn(),this._isQtyVisible.subscribe(this._updateQtyVisibility.bind(this),{callWithLast:!0}),this._isLastDigitSup=this._model.hasAskBidAdditionalPrecision.spawn(),this._isLastDigitSup.subscribe(this._updateLastDigitSup.bind(this)),this._highButtonsMode=t.spawn(),this._highButtonsMode.subscribe(this._updateHighButtonsMode.bind(this),{callWithLast:!0}),this._sellButtonHandler=this._onSellButton.bind(this),this._buyButtonHandler=this._onBuyButton.bind(this),this._qtyHandler=this._toggleCalcVisibility.bind(this),this._brokerButtonHandler=this._onBrokerButton.bind(this),this._sellButtonEl.addEventListener("click",this._sellButtonHandler),this._buyButtonEl.addEventListener("click",this._buyButtonHandler),this._qtyEl.addEventListener("click",this._qtyHandler),this._brokerButtonEl.addEventListener("click",this._brokerButtonHandler),window.addEventListener("resize",this._windowResizeHandlerThrottle),this._windowResizeHandler()}destroy(){var e;this._ask.destroy(),this._askTooltip.destroy(),
this._bid.destroy(),this._bidTooltip.destroy(),this._spread.destroy(),this._spreadTooltip.destroy(),this._qty.destroy(),this._qtyTooltip.destroy(),this._isVisible.destroy(),this._isQtyVisible.destroy(),this._isLastDigitSup.destroy(),this._highButtonsMode.destroy(),this._canTrade.destroy(),this._brokerIconUrl.destroy(),this._sellLoader.destroy(),this._buyLoader.destroy(),this._brokerLoader.destroy(),this._sellButtonEl.removeEventListener("click",this._sellButtonHandler),this._buyButtonEl.removeEventListener("click",this._buyButtonHandler),this._qtyEl.removeEventListener("click",this._qtyHandler),this._brokerButtonEl.removeEventListener("click",this._brokerButtonHandler),null===(e=this._resizeObserver)||void 0===e||e.disconnect(),this._resizeObserver=null,this.element.remove(),delete this.element,window.removeEventListener("resize",this._windowResizeHandlerThrottle)}updateModeByWidth(e){var t;const i=this._cachedBreakPoints[0],s=this._cachedBreakPoints[1];this._mode=void 0!==i&&e<i?0:void 0!==s&&e<s?1:2,this._parentWidth=e;const r=1===this._mode;this._buttonsWrapperEl.classList.toggle(Tt.column,r),null===(t=this._informerWrapperEl)||void 0===t||t.classList.toggle(Tt.column,r),this._updateVisibility()}height(){return this._height}renderTo(e,t){void 0!==t?e.insertBefore(this.element,t):e.appendChild(this.element),null===this._resizeObserver&&(this._resizeObserver=new mt.default(this._updateBreakPointsAndSize.bind(this))),this._resizeObserver.unobserve(this.element),this._resizeObserver.observe(this.element)}isHiddenByViewport(){return this._isHiddenByViewport}_render(){const e=this._bid.value()||"...";this._sellButtonTextEl.appendChild(document.createTextNode(e)),this._sellButtonTextEl.classList.add(Tt.buttonText),this._sellButtonEl.append(this._sellButtonTextEl),this._sellButtonEl.classList.add("apply-common-tooltip",Tt.button,Tt.sellButton);const t=this._spread.value()||"";this._spreadEl.appendChild(document.createTextNode(String(t))),this._spreadEl.classList.add("apply-common-tooltip",Tt.spread);const i=this._qty.value()||"";this._qtyTextEl.appendChild(document.createTextNode(i)),this._qtyEl.append(this._qtyTextEl),this._qtyEl.setAttribute("data-name","qtyEl"),this._qtyEl.classList.add("apply-common-tooltip",Tt.button,Tt.qty),this._spreadQtyWrapper.classList.add(Tt.spreadQtyWrapper),this._spreadQtyWrapper.appendChild(this._spreadEl),this._spreadQtyWrapper.appendChild(this._qtyEl);const s=this._ask.value()||"...";this._buyButtonTextEl.appendChild(document.createTextNode(String(s))),this._buyButtonTextEl.classList.add(Tt.buttonText),this._buyButtonEl.append(this._buyButtonTextEl),this._buyButtonEl.classList.add("apply-common-tooltip",Tt.button,Tt.buyButton),this._brokerButtonEl.appendChild(this._brokerIconWrapEl),this._brokerIconWrapEl.classList.add(Tt.brokerButtonIconWrap),this._brokerButtonEl.classList.add(Tt.brokerButton),this._buttonsWrapperEl.appendChild(this._sellButtonEl),this._buttonsWrapperEl.appendChild(this._spreadQtyWrapper),this._buttonsWrapperEl.appendChild(this._buyButtonEl),
this._buttonsWrapperEl.appendChild(this._brokerButtonEl),this._buttonsWrapperEl.classList.add(Tt.buttonsWrapper),this._buttonsWrapperEl.classList.toggle(Tt.touchMode,St.trackingModeIsAvailable),this._buttonsWrapperEl.classList.toggle(Tt.notAvailableOnMobile,Nt),this.element.appendChild(this._buttonsWrapperEl),this._initTradingInformer(),this.element.classList.add(Tt.container)}_initTradingInformer(){{if(void 0===this._model.informerMessage$)return;const e=this._informerWrapperEl=document.createElement("div");e.classList.add(Tt.informerWrapper),e.classList.toggle(Tt.touchMode,St.trackingModeIsAvailable),e.classList.toggle(Tt.notAvailableOnMobile,Nt),(0,Bt.renderTradingInformer)(e,this._model.informerMessage$),this.element.appendChild(e)}}_updateBreakPointsAndSize(e){const t=e[0],i=2*xt;2===this._mode&&(this._cachedBreakPoints[1]=Math.round(t.contentRect.width)+i),1===this._mode&&(this._cachedBreakPoints[0]=Math.round(t.contentRect.width)+i),this.updateModeByWidth(this._parentWidth);const s=t.contentRect.height>0?Math.round(t.contentRect.height)+i:0;this._height.setValue(s)}_updateBrokerIconImage(){const e=this._brokerIconLoading.value(),t=!this._brokerIconVisible.value()&&!e;if(this._brokerButtonEl.classList.toggle(Et.blockHidden,t),t)return;if(this._toggleLoaderVisibility(this._brokerButtonEl,this._brokerLoader,e),e)return void(this._brokerIconWrapEl.innerHTML="");const i=this._brokerIconUrl.value(),s=null===i;this._brokerIconWrapEl.innerHTML=s?It:`<image src="${i}" alt="Account Manager" />`,this._brokerButtonEl.classList.toggle(Tt.brokerButtonDefault,s)}async _onSellButton(){if(null===this._bid.value())return;const e=this._highButtonsMode.value();this._trackEvent("Sell/Buy Buttons","Sell",e?"Instant":"Not Instant"),e&&this._canTrade.value()&&this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!0),await this._model.tryToPlaceSellOrder(),e&&this._canTrade.value()&&setTimeout((()=>this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!1)),300)}async _onBuyButton(){if(null===this._ask.value())return;const e=this._highButtonsMode.value();this._trackEvent("Sell/Buy Buttons","Buy",e?"Instant":"Not Instant"),e&&this._canTrade.value()&&this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!0),await this._model.tryToPlaceBuyOrder(),e&&this._canTrade.value()&&setTimeout((()=>this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!1)),300)}_onBrokerButton(){this._model.canShowMobileTrading()?(0,Pt.showTradingPanelPopup)():this._toggleMinimizeBottomWidgetBar()}_toggleLoaderVisibility(e,t,i){e.classList.toggle(Tt.loading,i),t.toggleVisibility(i)}_updateBuyButton(e){const t=null!==e&&this._isLastDigitSup.value();Vt(this._buyButtonTextEl,`${e||"..."}`,t,Tt.lastCharSup)}_updateSellButton(e){const t=null!==e&&this._isLastDigitSup.value();Vt(this._sellButtonTextEl,`${e||"..."}`,t,Tt.lastCharSup)}_updateSpread(e){const t=`${e||""}`;(0,Ct.updateTextNode)(this._spreadEl,t),this._updateVisibilityForSpreadQtyWrapper()}_updateQty(e){let t=`${e||""}`;!this._isCalcOpened&&t.length>0&&(t=(0,
I.abbreviatedNumber)(Number(t))),(0,Ct.updateTextNode)(this._qtyTextEl,t)}_updateHighButtonsMode(e){this._buttonsWrapperEl.classList.toggle(Tt.highButtons,e)}_updateBgButtonsMode(e){var t;this._buttonsWrapperEl.classList.toggle(Tt.withoutBg,!e),null===(t=this._informerWrapperEl)||void 0===t||t.classList.toggle(Et.blockHidden,!e)}_updateVisibilityForSpreadQtyWrapper(){const e=!this._isQtyVisible.value()&&null===this._spread.value();this._spreadQtyWrapper.classList.toggle(Et.blockHidden,e)}_updateQtyVisibility(e){this._qtyEl.classList.toggle(Et.blockHidden,!e),this._spreadQtyWrapper.classList.toggle(Tt.withoutQty,!e),this._updateVisibilityForSpreadQtyWrapper()}_updateVisibility(){var e;const t=this._isVisible.value()&&0!==this._mode&&!this._isHiddenByViewport;this._buttonsWrapperEl.classList.toggle(Et.blockHidden,!t),null===(e=this._informerWrapperEl)||void 0===e||e.classList.toggle(Et.blockHidden,!t||!this._canTrade.value())}_updateLastDigitSup(){this._updateBuyButton(this._ask.value()),this._updateSellButton(this._bid.value())}_updateButtonTooltip(e,t){if(""===t)return(0,vt.setTooltipData)(e,"text",t),void e.removeAttribute("title");e.setAttribute("title",t)}_toggleCalcVisibility(){this._isCalcOpened=!this._isCalcOpened,this._renderCalc()}_closeCalc(){this._isCalcOpened=!1,this._updateQty(this._qty.value()),this._model.applyQty(),this._renderCalc()}_renderCalc(){Promise.all([i.e(34465),i.e(69121),i.e(88194),i.e(87845),i.e(542),i.e(60123),i.e(47047),i.e(88096),i.e(58431),i.e(93809)]).then(i.bind(i,290567)).then((async e=>{const t=await this._model.getQtyInfo();null!==t&&e.render(this._isCalcOpened,this._calcContainer,{...t,withInput:!0,valueGetter:this._getCurrentQty,position:this._getCalcPosition(),targetEl:this._qtyEl,onClose:this._closeCalc.bind(this),onValueChange:this._model.setQty,trackEventTarget:"Sell/Buy Buttons",trackEvent:this._trackEvent})}))}_getCalcPosition(){return(0,yt.getPopupPositioner)(this._qtyEl,{horizontalAttachEdge:yt.HorizontalAttachEdge.Left,horizontalDropDirection:yt.HorizontalDropDirection.FromLeftToRight})}_windowResizeHandler(){const e=Nt&&(window.innerWidth<567||window.innerHeight<440);this._isHiddenByViewport!==e&&(this._isHiddenByViewport=e,this._updateVisibility())}}const At=r.t(null,void 0,i(73953));class Mt{constructor(e,t,i,s,r,n,o,a){const{showSellBuyButtons:l,noConfirmEnabled:c,themeName:d}=n;this._showSellBuyButtons=l,this._isEconomySymbol=i,this._isInReplay=o,this._trackEvent=r.trackEvent,this._model=new gt({dataEvents:e,getSymbolName:t,isNonTradableInstrument:i.spawnOwnership(),qtySuggester:s,tradingCommands:r,settings:{noConfirmEnabled:c,themeName:d,showSellBuyButtons:l.spawnOwnership()},isInReplay:o.spawnOwnership(),hibernated:a}),this._renderer=new Lt({model:this._model,highButtonsMode:c.spawnOwnership(),trackEvent:r.trackEvent,toggleMinimizeBottomWidgetBar:r.toggleMinimizeBottomWidgetBar})}destroy(){this._model.destroy(),this._renderer.destroy(),this._isEconomySymbol.release(),this._isInReplay.release(),this._showSellBuyButtons.release()}renderTo(e,t){
this._renderer.renderTo(e,t)}setGlobalVisibility(e){this._model.setGlobalVisibility(e)}visibility(){return this._model.visible}updateWidgetModeBySize(e){this._renderer.updateModeByWidth(e.width)}contextMenuActions(){if(this._renderer.isHiddenByViewport())return[];return[new _t.Action({actionId:"Trading.SellBuyButtonsToggleVisibility",options:{checkable:!0,checked:this._showSellBuyButtons.value(),label:At,disabled:this._isInReplay.value()||this._isEconomySymbol.value(),onExecute:()=>{const e=!this._showSellBuyButtons.value();this._showSellBuyButtons.setValue(e),this._trackEvent("SellBuyButtonsWidget context menu","Show Sell/Buy Button",e?"Check":"Uncheck")}}})]}height(){return this._renderer.height()}}var Dt=i(111393),Rt=i(619027),Wt=i(640712);const Ft=ve.forwardRef(((e,t)=>ve.createElement("div",{ref:t,className:Wt.popupWrapper},e.children)));var Ht=i(670797);const qt=(()=>{let e,t,s,r=null,n=null;return async(o,a,l,c)=>{const d=null==o?void 0:o.currentAccount();if(null===r||n!==o||e!==d||s!==c){null==t||t.remove();const{AccountManager:u}=await Promise.all([i.e(72639),i.e(89842),i.e(68992),i.e(88548),i.e(81643),i.e(36747),i.e(91033),i.e(48155),i.e(45896),i.e(46036),i.e(49205),i.e(22486),i.e(52251),i.e(12494),i.e(80914),i.e(68439),i.e(41446),i.e(94643),i.e(81721),i.e(23718),i.e(52931),i.e(95008),i.e(86045),i.e(65747),i.e(9050),i.e(9555),i.e(8480),i.e(88354)]).then(i.bind(i,990335)),h={container:a,visible:new N.WatchedValue(!0)};r=a,n=o,e=d,s=c,t=await u.create({broker:o,bridge:h,mode:0,overlapManager:l,summaryFieldsVisibilityManager:c})}else a.appendChild(r)}})(),$t=new N.WatchedValue(null);function zt(e){const{broker:t,summaryFieldsVisibilityManager:i}=e,s=(0,ve.useRef)(null),r=(0,ve.useContext)(Ht.SlotContext);return(0,ve.useEffect)((()=>{$t.setValue(r)}),[r]),(0,ve.useEffect)((()=>{null!==s.current&&qt(t,s.current,$t.readonly(),i)}),[]),ve.createElement(Ft,{ref:s})}var Ut=i(443549),Qt=i(269089),jt=i(71741),Gt=i(308481),Kt=i(581713),Jt=i(90141);function Zt(e){const{currentAccount$:t,resetAccount:i,changeAccountSettings:s,deleteAccount:r}=e,n=(0,Ne.useObservable)(t);return void 0!==n&&(void 0!==r&&!n.isDefault||void 0!==i||void 0!==s)?ve.createElement("span",{className:Jt.wrapper},ve.createElement("span",{className:Jt.buttonWrapper},ve.createElement(Gt.AccountSettingsButton,{...e,bigIcon:!0})),ve.createElement(Kt.HeaderControlsSeparator,null)):ve.createElement(ve.Fragment,null)}var Xt=i(517516);const Yt=r.t(null,void 0,i(890801));class ei extends Dt.DialogRenderer{constructor(e){super(),this._title=Yt,this._isSubscribed=!1,this._showSeparator=!0,this._handleClose=()=>{Oe.unmountComponentAtNode(this._container),this._setVisibility(!1)},this._trading=e}visible(){return this._visibility.spawn().readonly()}show(){this._isSubscribed||(this._isSubscribed=!0,this._onStatusChange(this._trading.connectStatus()),this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange)),this._setVisibility(!0),this._renderComponent()}hide(){this._handleClose()}_onStatusChange(e,t){var i,s
;if(null===(i=this._trading.activeBroker())||void 0===i||i.currentAccountUpdate.unsubscribe(this,this._renderAccountManager),this._connectStatus!==e)if(this._connectStatus=e,this._additionalHeaderElement=void 0,2!==e&&(null==t?void 0:t.disconnectType)!==w.DisconnectType.Offline){if(3===e||4===e){if((null==t?void 0:t.disconnectType)===w.DisconnectType.BrokenConnection)return void this._renderSpinner();this._renderBrokerSelectScreen()}1===e&&(null===(s=this._trading.activeBroker())||void 0===s||s.currentAccountUpdate.subscribe(this,this._renderAccountManager),this._renderAccountManager())}else this._renderSpinner()}_renderComponent(){Oe.render(ve.createElement(Rt.AdaptivePopupDialog,{dataName:"trading-dialog",isOpened:this.visible().value(),onClose:this._handleClose,showSeparator:this._showSeparator,fullScreen:!0,draggable:!1,title:this._title,render:()=>this._content,additionalHeaderElement:this._additionalHeaderElement,additionalElementPos:"after",headerClassName:Xt.header}),this._container)}_renderSpinner(){this._showSeparator=!0,this._title=Yt,this._changeDialogContent(ve.createElement(Ut.Spinner,null))}_renderOfflineScreen(){this._title=Yt,this._changeDialogContent(ve.createElement(OfflineScreen,null))}async _renderBrokerSelectScreen(){{const{BrokerSelectScreenRenderer:e}=await Promise.all([i.e(88548),i.e(29928),i.e(80914),i.e(41446),i.e(51098),i.e(71754)]).then(i.bind(i,305114)),t=new e(null,this._trading),s=await t.createComponent(),r=ve.createElement("div",{className:Xt.brokerSelectScreenWrapper},s);this._showSeparator=!0,this._title=Yt,this._changeDialogContent(r)}}async _renderAccountManager(){const e=(0,s.ensureNotNull)(this._trading.activeBroker()).accountManagerInfo().summary,t=new jt.SummaryFieldsVisibilityManager(e,this._trading.getBrokerTradingSettingsStorage),r=await(0,Qt.makeAccountManagerHeaderDropdownsProps)(this._trading,t,0);if(this._showSeparator=!1,this._title=Yt,void 0!==r){const{AccountManagerHeaderDropdowns:e}=await Promise.all([i.e(72639),i.e(89842),i.e(68992),i.e(88548),i.e(81643),i.e(36747),i.e(91033),i.e(48155),i.e(45896),i.e(46036),i.e(49205),i.e(22486),i.e(52251),i.e(12494),i.e(80914),i.e(68439),i.e(41446),i.e(94643),i.e(81721),i.e(23718),i.e(52931),i.e(95008),i.e(86045),i.e(65747),i.e(9050),i.e(9555),i.e(8480),i.e(88354)]).then(i.bind(i,249147));this._title=ve.createElement(e,{...r}),this._additionalHeaderElement=ve.createElement(Zt,{...r.accountDropdownProps})}this._content=ve.createElement(zt,{broker:this._trading.activeBroker(),summaryFieldsVisibilityManager:t}),this._renderComponent()}_changeDialogContent(e){this._content=ve.createElement(Ft,null,e),this._renderComponent()}}var ti,ii=i(67003),si=i(638456),ri=i(139195);async function ni(e,t){localStorage.setItem(e,await(0,ri.userSpecificEncrypt)(t))}!function(e){e.get=async function(){return si.CheckMobile.any()||await async function(){const e=n.getValue(W.settingsKeys.ACTIVE_BROKER);if(n.remove(W.settingsKeys.ACTIVE_BROKER,{forceFlush:!0}),void 0===e)return;await ni(W.settingsKeys.ACTIVE_BROKER,e)}(),async function(e){0
;const t=localStorage.getItem(e);if(null===t)return null;const i=await(0,ri.userSpecificDecrypt)(t);null===i&&localStorage.removeItem(e);return i}(W.settingsKeys.ACTIVE_BROKER)},e.set=async function(e){await ni(W.settingsKeys.ACTIVE_BROKER,e)},e.clear=function(){n.remove(W.settingsKeys.ACTIVE_BROKER,{forceFlush:!0}),localStorage.removeItem(W.settingsKeys.ACTIVE_BROKER)}}(ti||(ti={}));var oi=i(960521),ai=i.n(oi),li=i(173587),ci=i(233064),di=i(218286),ui=i(169977),hi=i(312694),pi=i(410923),gi=i(265728),_i=i(482165),mi=i(678515),bi=i(192685);class vi{constructor(e){this._rawAndFilteredQtyMap=new Map,this._qtyInfo=new Map;const{symbolInfoGetter:t,onResetNeeded:i,qtySettingsStorageGetter:s}=e;this._getQtySettingsStorage=s,this._getSymbolInfo=t,i.subscribe(this,this._reset)}async getQty(e){return(0,pi.firstValueFrom)(this._getRawAndFilteredQty(e).filteredQty$)}setQty(e,t){this._getRawAndFilteredQty(e).rawQty$.next(t)}suggestedQtyChanged(e){return this._getRawAndFilteredQty(e).filteredQty$.pipe((0,li.skip)(1))}_getRawAndFilteredQty(e){var t;return null!==(t=this._rawAndFilteredQtyMap.get(e))&&void 0!==t?t:this._makeRawAndFilteredQty(e)}_makeRawAndFilteredQty(e){const t=new gi.ReplaySubject(1),i=this._getInitialQty(e).pipe((0,ci.switchMap)((e=>t.pipe((0,_.startWith)(e)))),(0,di.distinctUntilChanged)(),(0,ui.filter)((t=>this._isQtyCorrect(e,t))),(0,_i.tap)((t=>{var i;return null===(i=this._getQtySettingsStorage())||void 0===i?void 0:i.setSymbolQty(e,t)})),(0,hi.share)({connector:()=>new gi.ReplaySubject(1),resetOnRefCountZero:!1})),s={rawQty$:t,filteredQty$:i};return this._rawAndFilteredQtyMap.set(e,s),s}_isQtyCorrect(e,t){const i=(0,s.ensureDefined)(this._qtyInfo.get(e));return!(0,bi.checkQtyError)(i,t,!0).res}_getInitialQty(e){return(0,v.from)(this._getSymbolInfo(e)).pipe((0,h.map)((({qty:t})=>{var i;this._qtyInfo.set(e,t);const s=null===(i=this._getQtySettingsStorage())||void 0===i?void 0:i.symbolQty(e),r=t.default||t.min;return void 0!==s&&s>0?(n=(0,mi.clamp)(s,t.min,t.max),o=t.min,a=t.step,ai()(n).minus(o).div(a).round(0,1).mul(a).plus(o).toNumber()):r;var n,o,a})))}_reset(){this._rawAndFilteredQtyMap.forEach((({rawQty$:e})=>e.complete())),this._rawAndFilteredQtyMap.clear(),this._qtyInfo.clear()}}var yi=i(316230);class fi{constructor(){this._context=null,this._onContextChanged=new V.Delegate,this._contextChange=()=>{this._onContextChanged.fire(this.context())}}context(){var e,t;return null!==(t=null===(e=this._context)||void 0===e?void 0:e.externalContext())&&void 0!==t?t:null}setContext(e){var t,i;this._isEqualContexts(e)||(this._clearSubscription(),this._context=e,null===(t=this._context)||void 0===t||t.onStatusChange().subscribe(this,this._contextChange),null===(i=this._context)||void 0===i||i.onDataChange().subscribe(this,this._contextChange),this._contextChange())}onContextChanged(){return this._onContextChanged}clear(){this.setContext(null)}_clearSubscription(){var e,t;null===(e=this._context)||void 0===e||e.onDataChange().unsubscribeAll(this),
null===(t=this._context)||void 0===t||t.onStatusChange().unsubscribeAll(this)}_isEqualContexts(e){var t;return null===this._context||null===e?this._context===e:(null===(t=this.context())||void 0===t?void 0:t.type)===(null==e?void 0:e.externalContext().type)&&(this._context.status()===e.status()&&(0,yi.default)(this._context.errors(),e.errors())&&(0,yi.default)(this._context.data(),e.data()))}}var wi=i(583912);function ki(){var e;return null!==(e=wi.linking.ensuredProSymbol.value())&&void 0!==e?e:wi.linking.proSymbol.value()}class Si{constructor(e){this._onSymbolChange=e=>{this._processSymbol(null,e)},this._processSymbol=async(e,t)=>{if(void 0===this._continuousFrontContractExtractor)return void this._value.next({symbol:t});const i=this._continuousFrontContractExtractor.makeValueObservable(t).subscribe((e=>this._value.next(e)));null==e||e.addEventListener("abort",(()=>i.unsubscribe()),{once:!0})},this._getContinuousFrontContractExtractor=e;const t=ki();this._value=new d.BehaviorSubject({symbol:t});void 0!==(this._continuousFrontContractExtractor=e())&&this._onSymbolChange(t),this._processSymbol=(0,A.respectLatest)(this._processSymbol),wi.linking.ensuredProSymbol.subscribe(this._onSymbolChange)}reset(){this._continuousFrontContractExtractor=this._getContinuousFrontContractExtractor(),this._onSymbolChange(ki())}value(){return this._value.getValue()}async setSymbol(e){const t=(0,pi.firstValueFrom)(this._value.pipe((0,ui.filter)((t=>t.continuous===e||void 0===t.continuous&&t.symbol===e))));wi.linking.setSymbolAndLogInitiator(e,"trading linking"),await t}valueObservable(){return this._value.asObservable()}}class Pi{constructor(){this._title$=new d.BehaviorSubject(""),this._description$=new d.BehaviorSubject(void 0),this._symbol$=new d.BehaviorSubject(""),this._hasBatsQuotes$=new d.BehaviorSubject(!1),this._hasDelayedQuotes$=new d.BehaviorSubject(!1),this._isTradable$=new d.BehaviorSubject(!1),this._backFunction$=new d.BehaviorSubject(void 0),this._closeFunction$=new d.BehaviorSubject(void 0),this._cancelFunction$=new d.BehaviorSubject(void 0),this._informerMessage$=new d.BehaviorSubject(void 0),this._settings$=new d.BehaviorSubject(void 0),this.title$=this._title$.asObservable(),this.description$=this._description$.asObservable(),this.symbol$=this._symbol$.asObservable(),this.hasBatsQuotes$=this._hasBatsQuotes$.asObservable(),this.hasDelayedQuotes$=this._hasDelayedQuotes$.asObservable(),this.isTradable$=this._isTradable$.asObservable(),this.backFunction$=this._backFunction$.asObservable(),this.closeFunction$=this._closeFunction$.asObservable(),this.cancelFunction$=this._cancelFunction$.asObservable(),this.informerMessage$=this._informerMessage$.asObservable(),this.settings$=this._settings$.asObservable()}setTitle(e){this._title$.next(e)}setDescription(e){this._description$.next(e)}setSymbol(e){this._symbol$.next(e)}setHasBatsQuotes(e){this._hasBatsQuotes$.next(e)}setHasDelayedQuotes(e){this._hasDelayedQuotes$.next(e)}setIsTradable(e){this._isTradable$.next(e)}setBackFunction(e){this._backFunction$.next(e)}
setCloseFunction(e){this._closeFunction$.next(e)}setCancelFunction(e){this._cancelFunction$.next(e)}setInformerMessage(e){this._informerMessage$.next(e)}setSettings(e){this._settings$.next(e)}}var Ci=i(314802),Bi=i(779923),Ti=i(646417);const Ei={logIn:r.t(null,void 0,i(571891)),GotIt:r.t(null,void 0,i(875139))};class Oi{constructor(){this._hintTooltip=null,this._tooltipRendererModulePromise=null}drawAttention(){const e=document.querySelector("."+k.bottomTradingTabClassName);this._loadOrShowHint(e,Ti.TradingWizardHintType.NeedBrokerSignIn)}needSignIn(e,t){this._loadOrShowHint(e,Ti.TradingWizardHintType.NeedSignIn,{action:t,text:Ei.logIn})}showTooltipOverSelectBrokerButton(e){this._loadOrShowHint(e,Ti.TradingWizardHintType.AboutFavoritesBrokers)}destroy(){null!==this._hintTooltip&&this._hintTooltip.destroy()}_loadOrShowHint(e,t,s,r){null!==e&&O.enabled("popup_hints")&&(this._hintTooltip?this._hintTooltip.show(e,t,s,r):null===this._tooltipRendererModulePromise&&(this._tooltipRendererModulePromise=Promise.resolve().then(i.bind(i,646417)).then((i=>{this._hintTooltip=new i.TradingToolipRenderer,this._hintTooltip.show(e,t,s,r)}))))}}var Ii=i(254601),xi=i(711803),Ni=i(653501),Vi=i(822122),Li=i(175203),Ai=i(347236),Mi=i(978137);async function Di(e){const t={...e,timestamp:Date.now()};return t.tvUsername=(await(0,Ai.signDataWithSha256Hmac)(t.tvUsername,"dBuCh3nK0")).toBase64(),t}function Ri(e,t){const i=Math.ceil(e),s=Math.floor(t);return Math.floor(Math.random()*(s-i))+i}let Wi;function Fi(e){return Wi=null!=Wi?Wi:new TextEncoder,Wi.encode(e).length}function Hi(e,t,i){const{payload:s,action:r,...n}=e;return{...n,action:"internal-message.large-log",payload:{message:`Too large log, size ${t} bytes is larger than maximum size ${i} bytes`,triggeredLog:JSON.stringify({action:r,payload:s}).slice(0,1e3)+"..."}}}const qi="trading";class $i extends class{constructor(e){this._events=[],this._delayedLogsInfo=new Map,this._isPageUnloading=!1,this._retries=0,this._pushInterval=Ri(5e3,1e4),this._restorePushingInterval=Ri(18e5,27e5),this._delayLog=async e=>{const t=this._delayedLogsInfo.get(e);if(void 0!==t)return this._delayedLogsInfo.delete(e),this._log(t.event)},this._pageUnloadingHandler=async()=>{this._isPageUnloading||"visible"===document.visibilityState||0===this._events.length||(this._isPageUnloading=!0,this._addDelayedEventsToQueue(),await this._push(),this._isPageUnloading=!1)},this._logger=e,document.addEventListener("beforeunload",this._pageUnloadingHandler),document.addEventListener("visibilitychange",this._pageUnloadingHandler)}async log(e){const t=await Di(e);return this._log(t)}async debounceLog(e,t,i){const s=await Di(e),r=this._delayedLogsInfo.get(t);if(void 0!==r)return void(r.event=s);const n={event:s};this._delayedLogsInfo.set(t,n),n.timerId=setTimeout(this._delayLog,i,t)}async _log(e){this._events.push(e),this._setPushTimer()}_addDelayedEventsToQueue(){const e=Array.from(this._delayedLogsInfo.values()).map((({event:e,timerId:t})=>(clearTimeout(t),e)));this._delayedLogsInfo.clear(),this._events.concat(e)}
_setPushTimer(){void 0===this._pushTimerId&&(this._pushTimerId=setTimeout((async()=>{this._pushTimerId=void 0,await this._push()}),this._pushInterval))}_setRestorePushingTimer(){void 0===this._restorePushingTimerId&&(this._logger.logInfo(`Stop pushing logs. Will try to restore pushing after ${Math.round(this._restorePushingInterval/60/1e3)} minutes`),this._restorePushingTimerId=setTimeout((()=>{this._logger.logInfo("Restore pushing logs."),this._restorePushingTimerId=void 0,this._events=[],this._retries=0}),this._restorePushingInterval))}async _push(){if(await(0,Mi.waitForOnline)(),0===this._events.length||this._retries>=5)return;const e=this._events;try{this._events=[],await this._send(e,this._isPageUnloading),this._retries=0,0!==this._events.length&&this._setPushTimer()}catch(t){if(this._retries++,this._logger.logError(`Failed to send events to Server logger: ${(0,C.getErrorMessage)(t)}. Retries count: ${this._retries}`),this._retries>=5)return void this._setRestorePushingTimer();this._events.push(...e),this._setPushTimer()}}}{constructor(e,t){super(t),this._url=e}async _send(e,t){const{convertedEvents:i,remainingEvents:r}=function(e,t){const i=[...e],r=[];let n=0;for(let o=0;o<e.length;o++){let e=(0,s.ensureDefined)(i.shift(),"Logger event"),o=JSON.stringify(e),a=Fi(o);if(a>t&&(e=Hi(e,a,t),o=JSON.stringify(e),a=Fi(o)),n+=a,n>t){i.unshift(e);break}r.push({data:e})}return{convertedEvents:JSON.stringify(r),remainingEvents:i}}(e,5242880);this._events.unshift(...r);const n=new Blob([i],{type:"application/json"});let o=!1;if(t&&n.size<32768)o=navigator.sendBeacon(this._url,n);else try{o=(await fetch(this._url,{method:"POST",body:n})).ok}catch(e){throw Li.telemetry.sendReport(qi,"logstash_fetch_error"),e}if(!o)throw Li.telemetry.sendReport(qi,"logstash_data_not_queued_error"),new Error("The data wasn't queued for transfer.")}}var zi=i(10787);class Ui{constructor(e){this._subscribedBroker=null,this.sendReport=(e,t)=>{this._sendReport(e,t)},this._trading=e,this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange)}_onStatusChange(e,t){if(null!==this._subscribedBroker&&(this._subscribedBroker.tradingOperationFinished.unsubscribe(this,this._sendOperationReport),this._subscribedBroker=null),1===e){const e=(0,s.ensureNotNull)(this._trading.activeBroker());e.tradingOperationFinished.subscribe(this,this._sendOperationReport),this._subscribedBroker=e,this._sendReport("connection_success")}4!==e&&(null==t?void 0:t.disconnectType)!==w.DisconnectType.APIError||(this._sendReport("connection_fail"),"Paper"===(0,s.ensureNotNull)(this._trading.activeBroker()).metainfo().id&&this._trading.trackEvent("BrokerTelemetry","Paper Connection Error",navigator.onLine.toString())),(null==t?void 0:t.disconnectType)!==w.DisconnectType.BrokenConnection||si.CheckMobile.any()&&"hidden"===document.visibilityState||this._sendReport("broken_connection")}_sendOperationReport(e){this._sendReport(e?"operation_success":"operation_fail")}_sendReport(e,t){const i=this._subscribedBroker||this._trading.activeBroker();if(null===i)return
;const s=(i.metainfo().telemetryId||i.metainfo().id).toLowerCase();Li.telemetry.sendReport("trading",`${s}_${e}`,void 0!==t?{value:t}:void 0)}}var Qi=i(226722),ji=i(268222),Gi=i(541558);function Ki(e){return void 0===e?"allowed_with_warning":(0,ee.isFeatureEnabled)("disallow_concurrent_sessions")?e:"disallowed"===e?"allowed_with_warning":e}class Ji{constructor(e){Qi.TVXWindowEvents.on("CheckConcurrentSessionsAllowanceStatus",(t=>{const i=e();if(null===i||i.metainfo().id!==function(e){return e.split("+")[0]}(t))return;const s=Ki(i.metainfo().concurrentSessionsAllowance);Qi.TVXWindowEvents.emit("ConcurrentSessionsAllowanceStatus",s)}))}async getConcurrentSessionAllowanceStatus(e){const t=(0,ji.createDeferredPromise)(),i=function(e){return`${e}+${(0,Gi.randomHash)()}`}(e),s=e=>{clearTimeout(r),t.resolve(e)};Qi.TVXWindowEvents.on("ConcurrentSessionsAllowanceStatus",s);const r=setTimeout((()=>t.resolve("allowed")),100);Qi.TVXWindowEvents.emit("CheckConcurrentSessionsAllowanceStatus",i);try{return await t.promise}finally{Qi.TVXWindowEvents.off("ConcurrentSessionsAllowanceStatus",s)}}}class Zi{constructor(e){this._transientStorage={},this._persistentStorageKey=`trading.${e}`;const t=n.getJSON(this._persistentStorageKey,{});delete t.orderTicketQuantity,this._transientStorage=t}setTakeProfitPips(e,t,i){this._setPips("takeProfit",e,t,i)}takeProfitPips(e){return this._getSectionValue("takeProfit",e)}setStopLossPips(e,t,i){this._setPips("stopLoss",e,t,i)}stopLossPips(e){return this._getSectionValue("stopLoss",e)}setDuration(e,t,i){const s=this.duration(e,t);null!==i&&void 0!==s&&s.type===i.type&&s.datetime===i.datetime||null===i&&void 0===s||(this._setDuration(e,t,i),this._syncStorage())}duration(e,t){var i;return this._migrateDuration(e,t),null===(i=this._getSectionValue("duration",e))||void 0===i?void 0:i[t]}setSymbolQty(e,t){this._getOrCreateSection("qty")[e]=t,this._syncStorage()}symbolQty(e){return this._getSectionValue("qty",e)}setCustomFields(e,t,i){var s,r,n;const o=this._getOrCreateSection("customFields");null!==(s=o[e])&&void 0!==s||(o[e]={}),null!==(r=(n=o[e])[t])&&void 0!==r||(n[t]={});const a=o[e][t];for(const[e,t]of Object.entries(i))"string"==typeof t&&""!==t||"boolean"==typeof t?a[e]=t:delete a[e];0===Object.keys(a).length&&delete o[e][t],0===Object.keys(o[e]).length&&delete o[e],this._syncStorage()}customFields(e,t,i){this._migrateCustomFields(e,t,i);const s={},r=this._transientStorage.customFields;if(void 0===r||void 0===r[e])return s;const n=r[e][t];return void 0===n||i.forEach((e=>{const t=n[e];""!==t&&void 0!==t&&(s[e]=t)})),s}orderType(e){return this._getSectionValue("orderType",e)}setOrderType(e,t){this._getOrCreateSection("orderType")[e]=t,this._syncStorage()}setTableColumnsOrder(e,t){this._getOrCreateSection("tableColumnsOrder")[e]=t,this._syncStorage()}tableColumnsOrder(e){return this._getSectionValue("tableColumnsOrder",e)}setOrderSizeCalculatorState(e,t){null===t?this._removeValue("orderSizeCalculatorState",e):this._getOrCreateSection("orderSizeCalculatorState")[e]={...t},this._syncStorage()}
orderSizeCalculatorState(e){const t=this._getSectionValue("orderSizeCalculatorState",e);return void 0!==t?{...t}:void 0}summaryFieldsVisibilityInfo(){const e=new Map,t=this._transientStorage.summaryFields;if(void 0===t)return e;for(const[i,s]of Object.entries(t))e.set(i,{id:i,visible:s});return e}setSummaryFieldsVisibilityInfo(e){e.forEach((({id:e,visible:t})=>{this._getOrCreateSection("summaryFields")[e]=t})),this._syncStorage()}_getOrCreateSection(e){return e in this._transientStorage||(this._transientStorage[e]={}),this._transientStorage[e]}_getSectionValue(e,t){const i=this._transientStorage[e];return void 0!==i?i[t]:void 0}_removeValue(e,t){const i=this._transientStorage[e];void 0!==i&&(delete i[t],0===Object.keys(i).length&&delete this._transientStorage[e])}_setPips(e,t,i,s){const r=this._getSectionValue(e,t);if(!(void 0!==r&&r===i||void 0===r&&i===s)){if(void 0!==r&&i===s)this._removeValue(e,t);else{this._getOrCreateSection(e)[t]=i}this._syncStorage()}}_setDuration(e,t,i){var s;const r=this._getOrCreateSection("duration");if(null===i){if(void 0===r[e])return;return delete r[e][t],void(0===Object.keys(r[e]).length&&delete r[e])}null!==(s=r[e])&&void 0!==s||(r[e]={}),r[e][t]=i}_migrateCustomFields(e,t,i){const s={},r=this._transientStorage.customFields;void 0===r||"object"==typeof r&&void 0!==r[e]||(i.forEach((t=>{const i=r[`${e}.${t}`];""!==i&&void 0!==i&&(s[t]=i,this._removeValue("customFields",`${e}.${t}`))})),this.setCustomFields(e,t,s))}_migrateDuration(e,t){const i=this._getSectionValue("duration",e);if("string"!=typeof i)return;const s={type:i},r=this._getSectionValue("durationDatetime",e);"number"==typeof r&&(s.datetime=r,this._removeValue("durationDatetime",e)),this._removeValue("duration",e),this._setDuration(e,t,s),this._syncStorage()}_syncStorage(){n.setJSON(this._persistentStorageKey,this._transientStorage)}}class Xi extends Zi{constructor(e,t){super(e),this._orderType=t}setDuration(e,t,i){var s;return super.setDuration(e,null!==(s=this._orderType)&&void 0!==s?s:t,i)}duration(e,t){var i;return super.duration(e,null!==(i=this._orderType)&&void 0!==i?i:t)}setCustomFields(e,t,i){var s;return super.setCustomFields(e,null!==(s=this._orderType)&&void 0!==s?s:t,i)}customFields(e,t,i){var s;return super.customFields(e,null!==(s=this._orderType)&&void 0!==s?s:t,i)}}var Yi=i(979157),es=i(930635);const ts=r.t(null,void 0,i(697174));class is{constructor(e,t){this._handleValuesChange=([e,t])=>(e.activeChartWidget!==t.activeChartWidget&&(this._hintRenderer.destroy(),this._hintRenderer=new this._hintRendererModule.ChartWarningHintRenderer(t.activeChartWidget)),t.isInstantTradingEnabled&&void 0!==t.warningMessage?this._hintRenderer.show({warningHeader:ts,text:t.warningMessage}):this._hintRenderer.hide());const{activeChartWidget:i,isInstantTradingEnabled:s,warningMessage$:r}=t;this._hintRendererModule=e,this._activeChartWidget=(0,rt.makeObservableFromWatchedValue)(i),this._isInstantTradingEnabled=(0,rt.makeObservableFromWatchedValue)(s);const n={activeChartWidget:i.value(),isInstantTradingEnabled:s.value(),
warningMessage:void 0};this._hintRenderer=new this._hintRendererModule.ChartWarningHintRenderer(n.activeChartWidget),this._valuesSubscription=(0,m.combineLatest)({activeChartWidget:this._activeChartWidget,isInstantTradingEnabled:this._isInstantTradingEnabled,warningMessage:r}).pipe((0,_.startWith)(n),(0,Yi.debounceTime)(100),(0,es.pairwise)()).subscribe(this._handleValuesChange)}destroy(){this._hintRenderer.destroy(),this._valuesSubscription.unsubscribe()}static async create(e){const t=await Promise.all([i.e(32109),i.e(6209),i.e(28497),i.e(962),i.e(83129)]).then(i.bind(i,629981));return new is(t,e)}}var ss=i(710078),rs=i(336397),ns=i(876332),os=i(14558),as=i(839391),ls=i.n(as);class cs{constructor(e){this._cache=new Map,this._quoteSessionSubscriptionsInfo=new Map,this._get=async e=>{const t=[].concat(...e),i=Array.from(new Set(t)),s={},r={};for(const e of i){if(""===e)throw new Error("Symbol is empty string");const t=this._cache.get(e);if(void 0!==t)s[e]=t.promise;else{const{resolve:t,promise:i}=(0,ji.createDeferredPromise)(),n={promise:i,isResolved:!1};i.then((()=>{n.isResolved=!0})),this._cache.set(e,n),s[e]=i,r[e]=t}}const n=(0,Gi.guid)(),o=Object.keys(r);return this._quoteSessionSubscriptionsInfo.set(n,{symbols:o,remainedSymbols:new Set(o)}),this._quoteSessionMultiplexer.subscribe(n,o,this._makeQuoteDataHandler(r,n)),Promise.all(t.map((e=>s[e])))},this._onQuoteData=(e,t,i,r)=>{const n=e.symbolname;if(void 0!==n&&this._isRequiredDataReceived(e)){t[n](e.values);const o=(0,s.ensureDefined)(this._quoteSessionSubscriptionsInfo.get(r),"quoteSessionSubscriptionInfo");o.remainedSymbols.delete(n),0===o.remainedSymbols.size&&(this._quoteSessionSubscriptionsInfo.delete(r),this._quoteSessionMultiplexer.unsubscribe(r,o.symbols,i))}};const{requiredFields:t,additionalFields:i,quoteSessionMultiplexerType:r="simple"}=e;this._requiredFields=t,this._additionalFields=i,this._quoteSessionMultiplexer=(0,ns.getQuoteSessionInstance)(r),this.get=ls()(this._get,50,{accumulate:!0})}invalidateCache(e){const t=this._cache.get(e);void 0!==t&&t.isResolved&&this._cache.delete(e)}_makeQuoteDataHandler(e,t){const i=s=>this._onQuoteData(s,e,i,t);return i}_isRequiredDataReceived(e){const t=Object.keys(e.values);let i;return i=void 0===this._additionalFields?[this._requiredFields]:this._additionalFields.map((e=>[...this._requiredFields,...e])),i.some((e=>e.every((e=>t.includes(e)))))||void 0!==e.complete}}const ds=new Map;const us=3e5,hs=2147483647;function ps(e){return r.t(null,{replace:{frontContract:e}},i(360549))}function gs(e){return r.t(null,{replace:{frontContract:e}},i(353386))}class _s{constructor(){this._symbols$=new Map,this._addWarningBeforeSwitching=async(e,t)=>{if(void 0===t.switchTime||void 0===t.continuous)throw new Error("Symbol is not continuous");if(null==e?void 0:e.aborted)throw new Error("Signal is already aborted");const i=t.symbol.split(":")[1],s={...t,warning:gs(i)},r=1e3*t.switchTime-window.ChartApiInstance.serverTime()-us;if(r<0)return s;const n=(0,
ji.createDeferredPromise)(),o=r>hs,a=os.workerBasedTimers.setTimeout((()=>o?n.resolve(this._addWarningBeforeSwitching(e,t)):n.resolve(s)),o?hs:r);return null==e||e.addEventListener("abort",(()=>{os.workerBasedTimers.clearTimeout(a),n.reject()}),{once:!0}),n.promise}}destroy(){this._symbols$.clear()}async makeValue(e){const t=this._symbols$.get(e);return void 0!==t?(0,pi.firstValueFrom)(t):this._makeValue(e)}makeValueObservable(e){const t=this._symbols$.get(e);if(void 0!==t)return t;const i=new AbortController,s=(0,A.respectLatest)(this._addWarningBeforeSwitching),r=(0,v.from)(this._makeValue(e)).pipe((0,ci.switchMap)((e=>this._makeValueChangeObservable(e).pipe((0,_.startWith)(e),(0,b.mergeMap)((e=>(0,v.from)(s(i.signal,e).catch((()=>null))).pipe((0,ui.filter)((e=>null!==e)),(0,_.startWith)(e))))))),(0,ss.finalize)((()=>{i.abort(),this._symbols$.delete(e)})),(0,rs.shareReplay)({bufferSize:1,refCount:!0}));return this._symbols$.set(e,r),r}async _makeValue(e){return e.includes("1!")?this._makeContinuousValue(e):{symbol:e}}_makeValueChangeObservable(e){if(void 0===e.continuous||void 0===e.switchTime)return f.EMPTY;const t=this._quoteSession(),i=(0,Gi.guid)(),[s,r]=e.symbol.split(":");return(0,g.fromEventPattern)((s=>t.subscribe(i,e.continuous,s)),(s=>t.unsubscribe(i,e.continuous,s))).pipe((0,h.map)((([{values:e}])=>({frontContract:e.front_contract,switchTime:e["front-contract-switch-time"]}))),(0,ui.filter)((e=>void 0!==e.frontContract&&e.frontContract!==r&&void 0!==e.switchTime)),(0,h.map)((t=>({symbol:`${s}:${t.frontContract}`,continuous:e.continuous,switchTime:t.switchTime,message:ps(t.frontContract)}))),(0,di.distinctUntilChanged)(((e,t)=>e.continuous===t.continuous&&e.symbol===t.symbol&&e.switchTime===t.switchTime&&e.warning===t.warning&&e.message===t.message)))}_quoteStaticInfoManager(){var e;return null!==(e=this._quoteStaticInfoManagerInstance)&&void 0!==e?e:this._quoteStaticInfoManagerInstance=function(e){const{requiredFields:t,additionalFields:i,quoteSessionMultiplexerType:s}=e,r=t.sort().join();let n=`${s}+${r}`;void 0!==i&&(n=`${s}+${r}+${i.map((e=>e.sort().join())).sort().join("|")}`);const o=ds.get(n);if(void 0!==o)return o;const a=new cs(e);return ds.set(n,a),a}({requiredFields:["front_contract","front-contract-switch-time","listed_exchange","typespecs"],quoteSessionMultiplexerType:"full"})}async _makeContinuousValue(e){const t=this._quoteStaticInfoManager();t.invalidateCache(e);const{front_contract:i,listed_exchange:s,"front-contract-switch-time":r,typespecs:n}=await t.get(e);if(!n.includes("continuous")||void 0===i||void 0===r)return{symbol:e};const o={symbol:`${s}:${i}`,continuous:e,switchTime:r,message:ps(i)};return 1e3*o.switchTime-window.ChartApiInstance.serverTime()<us&&(o.warning=gs(i)),o}_quoteSession(){var e;return null!==(e=this._quoteSessionInstance)&&void 0!==e?e:this._quoteSessionInstance=(0,ns.getQuoteSessionInstance)("full")}}function ms(e){const{solutionId:t}=e,s=r.t(null,{replace:{link_start:`<a href="?solution=${t}">`,link_end:"</a>"}},i(91757));return ve.createElement("div",{
dangerouslySetInnerHTML:{__html:s}})}var bs=i(177259),vs=i(11429),ys=i(497754),fs=i.n(ys),ws=i(591800),ks=i(604286),Ss=i(886495);function Ps(e){const{children:t,tooltipText:i,tooltipHotKey:s}=e;return ve.createElement("span",{className:fs()("apply-common-tooltip",Ss.content),"data-tooltip-hotkey":s,title:i},ve.createElement("span",{className:Ss.contentInner},t))}const Cs=(0,ks.hotKeySerialize)({keys:[(0,ws.humanReadableModifiers)(ws.Modifiers.Shift,!1),"T"],text:"{0} + {1}"}),Bs=(0,ks.hotKeySerialize)({keys:[(0,ws.humanReadableModifiers)(ws.Modifiers.Shift,!1),"D"],text:"{0} + {1}"});const Ts=(0,B.getLogger)("Trading.Core"),Es={1:"Connected",2:"Connecting",3:"Disconnected",4:"Error"},Os="alert/alarm_clock";function Is(e){return(0,l.alertSounds)().some((t=>e===t.path))}const xs=O.enabled("buy_sell_buttons"),Ns=(0,ee.isFeatureEnabled)("show_concurrent_connection_warning"),Vs=!0,Ls=window.TRADING_SERVER_LOGGER_URL,As=void 0!==Ls&&(0,ee.isFeatureEnabled)("enable_trading_server_logger"),Ms=(0,ee.isFeatureEnabled)("continuous_front_contract_trading"),Ds="Shortcut";class Rs{constructor(e,t){this.accountType=new N.WatchedValue,this.onBrokerChange=new V.Delegate,this.onBrokerLoading=new V.Delegate,this.onConnectionStatusChange=new V.Delegate,this.onNewNotification=new V.Delegate,this.onNeedSelectBroker=new V.Delegate,this.onNotificationsChanged=new V.Delegate,this.showTradedSources=new N.WatchedValue(!0),this.showSellBuyButtons=new N.WatchedValue,this.noConfirmEnabled=new N.WatchedValue,this.showOnlyRejectionNotifications=new N.WatchedValue,this.showPricesWithZeroVolume=new N.WatchedValue,this.showSpread=new N.WatchedValue,this.orderExecutedSoundParams=function(){const e=Is(Os)?Os:(0,l.alertSounds)()[0].path;return{enabled:new N.WatchedValue(!1),path:new N.WatchedValue(e)}}(),this._activeBroker=null,this._orderViewController=null,this._orderControllerPromise=null,this._brokerCommandsUI=null,this._showPricesWithZeroVolume=new N.WatchedValue,this._showSpread=new N.WatchedValue,this._closePositionDialogVisibility=new M.DialogVisibility,this._orderDialogVisibility=new M.DialogVisibility,this._loginDialogVisibility=new M.DialogVisibility,this._tradingPanelPopupVisibility=new M.DialogVisibility,this._tradingSettingsStorage=null,this._offlineListener=this._offlineHandler.bind(this),this._onlineListener=this._onlineHandler.bind(this),this._notifications=[],this._account=null,this._domPanelVisibility=new N.WatchedValue(!1),this._orderPanelVisibility=new N.WatchedValue(!1),this._pipValueType$=new d.BehaviorSubject(w.PipValueType.None),this._switchingBroker=!1,this._isReconnectNeeded=!1,this._accountVerificationPromise=null,this._chartWidgetCollection=null,this._tradedItemsChartCollectionFacadePromise=null,this._tradeNowBrokerId=null,this.getBrokerTradingSettingsStorage=()=>this._tradingSettingsStorage,this.trackEvent=(e,t,i)=>{const s=e?`[${e}] ${t}`:t;if(this._gui()){const e=this._activeBroker?this._activeBroker.metainfo().id+" Trading":"Trading No Broker",t=this._activeBroker?this._activeBroker.currentAccountType():void 0
;this._gui().trackEvent(e,s,i||t)}},this.showErrorNotification=(e,t,i=25e3)=>{this._showNotification(e,t,"danger",i),O.enabled("show_trading_notifications_history")&&this._addNotificationRow(e,t,"danger",i),this._log(e,t)},this.setDOMPanelVisibility=(e,t=!0)=>{e&&t&&!this._makeSureCanTrade()||(e?this.tradingPanel.openPage(D.TradingPage.DOMPanel):this.tradingPanel.close())},this.setOrderPanelVisibility=async(e,t=!0)=>{if(e&&t&&!this._makeSureCanTrade())return;const{openPanel:i,closePanel:s}=await this._getOrderViewController();e?await i():await s()},this.getTradeNowBrokerId=()=>this._tradeNowBrokerId,this.clearTradeNowBrokerId=()=>{this._tradeNowBrokerId=null},this.toggleTradingPanelVisibility=async()=>{const e=this._orderDialogVisibility.getValue().isVisible,t=this.tradingPanel.isOpened.value();e?this.setDOMPanelVisibility(!t):this._updateTradingPanelVisibility({isOpened:!t})},this._handleVisibilityChange=()=>{null!==this._activeBroker&&this._activeBroker.metainfo().configFlags.usesWSConnection&&"visible"!==document.visibilityState&&(this._isReconnectNeeded=!0,this._selectBrokerInternal({brokerId:null,isUserAction:!1,keepSessionAlive:!1,disconnectInfo:{disconnectType:w.DisconnectType.BrokenConnection}}).then((()=>{if(this._isReconnectNeeded)return this._tryReconnectLastBroker()})))},this._tryReconnectLastBroker=async()=>{if(this._isReconnectNeeded){if("hidden"===document.visibilityState)return window.addEventListener("visibilitychange",this._tryReconnectLastBroker,{once:!0});this._isReconnectNeeded=!1,await this._selectLastBroker()}},this._onCurrentAccountUpdate=()=>{const e=(0,s.ensureNotNull)(this._activeBroker).currentAccount();this._account!==e&&(this._tradedContextLinking.clear(),this._account=e,this.onNotificationsChanged.fire(this.getNotifications()))},this._onFullScreenDialogOpen=()=>{this._guiAccessor.closeAllNotifications()},this._setPipValueType=async()=>{const{symbol:e}=this._linking.value(),{type:t}=await this._realtimeProvider.symbolInfo(e),i="forex"===t?w.PipValueType.Pips:w.PipValueType.Ticks;this._pipValueType$.next(i)},this._trackNonTradableSymbol=async()=>{var e;if(1===(null===(e=this._activeBroker)||void 0===e?void 0:e.connectionStatus())){const{symbol:e}=this._linking.value();if(void 0===e)return;const t=await this._activeBroker.isTradable(e);t&&!t.tradable&&this.trackEvent("Symbol is not tradable",e)}},this._onBrokerChanged=e=>{if(null===e)return void(this._tradingSettingsStorage=null);const t=e.metainfo();this._tradingSettingsStorage=(0,ee.isFeatureEnabled)("order_type_specific_settings_saving")?new Zi(t.id):new Xi(t.id,(0,k.getDefaultOrderType)(t.configFlags))},this._tradeNow=async()=>{if(void 0!==window.TradingView.bottomWidgetBar&&null!==this._tradeNowBrokerId)try{await window.TradingView.bottomWidgetBar.toggleWidget("paper_trading",!0)}catch(e){this._tradingWizard.drawAttention()}},this._updateTradingPanelVisibility=e=>{
const{isOpeningAvailable:t=this.tradingPanel.isOpeningAvailable.value(),isOpened:i=this.tradingPanel.isOpened.value(),activePage:s=this.tradingPanel.activePage.value(),shouldCanTrade:r}=e,n=t&&i;s===D.TradingPage.OrderPanel?this.setOrderPanelVisibility(n,r):this.setDOMPanelVisibility(n,r)},this._toggleTradingPanelPage=e=>{e!==this.tradingPanel.activePage.value()&&(e===D.TradingPage.OrderPanel&&this.setOrderPanelVisibility(!0),e===D.TradingPage.DOMPanel&&this.setDOMPanelVisibility(!0))},this._onLinkingSymbolChange=e=>{var t;e.symbol!==(null===(t=this._tradedContextLinking.context())||void 0===t?void 0:t.data().symbol)&&this._tradedContextLinking.clear()},this._brokersRegistrationPromise=(0,vs.registerBrokers)(),this._linking=new Si((()=>this._continuousFrontContractExtractor)),this._abortController=new AbortController,this._setPipValueType=(0,E.sequentialize)(this._setPipValueType),this._selectBrokerInternal=(0,E.sequentialize)(this._selectBroker),void 0!==navigator.locks&&(this._selectBrokerInternal=e=>navigator.locks.request(`select-broker-${e.brokerId}`,{ifAvailable:!0},(t=>this._selectBroker({...e,hasConcurrentSession:null===t})))),this._showSellBuyButtonsKey=this._makeShowSellBuyButtonsKey(),this._resizerBridge=e,this._realtimeProvider=new U((()=>this.activeBroker()),this.onBrokerChange,this.onConnectionStatusChange,(e=>this.getActualSymbol(e))),this._positionService=new Ye.PositionsService(this),this._ordersService=new et.OrdersService(this),this._tradingStat=new G(this),this._serverLogger=As?new $i(Ls,Ts):null,this._tradedContextLinking=new fi,this.onBrokerChange.subscribe(this,this._onBrokerChanged),void 0!==t&&(t.subscribe(null,this._tradeNow,!0),this._tradeNowInit()),this.brokerTelemetry=new Ui(this),this._tradingWizard=new Oi,this._initPaidBrokersByUserRegion(),Ns&&(this._tradingXWindowEvents=new Ji((()=>this.activeBroker()))),this.tradingPanelPopup=new ei(this),this.tradingPanelPopup.visible().subscribe((e=>{e?(this._tradingPanelPopupVisibility.setValue({isVisible:e,isFullScreen:!0}),this._onFullScreenDialogOpen()):this._tradingPanelPopupVisibility.setValue({isVisible:e})}));const r=this._makeTradingPanelTabsConfig();this.tradingPanel=new Re(e,r);this._qtySuggester=new vi({onResetNeeded:this.onConnectionStatusChange,symbolInfoGetter:e=>this._realtimeProvider.symbolInfo(e),qtySettingsStorageGetter:()=>this._tradingSettingsStorage}),this._qtySuggesterWithOrderSizeCalculatorResetting={getQty:this._qtySuggester.getQty.bind(this._qtySuggester),suggestedQtyChanged:this._qtySuggester.suggestedQtyChanged.bind(this._qtySuggester),setQty:(e,t)=>{if(!(0,ee.isFeatureEnabled)("order_size_calculator"))return this._qtySuggester.setQty(e,t);const i=this._qtySuggester.suggestedQtyChanged(e).subscribe((()=>{var i;return null===(i=this._tradingSettingsStorage)||void 0===i?void 0:i.setOrderSizeCalculatorState(e,{calculationType:"units",value:t})}));this._qtySuggester.setQty(e,t),i.unsubscribe()}};const n=new Ce(e,(()=>this.tradingPanel.close()),this,this._qtySuggesterWithOrderSizeCalculatorResetting,this._linking,new Pi)
;this.tradingPanel.addPage(D.TradingPage.DOMPanel,n),this._orderPanelHeaderState=new Pi;const o=new Be(this._orderPanelHeaderState);this.tradingPanel.addPage(D.TradingPage.OrderPanel,o),this._updateTradingPanelVisibility({shouldCanTrade:!1}),(0,Te.isMobileTradingAvailable)()||this.tradingPanel.isOpeningAvailable.subscribe((async e=>{this._updateTradingPanelVisibility({isOpeningAvailable:e})})),(0,x.combine)((()=>({})),this.tradingPanel.activePage.weakReference(),this.tradingPanel.isOpened.weakReference()).subscribe((()=>{this._domPanelVisibility.setValue(this.tradingPanel.isPageOpened(D.TradingPage.DOMPanel)),this._orderPanelVisibility.setValue(this.tradingPanel.isPageOpened(D.TradingPage.OrderPanel))})),this.closePositionDialogVisibility=this._closePositionDialogVisibility.value$,this.orderDialogVisibility=this._orderDialogVisibility.value$,this.loginDialogVisibility=this._loginDialogVisibility.value$,this.possibleFullScreenDialogsVisibility=(0,u.merge)(this.closePositionDialogVisibility.pipe((0,h.map)((e=>({...e,name:"close-position-dialog"})))),this.orderDialogVisibility.pipe((0,h.map)((e=>({...e,name:"order-dialog"})))),this.loginDialogVisibility.pipe((0,h.map)((e=>({...e,name:"login-dialog"})))),this._tradingPanelPopupVisibility.value$.pipe((0,h.map)((e=>({...e,name:"trading-panel-popup"}))))),Promise.all([i.e(99900),i.e(34465),i.e(72639),i.e(69121),i.e(88194),i.e(87845),i.e(68992),i.e(88548),i.e(81643),i.e(29928),i.e(542),i.e(34545),i.e(6209),i.e(47981),i.e(929),i.e(80914),i.e(41446),i.e(34232),i.e(47302)]).then(i.bind(i,255146)).then((e=>{this.loginDialogRenderer=new e.LoginDialogRenderer((()=>this.selectBroker(null)),this.trackEvent,this.checkRealtimeDataPermissions.bind(this)),this.loginDialogRenderer.visibility.subscribe(this._makeDialogVisibilityHandler(this._loginDialogVisibility))})),this._linking.valueObservable().subscribe(this._onLinkingSymbolChange)}setChartWidgetCollection(e){(0,s.assert)(null===this._chartWidgetCollection,"ChartWidgetCollection can be set only once"),this._chartWidgetCollection=e,this._guiAccessor=new ie(e),new Ue(this),this._loadState(),n.onSync.subscribe(this,this._loadState);const t=()=>{this._save()};this.showSellBuyButtons.subscribe(t),this.noConfirmEnabled.subscribe(t),this.showOnlyRejectionNotifications.subscribe(t),this._showPricesWithZeroVolume.subscribe(t),this._showSpread.subscribe(t),this.orderExecutedSoundParams.enabled.subscribe(t),this.orderExecutedSoundParams.path.subscribe(t),window.addEventListener("offline",this._offlineListener),window.addEventListener("online",this._onlineListener),this.bindShortcuts(),window.loginStateChange.subscribe(null,(async()=>{window.is_authenticated&&!this._switchingBroker?await this.pickDefaultBroker():this.activeBroker()&&this.selectBroker(null,!0)})),setTimeout((async()=>{window.is_authenticated&&!this._switchingBroker&&await this.pickDefaultBroker()})),(0,Ci.isOnMobileAppPage)("old")&&window.addEventListener("visibilitychange",this._handleVisibilityChange),
this._tradedItemsChartCollectionFacadePromise=this._createTradedItemsChartCollectionFacade(e),this._registerCustomSources(e),this._registerCustomWidgets(e)}showPricesWith(){return{zeroVolume:this._showPricesWithZeroVolume,spread:this._showSpread}}domPanelVisibility(){return this._domPanelVisibility}orderPanelVisibility(){return this._orderPanelVisibility}realtimeProvider(){return this._realtimeProvider}toggleTradingPanelPopup(){this.tradingPanelPopup.visible().value()?this.tradingPanelPopup.hide():this.tradingPanelPopup.show()}toggleTradingWidget(){return window.TradingView.bottomWidgetBar?window.TradingView.bottomWidgetBar.activateTradingTab():Promise.resolve()}toggleMinimizeBottomWidgetBar(){if(window.TradingView.bottomWidgetBar)return window.TradingView.bottomWidgetBar.toggleMinimize()}bottomWidgetBarMode(){if(!window.TradingView.bottomWidgetBar)throw new Error("Unable to provide bottom widget mode: bottomWidgetBar undefined");return window.TradingView.bottomWidgetBar.mode()}tradingWizard(){return this._tradingWizard}showTradingProperties(){this._gui()&&this._gui().showTradingProperties()}linking(){return this._linking}async brokersMetainfo(){return await this._brokersRegistrationPromise,R.brokersList()}brokersList(){return(0,vs.getBrokersList)()}brokersPlans(){return this._getBrokersPlans()}activeBroker(){return this._activeBroker}brokerCommandsUI(){return this._brokerCommandsUI}async selectBroker(e,t){await this._selectBrokerInternal({brokerId:e,isUserAction:!0,keepSessionAlive:t})}async pickDefaultBroker(){if(this._activeBroker)return;let e=null;const t=(await this.brokersMetainfo()).filter((e=>!e.configFlags.isSuspended));{const i=await ti.get();i&&t.some((e=>e.id===i))&&(e=i)}e&&this._selectBrokerInternal({brokerId:e,isUserAction:!1})}async makeNewOrderContextMenuAction(e,t,s){const n=await this._qtySuggester.getQty(e);return{name:"trade-new-order",action:()=>{const{symbol:i}=this._linking.value();i!==e&&this._linking.setSymbol(e),this.trackEvent(t,"New Order"),this._checkAndOpenOrderDialog({symbol:e,qty:n,limitPrice:s,stopPrice:s})},text:(0,T.appendEllipsis)(r.t(null,void 0,i(967498))),statName:"NewOrder",shortcutHint:(0,a.humanReadableHash)(o.Modifiers.Shift+84)}}async defaultContextMenuActions(e,{onlyMainActions:t=!1,gaOrigin:s="Chart Context Menu",hideNotExecutableAction:n=!1}={}){const{symbol:o}=await this.getActualSymbol(e.symbol),a=(await Promise.all([this._makeSubActions(o,e,s,n),this.makeNewOrderContextMenuAction(o,s,e.value||void 0)])).flat();return!t&&O.enabled("property_pages")&&(a.push({separator:!0}),a.push({name:"trade-properties",action:()=>{this.trackEvent(s,"Trading Properties"),this.showTradingProperties()},text:(0,T.appendEllipsis)(r.t(null,void 0,i(873503))),iconId:"Settings",statName:"Properties"})),a}defaultDropdownMenuActions(e){const t="Bottom Panel Dropdown",s=[],n=this.activeBroker(),o=e||{tradingProperties:!0,restoreConfirmations:n&&n.metainfo().configFlags.supportConfirmations};return O.enabled("property_pages")||(o.tradingProperties=!1),o.tradingProperties&&s.push({action:()=>{
this.showTradingProperties(),this.trackEvent(t,"Trading Properties")},text:(0,T.appendEllipsis)(r.t(null,void 0,i(873503))),iconId:"Settings"}),o.restoreConfirmations&&s.push({action:()=>{this._showRestoreConfirmations(),this.trackEvent(t,"Restore confirmations")},text:(0,T.appendEllipsis)(r.t(null,void 0,i(102653)))}),s}chartContextMenuActions(e,t){return(this._activeBroker&&1===this._activeBroker.connectionStatus()?this._activeBroker.chartContextMenuActions(e,t):this.defaultContextMenuActions(e,t)).then((e=>(0,k.convertActionDescriptionsToActions)(e)))}connectStatus(){return this._activeBroker?this._activeBroker.connectionStatus():3}bindShortcuts(){if(this._hotkeys)return;this._hotkeys=o.createGroup({desc:"Trading"});const e=async e=>{const{symbol:t}=this._linking.value(),i={qty:await this._qtySuggester.getQty(t),side:e,symbol:t,type:2,seenPrice:null};this.trackEvent(Ds,-1===e?"Sell":"Buy",this._getInstantTradingEventLabel()),this._checkAndPlaceOrder(i)};this._hotkeys.add({desc:"Buy",hotkey:o.Modifiers.Shift+66,handler:()=>e(1)}),this._hotkeys.add({desc:"Sell",hotkey:o.Modifiers.Shift+83,handler:()=>e(-1)});const t=O.enabled("order_panel"),i=O.enabled("dom_widget");t&&this._hotkeys.add({desc:"Open/close Order Panel",hotkey:o.Modifiers.Shift+84,handler:()=>{if(!this.tradingPanel.isOpeningAvailable.value())return;const e=this.tradingPanel.isOpened.value()&&this.tradingPanel.activePage.value()===D.TradingPage.OrderPanel;this.trackEvent(Ds,e?"Close OT":"Open OT",this._getInstantTradingEventLabel()),this.setOrderPanelVisibility(!e)}}),i&&this._hotkeys.add({desc:"Open/close DOM",hotkey:o.Modifiers.Shift+68,handler:()=>{if(!this.tradingPanel.isOpeningAvailable.value())return;const e=this.tradingPanel.isOpened.value()&&this.tradingPanel.activePage.value()===D.TradingPage.DOMPanel;this.trackEvent(Ds,e?"Close DOM":"Open DOM",this._getInstantTradingEventLabel()),this.setDOMPanelVisibility(!e)}})}formatter(e){return this.realtimeProvider().formatter(e)}showSuccessNotification(e,t,i=1e4){this.showOnlyRejectionNotifications.value()||this._showNotification(e,t,"success",i),O.enabled("show_trading_notifications_history")&&this._addNotificationRow(e,t,"success",i),this._log(e,t)}getNotifications(){return this._notifications.filter((e=>e.account===this._account&&e.broker===(this._activeBroker?this._activeBroker.metainfo().id:null)))}orderViewController(){return(0,s.ensureNotNull)(this._orderViewController)}tradingStat(){return this._tradingStat}async verifyBrokerLiveAccount(){return this._verifyLiveAccount(),null!==this._accountVerificationPromise?this._accountVerificationPromise:Promise.reject("Account verification is not needed")}pipValueType(){return this._pipValueType$.asObservable()}tradedItemsChartCollectionFacade(){return(0,s.ensureNotNull)(this._tradedItemsChartCollectionFacadePromise)}async checkRealtimeDataPermissions(e){const t=(0,s.ensureNotNull)(this._activeBroker),{id:i,altBrokerId:r}=t.metainfo();await(0,
zi.checkRealtimeDataSubscription)(i,null!=e?e:t.getRealtimeDataCheckParams(),r)&&this._guiAccessor.reconnectChartApi(!0)}async removeRealtimeDataPermissions(){await(0,zi.removeRealtimeDataSubscription)((0,s.ensureNotNull)(this._activeBroker).metainfo().id)&&this._guiAccessor.reconnectChartApi(!0)}makeActualSymbolObservable(e){var t,i;return null!==(i=null===(t=this._continuousFrontContractExtractor)||void 0===t?void 0:t.makeValueObservable(e))&&void 0!==i?i:(0,p.of)({symbol:e})}async getActualSymbol(e){return void 0===this._continuousFrontContractExtractor?{symbol:e}:this._continuousFrontContractExtractor.makeValue(e)}getQtySuggester(){return this._qtySuggester}_getInstantTradingEventLabel(){return this.noConfirmEnabled.value()?"Instant":"Not Instant"}async _getOrderViewController(){return null!==this._orderViewController?this._orderViewController:(await this._createOrderController(),this._getOrderViewController())}async _selectBroker(e){var t,s;const{brokerId:n,isUserAction:o,keepSessionAlive:a=!1,disconnectInfo:l,hasConcurrentSession:c}=e;if(this._switchingBroker)return void Ts.logWarn(`Broker is already selected, but a new broker id: ${n} was received.`);const d=this._activeBroker?this._activeBroker.metainfo().id:null;if(n!==d)if(null===(t=this._linkingSubscription)||void 0===t||t.unsubscribe(),this._destroyContinuousFrontContractTrading(),n&&(0,ee.isFeatureEnabled)((0,k.makeMaintananceFeatureToggleName)(n))){const e=R.brokersList().filter((e=>e.id===n))[0];this._gui().showMaintenance(e.title)}else if(n&&(0,ee.isFeatureEnabled)((0,k.makeBrokerSideMaintananceFeatureToggleName)(n))){const e=R.brokersList().filter((e=>e.id===n))[0];this._gui().showBrokerSideMaintenance(e.title)}else{if(this._activeBroker){const e=this._activeBroker&&this._activeBroker.disconnectWarningMessage(),t=()=>this._showReviewDialogIfNeeded(3,{disconnectType:w.DisconnectType.LogOut});if(null!==e&&window.is_authenticated){if(!await(0,_e.showSimpleConfirmDialog)({title:r.t(null,void 0,i(349391)),text:e,mainButtonText:r.t(null,void 0,i(162058)),mainButtonIntent:"danger",cancelButtonText:r.t(null,void 0,i(620036)),onConfirm:()=>{t(),this._logOut(o,a,l)},onCancel:()=>{t()}}))return}else t(),this._logOut(o,a,l)}if(null!=n){if(this._tradeNowBrokerId=null,Ns){const e=c?Ki(R.getBrokerMetainfo(n).concurrentSessionsAllowance):await this._tradingXWindowEvents.getConcurrentSessionAllowanceStatus(n);if("allowed_with_warning"===e){if(!o)return;if(!await new Promise((e=>{(0,Bi.showConfirm)({title:r.t(null,void 0,i(587168)),text:r.t(null,void 0,i(975231)),mainButtonText:r.t(null,void 0,i(468988)),mainButtonIntent:"danger",cancelButtonText:r.t(null,void 0,i(620036)),onConfirm:({dialogClose:t})=>{e(!0),t()},onCancel:({dialogClose:t})=>{e(!1),t()},onClose:()=>{e(!1)}})})))return}if("disallowed"===e){if(!o)return;return void await new Promise((e=>{(0,Bi.showWarning)({title:r.t(null,void 0,i(587168)),text:r.t(null,void 0,i(219170)),buttonText:r.t(null,void 0,i(610393)),intentButton:"primary",onClose:e})}))}}let e;!function(){
if(!window.is_authenticated)throw Ts.logError("User is not logged in"),new Error("Please sign in first.")}(),this._switchingBroker=!0;e=(await this._getBrokersPlans()).filter((e=>e.slug_name===n))[0];try{const t=await R.createBrokerConnection(this,n,this._serverLogger,null,e),{isMaintenance:i,message:s}=await t.maintenanceStatus();if(i){if(!await this._showBrokerSideMaintenanceWarning(t.metainfo().id,s))return this._switchingBroker=!1,void t.disconnect(!0)}window.user.active_broker=e,await this._initBroker(t,a)}catch(e){this._switchingBroker=!1,Ts.logError((0,C.getLoggerMessage)(e))}}else o&&setTimeout((()=>{ti.clear(),delete window.user.active_broker})),this.onBrokerChange.fire(null),null===(s=this._closePositionDialogVisibilitySubscription)||void 0===s||s.unsubscribe(),this._brokerCommandsUI=null}else Ts.logWarn(`${n} is already selected.`)}_destroyContinuousFrontContractTrading(){var e,t;null===(e=this._chartTradingWarningManager)||void 0===e||e.destroy(),null===(t=this._continuousFrontContractExtractor)||void 0===t||t.destroy(),delete this._continuousFrontContractExtractor,this._linking.reset()}async _initContinuousFrontContractTrading(){var e,t;{if(!(Ms&&!(null===(e=this._activeBroker)||void 0===e?void 0:e.metainfo().configFlags.supportContinuousTrading)))return;this._continuousFrontContractExtractor=new _s,this._linking.reset();const i=null===(t=this._chartWidgetCollection)||void 0===t?void 0:t.activeChartWidget;if(void 0===i||null===this._activeBroker)return;const s=this._makeBrokerDependantWarningMessageObservable(this._activeBroker);this._chartTradingWarningManager=await is.create({activeChartWidget:i,warningMessage$:s,isInstantTradingEnabled:this.noConfirmEnabled})}}_makeTradingPanelTabsConfig(){return(0,Te.isMobileTradingAvailable)()?null:function(e){const{onSelect:t,orderPanelAvailable:s,domPanelAvailable:n}=e;return s&&n?{items:[{id:D.TradingPage.OrderPanel,children:ve.createElement(Ps,{tooltipText:r.t(null,void 0,i(986869)),tooltipHotKey:Cs},r.t(null,void 0,i(922541)))},{id:D.TradingPage.DOMPanel,children:ve.createElement(Ps,{tooltipText:r.t(null,void 0,i(763124)),tooltipHotKey:Bs},r.t(null,void 0,i(763124)))}],onSelect:t}:null}({onSelect:this._toggleTradingPanelPage,orderPanelAvailable:O.enabled("order_panel"),domPanelAvailable:O.enabled("dom_widget")})}_makeBrokerDependantWarningMessageObservable(e){let t,i=async(t,i)=>{const{tradable:s}=await(0,A.respectAbort)(t,e.isTradable(i));return s};i=(0,A.respectLatest)(i);try{t=e.currentAccount()}catch(e){}const s=(0,g.fromEventPattern)((t=>e.currentAccountUpdate.subscribe(null,t)),(t=>e.currentAccountUpdate.unsubscribe(null,t))).pipe((0,_.startWith)(t)),r=(0,g.fromEventPattern)((t=>e.connectionStatusUpdate.subscribe(null,t)),(t=>e.connectionStatusUpdate.unsubscribe(null,t))).pipe((0,_.startWith)(e.connectionStatus()));return(0,m.combineLatest)({value:this._linking.valueObservable(),currentAccountUpdate:s,connectionStatusUpdate:r}).pipe((0,b.mergeMap)((({value:e})=>(0,m.combineLatest)({isTradable:(0,v.from)(i(null,e.symbol)).pipe((0,_.startWith)(!1),(0,
y.catchError)((()=>f.EMPTY))),value:(0,p.of)(e)}))),(0,h.map)((e=>e.isTradable?e.value.warning:void 0)))}async _initBroker(e,t){this._activeBroker=e,this._activeBroker.connectionStatusUpdate.subscribe(this,this._connectionListener),this._activeBroker.currentAccountUpdate.subscribe(this,this._onCurrentAccountUpdate),this._realtimeProvider.onStatusChanged.subscribe(null,this._setPipValueType),this._realtimeProvider.onStatusChanged.subscribe(null,this._trackNonTradableSymbol),await this._initContinuousFrontContractTrading(),this._linkingSubscription=this._linking.valueObservable().subscribe((()=>{this._setPipValueType(),this._trackNonTradableSymbol()})),this._brokerCommandsUI=new Pe({activeBroker:this._activeBroker,guiAccessor:this._guiAccessor,noConfirmEnabled:this.noConfirmEnabled,orderViewController:this._getOrderViewController.bind(this),showErrorNotification:this.showErrorNotification.bind(this),trackEvent:this.trackEvent,tradingLinking:this._linking,abortSignalGetter:()=>this._abortController.signal}),this._closePositionDialogVisibilitySubscription=this._brokerCommandsUI.closePositionDialogVisibility.subscribe(this._makeDialogVisibilityHandler(this._closePositionDialogVisibility)),this._activeBroker.tryRestoreSession(),await ti.set(this._activeBroker.metainfo().id),this.onBrokerChange.fire(this._activeBroker),this._getOrderViewController(),this._updateConnectionStatus(this.connectStatus()),this._switchingBroker=!1}async _showBrokerSideMaintenanceWarning(e,t){return(0,_e.showSimpleConfirmDialog)({title:r.t(null,{replace:{brokerId:e}},i(103718)),text:null!=t?t:r.t(null,void 0,i(536263)),cancelButtonText:r.t(null,void 0,i(620036)),mainButtonIntent:"primary",mainButtonText:r.t(null,void 0,i(891268)),showBackdrop:!0})}_makeDialogVisibilityHandler(e){return t=>{e.setValue(t),t.isFullScreen&&this._onFullScreenDialogOpen()}}_gui(){return this._guiAccessor}_addNotificationRow(e,t,i,s){const r={id:this._notifications.length,account:this._account,broker:this._activeBroker?this._activeBroker.metainfo().id:null,time:new Date,title:e,text:t,type:i};this._notifications.push(r),this.onNewNotification.fire(r)}_offlineHandler(){this._selectBrokerInternal({brokerId:null,isUserAction:!1,keepSessionAlive:!1,disconnectInfo:{disconnectType:w.DisconnectType.Offline}}),Ts.logNormal("The connection to the Internet was interrupted")}async _onlineHandler(){await this._selectLastBroker()&&Ts.logNormal("The connection to the Internet was restored")}_showNotification(e,t,i,s){this._gui()&&this._gui().showNotification(e,t,i,s)}_showReviewDialogIfNeeded(e,t){if(null===this._activeBroker)return;const o=this._activeBroker;if((0,ee.isFeatureEnabled)("review_popup_on_chart")&&(1===e||3===e&&t&&t.disconnectType===w.DisconnectType.LogOut)){const t=o.brokerPlan();t&&t.plan_verbose!==Vi.BrokerPlans.Free&&this.verifyBrokerLiveAccount().then((()=>{Ni.BrokerReviewPageData.setBrokerData({brokerId:t.id,brokerName:t.name,brokerUsername:t.username,brokerSlugName:t.slug_name}),window.runOrSignIn((()=>(0,Ii.getBrokerReviewStatusOrShowError)().then((t=>{
const a=W.settingsKeys.LOGIN_COUNTER+"."+o.metainfo().id,l=W.settingsKeys.LOGOUT_COUNTER+"."+o.metainfo().id;if(t===xi.BrokerReviewStatus.NonExists){const t=n.getInt(a,0),o=n.getInt(l,0);if(1===e&&3===t||3===e&&o>0&&o%5==0){const t=(0,s.ensureNotNull)(Ni.BrokerReviewPageData.getBrokerData()),n="Chart page — connecting status "+(1===e?"connected":"disconnected"),o={title:r.t(null,void 0,i(451622)).format({broker_name:t.brokerName})};(0,Ii.openCreateBrokerReviewDialog)(0,!1,{dialogTexts:o,dataForStats:n})}1===e&&n.setValue(a,t+1,{forceFlush:!0}),3===e&&n.setValue(l,o+1,{forceFlush:!0})}else n.remove(a),n.remove(l,{forceFlush:!0})}))),{source:"Trading panel, leave broker review"})})).catch((e=>Ts.logWarn(e)))}}_connectionListener(e,t){const i=this.connectStatus();this._showReviewDialogIfNeeded(e,t);const s=this._isReconnectNeeded=(null==t?void 0:t.disconnectType)===w.DisconnectType.BrokenConnection;3!==e||(null==t?void 0:t.disconnectType)!==w.DisconnectType.LogOut&&!this._isReconnectNeeded||this._selectBrokerInternal({brokerId:null,isUserAction:!1,keepSessionAlive:!1,disconnectInfo:t}).then((()=>{if(this._isReconnectNeeded)return this._tryReconnectLastBroker()})),(null==t?void 0:t.disconnectType)===w.DisconnectType.CancelAuthorization&&this.trackEvent("Signin","OAuth popup closed","By user"),(null==t?void 0:t.disconnectType)===w.DisconnectType.TimeOutForAuthorization&&this.trackEvent("Signin","OAuth popup closed","By timeout"),this._updateConnectionStatus(i,!s,t)}async _selectLastBroker(){const e=await ti.get();return null!==e&&(await this._selectBrokerInternal({brokerId:e,isUserAction:!1}),!0)}_updateOrderPanelSpinnerState(){const e=this._orderViewController,t=2===this.connectStatus(),i=null!==e&&e.stateChanging.value();this.tradingPanel.isLoading.setValue(t||i)}async _updateConnectionStatus(e,t=!0,s){var n,o;this._updateOrderPanelSpinnerState(),this.onConnectionStatusChange.fire(e,s),this._log("Connection status",Es[e]);const a=this._activeBroker;if(this._abortController.abort(),this._abortController=new AbortController,t){const e=null===(n=this._activeBroker)||void 0===n?void 0:n.metainfo().id;void 0!==e?await ti.set(e):ti.clear()}if(null!==this._activeBroker)if(3!==e&&4!==e||this._updateTradingPanelVisibility({isOpened:!1}),1===e){this._account=this._activeBroker.currentAccount(),this._guiAccessor.setBroker(this._activeBroker);{await this._checkOrRemoveRealtimeDataIfNeeded(this._activeBroker.metainfo());const e=this._activeBroker.connectWarningMessage();null!==e&&(0,_e.showSimpleConfirmDialog)({title:r.t(null,void 0,i(195033)),text:e.message,mainButtonText:r.t(null,void 0,i(468988)),mainButtonIntent:"primary",checkboxLabel:r.t(null,void 0,i(913898)),showDisableConfirmationsCheckbox:null===(o=e.skippable)||void 0===o||o,showCancelButton:!1}),this._verifyLiveAccount()}}else this._tradedContextLinking.clear();else this._accountVerificationPromise=null,this._updateTradingPanelVisibility({isOpened:!1}),this._guiAccessor.setBroker(null),this._tradedContextLinking.clear()
;void 0!==this.loginDialogRenderer&&a===this._activeBroker&&(await this.loginDialogRenderer.updateStatus(a,e,s),this.loginDialogRenderer.visible().value()&&this.tradingPanelPopup.visible().value()&&this.tradingPanelPopup.hide())}async _checkOrRemoveRealtimeDataIfNeeded(e){if(!e.configFlags.supportRealtimeDataCheck)return;const{realtimeDataPermissionsToggleConfig:t}=e;if(void 0===t)return void this.checkRealtimeDataPermissions();const s=`${W.settingsKeys.REALTIME_DATA_ACCEPTED}.${e.id}`;switch(n.getValue(s)){case"true":return void this.checkRealtimeDataPermissions();case"false":return void this.removeRealtimeDataPermissions();default:const e=await function(e){const{solutionId:t,...i}=e;return(0,_e.showSimpleConfirmDialog)({...i,footer:ve.createElement(ms,{solutionId:t})})}({title:t.enableRealtimeDataPermissionsTitleText,text:t.enableRealtimeDataPermissionsToggleText,mainButtonText:r.t(null,void 0,i(83453)),cancelButtonText:r.t(null,void 0,i(546472)),showCloseButton:!1,closeOnOutsideClick:!1,mainButtonIntent:"primary",closeOnEscapePress:!1,solutionId:t.solutionId,showBackdrop:!0,closeOnBackDropClick:!1});e?await this.checkRealtimeDataPermissions():await this.removeRealtimeDataPermissions(),n.setValue(s,e)}}_verifyLiveAccount(){const e=(0,s.ensureNotNull)(this._activeBroker);null===this._accountVerificationPromise&&e.metainfo().configFlags.supportVerifyLiveAccount&&e.checkUserHasLiveAccount()&&(this._accountVerificationPromise=(0,zi.verifyLiveAccount)(e))}_save(){const e=n.getJSON(W.settingsKeys.PROPERTIES,{});n.setJSON(W.settingsKeys.PROPERTIES,{...e,[this._showSellBuyButtonsKey]:+!!this.showSellBuyButtons.value(),noConfirmEnabled:+!!this.noConfirmEnabled.value(),qweqrq:+!!this.showOnlyRejectionNotifications.value(),showPricesWithZeroVolume:+!!this._showPricesWithZeroVolume.value(),showSpread:+!!this._showSpread.value(),orderExecutedSoundParams:JSON.stringify({enabled:+!!this.orderExecutedSoundParams.enabled.value(),name:this.orderExecutedSoundParams.path.value()})})}_loadState(){const e=n.getJSON(W.settingsKeys.PROPERTIES,{}),t=e[this._showSellBuyButtonsKey];if(this.showSellBuyButtons.setValue(void 0!==t?!!t:Vs),this.noConfirmEnabled.setValue(!!e.noConfirmEnabled),this.showOnlyRejectionNotifications.setValue(!!e.qweqrq),this._showPricesWithZeroVolume.setValue(!e.hasOwnProperty("showPricesWithZeroVolume")||Boolean(e.showPricesWithZeroVolume)),this._showSpread.setValue(!e.hasOwnProperty("showSpread")||Boolean(e.showSpread)),e.hasOwnProperty("orderExecutedSoundParams")){const t=JSON.parse(e.orderExecutedSoundParams);this.orderExecutedSoundParams.enabled.setValue(!!t.enabled),this.orderExecutedSoundParams.path.setValue(Is(t.name)?t.name:this.orderExecutedSoundParams.path.value())}}_makeShowSellBuyButtonsKey(){return(0,Te.isMobileTradingAvailable)()?"showSellBuyButtonsMobile":"showSellBuyButtons"}_log(e,t){Ts.logNormal(`${this._activeBroker?this._activeBroker.metainfo().id+" Trading: ":""}${e} - ${t}`)}_makeSureCanTrade(){const e=this.activeBroker(),t=this.brokerCommandsUI(),i=(0,Te.isMobileTradingAvailable)()
;return e&&t?1===e.connectionStatus()||(i?this.toggleTradingPanelPopup():this.toggleTradingWidget(),!1):(i?(this.toggleTradingPanelPopup(),this.onNeedSelectBroker.fire()):this.toggleTradingWidget().then((()=>this.onNeedSelectBroker.fire())),!1)}_checkAndPlaceOrder(e,t=!0){this._makeSureCanTrade()&&(0,s.ensureNotNull)(this.brokerCommandsUI()).placeOrder(e,t)}_checkAndOpenOrderDialog(e){this._makeSureCanTrade()&&(0,s.ensureNotNull)(this.brokerCommandsUI()).placeOrder(e)}_makeSubAction({symbol:e,side:t,orderType:s,orderPrices:n,currentQuotes:o,qty:a,gaOrigin:l}){const c=1===t?"Trading.Buy":"Trading.Sell",d=1===t?"Buy":"Sell",u=1===s?"Limit":3===s?"Stop":"StopLimit",h=function(e){return"altPrice"in e&&"formattedAltPrice"in e}(n),p=e.split(":")[1],g=d+u,_={BuyLimit:r.t(null,void 0,i(302122)).format({symbol:p,qty:(0,I.abbreviatedNumber)(a),value:n.formattedPrice}),SellStop:r.t(null,void 0,i(627392)).format({symbol:p,qty:(0,I.abbreviatedNumber)(a),value:n.formattedPrice}),SellLimit:r.t(null,void 0,i(476678)).format({symbol:p,qty:(0,I.abbreviatedNumber)(a),value:n.formattedPrice}),BuyStop:r.t(null,void 0,i(255481)).format({symbol:p,qty:(0,I.abbreviatedNumber)(a),value:n.formattedPrice})};return h&&(_.SellStopLimit=r.t(null,void 0,i(194240)).format({symbol:p,qty:(0,I.abbreviatedNumber)(a),value:n.formattedPrice,altValue:n.formattedAltPrice}),_.BuyStopLimit=r.t(null,void 0,i(353343)).format({symbol:p,qty:(0,I.abbreviatedNumber)(a),value:n.formattedPrice,altValue:n.formattedAltPrice})),{name:`trade-${d}-${u}`.toLowerCase(),action:()=>{this.trackEvent(l,`${d} ${u}`);const i=1===s?"limitPrice":"stopPrice",r=1===t?null==o?void 0:o.ask:null==o?void 0:o.bid,c={qty:a,side:t,symbol:e,type:s,seenPrice:null!=r?r:null,currentQuotes:o};null!==n.price&&(c[i]=n.price),4===s&&h&&(c.limitPrice=n.altPrice),this._checkAndPlaceOrder(c)},iconId:c,text:_[g],statName:g}}_createOrderController(){return null===this._orderControllerPromise&&(this._orderControllerPromise=Promise.all([i.e(94689),i.e(20660)]).then(i.bind(i,500458)).then((({OrderViewController:e})=>new e({tradingCommands:{resizerBridge:this._resizerBridge,onNeedSelectBroker:this.onNeedSelectBroker,realtimeProvider:this.realtimeProvider(),pipValueType$:this.pipValueType(),trackEvent:this.trackEvent,toggleTradingWidget:this.toggleTradingWidget.bind(this),toggleTradingPanelPopup:this.toggleTradingPanelPopup.bind(this),showErrorNotification:this.showErrorNotification.bind(this),getTradingSettingsStorage:()=>this._tradingSettingsStorage},tradingPanelCommands:{container:this.tradingPanel.container,isOpened:this.tradingPanel.isOpened,isOpeningAvailable:this.tradingPanel.isOpeningAvailable,activePage:this.tradingPanel.activePage,close:this.tradingPanel.close.bind(this.tradingPanel),openPage:this.tradingPanel.openPage.bind(this.tradingPanel)},qtySuggester:this._qtySuggester,tradingLinking:this._linking,orderViewHeaderState:this._orderPanelHeaderState,tradedContextLinking:(0,ee.isFeatureEnabled)("enable_traded_context_linking")?this._tradedContextLinking:void 0}))).then((e=>{
this._orderControllerPromise=null,this._orderViewController=e,this._orderViewController.stateChanging.subscribe((()=>this._updateOrderPanelSpinnerState())),this._orderViewController.dialogVisibility.subscribe(this._makeDialogVisibilityHandler(this._orderDialogVisibility))}))),this._orderControllerPromise}async _registerCustomSources(e){!async function(e,t){const s=await Promise.all([i.e(91033),i.e(73534),i.e(28345),i.e(42650)]).then(i.bind(i,914949));e.addCustomSource("bidask",((i,r)=>new s.BidAsk(i,r,t.realtimeProvider(),(()=>{e.activeChartWidget.value().showGeneralChartProperties(L.TabNames.symbol)}))))}(e,this),Xe(e,this,this.showTradedSources);new((await Promise.all([i.e(91033),i.e(73534),i.e(28345),i.e(51652)]).then(i.bind(i,512393))).TradedSourcesManager)(this._ordersService,this._positionService,e,{activeTradedLinking:this._tradedContextLinking,showTradedSources:this.showTradedSources,realtimeProvider:this._realtimeProvider,qtySuggester:this._qtySuggesterWithOrderSizeCalculatorResetting,brokerCommandsUI:this.brokerCommandsUI.bind(this),trackEvent:this.trackEvent,pipValueType$:this.pipValueType(),makeActualSymbolObservable:this.makeActualSymbolObservable.bind(this),getSymbolSpecificTradingOptions:e=>(0,s.ensureNotNull)(this._activeBroker).getSymbolSpecificTradingOptions(e)})}_registerCustomWidgets(e){xs&&function(e,t,i){e.addCustomWidgetToLegend(((e,s)=>{const r=e.mainSeries(),n=(0,Je.createWVFromGetterAndSubscription)(e.isInReplay.bind(e),e.onInReplayStateChanged()),o=(0,Je.createWVFromGetterAndSubscriptions)((()=>{var e;return"economic"===(null===(e=r.symbolInfo())||void 0===e?void 0:e.type)}),[r.dataEvents().symbolResolved(),r.dataEvents().symbolError()]);return new Mt(r.dataEvents(),function(e){return()=>{const t=e.symbolInfo();return null!==t?t.pro_name||"":e.proSymbol()}}(r),o.ownership(),i,{onNeedSelectBroker:t.onNeedSelectBroker,realtimeProvider:t.realtimeProvider(),onBrokerConnectionStatusChange:t.onConnectionStatusChange,brokerConnectionStatus:t.connectStatus.bind(t),trackEvent:t.trackEvent,toggleTradingWidget:t.toggleTradingWidget.bind(t),toggleTradingPanelPopup:t.toggleTradingPanelPopup.bind(t),brokerCommandsUI:t.brokerCommandsUI.bind(t),toggleMinimizeBottomWidgetBar:()=>t.toggleMinimizeBottomWidgetBar(),makeActualSymbolObservable:t.makeActualSymbolObservable.bind(t)},{showSellBuyButtons:t.showSellBuyButtons.spawnOwnership(),noConfirmEnabled:t.noConfirmEnabled.spawnOwnership(),themeName:s.ownership()},n.ownership(),e.collapsed().spawnOwnership())}),{block:0,position:0})}(e,this,this._qtySuggesterWithOrderSizeCalculatorResetting)}async _makeSubActions(e,t,i,s=!1){if(null===t.value||(0,c.isNaN)(t.value))return[];const r=this.activeBroker();let n,o,a,l,d,u,h,p,g,_,m,b,v,y=null===r,f=null===r,w=!s&&null===r,B=!s&&null!==r,T=!s&&null===r;null!==r&&1===r.connectionStatus()&&(v=await r.isTradable(e))
;const[E,O,I,{ask:x,bid:N},V]=await Promise.all([this._qtySuggester.getQty(e),this._realtimeProvider.symbolInfo(e),this._realtimeProvider.formatter(e),this._realtimeProvider.quotesSnapshot(e),null==r?void 0:r.getSymbolSpecificTradingOptions(e)]);if(void 0===x||void 0===N||t.value<x&&t.value>N)return[];const L=O.variableMinTick?(0,P.makeVariableMinTickData)(O.minTick,O.variableMinTick):void 0,A=e=>(0,P.getMinTick)({minTick:O.minTick,price:e,variableMinTickData:L});if(null!==r&&v&&v.tradable){const e=r.metainfo().configFlags,i=(0,S.alignToStep)(t.value,A(t.value));n=i,a=i,l=i,o=i,d=l+A(l),u=o-A(o),y=Boolean(e.supportLimitOrders&&(0,k.isOrderTypeAllowed)(1,null==V?void 0:V.allowedOrderTypes)),f=Boolean(e.supportStopOrders&&(0,k.isOrderTypeAllowed)(3,null==V?void 0:V.allowedOrderTypes)),T=Boolean(e.supportStopLimitOrders&&(0,k.isOrderTypeAllowed)(4,null==V?void 0:V.allowedOrderTypes)),w=Boolean(e.supportStopOrdersInBothDirectionsInUI),B=Boolean(e.supportStopLimitOrdersInBothDirections),void 0!==O.limitPriceStep&&(n=(0,C.roundToStepByPriceTypeAndSide)(t.value,O.limitPriceStep,1,1),a=(0,C.roundToStepByPriceTypeAndSide)(t.value,O.limitPriceStep,1,-1),d=(0,C.roundToStepByPriceTypeAndSide)(t.value+A(t.value),O.limitPriceStep,1,1),u=(0,C.roundToStepByPriceTypeAndSide)(t.value-A(t.value),O.limitPriceStep,1,-1)),void 0!==O.stopPriceStep&&(l=(0,C.roundToStepByPriceTypeAndSide)(t.value,O.stopPriceStep,2,1),o=(0,C.roundToStepByPriceTypeAndSide)(t.value,O.stopPriceStep,2,-1)),h=I.format(n),p=I.format(o),g=I.format(a),_=I.format(l),m=I.format(d),b=I.format(u)}else n=a=l=o=t.value,h=p=g=_=t.formattedValue,d=l+A(l),u=o-A(o),m=I.format(d),b=I.format(u);const M={ask:x,bid:N},D=(N+x)/2,R=[];if(t.value<=D){if(y){const t={price:n,formattedPrice:h};R.push(this._makeSubAction({symbol:e,side:1,orderType:1,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:M}))}if(w){const t={price:l,formattedPrice:_};R.push(this._makeSubAction({symbol:e,side:1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:M}))}if(f||w){const t={price:o,formattedPrice:p};R.push(this._makeSubAction({symbol:e,side:-1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:M}))}if(T){const t={symbol:e,side:-1,orderType:4,orderPrices:{price:o,formattedPrice:p,altPrice:u,formattedAltPrice:b},qty:E,gaOrigin:i,currentQuotes:M};R.push(this._makeSubAction(t)),B&&R.push(this._makeSubAction({...t,side:1}))}}else{if(y){const t={price:a,formattedPrice:g};R.push(this._makeSubAction({symbol:e,side:-1,orderType:1,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:M}))}if(w){const t={price:o,formattedPrice:p};R.push(this._makeSubAction({symbol:e,side:-1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:M}))}if(f||w){const t={price:l,formattedPrice:_};R.push(this._makeSubAction({symbol:e,side:1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:M}))}if(T){const t={symbol:e,side:1,orderType:4,orderPrices:{price:l,formattedPrice:_,altPrice:d,formattedAltPrice:m},qty:E,gaOrigin:i,currentQuotes:M};R.push(this._makeSubAction(t)),B&&R.push(this._makeSubAction({...t,side:-1}))}}return R}
_initPaidBrokersByUserRegion(){this._brokersPlansPromise=(0,bs.getBrokersPlans)().catch((e=>(Ts.logWarn("Failed to fetch brokers info: "+e),[])))}async _getBrokersPlans(){let e=[];try{if(e=await this._brokersPlansPromise,!Array.isArray(e))throw new Error("Request result is not valid")}catch(e){Ts.logError(`Failed to fetch broker list by user region: ${e.message}`)}return e}async _showRestoreConfirmations(){const e=await(0,_e.showSimpleConfirmDialog)({title:r.t(null,void 0,i(102653)),text:r.t(null,void 0,i(526227)),mainButtonIntent:"primary"});null!==this._activeBroker&&e&&(new ii.DisabledConfirmations).clear()}_logOut(e,t,i){const r=(0,s.ensureNotNull)(this._activeBroker);r.connectionStatusUpdate.unsubscribe(this,this._connectionListener),r.currentAccountUpdate.unsubscribe(this,this._onCurrentAccountUpdate),this._realtimeProvider.onStatusChanged.unsubscribe(null,this._setPipValueType),this._realtimeProvider.onStatusChanged.unsubscribe(null,this._trackNonTradableSymbol),r.disconnect(t||!e),r.destroy(),this._activeBroker=null,this._updateConnectionStatus(3,e,i)}async _createTradedItemsChartCollectionFacade(e){return new((await Promise.all([i.e(91033),i.e(73534),i.e(28345),i.e(42650)]).then(i.bind(i,798498))).TradedItemsChartCollectionFacade)(e)}_tradeNowInit(){const e=new URL(decodeURIComponent(window.location.href)),t=e.searchParams.get("trade-now");e.searchParams.delete("trade-now"),window.history.replaceState(null,document.title,e.toString()),null===t||(0,Te.isMobileTradingAvailable)()||(this._tradeNowBrokerId=t,ti.clear())}}},941838:(e,t,i)=>{"use strict";i.d(t,{abbreviatedNumber:()=>a,roundedAbbreviatedNumber:()=>l});var s=i(960521),r=i(182436);const n=["","K","M","G","T","P"];function o(e){return e<n.length?n[e]:"e"+3*e}function a(e){if(e<1)return r.NumericFormatter.formatNoE(e);let t=0,i=+e;if(isFinite(i))for(;i>=1e3&&i%100==0;)t++,i/=1e3;return i+o(t)}function l(e){try{const t=new s.Big(e);if(t.abs().lt(1)){const e=(t.toFixed().split(".")[1]||"").length;return t.toFixed(Math.min(e,6))}const i=function(e){return Math.abs(e)>=1e5?Math.trunc(Math.log10(Math.abs(e))/3):0}(e);return t.div(1e3**i).round(2,s.Big.roundDown).toString()+o(i)}catch(t){return e.toString()}}},605587:(e,t,i)=>{"use strict";i.d(t,{withDialogLazyLoad:()=>o});var s=i(50959),r=i(640027),n=i(903535);function o(e){return t=>{const i=(0,r.useIsMounted)();return((0,n.useIsOpenedOnes)(t.isOpen)||t.isOpen)&&i?s.createElement(s.Suspense,{fallback:null},s.createElement(e,{...t})):null}}},347236:(e,t,i)=>{"use strict";async function s(e,t){const i=(s=t,Uint8Array.from(s,(e=>e.charCodeAt(0))));var s;const r=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),n=(new TextEncoder).encode(e),o=await crypto.subtle.sign("HMAC",r,n);return{value:o,toBase64:()=>{return e=o,btoa(String.fromCharCode.apply(null,new Uint8Array(e)));var e},toHex:()=>{return e=o,Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("");var e}}}i.d(t,{signDataWithSha256Hmac:()=>s})},191035:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 4a2 2 0 0 0 1.59-.79c.5.14.98.34 1.42.6L12 4a2 2 0 0 0 2.2 2c.25.43.45.9.59 1.41a2 2 0 0 0 0 3.18c-.14.5-.34.98-.6 1.42a2 2 0 0 0-2.18 2.18c-.44.26-.92.46-1.42.6a2 2 0 0 0-3.18 0c-.5-.14-.98-.34-1.42-.6L6 14a2 2 0 0 0-2.2-2 5.96 5.96 0 0 1-.59-1.41 2 2 0 0 0 0-3.18c.14-.5.34-.98.6-1.42L4 6a2 2 0 0 0 2-2.2c.43-.25.9-.45 1.41-.59A2 2 0 0 0 9 4zm1.53-1.83c-.29-.07-.54.16-.7.4a1 1 0 0 1-1.65 0c-.17-.24-.42-.47-.7-.4a6.9 6.9 0 0 0-2.27.94c-.23.15-.26.47-.22.75L5 4a1 1 0 0 1-1.14.99c-.28-.04-.6-.01-.75.22a6.96 6.96 0 0 0-.94 2.26c-.07.29.16.54.4.7a1 1 0 0 1 0 1.65c-.24.17-.47.42-.4.7.18.82.5 1.59.94 2.27.15.23.47.26.75.22L4 13a1 1 0 0 1 .99 1.14c-.04.28-.01.6.22.75.68.44 1.45.76 2.26.94.29.07.54-.16.7-.4a1 1 0 0 1 1.65 0c.17.24.42.47.7.4a6.9 6.9 0 0 0 2.27-.94c.23-.15.26-.47.22-.75a1 1 0 0 1 1.13-1.13c.28.04.6.01.75-.22.44-.68.76-1.45.94-2.26.07-.29-.16-.54-.4-.7a1 1 0 0 1 0-1.65c.24-.17.47-.42.4-.7a6.96 6.96 0 0 0-.94-2.27c-.15-.23-.47-.26-.75-.22a1 1 0 0 1-1.13-1.13c.04-.28.01-.6-.22-.75a6.96 6.96 0 0 0-2.26-.94zM9 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/></svg>'},634369:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M13 5.5c0-.28.22-.5.5-.5h1c.28 0 .5.22.5.5v1.55l.4.09c.9.18 1.73.53 2.46 1.02l.34.23.29-.3.81-.8c.2-.2.52-.2.71 0l.7.7.36-.35-.35.35c.2.2.2.51 0 .7l-.82.82-.29.29.23.34c.49.73.84 1.57 1.02 2.46l.08.4h1.56c.28 0 .5.22.5.5v1a.5.5 0 0 1-.5.5h-1.55l-.09.4a6.8 6.8 0 0 1-1.02 2.46l-.23.34.3.29.8.81c.2.2.2.52 0 .71l-.7.7a.5.5 0 0 1-.7 0l-.82-.8-.29-.3-.34.23c-.73.49-1.57.84-2.46 1.02l-.4.08v1.56a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1.55l-.4-.09a6.96 6.96 0 0 1-2.46-1.02l-.34-.23-.29.3-.81.8.35.36-.35-.35a.5.5 0 0 1-.71 0l-.7-.71a.5.5 0 0 1 0-.7l-.36-.36.35.35.82-.81.29-.29-.23-.34a6.96 6.96 0 0 1-1.02-2.46l-.08-.4H5.5a.5.5 0 0 1-.5-.5v-1c0-.28.22-.5.5-.5h1.55l.09-.4a6.8 6.8 0 0 1 1.02-2.46l.23-.34-.3-.29-.8-.81a.5.5 0 0 1 0-.71l.7-.7c.2-.2.51-.2.7 0l.82.8.29.3.34-.23a6.96 6.96 0 0 1 2.46-1.02l.4-.08V5.5zm.5-1.5c-.83 0-1.5.67-1.5 1.5v.75c-.73.2-1.43.48-2.06.86l-.54-.53a1.5 1.5 0 0 0-2.12 0l-.7.7a1.5 1.5 0 0 0 0 2.12l.53.54A7.95 7.95 0 0 0 6.25 12H5.5c-.83 0-1.5.67-1.5 1.5v1c0 .83.67 1.5 1.5 1.5h.75c.2.73.48 1.43.86 2.06l-.53.54a1.5 1.5 0 0 0 0 2.12l.7.7a1.5 1.5 0 0 0 2.12 0l.54-.53a7.8 7.8 0 0 0 2.06.86v.75c0 .83.67 1.5 1.5 1.5h1c.83 0 1.5-.67 1.5-1.5v-.75a7.95 7.95 0 0 0 2.06-.86l.54.53a1.5 1.5 0 0 0 2.12 0l.7-.7a1.5 1.5 0 0 0 0-2.12l-.53-.54a7.8 7.8 0 0 0 .86-2.06h.75c.83 0 1.5-.67 1.5-1.5v-1c0-.83-.67-1.5-1.5-1.5h-.75a7.95 7.95 0 0 0-.86-2.06l.53-.54a1.5 1.5 0 0 0 0-2.12l-.7-.7a1.5 1.5 0 0 0-2.12 0l-.54.53A7.95 7.95 0 0 0 16 6.25V5.5c0-.83-.67-1.5-1.5-1.5h-1zM12 14a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm2-3a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/></svg>'},117105:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 21 21m0-21-21 21"/></svg>'},315130:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 15 15m0-15-15 15"/></svg>'},238822:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 11 11m0-11-11 11"/></svg>'},663346:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" width="12" height="12"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 9 9m0-9-9 9"/></svg>'},534983:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="10" height="10"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 7 7m0-7-7 7"/></svg>'},512646:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M7.84 13.7H5.78V4.4l2.48-.06c1.35 0 2.42.4 3.22 1.2.8.78 1.19 1.83 1.19 3.15 0 3.34-1.61 5.01-4.83 5.01zm-.41-7.85v6.35c.26.02.55.03.86.03.83 0 1.48-.3 1.95-.9.48-.6.72-1.46.72-2.54 0-2-.93-2.99-2.78-2.99-.18 0-.43.02-.75.05z"/></svg>'},552828:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M13.4 5.9c-.41 1.62-1.16 2.43-2.25 2.43-.52 0-1.25-.15-2.2-.45-.93-.3-1.58-.45-1.96-.45-.55 0-.98.3-1.27.9H4.66c.1-.67.36-1.24.76-1.71.4-.48.86-.72 1.4-.72.56 0 1.31.16 2.27.46.95.3 1.62.45 2.01.45.64 0 1.06-.3 1.27-.9h1.03zm0 3.87c-.41 1.62-1.16 2.43-2.25 2.43-.52 0-1.25-.15-2.2-.45-.93-.3-1.58-.46-1.96-.46-.55 0-.98.3-1.27.9H4.66c.1-.67.36-1.24.76-1.7.4-.48.86-.72 1.4-.72.56 0 1.31.15 2.27.46.95.3 1.62.44 2.01.44.64 0 1.06-.3 1.27-.9h1.03z"/></svg>'},100578:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 8" width="16" height="8"><path fill="currentColor" d="M0 1.475l7.396 6.04.596.485.593-.49L16 1.39 14.807 0 7.393 6.122 8.58 6.12 1.186.08z"/></svg>'},643959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path stroke="currentcolor" stroke-width="1.2" d="M17 21l-7.5-7.5L17 6"/></svg>'},966883:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" fill="none" stroke="currentcolor"><path d="M3.5 10A6.5 6.5 0 1 0 10 3.5H5.233M7.5 6.5l-3-3 3-3"/></svg>'},513729:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M7 6l15 15m0-15L7 21"/></svg>'},333765:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path fill="currentColor" d="M9.707 9l4.647-4.646-.707-.708L9 8.293 4.354 3.646l-.708.708L8.293 9l-4.647 4.646.708.708L9 9.707l4.646 4.647.708-.707L9.707 9z"/></svg>'},29834:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM5 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0zm9.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM12 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0zm9.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM19 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0z"/></svg>'},816105:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="72" height="72" fill="none"><g clip-path="url(#clip0)"><path fill="#363A45" fill-rule="evenodd" clip-rule="evenodd" d="M62.1259 28.2153C61.4066 28.8157 61.0001 29.7273 61.0858 30.6604C61.6716 37.0347 59.7763 44.3291 55.3181 50.8221C46.9016 63.0797 32.5383 67.839 23.2366 61.4522C13.935 55.0654 13.2174 39.9512 21.6339 27.6935C26.4984 20.6088 33.3496 16.029 40.0619 14.6585C40.9752 14.472 41.731 13.8291 42.1024 12.9741C42.485 12.0934 42.9606 11.2346 43.5313 10.4123C47.906 4.1093 56.2129 2.33004 62.0853 6.4382C67.9578 10.5464 69.172 18.9863 64.7974 25.2892C64.0194 26.4103 63.1169 27.3882 62.1259 28.2153Z"/><rect width="47.2" height="34" fill="#1E222D" stroke="#B2B5BE" stroke-width="2" rx="3.8" x="12.4004" y="16"/><path stroke="#B2B5BE" stroke-linecap="round" stroke-width="2" d="M3.59961 54H67.1996"/><path fill="#B2B5BE" fill-rule="evenodd" clip-rule="evenodd" d="M29.1178 31.1324L30.8107 32.8253L32.225 31.4111L30.5321 29.7182L32.225 28.0253L30.8107 26.6111L29.1178 28.304L27.425 26.6111L26.0107 28.0253L27.7036 29.7182L26.0107 31.4111L27.425 32.8253L29.1178 31.1324Z"/><path fill="#B2B5BE" fill-rule="evenodd" clip-rule="evenodd" d="M43.5182 31.1324L45.2111 32.8253L46.6253 31.4111L44.9325 29.7182L46.6253 28.0253L45.2111 26.6111L43.5182 28.304L41.8253 26.6111L40.4111 28.0253L42.104 29.7182L40.4111 31.4111L41.8253 32.8253L43.5182 31.1324Z"/><path stroke="#B2B5BE" stroke-width="2" d="M30.5996 38.7H40.7996"/></g></svg>'},627687:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="72" height="72" fill="none"><g clip-path="url(#clip0)"><path fill="#F0F3FA" fill-rule="evenodd" clip-rule="evenodd" d="M62.1259 28.2153C61.4066 28.8157 61.0001 29.7273 61.0858 30.6604C61.6716 37.0347 59.7763 44.3291 55.3181 50.8221C46.9016 63.0797 32.5383 67.839 23.2366 61.4522C13.935 55.0654 13.2174 39.9512 21.6339 27.6935C26.4984 20.6088 33.3496 16.029 40.0619 14.6585C40.9752 14.472 41.731 13.8291 42.1024 12.9741C42.485 12.0934 42.9606 11.2346 43.5313 10.4123C47.906 4.1093 56.2129 2.33004 62.0853 6.4382C67.9578 10.5464 69.172 18.9863 64.7974 25.2892C64.0194 26.4103 63.1169 27.3882 62.1259 28.2153Z"/><rect width="47.2" height="34" fill="#fff" stroke="#1E222D" stroke-width="2" rx="3.8" x="12.4004" y="16"/><path stroke="#1E222D" stroke-linecap="round" stroke-width="2" d="M3.59961 54H67.1996"/><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M29.1178 31.1324L30.8107 32.8253L32.225 31.4111L30.5321 29.7182L32.225 28.0253L30.8107 26.6111L29.1178 28.304L27.425 26.6111L26.0107 28.0253L27.7036 29.7182L26.0107 31.4111L27.425 32.8253L29.1178 31.1324Z"/><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M43.5182 31.1324L45.2111 32.8253L46.6253 31.4111L44.9325 29.7182L46.6253 28.0253L45.2111 26.6111L43.5182 28.304L41.8253 26.6111L40.4111 28.0253L42.104 29.7182L40.4111 31.4111L41.8253 32.8253L43.5182 31.1324Z"/><path stroke="#000" stroke-width="2" d="M30.5996 38.7H40.7996"/></g></svg>'},829883:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16" width="20" height="16"><path fill="currentColor" fill-rule="evenodd" d="M7.5 2.5C7.5 1.67 8.17 1 9 1h2c.83 0 1.5.67 1.5 1.5v.15h-5V2.5zm6 0v.15H17a2.5 2.5 0 0 1 2.5 2.5v8.35A2.5 2.5 0 0 1 17 16H3a2.5 2.5 0 0 1-2.5-2.5V5.15A2.5 2.5 0 0 1 3 2.65h3.5V2.5A2.5 2.5 0 0 1 9 0h2a2.5 2.5 0 0 1 2.5 2.5zm-12 2.65c0-.83.67-1.5 1.5-1.5h14c.83 0 1.5.67 1.5 1.5v8.35c0 .83-.67 1.5-1.5 1.5H3a1.5 1.5 0 0 1-1.5-1.5V5.15zM9.25 6.5a1.75 1.75 0 1 0 0 3.5h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75h-1c0 .97.78 1.75 1.75 1.75h.25v1h1v-1h.25a1.75 1.75 0 1 0 0-3.5h-1.5a.75.75 0 0 1 0-1.5h1.5c.41 0 .75.34.75.75h1c0-.97-.78-1.75-1.75-1.75h-.25v-1h-1v1h-.25z"/></svg>'}}]);