(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[57953],{66243:e=>{e.exports={icon:"icon-n816Nq2K"}},301151:e=>{e.exports={wrapperPromoSymbolsContainer:"wrapperPromoSymbolsContainer-ekEcdsLD",promoSymbolsContainer:"promoSymbolsContainer-ekEcdsLD",symbol:"symbol-ekEcdsLD",icon:"icon-ekEcdsLD",logo:"logo-ekEcdsLD",symbolInfo:"symbolInfo-ekEcdsLD",symbolVisibility:"symbolVisibility-ekEcdsLD",name:"name-ekEcdsLD",symbolValueText:"symbolValueText-ekEcdsLD",currencySign:"currencySign-ekEcdsLD",positiveValue:"positiveValue-ekEcdsLD",negativeValue:"negativeValue-ekEcdsLD",animationBlock:"animationBlock-ekEcdsLD",animationWrapper:"animationWrapper-ekEcdsLD",translateUpFirstItem:"translateUpFirstItem-ekEcdsLD",priceUpAndDown:"priceUpAndDown-ekEcdsLD",translateUpSecondItem:"translateUpSecondItem-ekEcdsLD"}},558552:e=>{e.exports={}},796246:(e,t,o)=>{"use strict";o.r(t),o.d(t,{disposeWrapPineTags:()=>a,scrollTop:()=>m,wrapPineTags:()=>r});let s=null;async function n(){return s||(s=Promise.all([o.e(92191),o.e(72639),o.e(91895),o.e(45011),o.e(62670),o.e(7463)]).then(o.bind(o,469226))),s}function i(e,t=".tv-pine-code-tag-container"){return e.querySelectorAll(`${t}:not([data-colorized])`)||[]}async function r(e,t={}){const{selector:o,isCancelled:s=(()=>!1),onInit:r=(()=>{}),dark:a=!0,...m}=t,l=i(e,o);if(!l.length)return;const{renderPineCodeTag:d}=await n();s()||(l.forEach((e=>{var t;d(e,{dark:a,source:(t=e.innerHTML,t.replace(/<br>/g,"\n")),...m}),e.dataset.colorized=String(!0)})),requestAnimationFrame((()=>r(l))))}async function a(e,t){const o=i(e,t);if(!o.length)return;const{disposePineCodeTag:s}=await n();o.forEach((e=>{s(e)}))}function m(e){const t=null==e?void 0:e.getBoundingClientRect().top;void 0===t||t>=0||window.scrollTo({top:t+document.documentElement.scrollTop})}},765381:(e,t,o)=>{"use strict";o.d(t,{ChatDonationButton:()=>c});var s=o(50959),n=o(444372),i=o(497754),r=o(201465),a=o(335479),m=o(96870),l=o(584423),d=o.n(l),h=o(66243);function c(e){const{coins:t,username:l,recipient:c}=e,u=n.t(null,{plural:"{coins} coins",count:parseInt(t),replace:{coins:t}},o(670501)),g=(0,s.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),(0,a.showTVCoinsDialog)({tab:m.MainTab.History})}),[]),_=(0,s.useMemo)((()=>c?n.t(null,{plural:"{username} just sent {coins} coins to {recipient}",count:parseInt(t),replace:{coins:t,username:l,recipient:c}},o(370542)):n.t(null,{plural:"{username} just sent {coins} coins",count:parseInt(t),replace:{coins:t,username:l}},o(701839))),[l,t,c]);return s.createElement(r.RoundButton,{className:i(h.button,"apply-common-tooltip"),onClick:g,size:"xsmall",color:"black",title:_,startIcon:d()},s.createElement("span",{className:h.content},s.createElement("span",{className:h.value},u)))}},264462:(e,t,o)=>{"use strict";o.d(t,{Symbol:()=>h});var s=o(50959),n=o(497754),i=o(849204),r=o(160742),a=o(607546),m=o(852805),l=o(541346),d=o(301151);function h(e){const{symbol:t,className:h,isPromoVisible:c,onlyIcon:u}=e,[g,_]=(0,s.useState)(null),[R,p]=(0,s.useState)(null),[v,w]=(0,
s.useState)(null),[f,y]=(0,s.useState)(null),[b,C]=(0,s.useState)(""),D=(0,m.getShortNameAndProName)(t.proName).shortName,S=function(e,t){var o;if(null===(o=e.logoUrls)||void 0===o?void 0:o.length)return e.logoUrls;if(!t)return[];return(0,a.removeUsdFromCryptoPairLogos)((0,a.resolveLogoUrls)(t,i.LogoSize.Medium))}(t,g),E=S.length?[S[0]]:[];let I=null;return(0,s.useEffect)((()=>(async function(){return(await o.e(96301).then(o.bind(o,876332))).getQuoteSessionInstance("simple")}().then((e=>{I=e;I.subscribe("promoSymbol",t.proName,(e=>{const{values:t}=e;_(Object.keys(t).length?{...t}:null)}))})),()=>{null!==I&&I.unsubscribe("promoSymbol",t.proName)})),[]),(0,s.useEffect)((()=>{var e;if(!g)return;if(u)return;const t=new l.PercentageFormatter,o=null!==g.change_percent?g.change_percent:0,s=`${t.format(o,!0,2,!0)}`;p(g.last_price?g.last_price.toLocaleString("ru",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(",","."):null),w(null!==(e=g.currency_code)&&void 0!==e?e:null),y(s),C(o>0?d.positiveValue:d.negativeValue)}),[g]),u?s.createElement(r.CircleLogoAny,{className:d.logo,size:"xxxsmall",logoUrls:E,placeholderLetter:D[0],singleCircleLogoClassName:d.icon}):s.createElement("a",{href:`/chart/?symbol=${encodeURIComponent(t.proName)}`,className:n(d.symbol,h)},s.createElement(r.CircleLogoAny,{className:d.logo,logoUrls:E,size:"xsmall",placeholderLetter:D[0],singleCircleLogoClassName:d.icon}),s.createElement("div",{className:d.symbolInfo},s.createElement("span",{className:d.name},D),s.createElement("div",{className:d.animationBlock},s.createElement("div",{className:d.animationWrapper},s.createElement("span",{className:n(d.symbolValueText,c&&d.translateUpFirstItem)},s.createElement("span",null,R),s.createElement("span",{className:d.currencySign},v)),s.createElement("span",{className:n(d.symbolValueText,b,c&&d.translateUpSecondItem)},f)))))}},498966:(e,t,o)=>{"use strict";o.r(t),o.d(t,{SYMBOL_ROOM_PREFIX:()=>m,defaultSymbolRoomMesssage:()=>_,getChatHistoryMessageURL:()=>d,highlightNewMessages:()=>l,isSymbolRoom:()=>c,renderIconTemplate:()=>u,symbolFromChatRoomId:()=>g,symbolRoomId:()=>h});o(823127),o(161530);var s=o(444372),n=o(50959),i=o(500962),r=o(264462),a=o(823127);const m="symbol_";function l(e,t,o){let s=0;const n=a(e.find(".ch-item").toArray().reverse().slice(0,t));if(!(!n.length||t<1||o<1)){for(;t>0;){t-=n.eq(s).find(".ch-item-text").length,s++}n.slice(0,s).highlight(o)}}function d(e,t){const o=new Date(e),s=o.getMonth()+1,n=o.getDate(),i=o.getHours(),r=o.getMinutes();return"/chat/history/?room="+t+"&date="+(o.getFullYear()+"-"+(s<10?"0":"")+s+"-"+(n<10?"0":"")+n)+"&timefrom="+((i<10?"0":"")+i+"%3A"+(r<10?"0":"")+r)+"&timeto=00%3A00&usernames=&order=asc&tzoffset="+o.getTimezoneOffset()}function h(e,t=m){const o=e.replace(/[^a-z0-9]/gi,"_");return"en"===window.locale?`${t}${o}`:`${t}${o}_${window.locale}`}function c(e){return e.startsWith(m)}function u(e,t){i.render(n.createElement(r.Symbol,{symbol:{proName:e},isPromoVisible:!1,onlyIcon:!0}),t)}function g(e){let t=e.replace(new RegExp(`^${m}`),"")
;return"en"!==window.locale&&(t=t.replace(new RegExp(`_${window.locale}$`),"")),t}function _(){return{symbol:"",time:"Thu Jan 10 15:00:00 2022 UTC",meta:{version:"0.2",links:{}},username:"TradingView",user_pic:"https://s3.tradingview.com/userpics/6171439-Hlns_mid.png",text:s.t(null,void 0,o(153106))}}},348735:(e,t,o)=>{"use strict";o.r(t),o.d(t,{makeLiveSeparateModel:()=>A,makePrivateModel:()=>L,makePublicModel:()=>U,setPublicInitialRooms:()=>O});var s=o(707957),n=o(776734),i=o(262078),r=o(823127),a=o.n(r),m=o(616068),l=o(314916);class d{constructor(e){this._statInterval="",this._statSymbol="",this._historyRequest=null,this._room="",this._isActive=!0,this._messageReceivedDelegate=new s.Delegate,this._messageDeletedDelegate=new s.Delegate,this._messageReceivedInOtherRoomDelegate=new s.Delegate,this._messageDeletedInOtherRoomDelegate=new s.Delegate,this._unknownEventDelegate=new s.Delegate,this._pendingMessages={},this._newRoomInfoRequests={},this._onRoomDataHandler=this._pushStreamRoomDataHandler.bind(this),this._chatRooms=e,this._getChatRooms().startListenPushstream(),this._getChatRooms().roomsChanged().subscribe(this,this._flushPendingMessages),this._getChatRooms().otherEventReceived().subscribe(this,this._onOtherRoomEventReceived)}destroy(){this.setRoom(""),this._getChatRooms().roomsChanged().unsubscribe(this,this._flushPendingMessages),this._getChatRooms().otherEventReceived().unsubscribe(this,this._onOtherRoomEventReceived),this._getChatRooms().stopListenPushstream(),this._historyRequest&&this._historyRequest.abort()}roomAdded(){return this._getChatRooms().roomAdded()}roomChanged(){return this._getChatRooms().roomChanged()}roomDeleted(){return this._getChatRooms().roomDeleted()}roomsChanged(){return this._getChatRooms().roomsChanged()}messageReceived(){return this._messageReceivedDelegate}messageDeleted(){return this._messageDeletedDelegate}messageReceivedInOtherRoom(){return this._messageReceivedInOtherRoomDelegate}messageDeletedInOtherRoom(){return this._messageDeletedInOtherRoomDelegate}otherEventReceived(){return this._unknownEventDelegate}createRoom(e,t,o,s){this._getChatRooms().createRoom(e,t,o,s)}async editRoom(e,t,o,s){return this._getChatRooms().editRoom(e,t,o,s)}getRooms(){return this._getChatRooms().rooms()}getRoomById(e){return this._getChatRooms().getRoomById(e)}getRoomInfo(e,t,o,s){return this._getChatRooms().getRoomInfo(e,t,o,s)}setActive(e){this._isActive=e}isActive(){return this._isActive}room(){return this._room}isHistoryLoading(){return null!==this._historyRequest}setStatSymbol(e){this._statSymbol=e}setStatInterval(e){this._statInterval=e}loadHistory(e,t){this._loadHistoryInternal(e,t)}setRoom(e,t){this._room!==e&&(this._historyRequest&&(this._historyRequest.abort(),this._historyRequest=null),this._room&&i.pushStreamMultiplexer.off(this._getChannel(),this._onRoomDataHandler),this._room=e,this._room&&(this._historyRequest=this._loadHistoryInternal(0,((e,o,s)=>{t&&t(e,o,s),i.pushStreamMultiplexer.on(this._getChannel(),this._onRoomDataHandler)})),this._historyRequest.always((()=>{
this._historyRequest=null}))))}getBanStatus(e,t){window.user.is_moderator&&window.user.id!==e.user_id&&!e.is_moderator?a().get("/ban-status/",{user_id:e.user_id},(e=>{t(!0,!e.error)})):t(!1)}ignoredUsers(){return window.user.ignore_list}ignoredUsersV2(){return window.user.ignore_list_v2}ignoreUser(e,t,o,s){const n={action:t?"add":"remove",user_id:e.user_id,username:e.username};a().post(t?"/api/v1/user/privacy/ignore_list/add/":"/api/v1/user/privacy/ignore_list/remove/",n,(s=>{s.detail||(t?window.user.ignore_list[e.user_id]=e.username:delete window.user.ignore_list[e.user_id],window.crossTabSyncUserAttr&&window.crossTabSyncUserAttr("ignore_list")),o&&o(s)})).fail((e=>{if(s){const t=JSON.parse(e.responseText);t.error=t.detail,s(t)}}))}ignoreUserV2(e,t,o,s){t?l.IgnoreUsers.add(e.username).then((t=>{t.detail||window.user.ignore_list.push(e.user_id),o(t)})).catch((e=>s(e))):l.IgnoreUsers.remove(e.username).then((t=>{t.detail||(window.user.ignore_list=window.user.ignore_list.filter((t=>t!==e.user_id))),o(t)})).catch((e=>s(e))),window.crossTabSyncUserAttr&&window.crossTabSyncUserAttr("ignore_list")}sendMessageToRoom(e,t,o,s,i,r){if((o=o||{}).interval=this._statInterval,!(t=t.trim())&&!o.text)return!1;const m=window.TradingView.onChartPage?this._statSymbol:"",l={meta:JSON.stringify(o),room_id:e,symbol:m,text:t};s&&s.messageType&&(l.type=s.messageType,s.warningType&&(o.warning_type=s.warningType)),this._extendCommonRequestData(l),a().post("/conversation-post/",l).done(i).fail(r);const d="1"===l.is_private;return(0,n.getTracker)().then((t=>{null!==t&&t.trackChat(e,!1,d,window.locale)})),!0}sendMessage(e,t,o,s,n){return""!==this._room&&this.sendMessageToRoom(this._room,e,t,o,s,n)}reportMessage(e){new m.ReportSendingAgent({entityText:e.text,entityType:"message",entityURL:e.id.replace(/-/g,""),username:e.username},this._reportMessageOptions()).send()}deleteMessage(e,t,o){a().post("/conversation-delete/",{ids:e}).done(t).fail(o)}_getChatRooms(){return this._chatRooms}_reportMessageOptions(){return{}}_pushStreamRoomDataHandler(e,t,o,s){switch(e.action){case"message":this._messageReceivedDelegate.fire(e.data,e.data.room_id,s);break;case"message-delete":this._messageDeletedDelegate.fire(e.data,e.data.room_id,s);break;default:throw new Error(`AbstractChatModel._pushStreamRoomDataHandler: unknown action ${e.action}`)}}_onOtherRoomEventReceived(e,t,o,s){const n=e.data.room_id;n!==this.room()&&("message"===e.action||"message-delete"===e.action?this.getRoomById(n)?"message"===e.action?this._messageReceivedInOtherRoomDelegate.fire(e.data,n,s):this._messageDeletedInOtherRoomDelegate.fire(e.data,n,s):(this._pendingMessages[n]=this._pendingMessages[n]||[],this._pendingMessages[n].push({external:s,message:e}),this._newRoomInfoRequests[n]||(this._newRoomInfoRequests[n]=!0,this._getChatRooms().getRoomInfo(n,(()=>{delete this._newRoomInfoRequests[n],this._flushPendingMessages()}),(()=>{delete this._newRoomInfoRequests[n],this._getChatRooms().updateRooms()})))):this._unknownEventDelegate.fire(e,t,o,s))}_flushPendingMessages(){
Object.keys(this._pendingMessages).forEach((e=>{if(!this._pendingMessages[e]||!this.getRoomById(e))return;let t;t=e===this.room()?{message:this._messageReceivedDelegate,"message-delete":this._messageDeletedDelegate}:{message:this._messageReceivedInOtherRoomDelegate,"message-delete":this._messageDeletedInOtherRoomDelegate},this._pendingMessages[e].forEach((o=>{t[o.message.action].fire(o.message.data,e,o.external)})),delete this._pendingMessages[e]}))}_loadHistoryInternal(e,t){const o={_rand:Math.random(),offset:e,room_id:this._room,stat_interval:this._statInterval,stat_symbol:this._statSymbol};return this._extendCommonRequestData(o),a().get("/conversation-status/",o,(e=>{t&&t(e,0===e.messages.length,!1)}))}}var h=o(201089);const c=(0,h.getLogger)("Chat.PrivateChatModel");class u extends d{constructor(e){super(e),this._roomMessagesReadDelegate=new s.Delegate,this._otherRoomMessagesReadDelegate=new s.Delegate,this._roomMarkAsUnreadDelegate=new s.Delegate}roomMessagesRead(){return this._roomMessagesReadDelegate}otherRoomMessagesRead(){return this._otherRoomMessagesReadDelegate}roomMarkAsUnread(){return this._roomMarkAsUnreadDelegate}setMessagesRead(){this._updateRoomLastVisitedTime()}loadHistory(e,t){super.loadHistory(e,((e,o,s)=>{this.setMessagesRead(),t&&t(e,o,s)}))}updateRooms(){this._getChatRooms().updateRooms()}loadMoreRooms(e){return this._getChatRooms().loadMoreRooms(e)}leaveFromRoom(e,t){return this._getChatRooms().leaveFromRoom(e,t)}updateRoomUsers(e,t,o,s){return this._getChatRooms().updateRoomUsers(e,t,o,s)}updateRoomInfo(e,t){this._getChatRooms().getRoomInfo(e,t,void 0,!0)}hiddenRooms(){return this._getChatRooms().hiddenRooms()}addHiddenRoom(e){this._getChatRooms().addHiddenRoom(e),this._updateRoomLastVisitedTime(e)}markAsUnread(e){this._updateRoomLastVisitedTime(e,!0)}removeHiddenRoom(e){this._getChatRooms().removeHiddenRoom(e)}isRoomHidden(e){return this._getChatRooms().isRoomHidden(e)}searchUsers(e,t){r.get("/username_hint/",{s:e},t)}_extendCommonRequestData(e){e.is_private="1"}_getChannel(){return this.room()}_pushStreamRoomDataHandler(e,t,o,s){switch(e.action){case"message":this.setMessagesRead();break;case"messages-read":const t=this.getRoomById(e.data.room_id);return void(t?this._roomMessagesReadDelegate.fire(t):c.logError(`Received messages-read event for unknown room ${e.data.room_id}`))}super._pushStreamRoomDataHandler(e,t,o,s)}_onOtherRoomEventReceived(e,t,o,s){const n=e.data.room_id;if(n!==this.room())if("messages-read"!==e.action)if("mark-as-unread"!==e.action)super._onOtherRoomEventReceived(e,t,o,s);else{const e=this.getRoomById(n);e&&this._roomMarkAsUnreadDelegate.fire(e)}else{const e=this.getRoomById(n);e&&this._otherRoomMessagesReadDelegate.fire(e)}}_updateRoomLastVisitedTime(e,t=!1){(e&&e!==this.room()||this.isActive())&&(e=e||this.room(),r.post("/chats/status/",{room_id:e,mark_as_unread:t}))}}var g=o(444372),_=o(120780);class R extends d{constructor(e,t=!0){super(e),this._activeReconnect=!0,this._activeReconnect=t}deleteRoom(e,t){return this._getChatRooms().deleteRoom(e,t)}
async voteForChart(e,t,o){(0,_.fetch)(`/api/v1/ideas/${e.id}/like/`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:t?1:0})}).then((e=>e.json())).then(o)}voteForMessageWithSnapshot(e,t,o){r.post("/conversation-vote/",{id:e.id,vote:t?1:0},o)}favoriteRooms(){return this._getChatRooms().favoriteRooms()}isRoomFavorite(e){return this._getChatRooms().isRoomFavorite(e)}addFavoriteRoom(e){this._getChatRooms().addFavoriteRoom(e)}removeFavoriteRoom(e){this._getChatRooms().removeFavoriteRoom(e)}isShownOnlyFavorites(){return this._getChatRooms().isShownOnlyFavorites()}toggleShownOnlyFavorites(){this._getChatRooms().toggleShownOnlyFavorites()}_reportMessageOptions(){const e=this.getRoomById(this.room());return e?{additionalText:g.t(null,void 0,o(860407)).format({title:e.title})}:{}}_extendCommonRequestData(e){e.is_private=""}_getChannel(){return`chat_${this.room()}`}}class p extends R{setActive(e){super.setActive(e),e?i.pushStreamMultiplexer.addChannel("chat"):this._activeReconnect&&i.pushStreamMultiplexer.removeChannel("chat")}}class v extends R{setActive(e){super.setActive(e);const t=this.getRooms()[0].room_id;e?i.pushStreamMultiplexer.addChannel(t):this._activeReconnect&&i.pushStreamMultiplexer.removeChannel(t)}}class w{constructor(e){this._roomAddedDelegate=new s.Delegate,this._roomChangedDelegate=new s.Delegate,this._roomDeletedDelegate=new s.Delegate,this._roomsChangedDelegate=new s.Delegate,this._otherEventReceivedDelegate=new s.Delegate,this._subscribersCount=0,this._rooms=e||[],setTimeout((()=>{0===this._rooms.length&&this.updateRooms()}),0)}async getRoomInfo(e,t,o,s){const n=this.getRoomById(e);t&&n&&t(n)}startListenPushstream(){++this._subscribersCount,1===this._subscribersCount&&(this._multiplexerCallback=this._pushStreamBroadcastHandler.bind(this),i.pushStreamMultiplexer.on(this._multiplexerEvent(),this._multiplexerCallback))}stopListenPushstream(){--this._subscribersCount,0===this._subscribersCount&&i.pushStreamMultiplexer.off(this._multiplexerEvent(),this._multiplexerCallback)}rooms(){return this._rooms}getRoomById(e){const t=this._getRoomIndex(e);return-1===t?null:this._rooms[t]}roomAdded(){return this._roomAddedDelegate}roomChanged(){return this._roomChangedDelegate}roomDeleted(){return this._roomDeletedDelegate}roomsChanged(){return this._roomsChangedDelegate}otherEventReceived(){return this._otherEventReceivedDelegate}_onRoomAdded(e){e&&(this._rooms.push(e),this._roomAddedDelegate.fire(e))}_onRoomChanged(e){if(!e)return;const t=this._getRoomIndex(e.room_id);-1!==t&&(this._rooms[t]=e,this._roomChangedDelegate.fire(e))}_onRoomDeleted(e){if(!e)return;const t=this._getRoomIndex(e.room_id);-1!==t&&(this._rooms.splice(t,1),this._roomDeletedDelegate.fire(e))}_onRoomsChanged(e){const t=this._rooms;this._rooms=e,this._roomsChangedDelegate.fire(e,t)}_pushStreamBroadcastHandler(e,t,o,s){this._otherEventReceivedDelegate.fire(e,t,o,s)}_getRoomIndex(e){for(let t=this._rooms.length-1;t>=0;--t)if(this._rooms[t].room_id===e)return t;return-1}}var f=o(62802)
;const y=(0,h.getLogger)("Chat.PrivateChatRooms"),b="privatemessages.hiddenrooms";class C extends w{constructor(e=!0){super(null),this._updateRoomRequest=null,this._withPagination=!0,this._withPagination=e,window.loginStateChange.subscribe(this,this._onLoginStateChanged),this._onLoginStateChanged()}updateRooms(e=30){if(this._updateRoomRequest)return;this._withPagination||(e=0);const t=window;if(t.user&&t.is_authenticated){const t=new URL("/chats/get/",window.location.origin);t.searchParams.append("limit",String(e));(0,_.fetch)(t.href,{method:"GET"}).then((e=>e.json())).then(this._updateRooms.bind(this)).finally((()=>this._updateRoomRequest=null))}else this._onRoomsChanged([])}loadMoreRooms(e=30){this.updateRooms(this.rooms().length+e)}async createRoom(e,t,o,s){const i=new URL("/chats/create/",window.location.origin),r=await(0,_.fetch)(i.href,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:o.map((e=>`members[]=${e}`)).join("&")}),a=await r.json();a.error||a.room.existing||this._onRoomAdded(a.room),s&&s(a),(0,n.getTracker)().then((e=>{null!==e&&e.trackChat(a.room.room_id,!0,!0,window.locale)}))}async editRoom(e,t,o,s){const n=this.getRoomById(e);if(!n)return!1;try{const o=new URL("/chats/title/",window.location.origin),i=await(0,_.fetch)(o.href,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`room_id=${e}&room_title=${t}`}),r=await i.json();r.error||(n.title=t,this._onRoomChanged(n)),s&&s(r)}catch(t){return y.logError(`Something went wrong, when trying update title in ${e}.`),!1}return!0}async getRoomInfo(e,t,o,s){const n=this.getRoomById(e);if(n&&!s)return void(t&&t(n));const i=new URL("/chats/info/",window.location.origin);i.searchParams.append("room_id",e);try{const n=await(0,_.fetch)(i.href,{method:"GET"}),r=await n.json();if(r.error)return void(o&&o());if(r.room.members_count){const e=await this._getRoomMembers(r.room);r.room.members_info=e.results}const a=this.getRoomById(e);s&&a?this._onRoomChanged(r.room):a||this._onRoomAdded(r.room),t&&t(r.room)}catch(e){o&&o()}}async leaveFromRoom(e,t){if(!this.getRoomById(e))return!1;try{const o=new URL("/chats/leave/",window.location.origin),s=await(0,_.fetch)(o.href,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`room_id=${e}`}),n=await s.json();if(!n.error){const t=this.getRoomById(e);t?this._onRoomDeleted(t):y.logError(`We are already left the room ${e}`)}t&&t(n)}catch(t){return y.logError(`Something went wrong, when user ${window.user.username} trying leave room ${e}.`),!1}return!0}async updateRoomUsers(e,t,o,s){if(!this.getRoomById(e))return!1;const n=new URL("/chats/update/",window.location.origin),i=[t.map((e=>`members[]=${e}`)).join("&"),`room_id=${e}`];void 0!==(null==s?void 0:s.updateExistingRoom)&&i.push(`update_existing=${s.updateExistingRoom}`);try{const t=await(0,_.fetch)(n.href,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:i.join("&")}),s=await t.json(),r=this.getRoomById(e)
;r&&(s.room&&s.room.members_info&&s.room.room_id===r.room_id&&(r.members_info=s.room.members_info),this._onRoomChanged(r)),o&&o(s)}catch(t){return y.logError(`Something went wrong, when trying update room ${e}.`),!1}return!0}hiddenRooms(){return this._hiddenRooms}addHiddenRoom(e){this.isRoomHidden(e)||(this._hiddenRooms.push(e),this._flushHiddenRooms())}removeHiddenRoom(e){if(!this.isRoomHidden(e))return;const t=this._hiddenRooms.indexOf(e);this._hiddenRooms.splice(t,1),this._flushHiddenRooms()}isRoomHidden(e){return-1!==this._hiddenRooms.indexOf(e)}_multiplexerEvent(){return"pm_*"}_pushStreamBroadcastHandler(e,t,o,s){const n=e.data.type;if("join"===n||"leave"===n){if("leave"===n&&window.user.id===e.data.user_id)return;this.getRoomInfo(e.data.room_id,void 0,void 0,!0)}super._pushStreamBroadcastHandler(e,t,o,s)}_updateRooms(e){e.forEach((e=>{void 0!==e.first_members_info&&(e.members_info=e.first_members_info)})),this._onRoomsChanged(e)}async _getRoomMembers(e){var t;const o=new URL("/chats/get/members/",window.location.origin);o.searchParams.append("page_size",String(null!==(t=e.members_count)&&void 0!==t?t:50)),o.searchParams.append("page","1"),o.searchParams.append("room_id",e.room_id);const s=await(0,_.fetch)(o.href,{method:"GET"});return await s.json()}_flushHiddenRooms(){(0,f.setJSON)(b,this._hiddenRooms,{forceFlush:!0})}_onLoginStateChanged(){this._hiddenRooms=(0,f.getJSON)(b,[]),this.updateRooms()}}function D(e){return"en"!==window.language&&(e=`${e}.${window.locale}`),e}const S="publiccharts.favorites",E="chat.show_only_favorites";class I extends w{constructor(e){super(e),this._favoriteRooms=(0,f.getJSON)(D(S),{}),this._showOnlyFavorites=!!(0,f.getBool)(E)}updateRooms(){r.get("/chats/public/get/",this._onRoomsChanged.bind(this))}createRoom(e,t,o,s){const i={desc:t,title:e};r.post("/chats/public/create/",i,(e=>{e.error||r.post("/chats/public/createpingback/",{room_id:e.room.room_id}),s&&s(e),(0,n.getTracker)().then((t=>{null!==t&&t.trackChat(e.room.room_id,!0,!1,window.locale)}))}))}async editRoom(e,t,o,s){if(!this.getRoomById(e))return!1;const n={desc:o,room_id:e,title:t};return r.post("/chats/public/edit/",n,s),!0}deleteRoom(e,t){return!!this.getRoomById(e)&&(r.post("/chats/public/delete/",{room_id:e},t),!0)}favoriteRooms(){return Object.keys(this._favoriteRooms)}isRoomFavorite(e){return e in this._favoriteRooms}addFavoriteRoom(e){this._favoriteRooms[e]=!0,this._saveFavorires()}removeFavoriteRoom(e){delete this._favoriteRooms[e],this._saveFavorires()}isShownOnlyFavorites(){return this._showOnlyFavorites}toggleShownOnlyFavorites(){this._showOnlyFavorites=!this._showOnlyFavorites,(0,f.setValue)(E,this._showOnlyFavorites)}_multiplexerEvent(){return"chat_*"}_pushStreamBroadcastHandler(e,t,o,s){if("create_room"===e.data.type&&e.data.meta.lang===window.locale)return void this._onRoomAdded(e.data.meta.room);const n=this.getRoomById(e.data.room_id);if(n)switch(n.last_message_time=Date.now(),e.data.type){case"edit_room":return n.title=e.data.meta.room_title,n.description=e.data.meta.room_desc,
void this._onRoomChanged(n);case"delete_room":return void this._onRoomDeleted(n)}super._pushStreamBroadcastHandler(e,t,o,s)}_saveFavorires(){(0,f.setJSON)(D(S),this._favoriteRooms)}}const k=(0,h.getLogger)("Chat.ChatModelsFactory");let x=null,T=null,M=null;function L(e=!0){if(function(e=!0){T||(T=new C(e))}(e),!T)throw new Error("Unable to create private chat model");return new u(T)}function U(e=!0){if(M||(M=new I(x)),!M)throw new Error("Unable to create public chat model");return new p(M,e)}function O(e){M?k.logError("Trying set initial rooms after creating"):x=e}function A(e){const t=new I(e);return new v(t)}},616068:(e,t,o)=>{"use strict";o.r(t),o.d(t,{ReportSendingAgent:()=>r});var s=o(444372),n=(o(586463),o(229534)),i=o(823127);class r{constructor(e,t={}){switch(this._fullURL=`${window.location.protocol}//${window.location.host}`,this._data=e,this._options=t,e.entityType){case"message":this._entityString=s.t(null,void 0,o(358961)),this._actionString=s.t(null,void 0,o(417899)),this._fullURL+=`/chat/m/${e.entityURL}/`;break;case"comment":this._entityString=s.t(null,void 0,o(529352)),this._actionString=s.t(null,void 0,o(417899)),this._fullURL+=`${e.entityURL}#tc${e.entityID}`;break;case"idea":this._entityString=s.t(null,void 0,o(873855)),this._actionString=s.t(null,void 0,o(376481)),this._fullURL+=e.entityURL;break;case"script":this._entityString=s.t(null,void 0,o(475555)),this._actionString=s.t(null,void 0,o(376481)),this._fullURL+=e.entityURL;break;case"stream":this._entityString=s.t(null,void 0,o(972979)),this._actionString=s.t(null,void 0,o(376481)),this._fullURL+=e.entityURL;break;case"mind":this._entityString=s.t(null,void 0,o(212082)),this._actionString=s.t(null,void 0,o(417899)),this._fullURL+=e.entityURL;break;case"mind-comment":this._entityString=s.t(null,void 0,o(529352)),this._actionString=s.t(null,void 0,o(417899)),this._fullURL+=e.entityURL}}send(){const e={report_type:this._data.entityType,text:""};this._options.chartId&&(e.chart_id=this._options.chartId),this._data.entityID&&(e.object_id=this._data.entityID);const t={is_report:!0,meta:JSON.stringify(e),text:this.getText()};i.post("/conversation-post/",t).done((e=>{e&&e.error&&(0,n.showErrorDialog)({title:"Error",content:e.error,btnType:"danger"})}))}getTitle(){return s.t(null,void 0,o(469212)).format({entity:this._entityString,username:`<strong>${this._data.username}</strong>`})}getText(){let e=s.t(null,void 0,o(175462)).format({entity:this._entityString,username:this._data.username,url:this._fullURL});return this._options.additionalText&&(e+=`\n${this._options.additionalText}`),this._data.entityText&&(e+=`\n\n${this._data.entityText}`),e}getEntity(){return this._entityString}getAction(){return this._actionString}}},314916:(e,t,o)=>{"use strict";o.d(t,{IgnoreUsers:()=>a});var s,n=o(444372);function i(e){const t=new FormData;return t.append("username",e),t}!function(e){e[e.Unknown=0]="Unknown",e[e.BadRequest=400]="BadRequest",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.UnprocessableEntity=422]="UnprocessableEntity"}(s||(s={}))
;const r=n.t(null,void 0,o(223156));var a;!function(e){e.getAll=function(){return fetch("/api/v1/user/privacy/ignore_list/",{method:"GET"}).then((e=>{if(e.ok)return e.json();throw new Error(r)}))},e.add=async function(e){return fetch("/api/v1/user/privacy/ignore_list/add/",{method:"POST",body:i(e)}).then((e=>{if(e.ok)return e.json();if([s.UnprocessableEntity].includes(e.status))return e.json().then((t=>{if(!e.ok){const e=t.detail;throw new Error(e)}}));throw new Error(r)}))},e.remove=function(e){return fetch("/api/v1/user/privacy/ignore_list/remove/",{method:"POST",body:i(e)}).then((e=>{if(e.ok)return e.json();if([s.UnprocessableEntity].includes(e.status))return e.json().then((t=>{if(!e.ok){const e=t.detail;throw new Error(e)}}));throw new Error(r)}))}}(a||(a={}))},335479:(e,t,o)=>{"use strict";o.d(t,{showTVCoinsDialog:()=>n});var s=o(96870);function n(e){Promise.all([o.e(76592),o.e(63987),o.e(35213),o.e(63830),o.e(1888),o.e(94502),o.e(25977),o.e(93477),o.e(10564),o.e(28458)]).then(o.bind(o,46600)).then((t=>{const{page:o=s.CoinsPage.Main,tab:n=s.MainTab.GetCoins,productId:i=s.ProductId.Coin500,...r}=e||{};new t.TVCoinsDialog({page:o,tab:n,...r}).open()}))}},96870:(e,t,o)=>{"use strict";var s,n,i;o.d(t,{CoinsPage:()=>n,MainTab:()=>i,ProductId:()=>s}),function(e){e.TestCoins="100_coins",e.Coin500="500_coins",e.Coin1000="1000_coins",e.BagAndCoin="5000_coins"}(s||(s={})),function(e){e.Buy="Buy",e.Main="Main"}(n||(n={})),function(e){e.About="About",e.Refer="Refer",e.GetCoins="Get coins",e.History="History",e.Redeem="Redeem"}(i||(i={}))},852805:(e,t,o)=>{"use strict";function s(e){if(e.includes("|")){const[t,o,s]=e.split("|"),{proName:i,shortName:r}=n(t);return{proName:i,shortName:r,interval:o||void 0,currency:s||void 0}}{const{proName:t,shortName:o}=n(e);return{proName:t,shortName:o,interval:void 0,currency:void 0}}}function n(e){let t,o;return e.includes(":")?(o=e.split(":")[1],t=e):o=e,{proName:t,shortName:o}}o.d(t,{getShortNameAndProName:()=>n,getSymbolDataFromSymbolString:()=>s})},584423:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.25 9a5.75 5.75 0 0 1 9.79-4.1.75.75 0 1 0 1.05-1.07 7.25 7.25 0 0 0-12.18 6.7.75.75 0 1 0 1.47-.32c-.09-.4-.13-.8-.13-1.21Zm12.78-1.78a.75.75 0 0 0-1.45.36A5.77 5.77 0 0 1 4.87 13a.75.75 0 0 0-1.08 1.05 7.25 7.25 0 0 0 12.24-6.82Zm-7.68.07a.75.75 0 0 0-1.06 0L5.22 9.36a.75.75 0 1 0 1.06 1.06l1.54-1.54 1.54 1.54a.75.75 0 0 0 1.06 0l2.06-2.07a.75.75 0 0 0-1.06-1.06L9.9 8.83 8.35 7.29Z"/></svg>'}}]);