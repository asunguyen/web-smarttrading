"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[12127],{179030:(e,t,s)=>{s.d(t,{UpdatableItemsThread:()=>n,createThread:()=>a});var r=s(707957),i=s(129025);class n{constructor(e,t){this._itemsIds=new Set,this._historyReady=new i.WatchedValue(!1),this._newItems=new r.Delegate,this._items=[],this._destroyed=!1,this._intervalId=null,this._requestProps=e,this._expirationPeriod=t,this._abortController=new AbortController,this._requestItems(e,t,this._abortController.signal).then((e=>{this._destroyed||(this._items=e,e.forEach((e=>this._itemsIds.add(this._getIdForItem(e)))),this._intervalId=setInterval(this._update.bind(this),t),this._historyReady.setValue(!0))})).catch((e=>{if(!(e instanceof DOMException)||"The user aborted a request."!==e.message)throw e}))}destroy(){null!==this._intervalId&&clearInterval(this._intervalId),this._abortController.abort(),this._destroyed=!0}historyReady(){return this._historyReady.readonly()}history(){return this._items}newItems(){return this._newItems}async _update(){const e=await this._requestItems(this._requestProps,this._expirationPeriod,this._abortController.signal);if(this._destroyed)return;const t=this._getNewItemsFromResponse(e);0!==t.length&&(t.forEach((e=>this._itemsIds.add(this._getIdForItem(e)))),this._items=t.concat(this._items),this._newItems.fire(t))}}const o=new Map;function a(e,t,s){const r=t(s);let i=o.get(r);if(!i){i={thread:e(s),usages:0},o.set(r,i)}i.usages+=1;const n=i,a=Object.create(i.thread);return a.destroy=()=>{n.usages-=1,Promise.resolve().then((()=>{0===n.usages&&(o.delete(r),n.thread.destroy())}))},a}},121362:(e,t,s)=>{s.r(t),s.d(t,{popularMindsThread:()=>h});var r=s(179030),i=s(120780);const n=new Map;async function o(e,t,s){const r=performance.now();!function(e){const t=[];for(const[s,r]of n)r.expirationTime<e&&t.push(s);t.forEach((e=>n.delete(e)))}(r);const o=n.get(e.symbol);let a;return void 0!==o?a=o.promise:(a=async function(e,t){const s=new URL("/api/v1/minds/popular/",window.location.origin);s.searchParams.append("symbol",e.symbol),e.limit&&s.searchParams.append("limit",e.limit.toString());const r=await(0,i.fetch)(s.href,{credentials:"include",method:"GET",signal:t});if(!r.ok)throw Error("Error while popular minds fetch");return r.json()}(e,s),n.set(e.symbol,{promise:a,expirationTime:r+t})),a}class a extends r.UpdatableItemsThread{_getNewItemsFromResponse(e){return e.filter((e=>!this._itemsIds.has(e.uid)))}_requestItems(e,t,s){return o(e,t,s)}_getIdForItem(e){return e.uid}}function h(e,t){return(0,r.createThread)((e=>new a(e[0],e[1])),(e=>`${e[0].symbol}_${e[0].limit}`),[e,t])}}}]);