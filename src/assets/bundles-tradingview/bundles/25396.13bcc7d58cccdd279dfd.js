"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[25396,91859,8287],{963894:(e,t)=>{t.CircularBuffer=void 0;var i=function(){function e(e){this._start=0,this._size=0,this._buffer=new Array(e)}return e.prototype.size=function(){return this._size},e.prototype.capacity=function(){return this._buffer.length},e.prototype.enqueue=function(e){this._size<this._buffer.length?this._size++:this._start=(this._start+1)%this._buffer.length;var t=(this._start+this._size-1)%this._buffer.length;this._buffer[t]=e},e.prototype.dequeue=function(){if(0===this._size)throw new Error("Buffer is empty");var e=this._buffer[this._start];return this._buffer[this._start]=void 0,this._start=(this._start+1)%this._buffer.length,this._size--,e},e.prototype.get=function(e){if(e>=this._size)throw new Error("Index is out of range");var t=(this._start+e)%this._buffer.length;return this._buffer[t]},e.prototype.forEach=function(e,t){for(var i=0;i<this._size;i++){var r=(this._start+i)%this._buffer.length;e.call(t,this._buffer[r],r,this)}},e.prototype.clear=function(){for(var e=this._buffer.length,t=0;t<e;t++)this._buffer[t]=void 0;this._start=0,this._size=0},e}();t.CircularBuffer=i},277973:(e,t,i)=>{i.d(t,{default:()=>r});const r=function(e){return null===e}},895171:(e,t,i)=>{i.d(t,{default:()=>s});var r=i(745582);const n=function(e,t){var i;if("function"!=typeof t)throw new TypeError("Expected a function");return e=(0,r.default)(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=void 0),i}};const s=function(e){return n(2,e)}},745582:(e,t,i)=>{i.d(t,{default:()=>a});var r=i(968877),n=1/0;const s=function(e){return e?(e=(0,r.default)(e))===n||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const a=function(e){var t=s(e),i=t%1;return t==t?i?t-i:t:0}},500521:(e,t,i)=>{e.exports.pushChartPage=async function(e){const{default:t}=await Promise.all([i.e(76592),i.e(54712),i.e(33371),i.e(63987),i.e(35213),i.e(63830),i.e(1888),i.e(54765),i.e(25977),i.e(78905),i.e(11595),i.e(34629)]).then(i.t.bind(i,55244,23)),r=new t.ChartPage(e);TradingView.historyManager.push(r)}},210542:(e,t,i)=>{i.r(t),i.d(t,{entityForDataSource:()=>c,lineToolEntityInfo:()=>a,seriesEntityInfo:()=>l,studyEntityInfo:()=>o});var r=i(373017),n=i(82908),s=i(617540);function a(e){return{id:e.id(),name:(t=e.toolname,Object.keys(n.supportedLineTools).find((e=>n.supportedLineTools[e].name===t))||null)};var t}function o(e){return{id:e.id(),name:e.metaInfo().description}}function l(e){return{id:e.id(),name:"Main Series"}}function c(e,t){return t===e.mainSeries()?l(e.mainSeries()):(0,r.isStudy)(t)?o(t):(0,s.isLineTool)(t)?a(t):null}},178323:(e,t,i)=>{i.r(t),i.d(t,{LineDataSourceApi:()=>c,isLineToolRiskReward:()=>o});var r=i(650151),n=i(389137);const s=new Map([["LineToolBezierQuadro",3],["LineToolBezierCubic",4]]);function a(e){const t=s.get(e.toolname);if(void 0!==t)return t;const i=e.pointsCount();return-1===i?e.points().length:i}function o(e){return"LineToolRiskRewardLong"===e||"LineToolRiskRewardShort"===e}
const l=["alwaysShowStats","entryPrice","inputs.first bar time","inputs.last bar time","interval","linesWidths","points","snapTo45Degrees","stopPrice","symbol","symbolStateVersion","currencyId","unitId","targetPrice","zOrderVersion"];class c{constructor(e,t,i){this._source=e,this._undoModel=t,this._model=t.model(),this._pointsConverter=i}isSelectionEnabled(){return this._source.isSelectionEnabled()}setSelectionEnabled(e){this._source.setSelectionEnabled(e)}isSavingEnabled(){return this._source.isSavedInChart()}setSavingEnabled(e){this._source.setSavingInChartEnabled(e)}isShowInObjectsTreeEnabled(){return this._source.showInObjectTree()}setShowInObjectsTreeEnabled(e){this._source.setShowInObjectsTreeEnabled(e)}isUserEditEnabled(){return this._source.userEditEnabled()}setUserEditEnabled(e){this._source.setUserEditEnabled(e)}bringToFront(){this._model.bringToFront([this._source])}sendToBack(){this._model.sendToBack([this._source])}getProperties(){return this._source.properties().state(l,!0)}setProperties(e){this._setProps(this._source.properties(),e,"")}getPoints(){let e=this._source.points();const t=a(this._source);return e.length>t&&((0,r.assert)(o(this._source.toolname)),e=e.slice(0,t)),this._pointsConverter.dataSourcePointsToPriced(e)}setPoints(e){if(this._source.isFixed())return;const t=a(this._source);if(t!==e.length)throw new Error(`Wrong points count. Required: ${t}, provided: ${e.length}`);const i=this._pointsConverter.apiPointsToDataSource(e);this._model.startChangingLinetool(this._source),this._model.changeLinePoints(this._source,i),this._model.endChangingLinetool(!0),this._source.createServerPoints()}getAnchoredPosition(){return this._source.positionPercents()}setAnchoredPosition(e){const t=this._source.fixedPoint(),i=this._source.linkKey().value(),r=void 0===t?null:this._source.screenPointToPoint(t);if(!this._source.isFixed()||void 0===t||null===i||null===r)return;const n={logical:r,screen:t},s=new Map;s.set(i,e),this._model.startMovingSources([this._source],n,null,new Map),this._model.moveSources(n,s),this._model.endMovingSources(!0)}ownerSourceId(){return(0,r.ensureNotNull)(this._source.ownerSource()).id()}changePoint(e,t){if(this._source.isFixed())return;const i=this._pointsConverter.apiPointsToDataSource([e])[0];this._model.startChangingLinetool(this._source,{...i},t),this._model.changeLinePoint({...i}),this._model.endChangingLinetool(!1),this._source.createServerPoints()}isHidden(){return this._source.isSourceHidden()}getRawPoints(){return this._source.points()}setRawPoint(e,t){this._model.startChangingLinetool(this._source,{...t},e),this._model.changeLinePoint({...t}),this._model.endChangingLinetool(!1)}move(e,t){this._model.startMovingSources([this._source],{logical:e},null,new Map),this._model.moveSources({logical:t},new Map),this._model.endMovingSources(!1)}dataAndViewsReady(){return this._source.dataAndViewsReady()}zorder(){return this._source.zorder()}symbol(){return this._source.properties().symbol.value()}currency(){return this._source.properties().currencyId.value()}unit(){
return this._source.properties().unitId.value()}share(e){this._undoModel.shareLineTools([this._source],e)}setVisible(e,t=!1){this._undoModel.setProperty(this._source.properties().visible,e,null,t)}sharingMode(){return this._source.sharingMode().value()}_setProps(e,t,i){for(const r in t){if(!t.hasOwnProperty(r))continue;const s=0===i.length?r:`${i}.${r}`;if(e.hasOwnProperty(r)){const i=t[r];(0,n.isHashObject)(i)?this._setProps(e[r],i,s):e[r].setValue(i)}else console.warn(`Unknown property "${s}"`)}}}},66066:(e,t,i)=>{i.d(t,{ReplayApi:()=>r});class r{constructor(e){this._replayUIController=e}isReplayToolbarVisible(){return this._replayUIController.isReplayModeEnabled()}showReplayToolbar(){return this._replayUIController.enableReplayMode()}hideReplayToolbar(){return this._replayUIController.requestCloseReplay()}}},100148:(e,t,i)=>{function r(e,t){const i=e.dataSourceForId(t);if(null===i)throw new Error(`Chart has no study or shape with id "${t}"`);return i}i.d(t,{SelectionApi:()=>n});class n{constructor(e){this._model=e}add(e){Array.isArray(e)?this._model.selectionMacro((t=>{e.map(r.bind(null,this._model)).forEach((e=>t.addSourceToSelection(e)))})):this.add([e])}canBeAddedToSelection(e){const t=r(this._model,e);return this._model.selection().canBeAddedToSelection(t)}set(e){Array.isArray(e)?this._model.selectionMacro((t=>{t.clearSelection(),e.map(r.bind(null,this._model)).forEach((e=>t.addSourceToSelection(e)))})):this.set([e])}remove(e){Array.isArray(e)?this._model.selectionMacro((t=>{e.map(r.bind(null,this._model)).forEach((e=>t.removeSourceFromSelection(e)))})):this.remove([e])}contains(e){const t=r(this._model,e);return this._model.selection().isSelected(t)}allSources(){return this._model.selection().dataSources().map((e=>e.id()))}isEmpty(){return this._model.selection().isEmpty()}clear(){this._model.selectionMacro((e=>{e.clearSelection()}))}onChanged(){return this._model.onSelectedSourceChanged()}}},591316:(e,t,i)=>{i.d(t,{getStudyInputsInfo:()=>n});var r=i(444372);function n(e){return void 0===e.inputs?[]:e.inputs.map((e=>({...e,id:e.id,localizedName:void 0!==e.name?r.t(e.name,{context:"input"},i(788601)):""})))}},443403:(e,t,i)=>{i.d(t,{getStudyStylesInfo:()=>n});var r=i(822914);function n(e){const t={};if(e.defaults){const i=(0,r.default)(e.defaults);t.defaults=i}return void 0!==e.plots&&(t.plots=(0,r.default)(e.plots)),void 0!==e.styles&&(t.styles=(0,r.default)(e.styles)),void 0!==e.bands&&(t.bands=(0,r.default)(e.bands)),void 0!==e.filledAreas&&(t.filledAreas=(0,r.default)(e.filledAreas)),void 0!==e.palettes&&(t.palettes=(0,r.default)(e.palettes)),t}},656130:(e,t,i)=>{i.d(t,{generateChartUrl:()=>n});var r=i(314802);function n(e){const t=e.chartId?`/chart/${e.chartId}/`:"/chart/",i=new URL(t,location.href);return e.symbol&&i.searchParams.append("symbol",e.symbol),e.interval&&i.searchParams.append("interval",e.interval),e.style&&i.searchParams.append("style",e.style),(0,r.urlWithMobileAppParams)(i.href)}},332450:(e,t,i)=>{i.d(t,{CLOSE_POPUPS_AND_DIALOGS_COMMAND:()=>r,breakpointList:()=>n})
;const r="CLOSE_POPUPS_AND_DIALOGS_COMMAND",n=[1920,1440,1280,1024,768,480,0]},290382:(e,t,i)=>{i.d(t,{SymbolSearchUI:()=>a});var r=i(650151),n=i(34831),s=i(583912);class a{async show(e){if(null!==a._provider){const e=await a._provider.getSymbol();return s.linking.setSymbolAndLogInitiator(e.symbol,"symbol search UI"),e}if(a._currentShowingInstance)throw new DOMException("SymbolSearchUI is already shown","InvalidStateError");try{a._currentShowingInstance=this,a.preload();const t=await a._implementation;return(0,r.assert)(null!==t),new Promise((i=>{t.showDefaultSearchDialog({...e,onSearchComplete:e=>{i({symbol:e})}})}))}finally{a._currentShowingInstance=null}}static setProvider(e){this._provider=e}static preload(){null===this._provider&&null===this._implementation&&(this._implementation=(0,n.loadNewSymbolSearch)())}}a._currentShowingInstance=null,a._provider=null,a._implementation=null},578988:(e,t,i)=>{i.d(t,{backend:()=>M});var r={};i.r(r),i.d(r,{getCharts:()=>g,getChartsCount:()=>m,getDrawingTemplates:()=>D,getStandardStudyTemplateContentById:()=>A,getStudyTemplateContent:()=>w,getStudyTemplateContentById:()=>T,getStudyTemplatesList:()=>v,invalidateStudyTemplatesList:()=>b,loadChart:()=>_,loadDrawingTemplate:()=>k,removeChart:()=>f,removeDrawingTemplate:()=>E,removeStudyTemplate:()=>C,removeStudyTemplateById:()=>I,renameStudyTemplate:()=>P,replaceStudyTemplate:()=>W,saveChart:()=>p,saveDrawingTemplate:()=>L,saveStudyTemplate:()=>y});i(823127);var n=i(656130),s=i(930003);const a=(0,i(201089).getLogger)("Lib.AsyncGzip"),o=[];var l=i(120780);function c(e){if(e.ok)return e.json();throw new Error("not ok")}function h(e){if(e.ok)return e.json();throw new Error("not ok")}var d=i(314802),u=i(823127);function g(e){return new Promise(((t,i)=>{u.getJSON("/my-charts/",{limit:e},t).fail(i)}))}function m(e,t){u.getJSON("/api/v1/charts/count/",void 0,e).fail(t)}function _(e){const t=(0,n.generateChartUrl)({chartId:e.url}),i=document.createElement("a");i.href=t,!(0,d.isOnMobileAppPage)("new")&&/^\/chart(\/|$)/.test(location.pathname)&&(i.target="_blank",i.rel="noopener"),i.click()}function p(e,t,r,n,l){return function(e){let t;const r=new Promise(((r,n)=>{let a=setTimeout(n,5e3,new Error("Loading timed out"));t=o.pop()||new s.Worker(new URL(i.p+i.u(31482),i.b),{name:"Async gzip worker"}),t.onerror=n,t.onmessageerror=n,t.onmessage=e=>{clearTimeout(a),"done"===e.data.type?r(e.data.payload):a=setTimeout(n,3e4,new Error("Processing timed out"))},t.postMessage({type:"do",payload:e})}));return r.then((()=>{o.length<1?(delete t.onerror,delete t.onmessage,delete t.onmessageerror,o.push(t)):t.terminate()}),(e=>{a.logError(`Worker request failed: ${e.message}`),t.terminate()})),r}(n.content).catch((()=>null)).then((e=>{const t=new FormData;for(const i in n)"content"===i&&e?t.append(i,new Blob([e],{type:"application/gzip"}),"blob.gz"):t.append(i,String(n[i]));return fetch("/savechart/",{method:"POST",credentials:"same-origin",body:t})})).then((e=>{if(!e.ok)throw e;return e.text()}))}function f(e){return fetch("/api/v1/charts/delete/",{
method:"POST",credentials:"same-origin",body:JSON.stringify({uid:[e]}),headers:new Headers({"Content-Type":"application/json"})}).then((e=>{if(!e.ok)throw e;return e.json()})).then((e=>{if(e.error)throw e.error}))}let S=null;function v(){return null===S&&(S=(0,l.fetch)("/api/v1/study-templates",{credentials:"same-origin"}).then(c).then((e=>{const t=new Set((e.standard||[]).map((e=>e.name))),i=(e.custom||[]).map((e=>({...e,is_default:!1})));for(const e of i)t.delete(e.name);const r=(e.standard||[]).filter((e=>t.has(e.name))).map((e=>({...e,is_default:!0})));return[...i,...r]}))),S}function b(){S=null}function y(e){return t={name:e.name,content:e.content,meta_info:e.meta_info||{indicators:[]}},(0,l.fetch)("/api/v1/study-templates",{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>{if(e.ok)return e.json().then((e=>({result:e})));switch(e.status){case 403:return e.json().then((e=>({error:e.code})));case 422:return e.json().then((e=>({error:e.code,id:e.id})));default:throw new Error("not ok")}}));var t}async function w(e){throw new Error("Not implemented")}async function C(e){throw new Error("Not implemented")}function T(e,t){(function(e){return(0,l.fetch)(`/api/v1/study-templates/${e}`,{credentials:"same-origin"}).then(c)})(e).then(t)}function A(e,t){(function(e){return(0,l.fetch)(`/api/v1/study-templates/standard/${e}`,{credentials:"same-origin"}).then(c)})(e).then(t)}function I(e,t){(function(e){return(0,l.fetch)(`/api/v1/study-templates/${e}`,{credentials:"same-origin",method:"DELETE"}).then((e=>{if(!e.ok)throw new Error("not ok")}))})(e).then(t)}function P(e,t,i){(function(e,t){return(0,l.fetch)(`/api/v1/study-templates/${e}/rename/`,{credentials:"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(c)})(e,{name:t}).then(i)}function W(e,t,i){(function(e,t){return(0,l.fetch)(`/api/v1/study-templates/${e}`,{credentials:"same-origin",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(c)})(e,{name:t.name,content:t.content,meta_info:t.meta_info||{indicators:[]}}).then(i)}function D(e){return function(e){return(0,l.fetch)(`/drawing-templates/${e}/`,{credentials:"same-origin"}).then(h)}(e)}function L(e,t,i){return function(e,t,i){const r=new FormData;return r.append("name",t),r.append("tool",e),r.append("content",i),(0,l.fetch)("/save-drawing-template/",{method:"POST",credentials:"same-origin",body:r}).then(h)}(e,t,i)}function k(e,t){return async function(e,t){const i=await(0,l.fetch)(`/drawing-template/${e}/?templateName=${encodeURIComponent(t)}`,{credentials:"same-origin"}),r=await h(i);return JSON.parse(r.content)}(e,t)}function E(e,t){return function(e,t){const i=new FormData;return i.append("name",t),i.append("tool",e),(0,l.fetch)("/remove-drawing-template/",{method:"POST",credentials:"same-origin",body:i}).then(h)}(e,t)}const M=r},800092:(e,t,i)=>{i.d(t,{INTERVALS:()=>n});var r=i(444372);const n=[{name:"",label:r.t(null,{context:"interval"},i(537830))},{name:"H",
label:r.t(null,{context:"interval"},i(705285))},{name:"D",label:r.t(null,{context:"interval"},i(306174))},{name:"W",label:r.t(null,{context:"interval"},i(725042))},{name:"M",label:r.t(null,{context:"interval"},i(179410))}];n.push({name:"R",label:r.t(null,{context:"interval"},i(635693))})},856531:(e,t,i)=>{i.r(t),i.d(t,{closeMobileChartPickerCommand:()=>n,openMobileChartPickerCommand:()=>r});const r="OPEN_MOBILE_CHART_PICKER_COMMAND",n="CLOSE_MOBILE_CHART_PICKER_COMMAND"},9840:(e,t,i)=>{i.d(t,{CustomIntervalsService:()=>d,customIntervalsServiceInstance:()=>u});var r=i(62802),n=i(226722),s=i(405117),a=i(833813),o=i(552279),l=i(699466),c=i(731042),h=i(337779);class d extends l.AbstractJsonStoreService{constructor(e,t,i=[]){super(e,t,"CUSTOM_INTERVALS_CHANGED","IntervalWidget.intervals",i)}set(e,t){(0,s.trackGoProFeature)("customIntervals"),e.length<this.get().length?super.set(e,t):(0,o.runOrGoPro)((()=>super.set(e,t)),a.ProductFeatures.CUSTOM_INTERVALS,{feature:"customIntervals"})}_serialize(e){return(0,h.uniq)(e.map(c.normalizeIntervalString))}_deserialize(e){return(0,h.uniq)((0,c.convertResolutionsFromSettings)(e).filter(c.isResolutionMultiplierValid).map(c.normalizeIntervalString))}}const u=new d(n.TVXWindowEvents,r)},661797:(e,t,i)=>{i.d(t,{IntervalsService:()=>l});var r=i(583912),n=i(707957),s=i(9840),a=i(800092),o=i(731042);class l{constructor(e){this._customIntervalsService=s.customIntervalsServiceInstance,this._supportedIntervalsMayChange=new n.Delegate,this._fireSupportedIntervalsMayChange=()=>{this._supportedIntervalsMayChange.fire()},this._chartApiInstance=e,r.linking.supportedResolutions.subscribe(this._fireSupportedIntervalsMayChange),r.linking.range.subscribe(this._fireSupportedIntervalsMayChange),r.linking.seconds.subscribe(this._fireSupportedIntervalsMayChange),r.linking.ticks.subscribe(this._fireSupportedIntervalsMayChange),r.linking.intraday.subscribe(this._fireSupportedIntervalsMayChange),r.linking.dataFrequencyResolution.subscribe(this._fireSupportedIntervalsMayChange)}destroy(){r.linking.supportedResolutions.unsubscribe(this._fireSupportedIntervalsMayChange),r.linking.range.unsubscribe(this._fireSupportedIntervalsMayChange),r.linking.seconds.unsubscribe(this._fireSupportedIntervalsMayChange),r.linking.ticks.unsubscribe(this._fireSupportedIntervalsMayChange),r.linking.intraday.unsubscribe(this._fireSupportedIntervalsMayChange),r.linking.dataFrequencyResolution.unsubscribe(this._fireSupportedIntervalsMayChange)}getDefaultIntervals(){return null===this._chartApiInstance?[]:this._chartApiInstance.defaultResolutions().map(o.normalizeIntervalString)}getCustomIntervals(){return this._customIntervalsService.get()}add(e,t,i){if(!window.user.is_pro&&i)return i(),null;if(!this.isValidInterval(e,t))return null;const r=(0,o.normalizeIntervalString)(`${e}${t}`),n=this.getCustomIntervals();return this._isIntervalDefault(r)||n.includes(r)?null:(this._customIntervalsService.set((0,o.sortResolutions)([...n,r])),r)}remove(e){this._customIntervalsService.set(this.getCustomIntervals().filter((t=>t!==e)))}
isValidInterval(e,t){return(0,o.isResolutionMultiplierValid)(`${e}${t}`)}isSupportedInterval(e){return(0,o.isAvailable)(e)}supportedIntervalsMayChange(){return this._supportedIntervalsMayChange}getOnChange(){return this._customIntervalsService.getOnChange()}getPossibleIntervals(){return a.INTERVALS}getResolutionUtils(){return{getMaxResolutionValue:o.getMaxResolutionValue,getTranslatedResolutionModel:o.getTranslatedResolutionModel,mergeResolutions:o.mergeResolutions,sortResolutions:o.sortResolutions}}_isIntervalDefault(e){return this.getDefaultIntervals().includes(e)}}},723296:(e,t,i)=>{i.d(t,{RangeBinding:()=>h});var r=i(707957),n=i(77122),s=i(444372),a=i(223699),o=i(636929);function l(e){const t=function(e){const t=e.value.value,r=a.Interval.parse(t);if(!r.isValid()){if("YTD"===t)return s.t(null,{context:"timeframe_title"},i(987556));if("ALL"===t)return s.t(null,{context:"timeframe_title"},i(574944));if("LASTSESSION"===t)return c(1)}if(r.isMinutes()){const e=r.multiplier();return e%60!=0?(o=e,s.t(null,{plural:"{str} minutes",count:o,replace:{str:`${o}`},context:"timeframe_title"},i(644795))):(n=e/60,s.t(null,{plural:"{str} hours",count:n,replace:{str:`${n}`},context:"timeframe_title"},i(989020)))}var n;var o;if(r.isDays())return c(r.multiplier());if(r.isWeeks())return l=r.multiplier(),s.t(null,{plural:"{str} weeks",count:l,replace:{str:`${l}`},context:"timeframe_title"},i(667518));var l;if(r.isMonths()){const e=r.multiplier();return e%12!=0?(d=e,s.t(null,{plural:"{str} months",count:d,replace:{str:`${d}`},context:"timeframe_title"},i(703189))):(h=e/12,s.t(null,{plural:"{str} years",count:h,replace:{str:`${h}`},context:"timeframe_title"},i(304895)))}var h;var d;return e.description||e.text}(e),r=function(e){const t=e.targetResolution,r=a.Interval.parse(t);if(r.isMinutes()){const e=r.multiplier();return e%60!=0?(l=e,s.t(null,{plural:"{str} minutes intervals",count:l,replace:{str:`${l}`},context:"timeframe_title"},i(856347))):(n=e/60,s.t(null,{plural:"{str} hours intervals",count:n,replace:{str:`${n}`},context:"timeframe_title"},i(854028)))}var n;var l;if(r.isDays())return c=r.multiplier(),s.t(null,{plural:"{str} days intervals",count:c,replace:{str:`${c}`},context:"timeframe_title"},i(781693));var c;if(r.isWeeks())return h=r.multiplier(),s.t(null,{plural:"{str} weeks intervals",count:h,replace:{str:`${h}`},context:"timeframe_title"},i(458667));var h;if(r.isMonths()){const e=r.multiplier();return e%12!=0?(u=e,s.t(null,{plural:"{str} months intervals",count:u,replace:{str:`${u}`},context:"timeframe_title"},i(499773))):(d=e/12,s.t(null,{plural:"{str} years intervals",count:d,replace:{str:`${d}`},context:"timeframe_title"},i(757849)))}var d;var u;return o.resolutionsMap[t].text}(e);return s.t(null,{replace:{timePeriod:t,timeInterval:r},context:"timeframe_title"},i(829505))}const c=e=>s.t(null,{plural:"{str} days",count:e,replace:{str:`${e}`},context:"timeframe_title"},i(942908));class h{constructor(e){this._state={ranges:[]},this._change=new r.Delegate,this._rangeChangedListenerBound=this._onRangeChanged.bind(this)
;const{chartWidget:t}=this._context=e;t.withModel(null,(()=>{const e=t.model(),i=e.mainSeries();i.onStatusChanged().subscribe(this,this._updateAvailableRanges),n.enabled("update_timeframes_set_on_symbol_resolve")&&i.dataEvents().symbolResolved().subscribe(this,this._updateAvailableRanges),i.priceScale().properties().childs().lockScale.subscribe(this,this._updateAvailableRanges);const r=e.model().appliedTimeFrame();r.subscribe(this._rangeChangedListenerBound),this._rangeChangedListenerBound(r.value()),this._updateAvailableRanges()}))}state(){return this._state}onChange(){return this._change}selectRange(e){this._setState({activeRange:e.value.value});const{chartWidgetCollection:t}=this._context,i={val:e.value,res:e.targetResolution};t.setTimeFrame(i)}destroy(){const{chartWidget:e}=this._context;e.withModel(null,(()=>{const t=e.model(),i=t.mainSeries();i.onStatusChanged().unsubscribe(this,this._updateAvailableRanges),n.enabled("update_timeframes_set_on_symbol_resolve")&&i.dataEvents().symbolResolved().unsubscribe(this,this._updateAvailableRanges),i.priceScale().properties().childs().lockScale.unsubscribe(this,this._updateAvailableRanges),t.model().appliedTimeFrame().unsubscribe(this._rangeChangedListenerBound)})),this._change.destroy()}_setState(e){this._state=Object.assign({},this._state,e),this._change.fire(this._state)}_onRangeChanged(e){let t;null!==e&&"period-back"===e.val.type&&(t=e.val.value),this._setState({activeRange:t})}_updateAvailableRanges(){const{availableTimeFrames:e,chartWidget:t}=this._context;if(!t.hasModel())return;const i=t.model().mainSeries(),r=i.status();if(2===r||1===r)return;const n=e(i.symbolInfo(),i.status()).map((e=>({...e,description:l(e)})));0!==n.length&&this._setState({ranges:n})}}},82908:(e,t,i)=>{i.r(t),i.d(t,{isSupportedLineTool:()=>s,supportedLineTools:()=>a});var r=i(125226),n=i(314802);function s(e){return e in a}const a={cursor:{name:"cursor",onlySelectable:!0},dot:{name:"dot",onlySelectable:!0},arrow_cursor:{name:"arrow",onlySelectable:!0},eraser:{name:"eraser",onlySelectable:!0},measure:{name:"measure",onlySelectable:!0},zoom:{name:"zoom",onlySelectable:!0},brush:{name:"LineToolBrush"},highlighter:{name:"LineToolHighlighter"},text:{name:"LineToolText"},anchored_text:{name:"LineToolTextAbsolute",isAnchored:!0},note:{name:"LineToolNote"},anchored_note:{name:"LineToolNoteAbsolute",isAnchored:!0},signpost:{name:"LineToolSignpost"},callout:{name:"LineToolCallout"},balloon:{name:"LineToolBalloon"},comment:{name:"LineToolComment"},arrow_up:{name:"LineToolArrowMarkUp"},arrow_down:{name:"LineToolArrowMarkDown"},arrow_left:{name:"LineToolArrowMarkLeft"},arrow_right:{name:"LineToolArrowMarkRight"},price_label:{name:"LineToolPriceLabel"},price_note:{name:"LineToolPriceNote"},arrow_marker:{name:"LineToolArrowMarker"},flag:{name:"LineToolFlagMark"},vertical_line:{name:"LineToolVertLine"},horizontal_line:{name:"LineToolHorzLine"},cross_line:{name:"LineToolCrossLine"},horizontal_ray:{name:"LineToolHorzRay"},trend_line:{name:"LineToolTrendLine"},info_line:{name:"LineToolInfoLine"},trend_angle:{
name:"LineToolTrendAngle"},arrow:{name:"LineToolArrow"},ray:{name:"LineToolRay"},extended:{name:"LineToolExtended"},parallel_channel:{name:"LineToolParallelChannel"},disjoint_angle:{name:"LineToolDisjointAngle"},flat_bottom:{name:"LineToolFlatBottom"},anchored_vwap:{name:"LineToolAnchoredVWAP"},pitchfork:{name:"LineToolPitchfork"},schiff_pitchfork_modified:{name:"LineToolSchiffPitchfork"},schiff_pitchfork:{name:"LineToolSchiffPitchfork2"},inside_pitchfork:{name:"LineToolInsidePitchfork"},pitchfan:{name:"LineToolPitchfan"},gannbox:{name:"LineToolGannSquare"},gannbox_square:{name:"LineToolGannComplex"},gannbox_fixed:{name:"LineToolGannFixed"},gannbox_fan:{name:"LineToolGannFan"},fib_retracement:{name:"LineToolFibRetracement"},fib_trend_ext:{name:"LineToolTrendBasedFibExtension"},fib_speed_resist_fan:{name:"LineToolFibSpeedResistanceFan"},fib_timezone:{name:"LineToolFibTimeZone"},fib_trend_time:{name:"LineToolTrendBasedFibTime"},fib_circles:{name:"LineToolFibCircles"},fib_spiral:{name:"LineToolFibSpiral"},fib_speed_resist_arcs:{name:"LineToolFibSpeedResistanceArcs"},fib_wedge:{name:"LineToolFibWedge"},fib_channel:{name:"LineToolFibChannel"},xabcd_pattern:{name:"LineTool5PointsPattern"},cypher_pattern:{name:"LineToolCypherPattern"},abcd_pattern:{name:"LineToolABCD"},triangle_pattern:{name:"LineToolTrianglePattern"},"3divers_pattern":{name:"LineToolThreeDrivers"},head_and_shoulders:{name:"LineToolHeadAndShoulders"},elliott_impulse_wave:{name:"LineToolElliottImpulse"},elliott_triangle_wave:{name:"LineToolElliottTriangle"},elliott_triple_combo:{name:"LineToolElliottTripleCombo"},elliott_correction:{name:"LineToolElliottCorrection"},elliott_double_combo:{name:"LineToolElliottDoubleCombo"},cyclic_lines:{name:"LineToolCircleLines"},time_cycles:{name:"LineToolTimeCycles"},sine_line:{name:"LineToolSineLine"},long_position:{name:"LineToolRiskRewardLong"},short_position:{name:"LineToolRiskRewardShort"},forecast:{name:"LineToolPrediction"},date_range:{name:"LineToolDateRange"},price_range:{name:"LineToolPriceRange"},date_and_price_range:{name:"LineToolDateAndPriceRange"},bars_pattern:{name:"LineToolBarsPattern"},ghost_feed:{name:"LineToolGhostFeed"},projection:{name:"LineToolProjection"},rectangle:{name:"LineToolRectangle"},rotated_rectangle:{name:"LineToolRotatedRectangle"},circle:{name:"LineToolCircle"},ellipse:{name:"LineToolEllipse"},triangle:{name:"LineToolTriangle"},polyline:{name:"LineToolPolyline"},path:{name:"LineToolPath"},curve:{name:"LineToolBezierQuadro"},double_curve:{name:"LineToolBezierCubic"},arc:{name:"LineToolArc"},icon:{name:"LineToolIcon"},emoji:{name:"LineToolEmoji"},sticker:{name:"LineToolSticker"},regression_trend:{name:"LineToolRegressionTrend"},fixed_range_volume_profile:{name:"LineToolFixedRangeVolumeProfile"}};(0,r.isFeatureEnabled)("hide_tweet_drawingtool")||(a.tweet={name:"LineToolTweet"}),(0,r.isFeatureEnabled)("hide_left_right_arrow_tools")&&!(0,n.isOnMobileAppPage)("any")&&(delete a.arrow_left,delete a.arrow_right),a.idea={name:"LineToolIdea"},a.image={name:"LineToolImage"},
a.anchored_volume_profile={name:"LineToolAnchoredVolumeProfile"}},708706:(e,t,i)=>{i.d(t,{ChartChangesWatcher:()=>s,changedAll:()=>n});var r=i(707957);const n=3;class s{constructor(e,t,i){this._undoHistoryHasChanges=!1,this._changesMask=0,this._recursiveLoopingGuard=!1,this._handleMetainfoChanged=()=>{this._changesMask=1|this._changesMask},this._recalculateHaveChanges=(e,t)=>{if(!this._recursiveLoopingGuard)try{this._recursiveLoopingGuard=!0;const e=this._undoHistoryHasChanges?1:0;let i=this._lineToolsHaveChanges.value()?2:0;const r=this._changesMask;this._changesMask=e|i,r!==this._changesMask&&(this._changesMask&&(this._chartWidgetCollection.getAll().forEach((e=>{var i;null===(i=e.lineToolsSynchronizer())||void 0===i||i.markAsValidatedBecauseOfSavingToContent(!!t)})),i=this._lineToolsHaveChanges.value()?2:0,this._changesMask=e|i),this._onValueChanged.fire(0!==this._changesMask))}finally{this._recursiveLoopingGuard=!1}},this._chartWidgetCollection=e,this._undoHistory=e.undoHistory,this._lineToolsHaveChanges=e.lineToolsSynchronizerHasChanges,this._chartSaver=t,this._globalEvents=i,this._onValueChanged=new r.Delegate,this._subscribe()}destroy(){this._unsubscribe(),this._onValueChanged.destroy()}changes(){return this._changesMask}hasChanges(){return this._changesMask>0}getOnChange(){return this._onValueChanged}_subscribe(){var e;this._globalEvents.subscribe("chart_loaded",this._handleChartLoaded,this),this._globalEvents.subscribe("chart_migrated",this._handleChartMigrated,this),this._undoHistory.undoStack().onChange().subscribe(this,this._handleUndoHistoryChange),null===(e=this._chartSaver)||void 0===e||e.chartSaved().subscribe(this,this._handleChartSaved),this._lineToolsHaveChanges.subscribe(this._recalculateHaveChanges);this._chartWidgetCollection.metaInfo.name.subscribe(this._handleMetainfoChanged)}_unsubscribe(){var e;this._globalEvents.unsubscribe("chart_loaded",this._handleChartLoaded,this),this._globalEvents.unsubscribe("chart_migrated",this._handleChartMigrated,this),this._undoHistory.undoStack().onChange().unsubscribe(this,this._handleUndoHistoryChange),null===(e=this._chartSaver)||void 0===e||e.chartSaved().unsubscribe(this,this._handleChartSaved),this._lineToolsHaveChanges.unsubscribe(this._recalculateHaveChanges);this._chartWidgetCollection.metaInfo.name.unsubscribe(this._handleMetainfoChanged)}_setUndoHistoryHasChanges(e,t){this._undoHistoryHasChanges=e,this._recalculateHaveChanges(e,t)}_handleChartLoaded(){this._setUndoHistoryHasChanges(!1)}_handleUndoHistoryChange(e){e&&!e.customFlag("doesnt_affect_save")&&this._setUndoHistoryHasChanges(!0)}_handleChartMigrated(){this._setUndoHistoryHasChanges(!0)}_handleChartSaved(e){e&&this._setUndoHistoryHasChanges(!1,!0)}}},2008:(e,t,i)=>{i.d(t,{ChartWidgetApiBase:()=>ne});var r=i(650151),n=i(444372),s=i(809796),a=(i(77122),i(223699)),o=i(428784),l=i(547944),c=i(987571);class h{constructor(e){this._timeScale=e}coordinateToTime(e){const t=this._timeScale.coordinateToIndex(e);return this._timeScale.indexToTimePoint(t)}barSpacingChanged(){
return this._timeScale.barSpacingChanged()}rightOffsetChanged(){return this._timeScale.rightOffsetChanged()}setRightOffset(e){this._timeScale.setRightOffset(e)}setBarSpacing(e){this._timeScale.setBarSpacing(e)}barSpacing(){return this._timeScale.barSpacing()}rightOffset(){return this._timeScale.rightOffset()}width(){return this._timeScale.width()}defaultRightOffset(){return this._timeScale.defaultRightOffset().spawn()}defaultRightOffsetPercentage(){return this._timeScale.defaultRightOffsetPercentage().spawn()}usePercentageRightOffset(){return this._timeScale.usePercentageRightOffset().spawn()}isEmpty(){return this._timeScale.isEmpty()}scrollToFirstBar(e){this._timeScale.scrollToFirstBar(e)}scrollToRealtime(e){this._timeScale.scrollToRealtime(!1,e)}pointsCount(){return this._timeScale.points().size()}}var d=i(707957),u=i(15458);const g=new s.TranslatedString("change timezone",n.t(null,void 0,i(820505)));class m{constructor(e){this._onTimezoneChanged=new d.Delegate,this._chartWidget=e,this._timezoneProperty=e.properties().childs().timezone,this._timezoneProperty.subscribe(this,(e=>{this._onTimezoneChanged.fire(e.value())})),e.onAboutToBeDestroyed().subscribe(this,(()=>{this._timezoneProperty.unsubscribeAll(this)}),!0)}availableTimezones(){return u.availableTimezones}getTimezone(){const e=this._timezoneProperty.value();return(0,r.ensureDefined)(this.availableTimezones().find((t=>t.id===e)))}setTimezone(e,t){(0,r.assert)((0,u.timezoneIsAvailable)(e),`Incorrect timezone: ${e}`),(null==t?void 0:t.disableUndo)?this._timezoneProperty.setValue(e):this._chartWidget.model().setProperty(this._timezoneProperty,e,g)}onTimezoneChanged(){return this._onTimezoneChanged}}class _{constructor(e,t){this._chartUndoModel=e,this._chartModel=e.model(),this._priceScale=t}getMode(){const e=this._priceScale.properties().childs();return e.percentage.value()?2:e.indexedTo100.value()?3:e.log.value()?1:0}setMode(e){this._priceScale.setMode({percentage:2===e,log:1===e,indexedTo100:3===e})}isInverted(){return this._priceScale.isInverted()}setInverted(e){this._priceScale.properties().childs().isInverted.setValue(e)}isLocked(){return this._priceScale.isLockScale()}setLocked(e){this._priceScale.setMode({lockScale:e})}isAutoScale(){return this._priceScale.isAutoScale()}setAutoScale(e){this._priceScale.setMode({autoScale:e})}getVisiblePriceRange(){return this._priceScale.priceRangeInPrice()}setVisiblePriceRange(e){this._priceScale.setPriceRangeInPrice(e),this._chartModel.lightUpdate()}hasMainSeries(){return this._priceScale.hasMainSeries()}getStudies(){return this._priceScale.getStudies().map((e=>e.id()))}currency(){const e=this._chartModel.availableCurrencies(),t=this._priceScale.currency(e);return null===t?null:{readOnly:t.readOnly,selectedCurrency:null===t.selectedCurrency?"Mixed":t.selectedCurrency,currencies:e.getItems()}}setCurrency(e){var t;const i=null===(t=this.currency())||void 0===t?void 0:t.currencies
;i&&e&&!i.includes(e)?console.warn("The provided currency is not supported by your datafeed!"):this._chartUndoModel.setPriceScaleCurrency(this._priceScale,e)}unit(){const e=this._priceScale.unit(this._chartModel.availableUnits());return null===e?null:{selectedUnit:e.selectedUnit,readOnly:0===e.availableGroups.size,availableGroups:Array.from(e.availableGroups)}}setUnit(e){!e||this._chartModel.availableUnits().unitGroupById(e)?this._chartUndoModel.setPriceScaleUnit(this._priceScale,e):console.warn("The provided unit is not supported by your datafeed!")}coordinateToPrice(e){var t;const i=null===(t=this._priceScale.mainSource())||void 0===t?void 0:t.firstValue();return null==i?null:this._priceScale.coordinateToPrice(e,i)}measureUnitId(){const e=this._priceScale.measureUnitId(this._chartModel.availableUnits());return null===e?null:{selectedMeasureUnitId:e.selectedMeasureUnitId}}}var p=i(210542),f=i(389137),S=i(142257);const v=new s.TranslatedString("change pane height",n.t(null,void 0,i(187510)));class b extends S.UndoCommand{constructor(e,t,i){super(v),this._model=e,this._paneIndex=t,this._paneHeight=i,this._prevStretchFactors=this._model.panes().map((e=>e.stretchFactor()))}redo(){this._model.changePanesHeight(this._paneIndex,this._paneHeight)}undo(){const e=this._model.panes();for(let t=0;t<e.length;++t)e[t].setStretchFactor((0,r.ensureDefined)(this._prevStretchFactors[t]));this._model.fullUpdate()}}class y{constructor(e,t){this._priceScales=new WeakMap,this._pane=e,this._chartWidget=t}hasMainSeries(){return this._pane.containsMainSeries()}getLeftPriceScales(){return this._pane.leftPriceScales().map(this._getPriceScaleApi,this)}getRightPriceScales(){return this._pane.rightPriceScales().map(this._getPriceScaleApi,this)}getMainSourcePriceScale(){const e=this._pane.mainDataSource();if(null===e)return null;const t=e.priceScale();return null===t||this._pane.isOverlay(e)?null:this._getPriceScaleApi(t)}setMaximized(e){if(this._pane.maximized().value()!==e)for(const e of this._chartWidget.paneWidgets())if(e.state()===this._pane){this._chartWidget.toggleMaximizePane(e);break}}legendLoaded(){const e=this._chartWidget.paneByState(this._pane);return Boolean(e&&e.statusWidget())}getAllEntities(){const e=this._pane.model();return this._pane.sourcesByGroup().allIncludingHidden().filter((e=>!e.isSpeciallyZOrderedSource())).map((t=>(0,p.entityForDataSource)(e,t))).filter(f.notNull).filter((e=>null!==e.name))}getHeight(){return this._pane.height()}setHeight(e){const t=this._chartWidget.model().model(),i=t.panes();(0,r.assert)(i.length>1,"Unable to change pane's height if there is only one pane");const n=i.indexOf(this._pane);(0,r.assert)(-1!==n,"Invalid pane index");const s=new b(t,n,e);this._chartWidget.model().undoHistory().pushUndoCommand(s)}moveTo(e){const t=this.paneIndex();t!==e&&((0,r.assert)(e>=0&&e<this._chartWidget.paneWidgets().length,"Invalid pane index"),this._chartWidget.model().movePane(t,e))}paneIndex(){return this._chartWidget.model().model().panes().indexOf(this._pane)}collapse(){
if(1===this._chartWidget.paneWidgets().length)throw new Error("Cannot collapse a single pane!");if(this._pane.collapsed().value())throw new Error("Cannot collapse current pane!");this._chartWidget.model().toggleCollapsedPane(this._pane)}restore(){if(1===this._chartWidget.paneWidgets().length)throw new Error("Cannot restore a single pane!");if(!this._pane.collapsed().value())throw new Error("Cannot restore current pane!");this._chartWidget.model().toggleCollapsedPane(this._pane)}_getPriceScaleApi(e){let t=this._priceScales.get(e);return void 0===t&&(t=new _(this._chartWidget.model(),e),this._priceScales.set(e,t)),t}}var w=i(982217),C=i(641569),T=i(677305),A=i(475201),I=i(852654),P=i(20269),W=i(642563),D=i(438907),L=i(723604),k=i(504101),E=i(591316),M=i(443403),F=i(590713);class R{constructor(e,t){this._onStudyCompleted=new d.Delegate,this._onStudyError=new d.Delegate,this._study=e,this._chartWidget=t,this._undoModel=this._chartWidget.model(),this._model=this._undoModel.model(),this._study.onAboutToBeDestroyed().subscribe(this,(()=>{this._study.onStatusChanged().unsubscribeAll(this),this._study.onAboutToBeDestroyed().unsubscribeAll(this)})),this._study.onStatusChanged().subscribe(this,(e=>{switch(e.type){case k.StudyStatusType.Completed:this._onStudyCompleted.fire();break;case k.StudyStatusType.Error:this._onStudyError.fire()}}))}isUserEditEnabled(){return this._study.userEditEnabled()}setUserEditEnabled(e){this._study.setUserEditEnabled(e)}getInputsInfo(){return(0,E.getStudyInputsInfo)(this._study.metaInfo())}getInputValues(){const e=this._study.inputs({symbolsForChartApi:!1,asObject:!0});return Object.keys(e).map((t=>{const i=e[t];return{id:t,value:(0,f.isObject)(i)?i.v:i}}))}getStyleInfo(){return(0,M.getStudyStylesInfo)(this._study.metaInfo())}getStyleValues(){const{styles:e,bands:t,filledAreas:i,palettes:r,graphics:n,ohlcPlots:s,filledAreasStyle:a}=this._study.properties().state();return{styles:e,bands:t,filledAreas:i,palettes:r,graphics:n,ohlcPlots:s,filledAreasStyle:a}}setInputValues(e){const t=this.getInputValues();for(const i of e){void 0!==t.find((e=>e.id===i.id))?this._study.properties().childs().inputs.childs()[i.id].setValue(i.value):console.warn(`There is no such input: "${i.id}"`)}}mergeUp(){this._model.isMergeUpAvailableForSource(this._study)&&new I.MergeUpUndoCommand(this._model,this._study,null).redo()}mergeDown(){this._model.isMergeDownAvailableForSource(this._study)&&new I.MergeDownUndoCommand(this._model,this._study,null).redo()}unmergeUp(){this._model.isUnmergeAvailableForSource(this._study)&&new A.UnmergeUpUndoCommand(this._model,this._study,null).redo()}unmergeDown(){this._model.isUnmergeAvailableForSource(this._study)&&new A.UnmergeDownUndoCommand(this._model,this._study,null).redo()}onDataLoaded(){return this._onStudyCompleted}onStudyError(){return this._onStudyError}mergeUpWithUndo(){this._model.isMergeUpAvailableForSource(this._study)&&this._undoModel.mergeSourceUp(this._study)}mergeDownWithUndo(){
this._model.isMergeDownAvailableForSource(this._study)&&this._undoModel.mergeSourceDown(this._study)}unmergeUpWithUndo(){this._model.isUnmergeAvailableForSource(this._study)&&this._undoModel.unmergeSourceUp(this._study)}unmergeDownWithUndo(){this._model.isUnmergeAvailableForSource(this._study)&&this._undoModel.unmergeSourceDown(this._study)}priceScale(){return new _(this._undoModel,(0,r.ensureNotNull)(this._study.priceScale()))}symbolSource(){const e=(0,r.ensureNotNull)(this._study.symbolSource());return{symbol:e.symbol(),currencyId:e.currency(),unitId:e.unit()}}currency(){return this._study.currency()}changePriceScale(e){const t=(0,r.ensureNotNull)(this._model.paneForSource(this._model.mainSeries())),i=(0,r.ensureNotNull)(this._model.paneForSource(this._study));switch(e){case"no-scale":(0,r.assert)(i.actionNoScaleIsEnabled(this._study),"Unable to leave a pane without any non-overlay price scale"),new P.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"overlay",null).redo();break;case"as-series":(0,r.assert)(i===t,"Study should be on the main pane"),new P.MoveToExistingPriceScaleUndoCommand(this._model,this._study,i,this._model.mainSeries().priceScale(),null).redo();break;case"new-left":new P.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"left",null).redo();break;case"new-right":new P.MoveToNewPriceScaleUndoCommand(this._model,this._study,i,"right",null).redo();break;default:const n=this._model.dataSourceForId(e);if(null===n)throw new Error(`There is no study with entityId='${e}'`);const s=i===this._model.paneForSource(n);(0,r.assert)(s,"Both studies should be on the same pane");const a=(0,r.ensureNotNull)(n.priceScale()),o=(0,T.sourceNewCurrencyOnPinningToPriceScale)(this._study,a,this._model),l=(0,D.sourceNewUnitOnPinningToPriceScale)(this._study,a,this._model);new P.MoveToExistingPriceScaleUndoCommand(this._model,this._study,i,a,null).redo(),null!==o&&new C.SetPriceScaleCurrencyUndoCommand(a,o,this._undoModel.chartWidget(),null).redo(),null!==l&&new L.SetPriceScaleUnitUndoCommand(a,l,this._undoModel.chartWidget(),null).redo()}}isVisible(){return this._study.properties().childs().visible.value()}setVisible(e){this._study.properties().childs().visible.setValue(e)}bringToFront(){this._model.bringToFront([this._study])}sendToBack(){this._model.sendToBack([this._study])}applyOverrides(e){(0,o.applyOverridesToStudy)(this._study,e)}dataLength(){return this._study.status().type!==k.StudyStatusType.Completed?0:this._study.metaInfo().plots.length>0?this._study.data().size():this._model.mainSeries().bars().size()}isLoading(){const e=this._study.status();return e.type===k.StudyStatusType.Undefined||e.type===k.StudyStatusType.Loading}hasPendingUnresolvedSymbols(){return this._study.hasPendingUnresolvedSymbols()}anyGraphicsReady(){return!(0,F.isStudyGraphicsEmpty)(this._study.graphics())}graphicsViewsReady(){return this._study.graphicsViewsReady()}properties(){return this._study.properties()}async applyToEntireLayout(){
const e=new W.ActionsProvider(this._chartWidget),t=(await e.contextMenuActionsForSources([this._study])).find((e=>"applyStudyToEntireLayout"===e.id));t&&t.execute()}status(){return{...this._study.status()}}title(){return this._study.title(w.TitleDisplayTarget.StatusLine)}symbolsResolved(){return this._study.symbolsResolved()}}var x=i(178323);class O{constructor(e,t){this._series=e,this._undoModel=t,this._model=t.model()}isUserEditEnabled(){return this._series.userEditEnabled()}setUserEditEnabled(e){this._series.setUserEditEnabled(e)}mergeUp(){this._model.isMergeUpAvailableForSource(this._series)&&new I.MergeUpUndoCommand(this._model,this._series,null).redo()}mergeDown(){this._model.isMergeDownAvailableForSource(this._series)&&new I.MergeDownUndoCommand(this._model,this._series,null).redo()}unmergeUp(){this._model.isUnmergeAvailableForSource(this._series)&&new A.UnmergeUpUndoCommand(this._model,this._series,null).redo()}unmergeDown(){this._model.isUnmergeAvailableForSource(this._series)&&new A.UnmergeDownUndoCommand(this._model,this._series,null).redo()}detachToRight(){new P.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"right",null).redo()}detachToLeft(){new P.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"left",null).redo()}detachNoScale(){new P.MoveToNewPriceScaleUndoCommand(this._model,this._series,this._pane(),"overlay",null).redo()}changePriceScale(e){const t=(0,r.ensureNotNull)(this._model.paneForSource(this._series));switch(e){case"new-left":new P.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"left",null).redo();break;case"new-right":new P.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"right",null).redo();break;case"no-scale":(0,r.assert)(t.actionNoScaleIsEnabled(this._series),"Unable to leave a pane without any non-overlay price scale"),new P.MoveToNewPriceScaleUndoCommand(this._model,this._series,t,"overlay",null).redo();break;default:const i=this._model.dataSourceForId(e);if(null===i)throw new Error(`There is no study with entityId='${e}'`);const n=this._model.paneForSource(i)===t;(0,r.assert)(n,"Study should be on the main pane");const s=(0,r.ensureNotNull)(i.priceScale());new P.MoveToExistingPriceScaleUndoCommand(this._model,this._series,t,s,null).redo()}}isVisible(){return this._series.properties().childs().visible.value()}setVisible(e){this._series.properties().childs().visible.setValue(e)}bringToFront(){this._model.bringToFront([this._series])}sendToBack(){this._model.sendToBack([this._series])}entityId(){return this._series.id()}chartStyleProperties(e){return this._series.properties().childs()[N(e)].state(["inputs","inputsInfo"])}setChartStyleProperties(e,t){this._series.properties().childs()[N(e)].mergeAndFire(t)}barsCount(){return this._series.bars().size()}symbolSource(){return{symbol:this._series.symbol(),currencyId:this._series.currency(),unitId:this._series.unit()}}isLoading(){return this._series.isLoading()}data(){return this._series.data()}priceScale(){return new _(this._undoModel,this._series.priceScale())}_pane(){return(0,
r.ensureNotNull)(this._model.paneForSource(this._series))}}function N(e){switch(e){case 0:return"barStyle";case 1:return"candleStyle";case 2:return"lineStyle";case 14:return"lineWithMarkersStyle";case 15:return"steplineStyle";case 3:return"areaStyle";case 16:return"hlcAreaStyle";case 4:return"renkoStyle";case 5:return"kagiStyle";case 6:return"pnfStyle";case 7:return"pbStyle";case 8:return"haStyle";case 9:return"hollowCandleStyle";case 10:return"baselineStyle";case 11:return"rangeStyle";case 12:return"hiloStyle";case 13:return"columnStyle";case 17:return"volFootprintStyle";default:(0,r.ensureNever)(e)}throw new Error(`unsupported chart style: ${e}`)}var V=i(100148),B=i(723296);class U{constructor(e){this._drawer=null,this._context=e,this._rangeBindings=new B.RangeBinding(e)}drawer(){return Promise.all([i.e(22666),i.e(5993),i.e(62253),i.e(92191),i.e(34465),i.e(32109),i.e(72639),i.e(9817),i.e(69121),i.e(53842),i.e(4015),i.e(92108),i.e(66639),i.e(88194),i.e(87845),i.e(35649),i.e(5145),i.e(38669),i.e(25190),i.e(99916),i.e(22486),i.e(24215),i.e(89434),i.e(18511),i.e(17301),i.e(43159),i.e(46601),i.e(962),i.e(24370),i.e(68985),i.e(95216),i.e(72794),i.e(11571),i.e(8866)]).then(i.bind(i,41094)).then((e=>(null===this._drawer&&(this._drawer=new e.DateRangeDrawerApi(this._context)),this._drawer)))}state(){return this._rangeBindings.state()}onChange(){return this._rangeBindings.onChange()}selectRange(e){this._rangeBindings.selectRange(e)}goToTime(e){const t=this._context.chartWidget.model().model();t.gotoTime(e).then((e=>{const i=t.mainSeries();void 0===e?i.clearGotoDateResult():i.setGotoDateResult(e)}))}}var z=i(775548),H=i(209800),G=i(519231);function j(e,t){const{symbolChanged:i,currencyChanged:r,unitChanged:n,styleChangeRequiresRestart:s}=e.compareSymbolParams(t);return!(i||r||n||s)}function $(e,t){e.isLoading()&&!e.isFailed()||t(e.isFailed());const i=e.seriesSource().symbolInstanceId(),r=e.dataEvents(),n=e.symbolParams(),s=()=>{r.completed().unsubscribe(null,a),(j(e,n)||e.seriesSource().symbolInstanceId()===i)&&t(!1)},a=()=>{r.error().unsubscribe(null,s),(j(e,n)||e.seriesSource().symbolInstanceId()===i)&&t(!0)};r.completed().subscribe(null,s,!0),r.error().subscribe(null,a,!0)}var q=i(397150),J=i(526075),K=i(885482),Z=i(82908),X=i(123390),Y=i(129025),Q=i(242558),ee=i(308721),te=i(974655);const ie=new s.TranslatedString("change price to bar ratio",n.t(null,void 0,i(569510))),re=new s.TranslatedString("toggle lock scale",n.t(null,void 0,i(121203)));class ne{constructor(e,t){this._visibleBarsChanged=new d.Delegate,this._crosshairMoved=new d.Delegate,this._dataSourceHovered=new d.Delegate,this._ranges=null,this._panes=new WeakMap,this._studies=new WeakMap,this._lineDataSources=new WeakMap,this._selectionApi=null,this._prevVisibleRange=null,this._prevHoveredSourceId=null,this._chartWidget=e,this._activateChart=t,this._timezoneApi=new m(e),this._chartWidget.withModel(this,(()=>{this._chartWidget.model().crossHairSource().moved().subscribe(this,this._onCrosshairMoved),
this._chartWidget.model().model().hoveredSourceChanged().subscribe(this,this._onHoveredSourceChanged),this._chartWidget.model().timeScale().logicalRangeChanged().subscribe(this,this._onLogicalRangeChanged)})),this._widgetLinkingGroupIndex=e.linkingGroupIndex().spawn(),this._widgetLinkingGroupIndex.subscribe((e=>this._apiLinkingGroupIndex.setValue(e))),this._apiLinkingGroupIndex=new Y.WatchedValue(this._widgetLinkingGroupIndex.value()),this._apiLinkingGroupIndex.subscribe((e=>{this._widgetLinkingGroupIndex.value()!==e&&(this._chartWidget.hasModel()?this._chartWidget.model().setLinkingGroupIndex(e):this._widgetLinkingGroupIndex.setValue(e))})),this._chartWidget.onAboutToBeDestroyed().subscribe(this,this._destroy,!0)}setActive(){this._activateChart()}getPriceToBarRatio(){return this._chartWidget.model().model().mainSeriesScaleRatioProperty().value()}setPriceToBarRatio(e,t){const i=this._chartWidget.model(),r=i.model(),n=r.mainSeriesScaleRatioProperty();(null==t?void 0:t.disableUndo)?new G.SetScaleRatioPropertiesCommand(n,e,null,r).redo():i.setScaleRatioProperty(n,e,ie)}isPriceToBarRatioLocked(){return this._chartWidget.model().model().mainSeries().priceScale().isLockScale()}setPriceToBarRatioLocked(e,t){const i=this._chartWidget.model(),r=i.model(),n=r.mainSeries().priceScale();(null==t?void 0:t.disableUndo)?new H.SetPriceScaleModeCommand({lockScale:e},n,null,r).redo():i.setPriceScaleMode({lockScale:e},n,re)}id(){return this._chartWidget.id()}onDataLoaded(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().completed())}onSymbolChanged(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().symbolResolved())}onIntervalChanged(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().onIntervalChanged())}onVisibleRangeChanged(){return this._makeSubscriptionFromDelegate(this._visibleBarsChanged)}onChartTypeChanged(){const e=this._chartWidget.model().mainSeries().onStyleChanged();return this._makeSubscriptionFromDelegate(e)}onSeriesTimeframe(){return this._makeSubscriptionFromDelegate(this._chartWidget.model().mainSeries().dataEvents().seriesTimeFrame())}dataReady(e){const t=!this._chartWidget.hasModel()||!this._chartWidget.model().mainSeries()||this._chartWidget.model().mainSeries().data().isEmpty();return e&&(t?this.onDataLoaded().subscribe(null,e,!0):e()),!t}whenChartReady(e){this._chartWidget.withModel(this,e)}crossHairMoved(){return this._makeSubscriptionFromDelegate(this._crosshairMoved)}onHoveredSourceChanged(){return this._makeSubscriptionFromDelegate(this._dataSourceHovered)}setVisibleRange(e,t){throw new Error("Not implemented")}setSymbol(e,t){(0,f.isFunction)(t)&&(t={dataReady:t});const{dataReady:i,doNotActivateChart:r}=t||{};e===this.symbol()||this._chartWidget.hasModel()&&this._chartWidget.model().mainSeries().symbolSameAsResolved(e)?null==i||i():(r||this._activateChart(),this._chartWidget.setSymbol(e),$(this._chartWidget.model().mainSeries(),(e=>{!e&&i&&i()})))}async setResolution(e,t){(0,
f.isFunction)(t)&&(t={dataReady:t});const{dataReady:i,doNotActivateChart:r}=t||{};let n=a.Interval.normalize(e);if(null!==n&&(n=this._chartWidget.model().mainSeries().getSupportedResolution(n)),null===n||n===this.resolution())return null==i||i(),!0;r||this._activateChart();const s=this._chartWidget.chartWidgetCollection().setResolution(n,void 0,this._chartWidget);return $(this._chartWidget.model().mainSeries(),(e=>{!e&&i&&i()})),s}async setChartType(e,t){if(this._chartWidget.model().mainSeries().properties().childs().style.value()===e)return null==t||t(),!0;const i=this._chartWidget.chartWidgetCollection().setChartStyleToWidget(e,this._chartWidget);return $(this._chartWidget.model().mainSeries(),(e=>{!e&&t&&t()})),i}resetData(){this._chartWidget.model().mainSeries().rerequestData()}getBarsMarksSources(){return this._chartWidget.model().barsMarksSources()}getAllStudies(){return this._chartWidget.model().model().allStudies(!0).map(p.studyEntityInfo)}getAllPanesHeight(){const e=this._chartWidget.model().model().panes();if(this._chartWidget.isMaximizedPane()){let t=0,i=0;e.forEach((e=>{t+=e.height(),i+=e.stretchFactor()}));const r=i/t;return e.map((e=>Math.round(e.stretchFactor()/r*100)/100))}return e.map((e=>e.height()))}setAllPanesHeight(e){const t=this._chartWidget.model().model(),i=t.panes();(0,r.assert)(i.length===e.length,"There`s a mismatch between the number of heights you provided and the number of panes.");const n=i.reduce(((e,t)=>e+t.stretchFactor()),0)/e.reduce(((e,t)=>e+t));e.forEach(((e,t)=>{const r=e*n;i[t].setStretchFactor(r)})),t.fullUpdate()}maximizeChart(){this._chartWidget.requestFullscreen()}isMaximized(){return this._chartWidget.inFullscreen()}restoreChart(){this._chartWidget.exitFullscreen()}sessions(){return this._chartWidget.model().model().sessions()}chartModel(){return this._chartWidget.model().model()}getTimeScaleLogicalRange(){return this._chartWidget.model().timeScale().logicalRange()}createStudy(e,t,i,r,n,s){if("function"==typeof n)return console.warn('"createStudy" does not take "callback" parameter anymore'),Promise.resolve(null);if(s=s||{},"string"!=typeof e)return this._createStudy(e);if(s.checkLimit&&!this._chartWidget.model().canCreateStudy())return(0,q.showTooManyStudiesNotice)(),Promise.resolve(null);e=e.toLowerCase();const a=s.disableUndo?this._chartWidget.model().model():this._chartWidget.model(),l=J.StudyMetaInfo.findStudyMetaInfoByDescription(a.studiesMetaData(),e),c=a.createStudyInserter({type:"java",studyId:l.id},[]);if(c.setForceOverlay(!!t),s.priceScale&&c.setPreferredPriceScale(function(e){switch(e){case"no-scale":return"overlay";case"as-series":return"as-series";case"new-left":return"left";case"new-right":return"right";default:throw new Error('The pricescale "'+e+'" is invalid, the only valid options are "no-scale", "as-series", "new-left" and "new-right".')}}(s.priceScale)),s.allowChangeCurrency&&c.setAllowChangeCurrency(!0),s.allowChangeUnit&&c.setAllowChangeUnit(!0),Array.isArray(r)){
console.warn("Passing study inputs as an ordered array is now deprecated. Please use an object where keys correspond to the inputs of your study instead.");const e={};for(let t=0;t<l.inputs.length;++t)e[l.inputs[t].id]=r[t];r=e}return c.insert((()=>Promise.resolve({inputs:r||{},parentSources:[]}))).then((e=>(n&&(0,o.applyOverridesToStudy)(e,n),i&&e.setUserEditEnabled(!1),e.id())))}getStudyById(e){const t=this._chartWidget.model().model().getStudyById(e);if(null===t)throw new Error("There is no such study");return this._getStudyApi(t)}getSeries(){const e=this._chartWidget.model(),t=e.mainSeries();return new O(t,e)}getShapeById(e){const t=this._chartWidget.model().model().getLineToolById(e);if(null===t)throw new Error("There is no such shape");return this._getLineDataSourceApi(t)}removeAllShapes(){this._chartWidget.removeAllDrawingTools()}removeAllStudies(){this._chartWidget.removeAllStudies()}selection(){return null===this._selectionApi&&(this._selectionApi=new V.SelectionApi(this._chartWidget.model().model())),this._selectionApi}createStudyTemplate(e){return this._chartWidget.model().model().studyTemplate(e.saveSymbol,e.saveInterval)}applyStudyTemplate(e){this._chartWidget.model().applyStudyTemplate(e,""+1e3*Math.random())}symbol(){return this._chartWidget.symbolWV().value()}symbolExt(){const e=this._chartWidget.model().mainSeries().symbolInfo();return null===e?null:{symbol:e.name,full_name:e.full_name,exchange:e.exchange,description:e.description,type:e.type,pro_name:e.pro_name,typespecs:e.typespecs,delay:e.delay}}resolution(){return this._chartWidget.model().mainSeries().interval()}marketStatus(){return this._chartWidget.model().mainSeries().marketStatusModel().status().spawn()}getVisibleRange(){const e={from:0,to:0},t=this._chartWidget.model().timeScale(),i=t.visibleBarsStrictRange();if(null===i)return e;const n=i.firstBar(),s=i.lastBar(),a=this._convertIndexToPublicTime(s);if(null===a)return e;const o=Math.max((0,r.ensureNotNull)(t.points().range().value()).firstIndex,n);return e.from=(0,r.ensureNotNull)(this._convertIndexToPublicTime(o)),e.to=a,e}getTimezoneApi(){return this._timezoneApi}getPanes(){return this._chartWidget.model().model().panes().map((e=>this._getPaneApi(e)))}exportData(e){return Promise.reject("Data export is not supported")}isSelectBarRequested(){return this._chartWidget.selectPointMode().value()!==K.SelectPointMode.None}barTimeToEndOfPeriod(e){const t=this._prepareEndOfPeriodArgs();return function(e,t,i){if(i.isDays())return t;if(e.moveTo(1e3*t),i.isIntraday()){const i=e.indexOfBar(1e3*t);if(i<0)throw new Error(`${t} is out of the instrument session `);return e.endOfBar(i)/1e3}return e.startOfBar(c.SessionStage.LASTBAR_SESSION)/1e3}(t.barBuilder,e,t.intervalObj)}endOfPeriodToBarTime(e){const t=this._prepareEndOfPeriodArgs();return function(e,t,i){if(i.isDays())return t;const r=1e3*t-1;if(e.moveTo(r),i.isIntraday()){const i=e.indexOfBar(r);if(i<0)throw new Error(`${t} is out of the instrument session `);return e.startOfBar(i)/1e3}return e.startOfBar(0)/1e3}(t.barBuilder,e,t.intervalObj)}
createAnchoredShape(e,t){const i=t.shape;if((0,Z.isSupportedLineTool)(i)&&!0!==Z.supportedLineTools[i].isAnchored)return console.warn(`${i} is not an anchored shape. It can be created using createShape or createMultipointShape`),null;const r=this._chartWidget.model().model(),n=r.mainSeries();if(r.timeScale().isEmpty())return null;const s=void 0!==t.ownerStudyId?r.dataSourceForId(t.ownerStudyId):n,a=this._convertPositionPercentToPricedPoint(e,s);return null===a?null:this.createMultipointShape([a],t)}properties(){return this._chartWidget.properties()}setBarSpacing(e){this._chartWidget.model().timeScale().setBarSpacing(e)}scrollChartByBar(e){this._chartWidget.model().scrollChartByBar(e)}mergeAllScales(e){this._chartWidget.model().mergeAllScales(e)}chartPainted(){return this._chartWidget.chartPainted()}applyOverrides(e){this._chartWidget.applyOverrides(e)}addOverlayStudy(e,t,i){return this._chartWidget.addOverlayStudy(e,t,i)}lineToolsSynchronizer(){return this._chartWidget.lineToolsSynchronizer()}cloneLineTool(e){const t=this._chartWidget.model(),i=t.model().dataSourceForId(e);t.cloneLineTools([i],!1)}shareLineTools(e,t){const i=this._chartWidget.model(),r=e.map((e=>i.model().dataSourceForId(e)));i.shareLineTools(r,t)}linkingGroupIndex(){return this._apiLinkingGroupIndex.spawn()}loadingScreenActive(){return this._chartWidget.screen.isShown()}symbolResolvingActive(){for(const e of this._chartWidget.model().model().symbolSources())if(e.symbolResolvingActive().value())return!0;return!1}hasModel(){return this._chartWidget.hasModel()}disableAllUtilitySources(){{const e=this._chartWidget.properties().childs(),t=this._chartWidget.model().mainSeries().properties().childs();[t.esdShowDividends,t.esdShowSplits,t.esdShowEarnings,t.showContinuousContractSwitches,t.showFuturesContractExpiration,e.chartEventsSourceProperties.childs().visible].forEach((e=>e.setValue(!1)))}}ranges(){return null===this._ranges&&(this._ranges=new U({chartWidget:this._chartWidget,chartWidgetCollection:this._chartWidget.chartWidgetCollection(),availableTimeFrames:z.availableTimeFrames})),this._ranges}getTimeScale(){return new h(this._chartWidget.model().timeScale())}async loadChartTemplate(e){await(0,ee.loadTheme)(this._chartWidget.chartWidgetCollection(),{themeName:e,standardTheme:!1,noUndo:!1,onlyActiveChart:!0})}setTimeFrame(e){this.setActive(),this._chartWidget.loadRange(e)}syncTime(e){if(this._chartWidget.hasModel()){const t=this._chartWidget.model().model(),i=t.mainSeries().syncModel();i&&t.syncTimeWithModel(i.syncSourceTarget(),e)}}syncDateRange(e,t){this._chartWidget.hasModel()&&this._chartWidget.model().model().gotoTimeRange(e,t)}_destroy(){this._chartWidget.hasModel()&&(this._chartWidget.model().crossHairSource().moved().unsubscribeAll(this),this._chartWidget.model().timeScale().logicalRangeChanged().unsubscribe(this,this._onLogicalRangeChanged)),this._widgetLinkingGroupIndex.destroy()}_createStudy(e){return new Promise(((t,i)=>{this._chartWidget.insertStudy(e,[]).then((e=>{null===e?i("Failed to create study"):t(e.id())}))}))}
_convertTimeToPublic(e){return this._getTimeConverter().convertInternalTimeToPublicTime(e)}_convertIndexToPublicTime(e){return null===this._chartWidget.model().mainSeries().symbolInfo()?null:this._getTimeConverter().convertTimePointIndexToPublicTime(e)}_getDefaultCreateMultipointShapeOptions(){return{filled:!0}}_convertPositionPercentToPricedPoint(e,t){const i=this._chartWidget.model().timeScale(),r=t.priceScale(),n=t.firstValue();if(null==n||!isFinite(n)||null===r)return null;const s=i.coordinateToIndex(e.x*i.width()),a=i.indexToTimePoint(s);if(null===a)return null;return{price:r.coordinateToPrice(e.y*r.height(),n),time:a}}_convertUserPointsToDataSource(e){const t=this._chartWidget.model().model(),i=t.mainSeries(),n=t.timeScale().points(),s=i.data();if(t.timeScale().isEmpty())return null;const a=e.map((e=>e.time||0)),o=this._alignPoints(a),l=(e,t,a)=>{const o=n.closestIndexLeft(e)||0,l={index:o,price:NaN},c=(0,r.ensureNotNull)(n.valueAt(o)),h=(0,r.ensureNotNull)(n.range().value());if(e>c&&o===h.lastIndex){const t=(0,r.ensureNotNull)(i.syncModel()).distance(c,e);t.success&&(l.index=l.index+t.result)}else if(e<c&&o===h.firstIndex){const t=(0,r.ensureNotNull)(i.syncModel()).distance(e,c);t.success&&(l.index=l.index-t.result)}if((0,f.isNumber)(t))l.price=t;else{const e=["open","high","low","close"];let t=a?e.indexOf(a)+1:1;t<=0&&(t=1),l.price=(0,r.ensure)((0,r.ensureNotNull)(s.valueAt(o))[t])}return l},c=[];for(let t=0;t<e.length;t++){const i=e[t];c.push(l(o[t],i.price,i.channel))}return c}_convertTimeFromPublic(e){return this._getTimeConverter().convertPublicTimeToInternalTime(e)}_getTimeConverter(){const e=this._chartWidget.model().mainSeries();return(0,X.getChartWidgetApiTimeConverter)(e.interval(),(0,r.ensureNotNull)(e.symbolInfo(),"main series symbol info"),this._chartWidget.model().model())}_onHoveredSourceChanged(e){const t=null!==e&&(0,te.isPriceDataSource)(e)?e.id():null,i=this._prevHoveredSourceId;this._prevHoveredSourceId=t,t!==i&&this._dataSourceHovered.fire(t)}_onCrosshairMoved(e){{const t=this._convertIndexToPublicTime(e.index);if(null===t)return;return void this._crosshairMoved.fire({price:e.price,time:t})}}_makeSubscriptionFromDelegate(e){return{subscribe:e.subscribe.bind(e),unsubscribe:e.unsubscribe.bind(e),unsubscribeAll:e.unsubscribeAll.bind(e)}}_prepareEndOfPeriodArgs(){const e=this._chartWidget.model().model(),t=e.timezone(),i=(0,r.ensureNotNull)(e.mainSeries().symbolInfo()),n=e.mainSeries().interval(),s=new l.SessionInfo(t,i.session,i.session_holidays,i.corrections);return{barBuilder:(0,l.newBarBuilder)(n,s,s),intervalObj:a.Interval.parse(n)}}_getPaneApi(e){let t=this._panes.get(e);return void 0===t&&(t=new y(e,this._chartWidget),this._panes.set(e,t)),t}_getStudyApi(e){let t=this._studies.get(e);return void 0===t&&(t=new R(e,this._chartWidget),this._studies.set(e,t)),t}_getLineDataSourceApi(e){let t=this._lineDataSources.get(e);return void 0===t&&(t=new x.LineDataSourceApi(e,this._chartWidget.model(),{apiPointsToDataSource:this._convertUserPointsToDataSource.bind(this),dataSourcePointsToPriced:e=>{
const t=(0,r.ensureNotNull)(this._chartWidget.model().mainSeries().syncModel()),i=this._chartWidget.model().timeScale();return e.map((e=>{const r=i.normalizeBarIndex(e.index);return{price:e.price,time:this._convertTimeToPublic(t.projectTime(r.time_t,r.offset))}}))}}),this._lineDataSources.set(e,t)),t}_alignPoints(e){const t=this._chartWidget.model().model(),i=t.mainSeries(),r=i.interval(),n=i.symbolInfo();if(t.timeScale().isEmpty()||!a.Interval.isDWM(r)||null===n)return e;const s=(0,Q.createDwmAligner)(r,n);return null===s?e:e.map((e=>s.timeToSessionStart(1e3*e)/1e3))}_onLogicalRangeChanged(){const e=this._chartWidget.model().mainSeries(),t=e.data().isEmpty();if(null!==this._chartWidget.model().timeScale().visibleBarsStrictRange()&&t)return void e.dataEvents().completed().subscribe(this,this._onLogicalRangeChanged,!0);const i=this.getVisibleRange();null!==this._prevVisibleRange&&(0,f.deepEquals)(this._prevVisibleRange,i)[0]||(this._prevVisibleRange=i,this._visibleBarsChanged.fire(i))}}},123390:(e,t,i)=>{i.d(t,{getChartWidgetApiTimeConverter:()=>s});var r=i(650151),n=i(242558);function s(e,t,i){return new o(function(e,t){const i=function(e,t){return e+t.session+t.timezone+(t.corrections||"")+(t.session_holidays||"")}(e,t);let r=a.get(i);void 0===r&&(r=(0,n.createDwmAligner)(e,t),a.set(i,r));return r}(e,t),i)}const a=new Map;class o{constructor(e,t){this._dwmAligner=e,this._chartModel=t}convertPublicTimeToInternalTime(e){return null!==this._dwmAligner?this._dwmAligner.timeToSessionStart(1e3*e)/1e3:e}convertInternalTimeToPublicTime(e){return null!==this._dwmAligner?this._dwmAligner.timeToExchangeTradingDay(1e3*e)/1e3:e}convertTimePointIndexToPublicTime(e){let t=this.convertTimePointIndexToInternalTime(e);return null!==t&&(t=this.convertInternalTimeToPublicTime(t)),t}convertTimePointIndexToInternalTime(e){const t=this._chartModel.timeScale();if(t.isEmpty())return null;const i=t.points(),{firstIndex:n,lastIndex:s}=(0,r.ensureNotNull)(i.range().value());let a=null;if(n<=e&&e<=s)a=i.valueAt(e);else if(e>s){const i=this._chartModel.mainSeries().syncModel();if(null!==i){const n=(0,r.ensureNotNull)(t.indexToTimePoint(s));a=i.projectTime(n,e-s)}}return a}}},878799:(e,t,i)=>{i.d(t,{LineToolsGroupControllerApi:()=>a});var r=i(888929),n=i(650151),s=i(617540);class a{constructor(e,t){this._controller=e,this._model=t}createGroupFromSelection(){return this._controller.createGroupFromSelection().id}removeGroup(e){const t=(0,n.ensureDefined)(this._groupById(e));this._controller.removeGroup(t)}groups(){return this._controller.groups().map((e=>e.id))}shapesInGroup(e){const t=(0,n.ensureDefined)(this._groupById(e));return(0,r.sortSources)(t.lineTools()).map((e=>e.id()))}excludeShapeFromGroup(e,t){const i=(0,n.ensureDefined)(this._groupById(e)),r=(0,n.ensureNotNull)(this._model.dataSourceForId(t));(0,n.assert)((0,s.isLineTool)(r),"Passed shapeId is not a line tool"),this._controller.excludeLineToolFromGroup(i,r)}addShapeToGroup(e,t){const i=(0,n.ensureDefined)(this._groupById(e)),r=(0,n.ensureNotNull)(this._model.dataSourceForId(t));(0,
n.assert)((0,s.isLineTool)(r),"Passed shapeId is not a line tool"),this._controller.addLineToolToGroup(i,r)}availableZOrderOperations(e){const t=(0,n.ensureDefined)(this._groupById(e));return this._controller.availableZOrderOperations(t)}bringToFront(e){const t=(0,n.ensureDefined)(this._groupById(e));this._controller.bringToFront(t)}bringForward(e){const t=(0,n.ensureDefined)(this._groupById(e));this._controller.bringForward(t)}sendBackward(e){const t=(0,n.ensureDefined)(this._groupById(e));this._controller.sendBackward(t)}sendToBack(e){const t=(0,n.ensureDefined)(this._groupById(e));this._controller.sendToBack(t)}insertAfter(e,t){const i=(0,n.ensureDefined)(this._groupById(e)),r=(0,n.ensureNotNull)(this._groupById(t)||this._model.dataSourceForId(t));this._controller.insertAfter(i,r)}insertBefore(e,t){const i=(0,n.ensureDefined)(this._groupById(e)),r=(0,n.ensureNotNull)(this._groupById(t)||this._model.dataSourceForId(t));this._controller.insertBefore(i,r)}groupVisibility(e){return(0,n.ensureDefined)(this._groupById(e)).visibility()}setGroupVisibility(e,t){const i=(0,n.ensureDefined)(this._groupById(e));this._controller.setGroupVisibility(i,t)}groupLock(e){return(0,n.ensureDefined)(this._groupById(e)).locked()}setGroupLock(e,t){const i=(0,n.ensureDefined)(this._groupById(e));this._controller.setGroupLock(i,t)}getGroupName(e){return(0,n.ensureDefined)(this._groupById(e)).name().value()}setGroupName(e,t){const i=(0,n.ensureDefined)(this._groupById(e));this._controller.setGroupName(i,t)}canBeGroupped(e){const t=e.map((e=>(0,n.ensureNotNull)(this._model.dataSourceForId(e))));return!t.some((e=>!(0,s.isLineTool)(e)))&&this._controller.canBeGroupped(t)}_groupById(e){return this._controller.groups().find((t=>t.id===e))}}},699466:(e,t,i)=>{i.d(t,{AbstractJsonStoreService:()=>n,CommonJsonStoreService:()=>s});var r=i(707957);class n{constructor(e,t,i,n,s){this._onChange=new r.Delegate,this._handleChange=()=>{this._onChange.fire(this.get())},this._crossTabEvents=e,this._jsonKeyValueStore=t,this.CROSSTAB_EVENT_NAME=i,this.JSON_STORE_KEY=n,this.defaultStoreValue=this._serialize(s),this._subscribe()}get(){const e=this._jsonKeyValueStore.getJSON(this.JSON_STORE_KEY,this.defaultStoreValue);return this._deserialize(e)}set(e,t){const i=this._serialize(e);this._jsonKeyValueStore.setJSON(this.JSON_STORE_KEY,i,t),this._crossTabEvents.emit(this.CROSSTAB_EVENT_NAME),this._onChange.fire(e)}getOnChange(){return this._onChange}destroy(){this._unsubscribe(),this._onChange.destroy(),delete this._onChange}_subscribe(){this._crossTabEvents.on(this.CROSSTAB_EVENT_NAME,this._handleChange),this._jsonKeyValueStore.onSync.subscribe(this,this._handleChange)}_unsubscribe(){this._crossTabEvents.off(this.CROSSTAB_EVENT_NAME,this._handleChange),this._jsonKeyValueStore.onSync.unsubscribe(this,this._handleChange)}}class s extends n{_serialize(e){return e}_deserialize(e){return e}}},976992:(e,t,i)=>{var r=i(159500),n=i(40752);const{getExchanges:s}=i(709404);function a(e){this._chartApiInstance=e}a.prototype.searchSymbols=function(e,t,i,r,n,s){
this._chartApiInstance.searchSymbols(e,t,i,r,n,!1,void 0,!1,null,function(e){e.forEach((function(e){e.flag=this.getFlagIdBySymbolExt(e)}),this),s(e)}.bind(this))},a.prototype.displayedExchanges=function(){var e=r.displayedExchangesFilter(this.supportedExchanges());return r.sortExchangesListByFlagIfNeeded(e)},a.prototype.supportedExchanges=function(){return s()},a.prototype.supportedSymbolsTypes=function(){return this._chartApiInstance.supportedSymbolsTypes()},a.prototype.getFlagIdBySymbolExt=function(e){return n.getFlagIdBySymbolInfo(e)},a.prototype.getFlagIdByExchangeInfo=function(e){return e?n.getFlagIdByName(e.flag):""},e.exports=a},159500:(e,t,i)=>{var r,n=i(77122),s=i(40752);r=function(e,t){var i=new RegExp("country-([a-z*_]+)","i"),r=s.supportedFlags().filter((function(e){return"forex"!==e&&"bitcoin"!==e&&"crypto"!==e})).sort(),n=["forex","country-usa","country-canada","country-ae","country-uk","country-europe","country-germany","country-ireland","country-italy","country-luxembourg","country-austria","country-norway","country-spain","country-poland","country-sweden","country-switzerland","country-turkey","country-israel","country-argentina","country-australia","country-brasil","country-mexico","country-peru","country-chile","country-colombia","country-new_zealand","country-brasil","country-india","country-japan","country-china","country-hong_kong","country-singapore","country-taiwan","country-russia","country-malaysia","country-bahrain","country-egypt","country-saudi_arabia","country-serbia","country-*","bitcoin","crypto"];t&&t.order&&(n=t.order);var a={};s.supportedFlags().forEach((function(e){a[e]=[]}));var o=[];function l(e){var t=a[e];t&&(o=o.concat(t.sort((function(e,t){return e.name.localeCompare(t.name)}))),delete a[e])}return e.forEach((function(e){e.flag&&a[e.flag].push(e),e.value||o.push(e)})),n.forEach((function(e){if("forex"===e||"bitcoin"===e||"crypto"===e)l(e);else{var t=i.exec(e),n=t&&t[1];"*"===n?r.forEach((function(e){l(e)})):l(n)}})),Object.keys(a).forEach((function(e){l(e)})),o},e.exports.displayedExchangesFilter=function(e){return n.enabled("symbol_search_limited_exchanges")&&(e=e.filter((function(e){return!("bitcoin"===e.flag||"crypto"===e.flag||e.hideInSymbolSearch)}))),e},e.exports.sortExchangesListByFlagIfNeeded=function(e){return n.enabled("symbol_search_flags")&&(e=r(e)),e}},40752:(e,t,i)=>{var r=i(519073).hasCryptoTypespec,n={ae:"flag-ae",argentina:"flag-ar",canada:"flag-ca",colombia:"flag-co",czech:"flag-cz",bitcoin:"flag-btc",brasil:"flag-br",bangladesh:"flag-bd",uk:"flag-uk",gb:"flag-uk",usa:"flag-us",egypt:"flag-eg",europe:"flag-eu",russia:"flag-ru",japan:"flag-jp",indonesia:"flag-id",india:"flag-in",forex:"flag-fx",luxembourg:"flag-lu",mexico:"flag-mx",germany:"flag-de",ireland:"flag-ie",italy:"flag-it",qatar:"flag-qa",peru:"flag-pe",spain:"flag-es",saudi_arabia:"flag-sa",serbia:"flag-rs",south_africa:"flag-za",sweden:"flag-se",switzerland:"flag-ch",turkey:"flag-tr",norway:"flag-no",austria:"flag-at",australia:"flag-au",new_zealand:"flag-nz",hong_kong:"flag-hk",taiwan:"flag-tw",
thailand:"flag-th",singapore:"flag-sg",south_korea:"flag-kr",pakistan:"flag-pk",poland:"flag-pl",israel:"flag-il",chile:"flag-cl",china:"flag-cn",malaysia:"flag-my",morocco:"flag-ma",bahrain:"flag-bh",nigeria:"flag-ng",finland:"flag-fi",iceland:"flag-is",denmark:"flag-dk",lithuania:"flag-lt",estonia:"flag-ee",latvia:"flag-lv",vietnam:"flag-vn",netherlands:"flag-nl",belgium:"flag-be",portugal:"flag-pt",france:"flag-fr",greece:"flag-gr",korea:"flag-kr",philippines:"flag-ph"},s={gb:"flag-uk"},a={FXCM:!0,OANDA:!0,FOREXCOM:!0,"FOREX.com":!0,FX_IDC:!0,FX:!0,IDC:!0};function o(e){return e?s[e]||"flag-"+e:""}e.exports.supportedFlags=function(){return Object.keys(n)},e.exports.getFlagIdByName=function(e){return e&&n[e]?n[e]:""},e.exports.getFlagIdBySymbolInfo=function(e){if(!e)return"";var t="";if(e.country)t=o(e.country&&e.country.toLowerCase());else if(e.rootItem){t=o(e.rootItem.country&&e.rootItem.country.toLowerCase())}else"forex"===e.type||!0===a[e.exchange]?t="flag-fx":r(e.typespecs||[])&&(t="flag-btc");return t}},497270:(e,t,i)=>{i.d(t,{TradingViewApiBase:()=>ie});var r=i(650151),n=i(583912),s=i(251954),a=i(77122),o=i(783375),l=i(333126),c=i(533422),h=i(314802),d=i(125226),u=i(661797),g=i(606858),m=i(103669),_=i(719885),p=i(988534),f=i(316478),S=i(388482),v=i(270294),b=i(290382),y=i(345848),w=i(308721),C=i(909740),T=i(707957);class A{constructor(e){this._toolbarThemeChanged=new T.Delegate,this._onWatchedThemeChanged=e=>{this._toolbarThemeChanged.fire(e)},this._opts=e,C.watchedTheme.subscribe(this._onWatchedThemeChanged)}destroy(){C.watchedTheme.unsubscribe(this._onWatchedThemeChanged)}isStdTheme(){const e=this._opts.chartWidgetCollection.getAll().every((e=>(0,w.isStdTheme)((0,w.extractThemeFromModel)(e.model()))));return Promise.resolve(e)}async setStdTheme(e,t=!0,i){await(0,w.loadTheme)(this._opts.chartWidgetCollection,{themeName:e,standardTheme:!0,syncState:t,noUndo:i})}setStdThemeForLayout(e,t=!0){(0,C.setTheme)(e),t&&(0,w.syncTheme)()}getCurrentThemeName(){return(0,w.getCurrentTheme)().name}toolbarThemeChanged(){return this._toolbarThemeChanged}}var I=i(82908),P=i(885482),W=i(129025),D=i(853965),L=i(617540),k=i(968361),E=i.t(k,2),M=i(192784),F=i(650151).ensureNotNull,R=i(776734).getTracker,x=i(178323).isLineToolRiskReward,O=i(82908).supportedLineTools,N=i(617540).createLineToolProperties,V=i(617540).prepareLineToolPropertiesByOwnerSource,B=i(210542).lineToolEntityInfo,U=i(878799).LineToolsGroupControllerApi,z=i(558105).RemoveSourcesUndoCommand;const{isLineDrawnWithPressedButton:H,isLineToolFinishRequiredWhenCreatedByApi:G}=i(616117),j=i(950740).EnvironmentState;var $=i(2008).ChartWidgetApiBase,q=i(885482);const J=i(345848).trackEvent;function K(e,t){return t.map((function(t){return e.dataSourceForId(t)}))}class Z extends ${executeActionById(e){this._chartWidget.executeActionById(e)}getCheckableActionState(e){return this._chartWidget.getCheckableActionState(e)}setZoomEnabled(e){this._chartWidget.model().model().setZoomEnabled(e)}setScrollEnabled(e){this._chartWidget.model().model().setScrollEnabled(e)}
refreshMarks(){this._chartWidget.refreshMarks()}clearMarks(e){this._chartWidget.clearMarks(e)}setEntityVisibility(e,t){console.warn("`setEntityVisibility` is deprecated. Use shape/study API instead");var i=this._chartWidget.model().model().dataSourceForId(e);if(i){var r=i.properties();r&&r.visible&&r.visible.setValue(t)}}availableZOrderOperations(e){var t=K(this._chartWidget.model().model(),e);return this._chartWidget.model().availableZOrderOperations(t)}sendToBack(e){var t=K(this._chartWidget.model().model(),e);this._chartWidget.model().sendToBack(t)}bringToFront(e){var t=K(this._chartWidget.model().model(),e);this._chartWidget.model().bringToFront(t)}insertAfter(e,t){var i=this._chartWidget.model().model(),r=K(i,e),n=i.dataSourceForId(t);this._chartWidget.model().insertAfter(r,n)}insertBefore(e,t){var i=this._chartWidget.model().model(),r=K(i,e),n=i.dataSourceForId(t);this._chartWidget.model().insertBefore(r,n)}bringForward(e){var t=K(this._chartWidget.model().model(),e);this._chartWidget.model().bringForward(t)}sendBackward(e){var t=K(this._chartWidget.model().model(),e);this._chartWidget.model().sendBackward(t)}showPropertiesDialog(e){var t=this._chartWidget.model().model().dataSourceForId(e);if(null===t)throw new Error("Study or shape "+e+" does not exist");this._chartWidget.showChartPropertiesForSource(t)}getAllShapes(){return this._chartWidget.model().model().allLineTools().map(B).filter((function(e){return null!==e.name}))}removeEntity(e,t){var i=this._chartWidget.model().chartModel().dataSourceForId(e);i?t&&t.disableUndo?new z(this._chartWidget.model().chartModel(),[i],"").redo():this._chartWidget.model().removeSource(i,!0,!0):console.warn("Can't find a source with id: "+e)}removeEntityWithUndo(e){var t=this._chartWidget.model().chartModel().dataSourceForId(e);this._chartWidget.model().removeSource(t,!1)}drawOnAllCharts(e){q.drawOnAllCharts.setValue(e)}getVisiblePriceRange(){return console.warn("`getVisiblePriceRange` is deprecated. Use Price Scale API instead"),this._chartWidget.model().mainSeries()?this._chartWidget.model().mainSeries().priceScale().priceRangeInPrice():null}scrollPosition(){return console.warn("`scrollPosition` is deprecated. Use rightOffset from Time Scale API instead"),this._chartWidget.model().timeScale().rightOffset()}defaultScrollPosition(){return console.warn("`defaultScrollPosition` is deprecated. Use defaultRightOffset from Time Scale API instead"),this._chartWidget.model().timeScale().defaultRightOffset().value()}_createTradingPrimitive(e,t){var i,r=this._chartWidget.model(),n=r.model(),s=n.paneForSource(n.mainSeries());function a(){var e=TradingView.CLOSE_PLOT,t=F(r.mainSeries().bars().last());return{index:t.index,price:t.value[e]}}return(i=t?n.createLineTool(s,a(),e):r.createLineTool({pane:s,point:a(),linetool:e}))?i._adapter:void 0}createOrderLine(e){e=e||{};return this._createTradingPrimitive("LineToolOrder",e.disableUndo)}createPositionLine(e){e=e||{};return this._createTradingPrimitive("LineToolPosition",e.disableUndo)}createExecutionShape(e){e=e||{}
;return this._createTradingPrimitive("LineToolExecution",e.disableUndo)}createShape(e,t){return this.createMultipointShape([e],t)}createMultipointShape(e,t){const i=Object.assign({},this._getDefaultCreateMultipointShapeOptions(),t);var r=O[i.shape]||O.flag;J("API","CreateDrawing",r.name),R().then((e=>{null!==e&&e.trackChartApiDrawingCreation(r.name)}));var n=this._chartWidget.model().model(),s=n.mainSeries();if(!n.timeScale().isEmpty()){var a=n.dataSourceForId(i.ownerStudyId)||s,o=n.paneForSource(a),l=this._convertUserPointsToDataSource(e);if(r.onlySelectable)throw new Error('Cannot create "'+i.shape+'" shape');if("LineToolIcon"===r.name){if(i.icon=i.icon||i.overrides&&i.overrides.icon,!i.hasOwnProperty("icon"))throw new Error("icon must be specified in options");i.overrides=i.overrides||{},i.overrides.icon=i.icon}var c,h,d=N(r.name,void 0,this._chartWidget.model().model());if(V(d,a),i.overrides)for(var u in i.overrides)d[u]?d[u].mergeAndFire(i.overrides[u]):x(r.name)&&-1!==["profitLevel","stopLevel"].indexOf(u)&&d.addProperty(u,i.overrides[u]);if(void 0!==d.text&&i.text&&d.text.setValue(i.text),d.hasChild("filled")&&i.filled&&d.filled.setValue(!0),null!==(h=i.disableUndo?(c=this._chartWidget.model().model()).createLineTool(o,l[0],r.name,d,void 0,a):(c=this._chartWidget.model()).createLineTool({pane:o,point:l[0],linetool:r.name,properties:d,ownerSource:a}))){if(x(r.name)){if(l.length>2)throw new Error("Wrong points count for "+i.shape+". Required 1 or 2");2===l.length&&(h.startChanging(1,l[1]),h.setPoint(1,l[1]),h.endChanging())}else{var g=h.pointsCount();if(g!==l.length&&-1!==g)throw new Error("Wrong points count for "+i.shape+". Required "+g);for(var m=new j(void 0,!0),_=H(r.name),p=1;p<l.length&&this._chartWidget.model().lineBeingCreated();p++)h.setLastPoint(l[p]),c.continueCreatingLine(l[p],m,p<l.length-1||_);G(r.name)&&(h.finish(),c.finishLineTool(h),c.continueCreatingLine(l[l.length-1],m,!1))}if(i.lock&&h.setUserEditEnabled(!1),i.disableSelection&&h.setSelectionEnabled(!1),i.disableSave&&(h.customization.disableSave=!0),i.hasOwnProperty("showInObjectsTree")&&(h.customization.showInObjectsTree=i.showInObjectsTree),i.zOrder){var f=this._chartWidget.model().availableZOrderOperations([h]);"top"===i.zOrder&&f.bringToFrontEnabled?c.bringToFront([h]):"bottom"===i.zOrder&&f.sendToBackEnabled&&c.sendToBack([h])}return h.id()}}}chartType(){return this._chartWidget.model().mainSeries().properties().style.value()}priceFormatter(){return this._chartWidget.model().mainSeries().priceScale().formatter()}setTimezone(e){this._chartWidget.setTimezone(e)}getTimezone(){return this._chartWidget.getTimezone()}canZoomOut(){return!this._chartWidget.model().zoomStack().isEmpty()}zoomOut(){this.canZoomOut()&&this._chartWidget.model().zoomFromViewport()}shapesGroupController(){return new U(this._chartWidget.model().lineToolsGroupController(),this._chartWidget.model())}requestSelectBar(){if(this.isSelectBarRequested())return Promise.reject("already requested");var e=this;return new Promise((function(t,i){e._chartWidget.requestSelectPoint({
pointType:"time"}).then((function(i){t(e._convertTimeToPublic(i.point.time))})).catch((function(){i("cancelled")}))}))}cancelSelectBar(){this.isSelectBarRequested()&&this._chartWidget.cancelRequestSelectPoint()}}var X=i(223699),Y=i(708706),Q=i(837032);function ee(){throw new Error("not implemented")}const te=(0,h.isOnMobileAppPage)("any")&&(!a.enabled("mobile_apps_distinguish_pro_full_name")||(0,d.isFeatureEnabled)("ignore_mobile_apps_distinguish_pro_full_name"));class ie{constructor(e){this.linking=n.linking,this._studyTemplatesDrawer=null,this._fontIconsSettingsDrawer=null,this._favoriteDrawingsToolbar=null,this._webview=null,this._themesApi=null,this._newsApiDeferredPromise=null,this._newsApiRejectionReason=null,this._watchlistApiDeferredPromise=null,this._watchlistApiRejectionReason=null,this._widgetbarApiDeferredPromise=null,this._widgetbarApiRejectionReason=null,this._isDestroyed=!1,this._widgebarApi=null,this._chartWidgets=new WeakMap,this._layoutSettingsDrawer=null,this._magnetEnabledWatchedValue=null,this._magnetModeWatchedValue=null,this._activateChart=e=>{this.setActiveChart(this._chartIndex(e))};const{chartApiInstance:t,chartWidgetCollection:i,studyMarket:r,saveChartService:a,loadChartService:o,sharingChartService:l=null,webview:c=null}=e;this._chartWidgetCollection=i,this._studyMarket=r,this._saveChartService=a,this._sharingChartService=l,this._loadChartLayoutDialog=o,this._intervalsService=new u.IntervalsService(t),this._alertsWidgetDialog=new g.AlertsWidgetDialog((()=>i.activeChartWidget.value())),this._detailsDialogController=m.DetailsDialogController.getInstance(),this._supportedChartStylesSpawn=n.linking.supportedChartStyles.spawn(),this._chartWidgetCollection.onAboutToBeDestroyed.subscribe(null,(()=>this.destroy()),!0),this._webview=c;const h=new Y.ChartChangesWatcher(this._chartWidgetCollection,window.saver,s);this._chartChangesWatcher=h,this._chartHasChanged=(0,Q.createWVFromGetterAndSubscription)((()=>h.hasChanges()),h.getOnChange());const d=i.lock;if(this._symbolSync=d.symbol.spawn(),this._intervalSync=d.interval.spawn(),this._dateRangeSync=d.dateRange.spawn(),this._crosshairSync=d.crosshair.spawn(),this._timeSync=d.trackTime.spawn(),te){const e=this.linking.symbol,t=this.linking.proSymbol,i=Object.create(t);i.setValue=(t,i)=>e.setValue(t,i),this.linking=Object.create(this.linking,{symbol:{configurable:!1,get:()=>i}})}}destroy(){var e,t,i;this._chartHasChanged.destroy(),this._chartChangesWatcher.destroy(),this._supportedChartStylesSpawn.destroy(),null===(e=this._intervalsService)||void 0===e||e.destroy(),null===(t=this._themesApi)||void 0===t||t.destroy(),null===(i=this._widgebarApi)||void 0===i||i.destroy(),this._widgetbarApiRejectionReason="This ITradingViewApi instance has been destroyed",this._symbolSync.destroy(),this._intervalSync.destroy(),this._dateRangeSync.destroy(),this._crosshairSync.destroy(),this._timeSync.destroy(),this._isDestroyed=!0,(0,P.properties)().childs().magnet.unsubscribeAll(this),(0,P.properties)().childs().magnetMode.unsubscribeAll(this)}themes(){
return null===this._themesApi&&(this._themesApi=new A({chartWidgetCollection:this._chartWidgetCollection})),this._themesApi}dialogs(){var e,t,i,r,n,s;return{Indicators:this._studyMarket,Compare:this._chartWidgetCollection.getCompareDialogRenderer(),ObjectsTree:l.ObjectTreeDialogController.getInstance(),ChartProperties:this._chartWidgetCollection.getChartPropertiesDialogRenderer(),ChartLayoutSaveAs:null!==(t=null===(e=this._saveChartService)||void 0===e?void 0:e.getSaveAsController())&&void 0!==t?t:null,ChartLayoutRename:null!==(r=null===(i=this._saveChartService)||void 0===i?void 0:i.getRenameController())&&void 0!==r?r:null,ChartLayoutCreate:null!==(s=null===(n=this._saveChartService)||void 0===n?void 0:n.getCreateController())&&void 0!==s?s:null,ChartLayoutLoad:this._loadChartLayoutDialog,Alerts:this._alertsWidgetDialog,Details:this._detailsDialogController,FinancialsCharts:p.FinancialsDialogController.getInstance(),Technicals:_.TechnicalsDialogController.getInstance(),Forecast:f.ForecastDialogController.getInstance()}}subscribe(e,t){s.subscribe(e,t,void 0)}unsubscribe(e,t){s.unsubscribe(e,t,void 0)}webview(){return this._webview||ee(),this._webview}studyTemplatesDrawerApi(){return Promise.all([i.e(22666),i.e(5993),i.e(4015),i.e(66639),i.e(35649),i.e(30006),i.e(91033),i.e(46036),i.e(98149),i.e(36752),i.e(96025),i.e(45166),i.e(59185),i.e(53979),i.e(10524),i.e(32157),i.e(962),i.e(17170)]).then(i.bind(i,742366)).then((e=>(this._studyTemplatesDrawer||(this._studyTemplatesDrawer=new e.ToolWidgetTemplatesDrawerMenuRenderer(this._chartWidgetCollection)),this._studyTemplatesDrawer)))}fontIconsSettingsDrawer(){return Promise.all([i.e(22666),i.e(35649),i.e(18182),i.e(24534),i.e(25820),i.e(47122),i.e(962),i.e(30979),i.e(88586),i.e(8775),i.e(25826),i.e(64558)]).then(i.bind(i,553169)).then((e=>(this._fontIconsSettingsDrawer||(this._fontIconsSettingsDrawer=new e.IconsSettingsDrawerApi),this._fontIconsSettingsDrawer)))}intervalsService(){return this._intervalsService}supportedChartTypes(){return this._supportedChartStylesSpawn}setBrokerName(e){this._chartWidgetCollection.setBroker(e)}getDrawOnAllCharts(){return(0,P.drawOnAllCharts)().value()}drawOnAllCharts(e){return(0,P.drawOnAllCharts)().setValue(e)}getDrawOnAllChartsMode(){return(0,P.drawOnAllChartsMode)().value()}drawOnAllChartsMode(e){(0,P.drawOnAllChartsMode)().setValue(e)}disableTrackingEvents(){(0,y.disableTrackingEvents)()}getSaveChartService(){return this._saveChartService}symbolSync(){return this._symbolSync}intervalSync(){return this._intervalSync}dateRangeSync(){return this._dateRangeSync}crosshairSync(){return this._crosshairSync}timeSync(){return this._timeSync}setSymbolSearchUI(e){b.SymbolSearchUI.setProvider({getSymbol:()=>e.getSymbol()})}chart(e=0){if(e<0||e>=this.chartsCount())throw Error("Incorrect index: "+e);return this._getChartWidgetApi(this._chartWidgetCollection.getAll()[e])}activeChart(){return this._getChartWidgetApi(this._activeChartWidget())}setActiveChart(e){if(e>=0&&e<this.chartsCount()){const t=this._chartWidgetCollection.getAll()[e]
;t&&(this._activeChartWidget().inFullscreen()?t.requestFullscreen():this._chartWidgetCollection.activeChartWidget.setValue(t))}}activeChartIndex(){return this._chartIndex(this._activeChartWidget())}chartsCount(){return c.layouts[this.layout()].count}layout(){return this._chartWidgetCollection.layout.value()}layoutName(){return this._chartWidgetCollection.metaInfo.name.value()}layoutNameWatchedValue(){return this._chartWidgetCollection.metaInfo.name.readonly()}async layoutSettingsDrawer(){{const e=await Promise.all([i.e(35649),i.e(46036),i.e(49205),i.e(12494),i.e(92175),i.e(68439),i.e(71550),i.e(962),i.e(45289)]).then(i.bind(i,890288));return this._layoutSettingsDrawer||(this._layoutSettingsDrawer=new e.LayoutSettingsDrawerApi(this._chartWidgetCollection)),this._layoutSettingsDrawer}}setLayout(e,t){(null==t?void 0:t.withUndo)?this._chartWidgetCollection.setChartLayoutWithUndo(e):this._chartWidgetCollection.setLayout(e)}undoRedoState(){return this._chartWidgetCollection.undoHistory.state()}clearUndoHistory(){return this._chartWidgetCollection.undoHistory.clearStack()}undo(){this._chartWidgetCollection.undoHistory.undo()}redo(){this._chartWidgetCollection.undoHistory.redo()}async selectLineTool(e,t){if(!(0,I.isSupportedLineTool)(e))return;const i=I.supportedLineTools[e].name;if("icon"===e){const e=null==t?void 0:t.icon;void 0!==e&&P.iconTool.setValue(e)}if(await(0,L.initLineTool)(i),"emoji"===e){const e=null==t?void 0:t.emoji;void 0!==e&&P.emojiTool.setValue(e)}if("sticker"===e){const e=null==t?void 0:t.sticker;void 0!==e&&P.stickerTool.setValue(e)}P.tool.setValue(i)}favoriteDrawingsToolbar(){return Promise.all([i.e(93370),i.e(65551)]).then(i.bind(i,217527)).then((e=>(this._favoriteDrawingsToolbar||(this._favoriteDrawingsToolbar=new e.FavoriteDrawingsApi),this._favoriteDrawingsToolbar)))}sharingChart(){return this._sharingChartService}watchlist(){ee()}setWatchlistApiPromise(e){ee()}news(){ee()}setNewsApiPromise(e){ee()}widgetbar(){ee()}setWidgetbarApiPromise(e){ee()}getChartStorage(){return(0,S.getChartStorage)()}setDebugMode(e){a.setEnabled("charting_library_debug_mode",e)}setFeatureEnabled(e,t){"chart_crosshair_menu"!==e?a.setEnabled(e,t):addPlusButtonProperty.setValue(t)}magnetEnabled(){return null===this._magnetEnabledWatchedValue&&(this._magnetEnabledWatchedValue=new W.WatchedValue((0,P.properties)().childs().magnet.value()),this._magnetEnabledWatchedValue.subscribe((e=>{(0,D.saveDefaultProperties)(!0),(0,P.properties)().childs().magnet.setValue(e),(0,D.saveDefaultProperties)(!1)})),(0,P.properties)().childs().magnet.subscribe(this,(()=>{(0,r.ensureNotNull)(this._magnetEnabledWatchedValue).setValue((0,P.properties)().childs().magnet.value())}))),this._magnetEnabledWatchedValue}magnetMode(){return null===this._magnetModeWatchedValue&&(this._magnetModeWatchedValue=new W.WatchedValue((0,P.properties)().childs().magnetMode.value()),this._magnetModeWatchedValue.subscribe((e=>{(0,D.saveDefaultProperties)(!0),(0,P.properties)().childs().magnetMode.setValue(e),(0,D.saveDefaultProperties)(!1)})),(0,
P.properties)().childs().magnetMode.subscribe(this,(()=>{(0,r.ensureNotNull)(this._magnetModeWatchedValue).setValue((0,P.properties)().childs().magnetMode.value())}))),this._magnetModeWatchedValue}flushBufferedData(){M.flushDelegate.fire()}chartWidgetCollectionState(...e){return this._chartWidgetCollection.state(...e)}chartWidgetCollectionSeriesStatuses(){return this._chartWidgetCollection.chartSeriesStatuses()}initAllLineTools(){return Promise.all(Object.keys(E).filter((e=>!E[e])).map((e=>(0,L.initLineTool)(e)))).then((()=>{}))}watermark(){ee()}setContextMenuOptions(e){ie.setContextMenuOptions(e)}changeSymbol(e,t,i){n.linking.interval.setValue((0,r.ensureNotNull)(X.Interval.normalize(t))),n.linking.setSymbolAndLogInitiator(e,"API"),i&&this.activeChart().onDataLoaded().subscribe(null,i,!0)}getSymbolInterval(e){const t={symbol:this.linking.proSymbol.value(),interval:this.linking.interval.value()};return null==e||e(t),t}hasChartChanges(){return this._chartHasChanged}setForceFullscreenMode(){this._chartWidgetCollection.setViewMode(v.CollectionViewMode.ForceFullscreen),this._activeChartWidget().requestFullscreen()}setMultichartMode(){this._chartWidgetCollection.setViewMode(v.CollectionViewMode.Multichart),this._activeChartWidget().exitFullscreen()}setDateRangeLinkingEnabled(e){this._chartWidgetCollection.lock.dateRange.setValue(e)}static setContextMenuOptions(e){void 0!==e.items_processor&&o.ContextMenuManager.setCustomItemsProcessor(e.items_processor),void 0!==e.renderer_factory&&o.ContextMenuManager.setCustomRendererFactory(e.renderer_factory)}_getChartWidgetApi(e){let t=this._chartWidgets.get(e);return void 0===t&&(t=new Z(e,this._activateChart.bind(null,e)),this._chartWidgets.set(e,t)),t}_chartIndex(e){return this._chartWidgetCollection.getAll().indexOf(e)}_activeChartWidget(){return this._chartWidgetCollection.activeChartWidget.value()}}},847499:(e,t,i)=>{i(583912).linking,i(268222).createDeferredPromise;var r=i(251954),n=i(783375).ContextMenuManager,s=i(885482),a=i(731042),o=i(578988).backend,l=i(201089),c=i(779923).showWarning,h=i(779923).showConfirm,d=i(82908),u=i(332450).CLOSE_POPUPS_AND_DIALOGS_COMMAND,g=i(497270).TradingViewApiBase,m=(i(526075).StudyMetaInfo,i(591316).getStudyInputsInfo,i(443403).getStudyStylesInfo,i(707957).Delegate),_=i(129025).WatchedValue,p=i(976992),f=i(262078).pushStreamMultiplexer,S=i(944454).ConnectionStatus,v=i(439016),b=v.tradingService,y=v.waitTradingService,w=i(25517).publishChart,C=i(25517).setPublishChartOptions,T=i(860037).showSupportDialog,A=i(856531),I=A.openMobileChartPickerCommand,P=A.closeMobileChartPickerCommand,W=i(525516).AlertService,D=i(66066).ReplayApi,L=i(960337),k=L.createGoProDialog,E=L.onGoProDialog,M=i(125226).isFeatureEnabled;e.exports=class extends g{constructor(e){const{chartWidgetCollection:t,saveChartService:i,loadChartService:r,sharingChartService:n,alertsDispatcher:s,supportTicketData:a,favoriteServices:o,chartApiInstance:l=null,studyMarket:c=null,webview:h,alertsFacadeChannelPushApi:d}=e;super({chartApiInstance:l,chartWidgetCollection:t,studyMarket:c,
saveChartService:i,loadChartService:r,sharingChartService:n,webview:h}),this._chartApiInstance=l,this._loadChartService=r,this._alertsDispatcher=s,this._supportTicketData=a,this._favoriteServices=o,this._alertsFacadeChannelPushApi=d,this._proxyWatchListChangedDelegate=null,this._lockDrawingsWatchedValue=null,this._hideDrawingsWatchedValue=null,this._hideIndicatorsWatchedValue=null,this._replayApi=null,this._getDataSourceHub=function(){return t.activeChartWidget.value().model().model()},this._alertService=this._alertsDispatcher&&this._alertsFacadeChannelPushApi?new W(this._alertsDispatcher,this._getDataSourceHub,this._alertsFacadeChannelPushApi):null,this._activeChangedChangedDelegate=new m,this._chartWidgetCollection.activeChartWidget.subscribe(function(){this._activeChangedChangedDelegate.fire()}.bind(this))}onContextMenu(e){r.subscribe("onContextMenu",(function(t){t.callback(e(t.unixtime,t.price))}))}onGrayedObjectClicked(e){r.subscribe("onGrayedObjectClicked",e)}onActiveChartChanged(){return this._activeChangedChangedDelegate}viewMode(){return this._chartWidgetCollection.viewMode.readonly().value()}viewModeWatchedValue(){return this._chartWidgetCollection.viewMode.readonly()}saveChart(e){if(this._saveChartService){var t=this._saveChartService.saveToJSON();return e&&e(JSON.parse(t.content))}}loadChart(e){throw new Error("Not implemented")}getStudiesList(){throw new Error("Not implemented")}getStudyInputs(e){throw new Error("Not implemented")}getStudyStyles(e){throw new Error("Not implemented")}getSavedCharts(e){o.getCharts().then(e)}loadChartFromServer(e){o.loadChart(e)}saveChartToServer(e,t,i){this._saveChartService&&this._saveChartService.saveChartSilently(e,t,i)}setAutosave(e){this._saveChartService&&this._saveChartService.autoSaveEnabled().setValue(e)}removeChartFromServer(e,t){o.removeChart(e).then(t)}getIntervals(){var e=[],t=a.getCustomResolutions();return null!==this._chartApiInstance&&(e=this._chartApiInstance.defaultResolutions()),a.mergeResolutions(e,t)}closePopupsAndDialogs(){n.hideAll(),r.emit(u)}selectedLineTool(){for(var e=Object.keys(d.supportedLineTools),t=s.tool.value(),i=0;i<e.length;++i)if(d.supportedLineTools[e[i]].name===t)return e[i];return""}lockAllDrawingTools(){return null===this._lockDrawingsWatchedValue&&(this._lockDrawingsWatchedValue=new _(s.lockDrawings().value()),this._lockDrawingsWatchedValue.subscribe((function(e){s.lockDrawings().setValue(e)})),s.lockDrawings().subscribe(this,(function(){this._lockDrawingsWatchedValue.setValue(s.lockDrawings().value())}))),this._lockDrawingsWatchedValue}hideAllDrawingTools(){return null===this._hideDrawingsWatchedValue&&(this._hideDrawingsWatchedValue=new _(s.hideAllDrawings().value()),this._hideDrawingsWatchedValue.subscribe((function(e){s.hideAllDrawings().setValue(e)})),s.hideAllDrawings().subscribe(this,(function(){this._hideDrawingsWatchedValue.setValue(s.hideAllDrawings().value())}))),this._hideDrawingsWatchedValue}hideAllIndicators(){
return null===this._hideIndicatorsWatchedValue&&(this._hideIndicatorsWatchedValue=new _(s.hideAllIndicators().value()),this._hideIndicatorsWatchedValue.subscribe((function(e){s.hideAllIndicators().setValue(e)})),s.hideAllIndicators().subscribe(this,(function(){this._hideIndicatorsWatchedValue.setValue(s.hideAllIndicators().value())}))),this._hideIndicatorsWatchedValue}mainSeriesPriceFormatter(){return this._chartWidgetCollection.activeChartWidget.value().model().mainSeries().priceScale().formatter()}showNoticeDialog(e){c({title:(e=e||{}).title,text:e.body||"",onClose:e.callback})}showConfirmDialog(e){if(!(e=e||{}).callback)throw Error("callback must be exist");var t=e.callback;function i(e){t&&(t(e),t=null)}h({title:e.title,text:e.body||"",onClose:function(){i(!1)},onConfirm:function(e){i(!0),e.dialogClose()}})}logs(){return{getLogHistory:l.getLogHistory,enable:l.loggingOn,disable:l.loggingOff}}showLoadChartDialog(){var e=this._loadChartService;e&&e.showLoadDialog()}showSaveAsChartDialog(){var e=this._saveChartService;e&&window.runOrSignIn((function(){e.saveChartAs()}),{source:"Save as chart dialogue"})}trading(){return b()}waitTrading(){return y()}symbolSearch(){return this._chartApiInstance?new p(this._chartApiInstance):null}saveChartOrShowTitleDialog(e,t,i){var r=this._saveChartService;r&&r.saveChartOrShowTitleDialog(e,t,i)}showRenameChartDialog(){var e=this._saveChartService;e&&e.renameChart()}setUserInfo(e){e&&(!1===e.profile_data_filled&&delete e.profile_data_filled,window.loginUser(e))}connect(){this._chartApiInstance.connected()||this._chartApiInstance.connect(),f.forceConnect()}disconnect(){this._chartApiInstance.connected()&&this._chartApiInstance.disconnect(),f.isConnected()&&f.disconnect()}loginRequired(){return window.loginRequiredDelegate}onConnectionStatusChanged(e){f.onStatus(e)}isConnected(){return f.status()===S.Open}showCreateAlertDialog(){this._alertsDispatcher&&this._alertsDispatcher.openCreateDialog({dataSourceHub:this._getDataSourceHub(),actionSource:"tv_api"})}alertService(){return this._alertService}publishChart(e){return w(e,!1)}setPublishChartOptions(e){C(e)}showSupportDialog(){T()}openMobileChartPicker(){r.emit(I)}closeMobileChartPicker(){r.emit(P)}replayApi(){if(null===this._chartApiInstance)return Promise.reject(new Error("replay api isn't available"));if(null!==this._replayApi)return Promise.resolve(this._replayApi);{const e=e=>(null===this._replayApi&&(this._replayApi=new D(new e.ReplayUIController(this._chartWidgetCollection,this._chartApiInstance))),this._replayApi)
;return M("multichart_replay")?Promise.all([i.e(42211),i.e(22666),i.e(5993),i.e(62253),i.e(92191),i.e(34465),i.e(9817),i.e(69121),i.e(53842),i.e(4015),i.e(92108),i.e(66639),i.e(88194),i.e(87845),i.e(93502),i.e(35649),i.e(36884),i.e(30006),i.e(542),i.e(58056),i.e(26855),i.e(67080),i.e(60123),i.e(47047),i.e(88096),i.e(80254),i.e(12339),i.e(73419),i.e(962),i.e(22816),i.e(73534),i.e(48305),i.e(57511),i.e(64796),i.e(6932)]).then(i.bind(i,498836)).then(e):Promise.all([i.e(42211),i.e(22666),i.e(5993),i.e(92191),i.e(34465),i.e(69121),i.e(53842),i.e(4015),i.e(88194),i.e(87845),i.e(35649),i.e(30006),i.e(542),i.e(58056),i.e(67080),i.e(60123),i.e(47047),i.e(88096),i.e(12339),i.e(58141),i.e(962),i.e(22816),i.e(58431),i.e(73534),i.e(48305),i.e(57511),i.e(64796),i.e(25815)]).then(i.bind(i,119061)).then(e)}}takeScreenshot(){return this._chartWidgetCollection.takeScreenshot()}setIntervalLinkingEnabled(e){this._chartWidgetCollection.lock.interval.setValue(e)}setTimeFrame(e){this._chartWidgetCollection.setTimeFrame(e)}startFullscreen(){return this._chartWidgetCollection.startFullscreen()}exitFullscreen(){return this._chartWidgetCollection.exitFullscreen()}takeClientScreenshot(e){return this._chartWidgetCollection.clientSnapshot(e)}getFavoriteIntervalsService(){if(this._favoriteServices)return this._favoriteServices.favoriteIntervalsService;throw new Error("not implemented")}getFavoriteChartStylesService(){if(this._favoriteServices)return this._favoriteServices.favoriteChartStylesService;throw new Error("not implemented")}getLinetoolsFavoritesStore(){if(this._favoriteServices)return this._favoriteServices.lineToolsFavoritesService;throw new Error("not implemented")}supportTicketData(){return this._supportTicketData}createGoProDialog(e){k(e)}onGoProDialog(e,t){E(e,t)}}},513249:(e,t,i)=>{i.d(t,{getAlertsActions:()=>a,getFiresActions:()=>o});var r=i(895171),n=i(125226),s=i(949307);const a=(0,r.default)((async()=>{const[{getAlertsCollection:e},{getAlertErrorPresenter:t},{getAlertSession:r},{getAlertsTrackers:a},o,{AlertsActions:l}]=await Promise.all([Promise.all([i.e(8287),i.e(1335),i.e(14141)]).then(i.bind(i,401335)),Promise.all([i.e(32327),i.e(8287),i.e(84884)]).then(i.bind(i,676361)),Promise.all([i.e(8287),i.e(55848)]).then(i.bind(i,908287)),i.e(95063).then(i.bind(i,206242)),(0,s.getPriceAlertsDispatcher)(),Promise.all([i.e(40113),i.e(8287),i.e(1335),i.e(88104),i.e(31383),i.e(46958)]).then(i.bind(i,946062))]);return new l({alertsCollection:e(),alertsErrorsPresenter:t(),alertsSession:r(),alertsTrackers:a(),alertsDispatcher:o},(0,n.isFeatureEnabled)("alerts-widgets-use-facade"))})),o=(0,r.default)((async()=>{const[{getAlertsRestApi:e},{getAlertErrorPresenter:t},{getAlertSession:r},{getAlertsTrackers:a},o,{FiresActions:l}]=await Promise.all([Promise.all([i.e(8287),i.e(52626)]).then(i.bind(i,171983)),Promise.all([i.e(32327),i.e(8287),i.e(84884)]).then(i.bind(i,676361)),Promise.all([i.e(8287),i.e(55848)]).then(i.bind(i,908287)),i.e(95063).then(i.bind(i,206242)),(0,
s.getPriceAlertsDispatcher)(),Promise.all([i.e(40113),i.e(88104),i.e(31383),i.e(79024)]).then(i.bind(i,141031))]);return new l({alertsRestApi:e(),alertsErrorsPresenter:t(),alertsSession:r(),alertsTrackers:a(),alertsDispatcher:o},(0,n.isFeatureEnabled)("alerts-widgets-use-facade"))}))},525516:(e,t,i)=>{i.d(t,{AlertService:()=>a});var r=i(707957),n=i(537133);const s="alert_service";class a{constructor(e,t,i){this.ALERT_DIALOG_CREATE_INVOCATION_ID=n.ALERT_DIALOG_CREATE_INVOCATION_ID,this._facadeChannelMessageDelegate=new r.Delegate,this._onAlertsCreated=e=>{this._onAlertsFacadeChannelMessage({m:"alerts_created",p:e})},this._onAlertsUpdated=e=>{this._onAlertsFacadeChannelMessage({m:"alerts_updated",p:e})},this._onAlertsDeleted=e=>{this._onAlertsFacadeChannelMessage({m:"alerts_deleted",p:e})},this._onAlertFired=e=>{this._onAlertsFacadeChannelMessage({m:"alert_fired",p:e})},this._alertsDispatcher=e,this._getDataSourceHub=t,this._alertsFacadeChannelPushApi=i}showCreateAlertDialog(){return new Promise(((e,t)=>{this._alertsDispatcher.openCreateDialog({actionSource:s,dataSourceHub:this._getDataSourceHub(),onDialogOpened:e,onAborted:t})}))}getAlertDialogInvocations(){return this._alertsDispatcher.getAlertDialogInvocations()}showEditAlertDialog(e){return new Promise(((t,i)=>{this._alertsDispatcher.openEditDialog(e,{actionSource:s,onDialogOpened:t,onAborted:i})}))}restartAlert(e){return new Promise(((t,i)=>{this._alertsDispatcher.restartAlert(e,{actionSource:s,success:t,error:i})}))}cloneAlert(e){return new Promise(((t,i)=>{this._alertsDispatcher.requestAlert(e,{error:i,success:e=>{this._alertsDispatcher.cloneAlert(e,{actionSource:s,success:t,error:i})}})}))}subscribe(e,t="alert"){"alert"===t?this._alertsDispatcher.subscribeToPushStream(e):(this._facadeChannelMessageDelegate.subscribe(null,e),this._subscribeToFacadeChannelPushApi())}unsubscribe(e,t="alert"){"alert"===t?this._alertsDispatcher.unsubscribeFromPushStream(e):(e?this._facadeChannelMessageDelegate.unsubscribe(null,e):this._facadeChannelMessageDelegate.unsubscribeAll(null),this._unsubscribeFromFacadeChannelPushApi())}_subscribeToFacadeChannelPushApi(){this._alertsFacadeChannelPushApi.on("alerts_created",this._onAlertsCreated),this._alertsFacadeChannelPushApi.on("alerts_updated",this._onAlertsUpdated),this._alertsFacadeChannelPushApi.on("alerts_deleted",this._onAlertsDeleted),this._alertsFacadeChannelPushApi.on("alert_fired",this._onAlertFired)}_unsubscribeFromFacadeChannelPushApi(){this._alertsFacadeChannelPushApi.off("alerts_created",this._onAlertsCreated),this._alertsFacadeChannelPushApi.off("alerts_updated",this._onAlertsUpdated),this._alertsFacadeChannelPushApi.off("alerts_deleted",this._onAlertsDeleted),this._alertsFacadeChannelPushApi.off("alert_fired",this._onAlertFired)}_onAlertsFacadeChannelMessage(e){const t={source:"pricealerts",data:e};this._facadeChannelMessageDelegate.fire(t)}}},606858:(e,t,i)=>{i.d(t,{AlertsWidgetDialog:()=>d});var r=i(62802),n=i.n(r),s=i(129025),a=i(949307),o=i(435361),l=i(953725),c=i(513249),h=i(244593);class d{constructor(e){
this._isVisible=new s.WatchedValue(!1),this._activeTab=new s.WatchedValue(function(){const e=n().getValue("alerts.widget_dialog.active_tab");return!e||"list"!==e&&"log"!==e?"list":e}()),this._willShow=!1,this._dialogImpl=null,this._getChartWidget=e,this._activeTab.subscribe((e=>{n().setValue("alerts.widget_dialog.active_tab",e)}))}setTab(e){this._activeTab.setValue(e)}show(){this._willShow||(this._willShow=!0,Promise.all([Promise.all([i.e(62272),i.e(30755),i.e(22666),i.e(62253),i.e(92191),i.e(32109),i.e(9817),i.e(4015),i.e(92108),i.e(13423),i.e(89842),i.e(35649),i.e(5145),i.e(38669),i.e(25190),i.e(36747),i.e(45896),i.e(58056),i.e(6209),i.e(15518),i.e(26053),i.e(7242),i.e(10897),i.e(29337),i.e(52455),i.e(22144),i.e(64861),i.e(51229),i.e(40153),i.e(45016),i.e(95005),i.e(94533),i.e(8112),i.e(962),i.e(30979),i.e(1335),i.e(72978),i.e(12405),i.e(35967),i.e(61491)]).then(i.bind(i,67916)),(0,a.getPriceAlertsDispatcher)(),(0,h.getWidgetAlertsCollection)(),(0,c.getFiresActions)(),(0,l.getAlertsActionCreators)(),(0,l.getFiresActionCreators)(),(0,o.getGlobalAlertFocusedIdTracker)(),Promise.all([i.e(8287),i.e(58198),i.e(46670)]).then(i.bind(i,224004)),Promise.resolve().then(i.bind(i,908287)),Promise.resolve().then(i.bind(i,206242))]).then((([{AlertsWidgetDialogImpl:e},t,i,r,n,s,a,{getUnreadFiresBuffer:o},{getAlertSession:l},{getAlertsTrackers:c}])=>{this._willShow&&(this._dialogImpl=new e({alertsDispatcher:t,widgetAlertsCollection:i,firesActions:r,alertsActionCreators:n,firesActionCreators:s,globalFocusedTracker:a,unreadFiresBuffer:o(),onClose:()=>this.hide(),activeTab:this._activeTab,getChartWidget:this._getChartWidget,alertSession:l(),alertTrackers:c()}),this._isVisible.setValue(!0))})))}hide(){this._dialogImpl&&(this._dialogImpl.destroy(),this._dialogImpl=null),this._willShow=!1,this._isVisible.setValue(!1)}visible(){return this._isVisible}}},435361:(e,t,i)=>{i.d(t,{getGlobalAlertFocusedIdTracker:()=>n});var r=i(949307);const n=function(e){let t;return()=>(t||(t=Promise.all([(0,r.getPriceAlertsDispatcher)(),i.e(68553).then(i.bind(i,197594))]).then((([t,{AlertInteractionStateIdTracker:i}])=>new i(t.alerts,e)))),t)}("selected")},694839:(e,t,i)=>{i.d(t,{getAlertConfig:()=>c});var r=i(895171),n=i(650151),s=i(125226),a=i(588948),o=(i(659863),i(77122));const l={from:3e4,to:18e5},c=(0,r.default)((()=>({priceAlertsFacadeClientUrl:h(),fetchTokenMaxRetriesCount:1,restRequestsMaxRetriesCount:1,permissionProxyEnabled:(0,s.isFeatureEnabled)("alerts-facade-use-permission-proxy"),autoUnsetMaintenanceTimeout:(0,s.isFeatureEnabled)("alerts-maintenance-auto-unset")?l:null,maxAlertExpiration:{type:"days",count:60},defaultAlertExpiration:{type:"months",count:1}})));function h(){return o.enabled("alerts")?(0,n.ensureDefined)((0,a.getFreshInitData)().priceAlertsFacadeClientUrl):""}},908287:(e,t,i)=>{i.r(t),i.d(t,{getAlertSession:()=>M});var r=i(895171),n=i(314802),s=(i(659863),i(129025)),a=i(125226),o=i(799402),l=i(707957),c=i(822122),h=i(201089);function d(e){const t=JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))
;return Date.now()+3e5>1e3*t.exp}const u=(0,h.getLogger)("Alerts.CacheToken");class g{constructor(){this.invalidated=new l.Delegate,this._fetchTokenPromise=null,this._timersDifference=Date.now()-performance.now(),window.loginStateChange.subscribe(null,(e=>{e||this.invalidated.fire()}))}get(e=!1){if(this._fetchTokenPromise)return this._fetchTokenPromise;const t=Date.now()-performance.now(),i=Math.abs(t-this._timersDifference);return this._fetchTokenPromise=this._tryGetFreshToken(e||i>3e4).then((e=>(this._fetchTokenPromise=null,this._timersDifference=t,e))).catch((e=>{throw this._fetchTokenPromise=null,this._timersDifference=t,u.logError(e instanceof Error?e.message:String(e)),e})),this._fetchTokenPromise}reset(){u.logWarn("Token has been force reset"),this.get(!0)}async _tryGetFreshToken(e){if(!window.is_authenticated){const e=new Error("Fetching token is denied for anonymous user");throw u.logError(e.message),e}u.logNormal("Getting token");let t=await this._fetchToken(e);return!e&&d(t)&&(u.logWarn("Fetched token is expired, force reloading token"),t=await this._fetchToken(!0)),d(t),t!==this._previousToken&&(this._previousToken&&this.invalidated.fire(),this._previousToken=t),t}async _fetchToken(e){const t=await fetch(`/entitlements-token/?user_id=${window.user.id}&pro_plan=${window.user.pro_plan||c.ProPlans.Free}`,{cache:e?"reload":"default"}),i=await t.json();if("code"in i)throw new Error(`Failed to fetch token, status ${t.status}, code: ${i.code}, message: ${i.detail}`);if(!t.ok)throw new Error(`Failed to fetch token, status ${t.status}`);return this._logFetchedToken(i.token),i.token}_logFetchedToken(e){e!==this._previousToken?u.logNormal(`Fetched new token: ${e}`):u.logNormal(`Fetched cached token: ${e}`)}}const m=(0,a.isFeatureEnabled)("alerts-use-browser-cache-for-jwt")?0:1,_=(0,r.default)((()=>new(0===m?g:o.AuthToken)));var p=i(833813),f=i(740254),S=i(526225),v=i(62802),b=i.n(v),y=i(199472),w=i(266325);function C(){var e;const t=(0,f.getConfig)(p.ProductFeatures.SERVER_SIDE_ALERTS);return null!==(e=null==t?void 0:t.overall_limit)&&void 0!==e?e:2e3}function T(){var e,t;const i=(0,f.getConfig)(p.ProductFeatures.SERVER_SIDE_ALERTS);return{primitive:null!==(e=null==i?void 0:i.primitive_limit)&&void 0!==e?e:0,complex:null!==(t=null==i?void 0:i.complex_limit)&&void 0!==t?t:0}}var A=i(694839);const I=(0,h.getLogger)("Alerts.Session.TokenInfo"),P=Date.now();async function W(e){const t=_();e&&t.reset();const i=await D(t),r=Date.now();return 0===m?{token:i,managerImplementation:0}:{token:i,managerImplementation:1,metadata:{moduleLoadingTimestamp:P,tokenGettingTimestamp:r,isTokenForceReset:Boolean(e),isTokenInitial:i===window.user.auth_token}}}async function D(e,t=0){const i=await e.get();return d(i)&&t<(0,A.getAlertConfig)().fetchTokenMaxRetriesCount?(I.logWarn("Received token is expired, retrying with a token refresh"),e.reset(),D(e,t+1)):i}class L{constructor(){this._abortController=new AbortController,this._twoFactorState=new s.WatchedValue(!1),this._twoFactorApiModulePromise=i.e(76047).then(i.bind(i,728236)),
this._syncPromise=this._sync()}value(){return this._twoFactorState.value()}async sync(e=!1){var t;return e&&(null===(t=this._abortController)||void 0===t||t.abort(),this._abortController=new AbortController,this._syncPromise=this._sync()),this._syncPromise}destroy(){var e;null===(e=this._abortController)||void 0===e||e.abort()}async _sync(){try{const{getTwoFactorStatus:e}=await this._twoFactorApiModulePromise,t=await Promise.race([(0,w.delay)(this._abortController.signal,5e3).then((()=>!0)),(0,w.respectAbort)(this._abortController.signal,e())]);this._twoFactorState.setValue(t)}catch(e){(0,w.isAbortError)(e)||this._twoFactorState.setValue(!0)}}}function k(){if(!window.is_authenticated||!window.user.id)return null;const e=new AbortController,t=new l.Delegate;return(0,y.subscriptionNotification)().on(y.SubscriptionEventType.Subscribe,i),(0,y.subscriptionNotification)().on(y.SubscriptionEventType.Unsubscribe,i),(0,y.subscriptionNotification)().on(y.SubscriptionEventType.Upgrade,i),(0,y.subscriptionNotification)().on(y.SubscriptionEventType.Downgrade,i),{id:window.user.id,username:window.user.username,settings:b(),twoFactorTracker:new L,hasActiveEmail:()=>Boolean(window.user.has_active_email),getSmsEmail:()=>window.user.sms_email,getFeatures:E,getTokenInfo:W,onSubscriptionChanged:t,destroy:function(){(0,y.subscriptionNotification)().off(i),e.abort()}};async function i(){try{await(0,w.respectAbort)(e.signal,(0,S.syncUserData)("price-alerts"))}catch(e){(0,w.skipAbortError)(e)}t.fire()}}function E(){return{overallLimit:C(),activeLimits:T(),alertsWithWebhook:(0,f.enabled)(p.ProductFeatures.ALERTS_WEBHOOK),alertsNoExpiration:(0,f.enabled)(p.ProductFeatures.ALERTS_NO_EXPIRATION),alertsOnSeconds:(0,f.enabled)(p.ProductFeatures.ALERTS_ON_SECONDS)}}const M=(0,r.default)((()=>{const e=new s.WatchedValue(k()),t=_();window.loginStateChange.subscribe(null,(()=>{const i=e.value();null==i||i.destroy();const r=k();r&&t.reset(),e.setValue(r)}));const i=(0,n.isOnMobileAppPage)("any");return{user:e,isOnMobileApp:i}}))},244593:(e,t,i)=>{i.d(t,{StudyLineTool:()=>o.StudyLineTool,getWidgetAlertsCollection:()=>c});var r=i(895171),n=i(125226),s=i(513249),a=i(949307),o=i(694130);const l=(0,n.isFeatureEnabled)("alerts-widgets-use-facade"),c=(0,r.default)((async()=>{const[{getAlertSession:e},{getAlertsTrackers:t},r]=await Promise.all([await Promise.all([i.e(8287),i.e(55848)]).then(i.bind(i,908287)),await i.e(95063).then(i.bind(i,206242)),await(0,s.getAlertsActions)()]),n=e(),o=t();if(l){const[e,{getAlertsCollection:t},{FacadeWidgetAlertsCollection:s}]=await Promise.all([(0,a.getPriceAlertsDispatcher)(),Promise.all([i.e(8287),i.e(1335),i.e(14141)]).then(i.bind(i,401335)),Promise.all([i.e(40113),i.e(88104),i.e(31383),i.e(35063)]).then(i.bind(i,520047))]);return new s(r,e,t(),n,o)}{const[e,{DispatcherWidgetAlertsCollection:t}]=await Promise.all([(0,a.getPriceAlertsDispatcher)(),Promise.all([i.e(40113),i.e(88104),i.e(31383),i.e(79718)]).then(i.bind(i,649356))]);return new t(r,e,n,o)}}))},694130:(e,t,i)=>{var r;i.d(t,{StudyLineTool:()=>r}),function(e){
e.LineToolAnchoredVWAP="AnchoredVWAP@tv-basicstudies"}(r||(r={}))},199472:(e,t,i)=>{i.d(t,{SubscriptionEventType:()=>l,subscriptionNotification:()=>h});var r=i(444372),n=i(226722),s=i(707957);const a=(0,i(201089).getLogger)("SubscriptionNotification"),o="subscriptionPermissionHasChanged";var l;!function(e){e.Subscribe="subscribe",e.Unsubscribe="unsubscribe",e.Downgrade="downgrade",e.Upgrade="upgrade",e.Change="change",e.PaymentMethodChanged="paymentmethodChanged",e.AgreementSigned="agreementSigned"}(l||(l={}));class c{constructor(){this.stateChanged=new s.Delegate,this._handlers=[],this._windowEventsHandlers=[],this._stateChangeHandlers=[]}on(e,t){const i=i=>{let r=null;try{r=JSON.parse(i)}catch(e){return void a.logWarn(`Failed to parse JSON: ${i}`)}e!==l.Change&&e!==r.type||t(r,{currentTab:!1})},r=i=>{e!==l.Change&&e!==i.type||t(i,{currentTab:!0})};n.TVXWindowEvents.on(o,i),this.stateChanged.subscribe(null,r),this._handlers.push(t),this._windowEventsHandlers.push(i),this._stateChangeHandlers.push(r)}off(e){let t;for(;-1!==t;)t=this._handlers.indexOf(e),t>-1&&(n.TVXWindowEvents.off(o,this._windowEventsHandlers[t]),this.stateChanged.unsubscribe(null,this._stateChangeHandlers[t]),this._handlers.splice(t,1),this._windowEventsHandlers=this._windowEventsHandlers.splice(t,1),this._stateChangeHandlers=this._stateChangeHandlers.splice(t,1))}showNotification(){Promise.all([i.e(62741),i.e(62253),i.e(92191),i.e(68992),i.e(81643),i.e(73151),i.e(33199),i.e(36953),i.e(967),i.e(27781),i.e(61298),i.e(61633),i.e(962),i.e(78845),i.e(42198),i.e(597),i.e(30870)]).then(i.bind(i,526715)).then((({showSubscriptionHasBeenChangedDialog:e})=>{e({pushReload:!0})}))}showChartNotification(){Promise.all([i.e(62741),i.e(62253),i.e(92191),i.e(68992),i.e(81643),i.e(73151),i.e(33199),i.e(36953),i.e(967),i.e(27781),i.e(61298),i.e(61633),i.e(962),i.e(78845),i.e(42198),i.e(597),i.e(30870)]).then(i.bind(i,526715)).then((({showSubscriptionHasBeenChangedDialog:e})=>{e({content:r.t(null,void 0,i(653427))})}))}showChartAgreementNotification(){Promise.all([i.e(62741),i.e(62253),i.e(92191),i.e(68992),i.e(81643),i.e(73151),i.e(33199),i.e(36953),i.e(967),i.e(27781),i.e(61298),i.e(61633),i.e(962),i.e(78845),i.e(42198),i.e(597),i.e(30870)]).then(i.bind(i,526715)).then((({showSubscriptionHasBeenChangedDialog:e})=>{e({title:r.t(null,void 0,i(719967)),content:r.t(null,void 0,i(180416))})}))}showBillingTimeoutNotification(){Promise.all([i.e(62741),i.e(62253),i.e(92191),i.e(68992),i.e(81643),i.e(73151),i.e(33199),i.e(36953),i.e(967),i.e(27781),i.e(61298),i.e(61633),i.e(962),i.e(78845),i.e(42198),i.e(597),i.e(30870)]).then(i.bind(i,526715)).then((({showSubscriptionHasBeenChangedDialog:e})=>{e({title:r.t(null,void 0,i(323672)),content:r.t(null,void 0,i(436344)),pushReload:!0})}))}xWindowEventsEmit(e){n.TVXWindowEvents.emit(o,JSON.stringify(e))}currentTabEmit(e){this.stateChanged.fire(e)}emit(e){this.currentTabEmit(e),this.xWindowEventsEmit(e)}static getInstance(){return c._instance||(c._instance=new c),c._instance}}function h(){return c.getInstance()}},25517:(e,t,i)=>{
i.r(t),i.d(t,{publishChart:()=>n,publishChartWidget:()=>s,setPublishChartOptions:()=>a});i(823127);let r;function n(e){const t={...e,...r};return new Promise((e=>{window.runOrSignIn((()=>{e(async function(e){return window.saver.publishChart(e)}(t))}),{source:"Publish chart",sourceMeta:"Chart"})}))}function s(e){n(e)}function a(e){r=e}},636929:(e,t,i)=>{i.d(t,{resolutionsMap:()=>n});var r=i(146585);const n={[(0,r.stringAsResolution)("1")]:{resolution:(0,r.stringAsResolution)("1"),text:(0,r.minutesStringLiteral)(1)},[(0,r.stringAsResolution)("3")]:{resolution:(0,r.stringAsResolution)("3"),text:(0,r.minutesStringLiteral)(3)},[(0,r.stringAsResolution)("5")]:{resolution:(0,r.stringAsResolution)("5"),text:(0,r.minutesStringLiteral)(5)},[(0,r.stringAsResolution)("15")]:{resolution:(0,r.stringAsResolution)("15"),text:(0,r.minutesStringLiteral)(15)},[(0,r.stringAsResolution)("30")]:{resolution:(0,r.stringAsResolution)("30"),text:(0,r.minutesStringLiteral)(30)},[(0,r.stringAsResolution)("45")]:{resolution:(0,r.stringAsResolution)("45"),text:(0,r.minutesStringLiteral)(45)},[(0,r.stringAsResolution)("60")]:{resolution:(0,r.stringAsResolution)("60"),text:(0,r.hoursStringLiteral)(1)},[(0,r.stringAsResolution)("120")]:{resolution:(0,r.stringAsResolution)("120"),text:(0,r.hoursStringLiteral)(2)},[(0,r.stringAsResolution)("180")]:{resolution:(0,r.stringAsResolution)("180"),text:(0,r.hoursStringLiteral)(3)},[(0,r.stringAsResolution)("240")]:{resolution:(0,r.stringAsResolution)("240"),text:(0,r.hoursStringLiteral)(4)},[(0,r.stringAsResolution)("1D")]:{resolution:(0,r.stringAsResolution)("1D"),text:(0,r.daysStringLiteral)(1)},[(0,r.stringAsResolution)("1W")]:{resolution:(0,r.stringAsResolution)("1W"),text:(0,r.weeksStringLiteral)(1)},[(0,r.stringAsResolution)("1M")]:{resolution:(0,r.stringAsResolution)("1M"),text:(0,r.monthsStringLiteral)(1)},[(0,r.stringAsResolution)("3M")]:{resolution:(0,r.stringAsResolution)("3M"),text:(0,r.monthsStringLiteral)(3)},[(0,r.stringAsResolution)("6M")]:{resolution:(0,r.stringAsResolution)("6M"),text:(0,r.monthsStringLiteral)(6)},[(0,r.stringAsResolution)("12M")]:{resolution:(0,r.stringAsResolution)("12M"),text:(0,r.yearsStringLiteral)(1)}}},775548:(e,t,i)=>{i.d(t,{availableTimeFrames:()=>s});var r=i(606311);const n={8:[r.timeFrames.ytd,r.timeFrames["12m"],r.timeFrames["60m"],r.timeFrames.all],3:[r.timeFrames["1d"],r.timeFrames["5d"],r.timeFrames["1m"],r.timeFrames["3m"],r.timeFrames["6m"],r.timeFrames.ytd,r.timeFrames["12m"],r.timeFrames["60m"],r.timeFrames.all]};function s(e,t){return 9===t&&(t=3),6===t&&(t=8),n[t]||[]}},449628:(e,t,i)=>{i.d(t,{disable:()=>c,enable:()=>h,pushBackListener:()=>l});var r=i(541558);const n=[];let s=null;function a(e){for(let t=0;t<n.length;t++)if(n[t].name===e)return t;return-1}function o(e){if(!s)for(let t=n.length-1;t>=0&&!0!==n[t].func(e);t--);}function l(e,t){const i={name:e,func:t},r=a(i.name);r>-1&&n.splice(r,1),n.unshift(i)}function c(){return s?null:(s=(0,r.randomHashN)(4),s)}function h(e){if(e!==s)throw Error("Lock id is outdated");s=null}
window.addEventListener("keypress",o,!1)},930003:(e,t,i)=>{i.d(t,{Worker:()=>r});class r extends Worker{constructor(e,t){super(function(e){const t=new URL(e),r=new Blob(["self.WEBPACK_PUBLIC_PATH=",JSON.stringify(new URL(i.p,location.href).href),";\n","self.locale=",JSON.stringify(i.g.locale),";\n",window.language?`self.language=${JSON.stringify(window.language)};\n`:"","importScripts(",JSON.stringify(t.href),");"],{type:"application/javascript"});return URL.createObjectURL(r)}(e),t)}}}}]);