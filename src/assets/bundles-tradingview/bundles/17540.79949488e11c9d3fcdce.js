"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[17540],{242558:(e,t,s)=>{s.d(t,{createDwmAligner:()=>u,createTimeToBarTimeAligner:()=>c});var i=s(988124),r=s(77122),n=s(223699),o=s(995310),a=s(547944);const l=new o.SessionInfo("Etc/UTC","0000-0000:1234567");function u(e,t){if(!d()||!n.Interval.isDWM(e))return null;const s=new o.SessionInfo(t.timezone,t.session,t.session_holidays,t.corrections),r=(0,a.newBarBuilder)(e,s,l);return{timeToSessionStart:e=>r.tradingDayToSessionStart(e),timeToExchangeTradingDay:e=>{const t=i.utc_to_cal(s.timezone,e),r=s.spec.correctTradingDay(t);return i.set_hms(r,0,0,0,0,i.get_timezone("Etc/UTC")),r.getTime()}}}function d(){return!r.enabled("disable_resolution_rebuild")}function c(e,t){if(!d())return e=>e;const s=new o.SessionInfo(t.timezone,t.session,t.session_holidays,t.corrections),i=(0,a.newBarBuilder)(e,s,s,!1);return e=>i.alignTimeIfPossible(e)}},364615:(e,t,s)=>{s.d(t,{LineToolAnchoredVolumeProfile:()=>I});var i=s(650151),r=s(526075),n=s(827523),o=s(853965),a=s(807218),l=s(389137),u=s(268008),d=s(590713),c=s(964824),p=s(837202);class h extends p.LineToolPriceAxisView{_updateRendererData(e,t,s){super._updateRendererData(e,t,s);const i=this._source.model().properties().childs().scalesProperties.childs(),r=this._source.properties().showLabelsOnPriceScale.value();t.visible=e.visible&&r&&i.showStudyPlotLabels.value(),e.visible=e.visible&&r&&i.showStudyLastValue.value(),t.text=this._data.title}}var _=s(742391),y=s(806960),S=s(932167);class P extends S.StudyPriceAxisView{_showPaneLabel(){const e=this._model.properties().childs().scalesProperties.childs();return this._visible()&&e.showStudyPlotLabels.value()}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs();return this._visible()&&e.showStudyLastValue.value()}_visible(){const e=this._source.properties().childs().styles.childs()[this._data.plotIndex].childs().display.value();return this._source.properties().childs().showLabelsOnPriceScale.value()&&Boolean(4&e)}}var m=s(347710);const f=(0,n.studyIdString)("VbPAnchored","tv-basicstudies"),g=[{styleId:"pocLines",title:"POC"},{styleId:"vahLines",title:"VAH"},{styleId:"valLines",title:"VAL"}];class I extends y.StudyLineDataSourceWithPlots{constructor(e,t,s,r,n){const o=s||(0,l.clone)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:f})),a=null!=t?t:I.createProperties(e);super(e,o,"vbpanchored_",a,r,n),this._priceAxisPointsInvalidated=!0;const u=(0,i.ensureDefined)(a.childs().graphics.childs().horizlines).childs(),d=this._createPlotPriceAxisViews();this._priceAxisViews=g.map(((e,t)=>new h(this,{pointIndex:t,title:e.title,backgroundPropertyGetter:()=>u[e.styleId].childs().color.value()}))).concat(d),this._priceAxisPoints=g.map(((e,t)=>({price:NaN,index:0}))),this._paneLabelsPaneViews=this._priceAxisViews.map((e=>new _.PanePriceAxisView(e,this,this._model))),this._createPaneViews().then((e=>{this._setPaneViews([...this._paneLabelsPaneViews,...e]),e.forEach((e=>e.update((0,c.sourceChangeEvent)({sourceId:this.id(),
clearData:!0}))))}))}pointsCount(){return 1}isForcedDrawPriceAxisLabel(){return!0}isSynchronizable(){return this._ownerSource===this._model.mainSeries()}priceAxisPoints(){return this._priceAxisPointsInvalidated&&(this._updatePriceLabels(),this._priceAxisPointsInvalidated=!1),this._priceAxisPoints}static createProperties(e,t){const s=r.StudyMetaInfo.getStudyPropertyRootNameById(f),n=(0,i.ensureNotNull)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:f})),a=(0,o.createDefaultsState)(!0,s,[],e.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(n,n,(0,l.merge)((0,l.clone)(a),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,s,i){const r=(0,a.prepareStudyPropertiesForLoadChart)(e,t,s,i);return this._configureProperties(r),r}_updateAllPaneViews(e){super._updateAllPaneViews(e),this._updateAnchors(),this._priceAxisPointsInvalidated=!0}_updateAnchors(){var e;if(0===this._points.length)return;const t=this.priceScale();if(!t)return;const s=null===(e=this._ownerSource)||void 0===e?void 0:e.firstValue();if(null==s)return;const r=this.graphics().horizlines();let n=null;const o=(0,i.ensureDefined)(this.properties().childs().graphics.childs().horizlines).childs();for(const e of g)if(o[e.styleId].childs().visible.value()){const t=r.get(e.styleId);(null==t?void 0:t.size)&&(n=t.values().next().value.level);break}if(null===n){const e=t.height()/2;n=t.coordinateToPrice(e,s)}this._points[0].price=n}_updatePriceLabels(){const e=(0,i.ensureDefined)(this.properties().childs().graphics.childs().horizlines).childs(),t=this.graphics().horizlines();g.forEach(((s,i)=>{if(this._priceAxisPoints[i].price=NaN,e[s.styleId].childs().visible.value()){const e=t.get(s.styleId);(null==e?void 0:e.size)&&(this._priceAxisPoints[i].price=e.values().next().value.level)}}))}_studyInputs(e){(0,i.assert)(1===e.length,"the line tool point should be defined");const t=e[0],s=this._getPointTime(t,!0);if(null===s)return this._subscribeApplyInputsOnSeriesCompleted(),null;if(!this._model.mainSeries().data().last())return null;return{...this.properties().childs().inputs.state(),first_bar_time:1e3*s}}async _createPaneViews(){var e;const t=this._metaInfo,i=t.graphics,r=[],n=!0;if(i.hhists){const{HHistPaneView:t}=await Promise.all([s.e(13207),s.e(20507)]).then(s.bind(s,670751)),i=null===(e=this.properties().childs().graphics.childs().polygons)||void 0===e?void 0:e.childs();r.push(new t(this,this._model,void 0,null==i?void 0:i.histBoxBg,n,!0))}if(i.horizlines){const{HorizLinePaneView:e}=await Promise.all([s.e(13207),s.e(20507)]).then(s.bind(s,722669));r.push(new e(this,this._model,void 0,n))}return t.plots.forEach((e=>{r.push(this._createStudyPlotPaneView(e.id,n))})),r}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(88601),s.e(96461),s.e(43474),s.e(68855),s.e(99094),s.e(56386),s.e(47924),s.e(60607)]).then(s.bind(s,762155))).StudyLineDataSourceDefinitionsViewModel}_isReady(){return!(0,d.isStudyGraphicsEmpty)(this.graphics())}_createStudyPlotPaneView(e,t){
return new u.StudyPlotPaneView(this,this._model.mainSeries(),this._model,e,t)}_createPlotPriceAxisViews(){return this.metaInfo().plots.map((e=>new P(this,{plotIndex:e.id})))}static _configureProperties(e){super._configureProperties(e),e.removeProperty("showLegendValues")}}},617540:(e,t,s)=>{s.r(t),s.d(t,{cloneLineTool:()=>at,createLineTool:()=>Qe,createLineToolProperties:()=>et,createStudyLineToolProperties:()=>tt,getNewToolProperties:()=>Ke,initAllLineToolsFromContent:()=>Ze,initLineTool:()=>Je,isLineTool:()=>it,isStudyLineTool:()=>rt,isTrading:()=>nt,lineToolByLinkKey:()=>lt,prepareLineToolPropertiesByOwnerSource:()=>Ye,setNewToolProperties:()=>Ge,supportsPhantomMode:()=>st,tryFindStudyLineToolNameByStudyId:()=>ot,unsetNewToolProperties:()=>qe});var i={};s.r(i),s.d(i,{LineStudyMtpAnalysis:()=>se,LineStudyMtpDecisionPoint:()=>re,LineStudyMtpDownWave1OrA:()=>Se,LineStudyMtpDownWave2OrB:()=>me,LineStudyMtpDownWave3:()=>ge,LineStudyMtpDownWave4:()=>ve,LineStudyMtpDownWave5:()=>be,LineStudyMtpDownWaveC:()=>Ve,LineStudyMtpElliotWaveMain:()=>ue,LineStudyMtpElliotWaveMajor:()=>ce,LineStudyMtpElliotWaveMinor:()=>he,LineStudyMtpRiskReward:()=>oe,LineStudyMtpUpWave1OrA:()=>Te,LineStudyMtpUpWave2OrB:()=>Le,LineStudyMtpUpWave3:()=>Me,LineStudyMtpUpWave4:()=>Re,LineStudyMtpUpWave5:()=>Ne,LineStudyMtpUpWaveC:()=>We});var r=s(650151),n=s(86441),o=s(395098),a=s(2122),l=s(875409),u=s(968361),d=s.t(u,2),c=s(732149),p=s(827523),h=s(526075),_=s(807218),y=s(31712),S=s(389137),P=s(853965),m=s(347710);const f=(0,p.studyIdString)("RegressionTrend","tv-basicstudies");function g(e){return void 0!==e.startPrice&&void 0!==e.endPrice}function I(e,t,s,i){return t.styles&&(v(t.styles.baseLine),v(t.styles.downLine),v(t.styles.upLine)),t}function v(e){void 0!==e&&void 0!==e.visible&&(e.display=e.visible?15:0,delete e.visible)}class w extends a.StudyLineDataSource{constructor(e,t,i,n,o){super(e,i=null!=i?i:(0,r.ensureNotNull)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:f})),"linreg_",null!=t?t:w.createProperties(e),n,o),this.version=2,this._trendData=null,Promise.all([s.e(88548),s.e(42244),s.e(6744),s.e(17862),s.e(13207),s.e(51583)]).then(s.bind(s,13105)).then((e=>{this._setPaneViews([new e.RegressionTrendPaneView(this,this._model)])}))}formatter(){throw new Error("This method should never be called")}pointsCount(){return 2}clearData(){this._trendData=null,super.clearData()}state(e){var t;const s=super.state(e);return e?{...s,nonseriesdata:null!==(t=this._trendData)&&void 0!==t?t:void 0}:s}restoreData(e){var t;super.restoreData(e),this._trendData=null!==(t=e.nonseriesdata)&&void 0!==t?t:null}startIndex(){if(null===this._trendData||null===this._indexes)return null;const e=this._indexes[this._trendData.startIndex];return e!==c.INVALID_TIME_POINT_INDEX?e:null}endIndex(){if(null===this._trendData||null===this._indexes)return null;const e=this._indexes[this._trendData.endIndex];return e!==c.INVALID_TIME_POINT_INDEX?e:null}baseLine(){return null===this._trendData?null:this._trendData.baseLine}downLine(){
return null===this._trendData?null:this._trendData.downLine}upLine(){return null===this._trendData?null:this._trendData.upLine}pearsons(){return null===this._trendData?null:this._trendData.pearsons}recalcStudyIfNeeded(){this._onStudyInputsMayChange()}cloneable(){return!1}static createProperties(e,t){const s=h.StudyMetaInfo.getStudyPropertyRootNameById(f),i=(0,r.ensureNotNull)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:f})),n=(0,P.createDefaultsState)(!0,s,[],e.studyVersioning());return this.createRegressionTrendPropertiesFromStudyMetaInfoAndState(i,i,(0,S.merge)((0,S.clone)(n),null!=t?t:{}),e.studyVersioning())}static createRegressionTrendPropertiesFromStudyMetaInfoAndState(e,t,s,i){const r=(0,_.prepareStudyPropertiesForLoadChart)(e,t,s,i,I);return this._configureProperties(r),r}static studyId(){return f}_studyInputs(e){(0,r.assert)(2===e.length,"all the line tool points should be defined");const[t,s]=e;if(t.index===s.index)return null;const i=this._getPointTime(t.index<=s.index?t:s,!0),n=this._getPointTime(s.index>=t.index?s:t,!0);return null===i||null===n?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),"first bar time":1e3*i,"last bar time":1e3*n}}_onDataUpdated(e,t,s){null!==t&&(t.indexes_replace||(this._trendData=t.data),"nochange"!==s&&(this._indexes=s),super._onDataUpdated(e,t,s))}_isReady(){return null!==this._trendData&&void 0!==this._trendData.startIndex&&void 0!==this._trendData.endIndex&&g(this._trendData.upLine)&&g(this._trendData.baseLine)&&g(this._trendData.downLine)}_updateAnchorsPrice(){if(!this._trendData||(0,S.isNaN)(this._trendData.baseLine.startPrice)||(0,S.isNaN)(this._trendData.baseLine.endPrice))return;const{startPrice:e,endPrice:t}=this._trendData.baseLine;2===this._points.length&&(this._points[0].price=(0,r.ensureDefined)(e),this._points[1].price=(0,r.ensureDefined)(t),this._timePoint[0].price=(0,r.ensureDefined)(e),this._timePoint[1].price=(0,r.ensureDefined)(t))}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(88601),s.e(96461),s.e(43474),s.e(68855),s.e(99094),s.e(56386),s.e(47924),s.e(60607)]).then(s.bind(s,422026))).RegressionTrendDefinitionsViewModel}static _configureProperties(e){super._configureProperties(e);const t=e.childs().styles.childs(),s=[t.upLine.childs().linewidth,t.downLine.childs().linewidth,t.baseLine.childs().linewidth];e.addChild("linesWidths",new y.LineToolWidthsProperty(s))}}var b=s(224153);const A=(0,p.studyIdString)("VbPFixed","tv-basicstudies");class V extends b.LineToolVbPFixed{constructor(e,t,s,i,r){super(e,t,s||(0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:A}),i,r)}calcIsActualSymbol(){a.StudyLineDataSource.prototype.calcIsActualSymbol.apply(this)}boundToSymbol(){return!0}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}static studyId(){return A}static createProperties(e,t){const s=h.StudyMetaInfo.getStudyPropertyRootNameById(A),i=(0,r.ensureNotNull)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",
studyId:A})),n=(0,P.createDefaultsState)(!0,s,[],e.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(i,i,(0,S.merge)((0,S.clone)(n),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,s,i){const r=(0,_.prepareStudyPropertiesForLoadChart)(e,t,s,i);return this._configureProperties(r),r}}var x=s(173948),T=s(855611),D=s(826908),L=s(811630),C=s(190973),M=s(291784),F=s(932167);class R extends F.StudyPriceAxisView{_showPaneLabel(){return!1}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs();return this._visible()&&"VWAP"===this._data.plotIndex&&e.showStudyLastValue.value()}_visible(){const e=this._source.properties().childs().styles.childs()[this._data.plotIndex].childs().display.value();return this._source.properties().childs().axisLabelVisible.value()&&Boolean(4&e)}}var B=s(342308),N=s(329007),E=s(268008);class W extends E.StudyPlotPaneView{constructor(e,t,s,i){super(e,t,s,i),this._line=e}_makeSureRendererIsValid(){(this._dataInvalidated||this._viewportInvalidated)&&this._updateImplFull(this._viewportInvalidated)&&(this._dataInvalidated=null),this._viewportInvalidated=!1}_updateRenderer(e,t){super._updateRenderer(e,t),this._addAlertsRenderer()}_addAlertsRenderer(){if(window.TradingView.printing||!this._line.hasAlert().value()||this._model.readOnly()||this._model.isInReplay())return!1;const e=this._series.data().bars().lastIndex(),t=this._series.model().timeScale().visibleBarsStrictRange();if(null===e||null===t||!t.contains(e))return!1;const s=this._items;if(!this._renderer.isEmpty()&&s.length>0){const e=s[s.length-1],t=this._model.timeScale().width();return!(isNaN(e.x)||e.x<0||s[0].x>t)&&(this._renderer.append(new B.PaneRendererClockIcon({points:[new n.Point(e.x,e.y)],color:this._line.getAlertIsActive()?this._lineColor:N.Constants.DrawingIconColor,horzMargin:-16})),!0)}return!1}}var O=s(201089),z=s(552698),U=s(1584),k=s(461794),$=s(964824),j=s(806960),H=s(742391);const G=(0,O.getLogger)("Chart.AnchoredVWAP"),q=(0,p.studyIdString)("AnchoredVWAP","tv-basicstudies");function K(e,t,s,i){return"calculate_stDev"in(0,r.ensureDefined)(e.inputs)||void 0===i.inputs.find((e=>"calculate_stDev"===e.id))||((0,r.ensureDefined)(t.inputs).calculate_stDev=!1),t.styles&&(X(t.styles.VWAP),X(t.styles.UpperBand),X(t.styles.LowerBand),X(t.styles.UpperBand_2),X(t.styles.LowerBand_2),X(t.styles.UpperBand_3),X(t.styles.LowerBand_3)),t}function X(e){void 0!==e&&void 0!==e.visible&&(e.display=e.visible?15:0,delete e.visible)}class J extends j.StudyLineDataSourceWithPlots{constructor(e,t,s,i,n){s=s||(0,r.ensureNotNull)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:q}));const o=null!=t?t:J.createProperties(e);super(e,s,"anchoredvwap",o,i,n);const[a,l,u,d,c,p,h]=this.metaInfo().plots,_=e.mainSeries(),y=[new W(this,_,e,a.id)];l&&u&&(y.push(new E.StudyPlotPaneView(this,_,e,l.id)),y.push(new E.StudyPlotPaneView(this,_,e,u.id))),d&&c&&p&&h&&(y.push(new E.StudyPlotPaneView(this,_,e,d.id)),y.push(new E.StudyPlotPaneView(this,_,e,c.id)),
y.push(new E.StudyPlotPaneView(this,_,e,p.id)),y.push(new E.StudyPlotPaneView(this,_,e,h.id))),this._properties.childs().areaBackground&&y.splice(0,0,new U.AreaBackgroundPaneView(this,e)),this._priceAxisViews=this.metaInfo().plots.map((e=>new R(this,{plotIndex:e.id}))),y.push(...this._priceAxisViews.map((e=>new H.PanePriceAxisView(e,this,this._model)))),this._anchorPriceCalculated=!1,this._onInputsReadyCallbacks=[],this._setPaneViews(y),e.properties().childs().scalesProperties.childs().showStudyLastValue.subscribe(this,this._onShowStudyLastValueChanged),o.onRestoreFactoryDefaults().subscribe(this,this._onRestoreFactoryDefaults)}destroy(){this.properties().onRestoreFactoryDefaults().unsubscribeAll(this),this.model().properties().childs().scalesProperties.childs().showStudyLastValue.unsubscribeAll(this),this._onInputsReadyCallbacks=[],super.destroy()}canHasAlert(){return!0}pointsCount(){return 1}updateAllViews(e){super.updateAllViews(e),this._priceAxisViews.forEach((t=>t.update(e)))}firstValue(){return this._model.mainSeries().firstValue()}priceRange(e,t){if(!this._isReady()||this.isSourceHidden())return null;const s=this.plots().minMaxOnRangeCached(e,t,[{name:this.metaInfo().plots[0].id,offset:0}]);if(null===s)return null;const i=(0,r.ensureNotNull)(this.priceScale());return i.isLog()?new M.PriceRange(i.priceToLogical(s.min),i.priceToLogical(s.max)):new M.PriceRange(s.min,s.max)}isIncludedInAutoScale(){return!0}restoreData(e){super.restoreData(e),void 0!==e.data&&(this._anchorPriceCalculated=!0)}properties(){return super.properties()}sourceId(){return this._studyId()}hasStateForAlert(){return L.alertsAvailable&&null!==this._inputs}stateForAlert(){const e=this.metaInfo(),t=(0,D.plotsForAlert)(e,this.offset.bind(this),["VWAP"]),s=(0,D.collectDepsForAlert)([this],this.id()),i=s.idForAlert,r=s.studyDependencies,n=s.inputsForAlert,o=(this.priceScale()||this.model().mainSeries().priceScale()).formatter(),a=o?T.FormattersSerializer.serialize(o):null;return{id:i,uniqueId:i,type:z.StateForAlertType.StudyLineTool,title:(0,k.clean)(this.translatedType(),!0),shortTitle:(0,k.clean)(this.translatedType(),!0),shortDescription:(0,k.clean)(e.shortDescription||"Study",!0),interval:this._model.mainSeries().interval(),fullId:e.fullId,isTVScript:Boolean(e.isTVScript),isTVScriptStrategy:Boolean(e.isTVScriptStrategy),isTVLibrary:Boolean(e.isTVLibrary),hasAlertFunction:Boolean(e.hasAlertFunction),plots:t,inputs:n,alerts:e.alerts,scriptIdPart:e.scriptIdPart,scriptVersion:e.pine?e.pine.version:"-1",callStudyDependencies:(0,x.formatCallstudyArg)((0,D.dependenciesForAlerts)([],(0,m.studyMetaInfoRepository)())),studyDependencies:r,formatter:a}}inputsForAlertState(){null===this._inputs&&G.logError("Could not get inputsForAlertState if VWAP has no inputs");const{start_time:e,source:t}=this.inputs();return{start_time:e,source:t}}inputs(){return(0,r.ensureNotNull)(this._inputs)}idForAlert(){return(0,D.collectDepsForAlert)([this],this.id()).idForAlert}defaultPlotIdForAlert(){return this.metaInfo().plots[0].id}static createProperties(e,t){
const s=h.StudyMetaInfo.getStudyPropertyRootNameById(q),i=(0,r.ensureNotNull)((0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:q})),n=(0,P.createDefaultsState)(!0,s,[],e.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(i,i,(0,S.merge)((0,S.clone)(n),null!=t?t:{}),e.studyVersioning())}static studyId(){return q}static createPropertiesFromStudyMetaInfoAndState(e,t,s,i){const r=(0,_.prepareStudyPropertiesForLoadChart)(e,t,s,i,K);return this._configureProperties(r),r}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._onStudyInputsMayChange()}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=e[0],s=this._getPointTime(t,!1);return null===s?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(["start_time"]),start_time:1e3*s}}_isReady(){return super._isReady()&&(null!==this._inputs||this._anchorPriceCalculated)&&this.model().lineBeingEdited()!==this}_onDataCleared(){super._onDataCleared(),this._anchorPriceCalculated=!1}_onInputsChanged(){if(super._onInputsChanged(),this._updateAlertCreationAvailable(),null!==this._inputs){for(const e of this._onInputsReadyCallbacks)try{e(this._inputs)}catch(e){G.logError(e.stack||e.message)}this._onInputsReadyCallbacks=[]}}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(96461),s.e(24770),s.e(99094),s.e(56386),s.e(18537)]).then(s.bind(s,865993))).AnchoredVWAPDefinitionsViewModel}_updateAnchorsPrice(e){if(!e&&(this._anchorPriceCalculated||!this.isActualSymbol()))return;const t=this.firstValue(),s=this.points();if(null===t||0===s.length)return;const i=s[0].index,r=this.plots().valueAt(i);if(null===r)return;const n=r[1];null!=n&&(this._points[0].price=n,this._timePoint[0].price=n,this._anchorPriceCalculated=!0)}_synchronizeAlert(e){this._onInputsReady((()=>super._synchronizeAlert(e)))}static _configureProperties(e){super._configureProperties(e),e.hasChild("axisLabelVisible")||e.addChild("axisLabelVisible",new C.default(true));const t=e.childs().styles.childs().VWAP.childs().linewidth,s=e.childs().styles.childs().VWAP.childs().color;e.addChild("linesWidths",new y.LineToolWidthsProperty([t])),e.addChild("linesColors",new y.LineToolColorsProperty([s]))}_onInputsReady(e){null!==this._inputs?e(this._inputs):this._onInputsReadyCallbacks.push(e)}_onShowStudyLastValueChanged(){this._priceAxisViews.forEach((e=>e.update((0,$.sourceChangeEvent)(this.id())))),this.model().updateSource(this)}_onRestoreFactoryDefaults(){this.properties().childs().axisLabelVisible.setValue(true)}}var Z=s(484812),Q=s(943994);function Y(e){return(0,p.studyIdString)(e,"mtp-mtpredictor")}class ee extends a.StudyLineDataSource{constructor(e,t,s,i,r,n){const o=Y(i),a=s||(0,m.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:o}),l=t||ee._createPropertiesFromStudyMetaInfo(a,e.studyVersioning());super(e,a,i,l,r,n),this._formatter=new Q.VolumeFormatter,(0,Z.createGraphicsPaneViews)(this,e).then(this._setPaneViews.bind(this))}formatter(){return this._formatter}
static _createPropertiesFromMtpStudyShortIdAndState(e,t){return super._createPropertiesFromStudyIdAndState(Y(e),t)}static _createPropertiesFromStudyMetaInfo(e,t){const s=(0,_.prepareStudyProperties)(e,{},null,t,[]);return super._configureProperties(s),s}}const te="mtp_tsanalysis";class se extends ee{constructor(e,t,s,i,r){super(e,t,s,te,i,r)}pointsCount(){return 1}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(te,e)}static studyId(){return Y(te)}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0);return null===t?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*t}}}const ie="mtp_decisionpoint";class re extends ee{constructor(e,t,s,i,r){super(e,t,s,ie,i,r),this._symbolIntervalChanged=!1,this._model.mainSeries().onSymbolIntervalChanged().subscribe(this,this._onSymbolIntervalChanged)}destroy(){this._model.mainSeries().onSymbolIntervalChanged().unsubscribeAll(this),super.destroy()}pointsCount(){return 1}onData(e){super.onData(e),this._symbolIntervalChanged=!1}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(ie,e)}static studyId(){return Y(ie)}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0);return null===t?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),symbolIntervalChanged:this._symbolIntervalChanged,bar:1e3*t}}_onSymbolIntervalChanged(){this._symbolIntervalChanged=!0}}const ne="mtp_riskreward";class oe extends ee{constructor(e,t,s,i,r){super(e,t,s,ne,i,r)}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(ne,e)}static getTooltipText(e){return e&&0!==e._points.length?1===e._points.length?"Select Stop Bar":2===e._points.length?"Select Target Point":null:"Select Entry Setup Bar"}static studyId(){return Y(ne)}_studyInputs(e){(0,r.assert)(3===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0),s=this._getPointTime(e[1],!0),i=this._getPointTime(e[2],!0);return null===t||null===s||null===i?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),entry_bar:1e3*t,stop_bar:1e3*s,target_bar:1e3*i,target_price:e[2].price}}}class ae extends ee{pointsCount(){return 1}_studyInputs(e){(0,r.assert)(1===e.length,"all the line tool points should be defined");const t=this._getPointTime(e[0],!0);return null===t?(this._subscribeApplyInputsOnSeriesCompleted(),null):{...this.properties().childs().inputs.state(),bar:1e3*t}}}const le="mtp_ew_main";class ue extends ae{constructor(e,t,s,i,r){super(e,t,s,le,i,r)}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(le,e)}static studyId(){return Y(le)}}const de="mtp_ew_major";class ce extends ae{constructor(e,t,s,i,r){super(e,t,s,de,i,r)}static createProperties(e){
return super._createPropertiesFromMtpStudyShortIdAndState(de,e)}static studyId(){return Y(de)}}const pe="mtp_ew_minor";class he extends ae{constructor(e,t,s,i,r){super(e,t,s,pe,i,r)}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(pe,e)}static studyId(){return Y(pe)}}class _e extends ee{_studyInputs(e){(0,r.assert)(e.length===this.pointsCount(),"all the line tool points should be defined");const t={...this.properties().childs().inputs.state()};for(let s=0;s<this.pointsCount();++s){const i=this._getPointTime(e[s],!0);if(null===i)return this._subscribeApplyInputsOnSeriesCompleted(),null;t[`bar${s}`]=1e3*i}return t}}const ye="mtp_wpt_down1ora";class Se extends _e{constructor(e,t,s,i,r){super(e,t,s,ye,i,r)}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(ye,e)}static getTooltipText(e){return`Down Wave 1 or A: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(ye)}}const Pe="mtp_wpt_down2orb";class me extends _e{constructor(e,t,s,i,r){super(e,t,s,Pe,i,r)}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Pe,e)}static getTooltipText(e){return`Down Wave 2 or B: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Pe)}}const fe="mtp_wpt_down3";class ge extends _e{constructor(e,t,s,i,r){super(e,t,s,fe,i,r)}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(fe,e)}static getTooltipText(e){return`Down Wave 3: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(fe)}}const Ie="mtp_wpt_down4";class ve extends _e{constructor(e,t,s,i,r){super(e,t,s,Ie,i,r)}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Ie,e)}static getTooltipText(e){return`Down Wave 4: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Ie)}}const we="mtp_wpt_down5";class be extends _e{constructor(e,t,s,i,r){super(e,t,s,we,i,r)}pointsCount(){return 5}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(we,e)}static getTooltipText(e){return`Down Wave 5: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(we)}}const Ae="mtp_wpt_downc";class Ve extends _e{constructor(e,t,s,i,r){super(e,t,s,Ae,i,r)}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Ae,e)}static getTooltipText(e){return`Down Wave C: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Ae)}}const xe="mtp_wpt_up1ora";class Te extends _e{constructor(e,t,s,i,r){super(e,t,s,xe,i,r)}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(xe,e)}static getTooltipText(e){return`Up Wave 1 or A: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(xe)}}const De="mtp_wpt_up2orb";class Le extends _e{constructor(e,t,s,i,r){super(e,t,s,De,i,r)}pointsCount(){return 2}static createProperties(e){
return super._createPropertiesFromMtpStudyShortIdAndState(De,e)}static getTooltipText(e){return`Up Wave 2 or B: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(De)}}const Ce="mtp_wpt_up3";class Me extends _e{constructor(e,t,s,i,r){super(e,t,s,Ce,i,r)}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Ce,e)}static getTooltipText(e){return`Up Wave 3: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Ce)}}const Fe="mtp_wpt_up4";class Re extends _e{constructor(e,t,s,i,r){super(e,t,s,Fe,i,r)}pointsCount(){return 2}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Fe,e)}static getTooltipText(e){return`Up Wave 4: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Fe)}}const Be="mtp_wpt_up5";class Ne extends _e{constructor(e,t,s,i,r){super(e,t,s,Be,i,r)}pointsCount(){return 5}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Be,e)}static getTooltipText(e){return`Up Wave 5: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Be)}}const Ee="mtp_wpt_upc";class We extends _e{constructor(e,t,s,i,r){super(e,t,s,Ee,i,r)}pointsCount(){return 3}static createProperties(e){return super._createPropertiesFromMtpStudyShortIdAndState(Ee,e)}static getTooltipText(e){return`Up Wave C: Select Point ${(e?e._points.length:0)+1}`}static studyId(){return Y(Ee)}}var Oe=s(364615),ze=s(477227),Ue=s(444331),ke=s(616117);function $e(e){for(const t of Object.keys(e))TradingView[t]=e[t]}$e(d),$e({LineToolRegressionTrend:w,LineToolVbPFixed:b.LineToolVbPFixed,LineToolFixedRangeVolumeProfile:V,LineToolAnchoredVWAP:J}),$e(i);const je={};Object.assign(je,d);let He=null;function Ge(e,t,s){return null!==He&&He.tool===e&&He.toolData===t||(He={properties:et(e,void 0,s),tool:e,toolData:t}),He.properties}function qe(){He=null}function Ke(e){return null!==He&&He.tool===e?He.properties:null}const Xe=new Map([["LineToolPriceNote",async()=>(await Promise.all([s.e(96461),s.e(99094),s.e(56386),s.e(17862),s.e(380)]).then(s.bind(s,82618))).LineToolPriceNote],["LineToolFibSpiral",async()=>(await Promise.all([s.e(96461),s.e(99094),s.e(56386),s.e(17862),s.e(78090)]).then(s.bind(s,154628))).LineToolFibSpiral],["LineToolCircleLines",async()=>(await Promise.all([s.e(96461),s.e(99094),s.e(56386),s.e(17862),s.e(59445)]).then(s.bind(s,869523))).LineToolCyclicLines]]);async function Je(e){if(rt(e)&&await(0,m.studyMetaInfoRepository)().findAllJavaStudies(),je[e])return;if(!je.hasOwnProperty(e))return;const t=(0,r.ensureDefined)(Xe.get(e));je[e]=await t()}async function Ze(e){if(!e)return;const t=new Set;("charts"in e?e.charts:[e]).forEach((e=>{e.panes.forEach((e=>{e.sources.forEach((e=>{(0,ke.isLineToolName)(e.type)&&t.add(e.type)}))}))})),await Promise.all(Array.from(t).map((e=>Je(e))))}function Qe(e,t,s,n,o,a){let l;if((0,r.assert)((0,ke.isLineToolName)(e),"Unknown line tool: "+e),o||s||(s=Ke(e)||void 0),"LineToolVbPFixed"===e)l=new b.LineToolVbPFixed(t,s,(0,
r.ensureDefined)(n),o,a);else if("LineToolAnchoredVolumeProfile"===e)l=new Oe.LineToolAnchoredVolumeProfile(t,s,(0,r.ensureDefined)(n),o,a);else if("LineToolFixedRangeVolumeProfile"===e)l=new V(t,s,(0,r.ensureDefined)(n),o,a);else if("LineToolRegressionTrend"===e)l=new w(t,s,(0,r.ensureDefined)(n),o,a);else if("LineToolAnchoredVWAP"===e)l=new J(t,s,(0,r.ensureDefined)(n),o,a);else if(e in i){l=new((0,r.ensureDefined)(i[e]))(t,s,(0,r.ensureDefined)(n),o,a)}else{l=new((0,r.ensureDefined)(je[e]))(t,s,o,a)}return l.toolname=e,qe(),l}function Ye(e,t){const s=(0,r.ensureNotNull)(t.symbolSource()),i=s.symbolInfo(),n=i?(0,Ue.extractLineToolSymbolFromSymbolInfo)(i,s.symbol()):s.symbol();e.childs().symbol.setValue(n),s.model().currencyConversionEnabled()&&e.childs().currencyId.setValue(s.currency()),s.model().unitConversionEnabled()&&e.childs().unitId.setValue(s.unit()),e.childs().symbolStateVersion.setValue(2),e.childs().zOrderVersion.setValue(2)}function et(e,t,s,n){if((0,r.assert)((0,ke.isLineToolName)(e),`${e} should be name of the line tool`),"LineToolVbPFixed"===e)return b.LineToolVbPFixed.createProperties(s,t);if("LineToolAnchoredVolumeProfile"===e)return Oe.LineToolAnchoredVolumeProfile.createProperties(s,t);if("LineToolFixedRangeVolumeProfile"===e)return V.createProperties(s,t);if("LineToolRegressionTrend"===e)return w.createProperties(s,t);if("LineToolAnchoredVWAP"===e)return J.createProperties(s,t);if(e in i){return(0,r.ensureDefined)(i[e]).createProperties(t)}return(0,r.ensureDefined)(je[e]).createProperties(t,n)}function tt(e,t,s,n,o){if((0,r.assert)((0,ke.isStudyLineToolName)(e),`${e} should be name of the study line tool`),"LineToolVbPFixed"===e)return b.LineToolVbPFixed.createPropertiesFromStudyMetaInfoAndState(t,s,n,o);if("LineToolAnchoredVolumeProfile"===e)return Oe.LineToolAnchoredVolumeProfile.createPropertiesFromStudyMetaInfoAndState(t,s,n,o);if("LineToolFixedRangeVolumeProfile"===e)return V.createPropertiesFromStudyMetaInfoAndState(t,s,n,o);if("LineToolRegressionTrend"===e)return w.createRegressionTrendPropertiesFromStudyMetaInfoAndState(t,s,n,o);if("LineToolAnchoredVWAP"===e)return J.createPropertiesFromStudyMetaInfoAndState(t,s,n,o);if(e in i){return(0,r.ensureDefined)(i[e]).createPropertiesFromStudyMetaInfoAndState(t,s,n,o)}throw new Error(`Property creation is not implemented for study line tool ${e}`)}function st(e){(0,r.assert)((0,ke.isLineToolName)(e),`${e} should be name of the line tool`);const t=d[e];return void 0!==t&&Boolean(t.supportPhantomMode)}function it(e){return e instanceof l.LineDataSource}function rt(e){return e instanceof a.StudyLineDataSource}function nt(e){return e instanceof ze.LineToolTrading}function ot(e){let t=null;if(e===w.studyId()?t="LineToolRegressionTrend":e===b.LineToolVbPFixed.studyId()?t="LineToolVbPFixed":e===V.studyId()&&(t="LineToolFixedRangeVolumeProfile"),null===t)for(const t in i)if(i[t].studyId()===e)return t;return t}function at(e,t,s,i){const a=t.toolname,l=t.properties().state();l.intervalsVisibilities=(0,
o.mergeIntervalVisibilitiesDefaults)(null==l?void 0:l.intervalsVisibilities);const u=et(t.toolname,l,e);u.childs().visible.setValue(!0);const d=(0,r.ensureNotNull)(t.ownerSource()),c=Qe(a,e,u);void 0!==i&&c.setId(i),c.setOwnerSource(d),c.toolname=a;const p=c.clonePositionOffset();if(t.isFixed()){const e=(0,r.ensureDefined)(t.fixedPoint()),i=s?e.add(new n.Point(p.xCoordOffset,p.yCoordOffset)):e;c.addFixedPoint(i)}const h=t.normalizedPoints(),_=s?function(e,t,s){const i=(0,r.ensureNotNull)(t.priceScale()),n=(0,r.ensureNotNull)(t.firstValue());return e.map((e=>{const t=e.price,r=i.priceToCoordinate(t,n)+s.yCoordOffset,o=i.coordinateToPrice(r,n);return{time_t:e.time_t,price:o,offset:e.offset+s.barOffset}}))}(h,d,p):h,y=t.points();return c.restorePoints(_,y),c.cloneData&&c.cloneData(t),c.recalculateStateByData&&c.recalculateStateByData(),c}function lt(e,t){var s;return null!==(s=e.dataSources().find((e=>it(e)&&e.linkKey().value()===t)))&&void 0!==s?s:null}},806960:(e,t,s)=>{s.d(t,{StudyLineDataSourceWithPlots:()=>a});var i=s(203308),r=s(650151),n=s(2122),o=s(534741);class a extends n.StudyLineDataSource{lastValueData(e,t,s){const n={noData:!0},a=this.priceScale();if(this._model.timeScale().isEmpty()||null===this.priceScale()||null===a||a.isEmpty()||this.plots().isEmpty())return n;const l=this._model.timeScale().visibleBarsStrictRange();if(null===l)return n;const u=this._studyProps();if(!u.childs().visible.value())return n;const d=this.plots().search(l.lastBar(),o.PlotRowSearchMode.NearestLeft,1);if(null===d)return n;const c=l.contains(d.index),p=!t&&c?d:(0,r.ensureNotNull)(this.plots().last()),h=this.metaInfo().plots.findIndex((t=>t.id===e));if(h<0||!p||!(0,i.default)(p.value[h+1]))return n;const _=p.value[h+1];if(null==_)return n;const y=(0,r.ensureDefined)(u.childs().styles.child(e)),S=(0,r.ensureNotNull)(this.firstValue()),P=a.priceToCoordinate(_,S);return{...a.getFormattedValues(_,S),noData:!1,price:_,color:y.childs().color.value(),coordinate:P,floatCoordinate:P,index:p.index}}priceLabelText(e){const t=(0,r.ensureDefined)(this._metaInfo.styles);return(0,r.ensureDefined)(t[e]).title}offset(e){return 0}getMinFirstBarIndexForPlot(){return-1/0}isPlotVisibleAt(e,t){return(this._studyProps().childs().styles.childs()[e].childs().display.value()&t)===t}_studyProps(){return this.properties()}}},2122:(e,t,s)=>{s.d(t,{StudyLineDataSource:()=>b});var i=s(650151),r=s(389137),n=s(195447),o=s(875409),a=s(853965),l=s(526075),u=s(484812),d=s(62745),c=s(114315),p=s(799567),h=s(989709),_=s(807218),y=s(988124),S=s(242558),P=s(964824),m=s(504101),f=s(985715);class g extends f.StatusProviderBase{constructor(e){super(e.model().properties().childs().scalesProperties.childs().textColor),this._source=e}color(){return"#ff0000"}errorStatus(){const e=this._source.status();return e.type===m.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,m.studyStatusSolutionId)(e),title:(0,m.studyStatusTitle)(e),studyFeature:(0,m.studyStatusFeature)(e)}:null}getSplitTitle(){return this._source.titleInParts()}text(){
return this._source.translatedType()}sourceStatusText(){return(0,m.convertStudyStatusToString)(this._source.status(),!0)}}var I=s(572230),v=s(833642);class w extends v.StatusView{constructor(e){super(e.statusProvider({}))}getSplitTitle(){return this._statusProvider.getSplitTitle()}}class b extends o.LineDataSource{constructor(e,t,i,r,n,o){super(e,r,n,o),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._isLegendDisplayed=!1,this._alignerCache=null,Promise.all([Promise.all([s.e(88548),s.e(42244),s.e(6744),s.e(17862),s.e(13207),s.e(51583)]).then(s.bind(s,67663)),Promise.all([s.e(88548),s.e(42244),s.e(6744),s.e(17862),s.e(13207),s.e(51583)]).then(s.bind(s,199258))]).then((t=>{const{LineToolBeingCreatedPaneView:s}=t[0],{StudyLineDataSourceAnchorsPaneView:i}=t[1];this._beingCreatedPaneView=new s(this,e),this._anchorsPaneView=new i(this,this.model()),this._model.lightUpdate()})),this._metaInfo=t,this._dataSource=new c.ExtendedStudyDataSource(e.chartApi(),e.mainSeries(),i,t),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated),this._dataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._statusProvider=new g(this),this._statusView=new w(this),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments}isDisplayedInLegend(){return this._isLegendDisplayed}titleInParts(){const e=[];if(this._showStudyArgumentsProperty.value()&&this._inputs)for(const t of this._metaInfo.inputs){if(!0===t.isHidden||"bool"===t.type)continue;const s=this._inputs[t.id];e.push(s.toString())}return[this.name(),e]}destroy(){this._dataSource.dataUpdated().unsubscribeAll(this),this._dataSource.dataCleared().unsubscribeAll(this),this._dataSource.studyStatusChanged().unsubscribeAll(this),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._isDestroyed||(this._dataSource.stop(),this.clearData())}start(){super.start(),this._isDestroyed||null===this._inputs||this._dataSource.start()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(e,t,s){super.setPoint(e,this._preparePoint(t,s))}move(e){}clearData(){this._clearAllDataExceptPointsetPoints(),this._pointsetPoints=null,this.updateAllViews((0,P.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),super.clearData()}data(){return this.plots()}plots(){return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}valueAt(e,t){var s,i
;return null!==(i=null===(s=this.ownerSource())||void 0===s?void 0:s.symbolSource().valueAt(e,t))&&void 0!==i?i:null}firstValue(){return this._model.mainSeries().firstValue()}state(e){const t=super.state(e);let s;this.metaInfo()instanceof l.StudyMetaInfo?s=this.metaInfo().state():(s=(0,r.clone)(this.metaInfo()),s.id=l.StudyMetaInfo.parseIdString(s.id+(s.version?"-"+s.version:"")).fullId);const i={...t,metaInfo:s};return e&&(i.data=this.plots().state(),i.nonseriesindexes=this._indexes,i.graphics=(0,u.saveStudyGraphics)(this.graphics(),null)),i}restoreData(e){var t;void 0!==e.data&&(this._loadedPlots=new n.PlotList((0,h.studyPlotFunctionMap)(this._metaInfo),h.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(e.data)),this._indexes=null!==(t=e.nonseriesindexes)&&void 0!==t?t:this._indexes,this._loadedGraphics=e.graphics?(0,u.loadStudyGraphics)(e.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then((e=>null===e||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new e(this._model.undoModel(),this)),this._definitionsViewModel))):Promise.resolve(this._definitionsViewModel)}paneViews(e){let t=[];if(this.isSourceHidden())return t;if(this._isReady()&&this._changeStatesStack.isEmpty()){const s=super.paneViews(e);null!==s&&(t=t.concat(s))}else null!==this._beingCreatedPaneView&&t.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&t.push(this._anchorsPaneView),t}propertiesChanged(e){super.propertiesChanged(e),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(e,t){const s=super.endChanging(e,t);return s.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),s}moveData(e){this._dataSource.moveData(e)}restorePoints(e,t,s){super.restorePoints(e,t,s),this._updateAnchorsPrice(!0)}realign(){super.realign(),null===this._model.mainSeries().symbolInfo()&&(this._alignerCache=null)}statusProvider(e){return this._statusProvider}statusView(){return this._statusView}legendView(){return null}dataProblemModel(){return null}dataUpdatedModeModel(){return null}marketStatusModel(){return null}onStatusChanged(){return this._dataSource.studyStatusChanged()}status(){return this._dataSource.studyStatus()}recalcStudyIfNeeded(){}static createPropertiesFromStudyMetaInfoAndState(e,t,s,i){const r=(0,_.prepareStudyPropertiesForLoadChart)(e,t,s,i);return this._configureProperties(r),r}_onStudyStatusChanged(e,t){let s;switch(t.type){case p.StudyStatusType.Error:s=!0;break;case p.StudyStatusType.Completed:s=!1;break;default:return}if(s===this._isLegendDisplayed)return;this._isLegendDisplayed=s;const i=this._model.paneForSource(this);if(i){const e=this._model.panes().indexOf(i),t=I.InvalidationMask.invalidateLegendWidgetLayout(e);this.model().invalidate(t)}}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(e){var t,s;super._updateAllPaneViews(e),
null===(t=this._beingCreatedPaneView)||void 0===t||t.update(),null===(s=this._anchorsPaneView)||void 0===s||s.update(e)}_getPointTime(e,t){const s=e.index,i=this._model.timeScale().indexToTimePoint(s);if(null!==i)return i;if(t||void 0===e.time)return null;const r=this._model.mainSeries().symbolInfo();if(null===r)return null;let n=this._model.properties().childs().timezone.value();"exchange"===n&&(n=r.timezone);const o=(0,y.cal_to_utc)((0,y.get_timezone)(n),e.time);return this._getStartBarAligner()(o)/1e3}_updateAnchorsPrice(e){}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._pointsetPoints=this._points.map((e=>({price:e.price,index:e.index,time:e.time}))),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews((0,P.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this._model.updateSource(this)}_onDataUpdated(e,t,s){var i;this._updateAnchorsPrice(),this.updateAllViews((0,P.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:null===(i=e[0])||void 0===i?void 0:i.index})),this._model.updateSource(this)}_onStudyInputsMayChange(){let e=null;if(null!==this._pointsetPoints&&this._pointsetPoints.length===this.pointsCount()&&(e=this._studyInputs(this._pointsetPoints),null===e&&(this._clearAllDataExceptPointsetPoints(),this.updateAllViews((0,P.sourceChangeEvent)(this.id())))),null!==e){const t=this.metaInfo().inputs.map((e=>e.id)),s=Object.keys(e);for(const i of s)t.includes(i)||delete e[i]}this._areInputsEqual(this._inputs,e)||this._applyStudyInputs(e)}_preparePoint(e,t){return super._preparePoint(this._alignPointToRangeOfActualData(e),t)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,(()=>this._onStudyInputsMayChange()),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){this.hasAlert().value()&&(this._localAndServerAlertsMismatch=!0)}static _createPropertiesFromStudyIdAndState(e,t){const s=l.StudyMetaInfo.getStudyPropertyRootNameById(e),i=new a.DefaultProperty(s,t);return this._configureProperties(i),i}static _configureProperties(e){super._configureProperties(e),e.removeExclusion("intervalsVisibilities")}_areInputsEqual(e,t){return null===t?null===e:null!==e&&(0,d.areStudyInputsEqual)(this._metaInfo.inputs,e,t)}_applyStudyInputs(e){const t=this._inputs;this._inputs=e,null!==e&&(this._unsubscribeApplyInputsOnSeriesCompleted(),this._dataSource.setInputs(e),null===t&&this.isStarted()&&!this._dataSource.isStarted()&&this._dataSource.start()),this._onInputsChanged()}_clearAllDataExceptPointsetPoints(){this._inputs=null,this._dataSource.clearData(),this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null}_getStartBarAligner(){const e=this._model.mainSeries().interval();return null!==this._alignerCache&&this._alignerCache.resolution===this._model.mainSeries().interval()||(this._alignerCache={resolution:e,aligner:(0,
S.createTimeToBarTimeAligner)(e,(0,i.ensureNotNull)(this._model.mainSeries().symbolInfo()))}),this._alignerCache.aligner}}},224153:(e,t,s)=>{s.d(t,{LineToolVbPFixed:()=>m});var i=s(277973),r=s(650151),n=s(827523),o=s(526075),a=s(2122),l=s(484812),u=s(268008),d=s(964824),c=s(389137),p=s(853965),h=s(807218),_=s(347710);const y=(0,n.studyIdString)("VbPFixed","tv-volumebyprice");function S(e,t,s,i){return t.styles&&(P(t.styles.developingPoc),P(t.styles.developingVAHigh),P(t.styles.developingVALow)),t}function P(e){void 0!==e&&void 0!==e.visible&&(e.display=e.visible?15:0,delete e.visible)}class m extends a.StudyLineDataSource{constructor(e,t,s,i,r){super(e,s||(0,_.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:y}),"vbpfixed_",null!=t?t:m.createProperties(e),i,r),this._createPaneViews().then((e=>{this._setPaneViews(e),e.forEach((e=>e.update((0,d.sourceChangeEvent)({sourceId:this.id(),clearData:!0}))))})),this.clearData()}pointsCount(){return 2}boundToSymbol(){return!1}offset(e){return 0}getMinFirstBarIndexForPlot(){return-1/0}calcIsActualSymbol(){this._isActualSymbol=!0,this._isActualCurrency=!0,this._isActualUnit=!0,this.calcIsActualInterval()}cloneable(){return!1}isSynchronizable(){return!1}isPlotVisibleAt(e,t){return(this.properties().childs().styles.childs()[e].childs().display.value()&t)===t}preferredZOrder(){return 0}static createProperties(e,t){const s=o.StudyMetaInfo.getStudyPropertyRootNameById(y),i=(0,r.ensureNotNull)((0,_.studyMetaInfoRepository)().findByIdSync({type:"java",studyId:y})),n=(0,p.createDefaultsState)(!0,s,[],e.studyVersioning());return this.createPropertiesFromStudyMetaInfoAndState(i,i,(0,c.merge)((0,c.clone)(n),null!=t?t:{}),e.studyVersioning())}static createPropertiesFromStudyMetaInfoAndState(e,t,s,i){const r=(0,h.prepareStudyPropertiesForLoadChart)(e,t,s,i,S);return this._configureProperties(r),r}static studyId(){return y}_studyInputs(e){(0,r.assert)(2===e.length,"all the line tool points should be defined");const[t,s]=e,i=Math.max(t.index,s.index),n=this._model.mainSeries().bars().lastIndex(),o=this._getPointTime(t.index<=s.index?t:s,!0),a=this._getPointTime(s.index>=t.index?s:t,!0);if(null===o||null===a)return this._subscribeApplyInputsOnSeriesCompleted(),null;return{...this.properties().childs().inputs.state(),first_bar_time:1e3*o,last_bar_time:1e3*a,subscribeRealtime:n===i,mapRightBoundaryToBarStartTime:!!this._needExtendToBarsEnding()||void 0}}_isReady(){return!(0,l.isStudyGraphicsEmpty)(this.graphics())}async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([s.e(88601),s.e(96461),s.e(43474),s.e(68855),s.e(99094),s.e(56386),s.e(47924),s.e(60607)]).then(s.bind(s,762155))).StudyLineDataSourceDefinitionsViewModel}_onDataUpdated(){this._updateAnchors(),this.updateAllViews((0,d.sourceChangeEvent)(this.id())),this._model.updateSource(this)}_updateAnchors(){const e=this._calculateAnchors();if(!e)return;const[{index:t,price:s},{index:i,price:r}]=e;if(this._timePoint.length&&(this._timePoint[0].price=s,this._timePoint[1].price=r),this._points.length){
const e=this.model().timeScale(),n=e.indexToTimePoint(t),o=e.indexToTimePoint(t);this._points[0]={index:t,price:s,time:(0,c.isNumber)(n)?new Date(1e3*n):void 0},this._points[1]={index:i,price:r,time:(0,c.isNumber)(o)?new Date(1e3*o):void 0}}}_calculateAnchors(){let e=null,t=null,s=null,r=null;if(this.graphics().hhists().forEach((i=>{i.forEach((i=>{const{priceLow:n,priceHigh:o,firstBarTime:a,lastBarTime:l}=i;(!e||n<e)&&(e=n),(!t||o>t)&&(t=o),(!s||a<s)&&(s=a),(!r||l>r)&&(r=l)}))})),!((0,i.default)(e)||(0,i.default)(t)||(0,i.default)(r)||(0,i.default)(s)))return[{price:t,index:s},{price:e,index:r}]}_updateAnchorsPrice(){const e=this._calculateAnchors();if(!e)return;const[{price:t},{price:s}]=e;this._timePoint.length&&(this._timePoint[0].price=t,this._timePoint[1].price=s),this._points.length&&(this._points[0].price=t,this._points[1].price=s)}async _createPaneViews(){var e;const t=this._metaInfo,i=t.graphics,r=[],n=this._needExtendToBarsEnding();if(i.hhists){const{HHistPaneView:t}=await Promise.all([s.e(13207),s.e(20507)]).then(s.bind(s,670751)),i=null===(e=this.properties().childs().graphics.childs().polygons)||void 0===e?void 0:e.childs();r.push(new t(this,this._model,void 0,null==i?void 0:i.histBoxBg,n))}if(i.horizlines){const{HorizLinePaneView:e}=await Promise.all([s.e(13207),s.e(20507)]).then(s.bind(s,722669));r.push(new e(this,this._model,void 0,n))}return t.plots.length>0&&r.push(this._createStudyPlotPaneView(t.plots[0].id,n)),t.plots.length>1&&r.push(this._createStudyPlotPaneView(t.plots[1].id,n)),t.plots.length>2&&r.push(this._createStudyPlotPaneView(t.plots[2].id,n)),r}_createStudyPlotPaneView(e,t){return new u.StudyPlotPaneView(this,this._model.mainSeries(),this._model,e,t)}_needExtendToBarsEnding(){var e;return void 0!==(null===(e=this.metaInfo().defaults.inputs)||void 0===e?void 0:e.mapRightBoundaryToBarStartTime)}}},342308:(e,t,s)=>{s.d(t,{PaneRendererClockIcon:()=>o});var i=s(315801),r=s(710455);const n=Math.sqrt(3);class o extends r.MediaCoordinatesPaneRenderer{constructor(e){super(),this.update(e)}update(e){var t;const s=e.points[0],i=null!==(t=e.points[1])&&void 0!==t?t:e.points[0],r=s.x-i.x,o=s.y-i.y;let a=e.horzMargin;void 0===a&&(a=r>0?10:-25),this._x=s.x+a,this._y=s.y+(0!==o&&Math.abs(r)*n<=Math.abs(o)?-7:o>0?-25:11),this._color=e.color}hitTest(e){return e.x<this._x||e.x>this._x+16||e.y<this._y||e.y>this._y+16?null:new i.HitTestResult(i.HitTarget.Regular)}_drawImpl(e){const t=e.context;t.translate(this._x-.5,this._y-.5),t.beginPath(),t.arc(8,9,6,0,2*Math.PI,!0),t.closePath(),t.moveTo(8,9),t.arc(8.5,5.5,.5,Math.PI,0),t.lineTo(9,10),t.arc(5.5,9.5,.5,.5*Math.PI,1.5*Math.PI),t.closePath(),t.moveTo(1.71,5.93),t.bezierCurveTo(-.61,2.83,3.86,-.76,6.39,2.18),t.bezierCurveTo(4.35,2.67,2.63,4.04,1.71,5.93),t.closePath(),t.moveTo(14.29,5.93),t.bezierCurveTo(16.61,2.83,12.14,-.76,9.61,2.18),t.bezierCurveTo(11.65,2.67,13.37,4.04,14.29,5.93),t.fillStyle=this._color,t.fill()}}},329007:(e,t,s)=>{var i;s.d(t,{Constants:()=>i}),function(e){e.DrawingIconColor="rgba( 170, 170, 170, 1)"}(i||(i={}))}}]);