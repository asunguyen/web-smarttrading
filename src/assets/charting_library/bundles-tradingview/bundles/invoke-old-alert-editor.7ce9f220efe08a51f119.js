"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[22172],{359663:(e,t,n)=>{n.d(t,{FeatureToggleWatchedValue:()=>r});var i=n(125226),o=n(129025);class r extends o.WatchedValue{constructor(e,t){super(function(e,t){return(0,i.isFeatureEnabled)(e)}(e)),(0,i.onFeaturesStateChanged)().subscribe(this,(t=>{e===t&&this.setValue((0,i.isFeatureEnabled)(e))}))}destroy(){(0,i.onFeaturesStateChanged)().unsubscribeAll(this),super.destroy()}}},799402:(e,t,n)=>{n.d(t,{AuthToken:()=>a});var i=n(707957),o=n(201089),r=n(120780);const s=(0,o.getLogger)("ChartApi.AuthToken",{color:"#173"});class a{constructor(){this.invalidated=new i.Delegate,this._tid=0,window.loginStateChange||(window.loginStateChange=new i.Delegate),window.loginStateChange.subscribe(this,(e=>{e||(this._set(window.user.auth_token),this.invalidated.fire())})),this._set(window.user.auth_token)}get(e){return window.is_authenticated?!e&&performance.now()<this._cache.monoValidThru&&Date.now()<this._cache.wallValidThru?(s.logInfo(`Using cached token ${this._cache.token}`),Promise.resolve(this._cache.token)):this._fetch(Boolean(e),0).then((e=>{if(!window.is_authenticated)throw new Error("User logged out while the request was in flight");return this._set(e),e})).catch((e=>(s.logError(`Error fetching new token: ${e&&e.message}`),""))):Promise.resolve("")}reset(){this._set(void 0),this.invalidated.fire()}_set(e){if(window.is_authenticated&&void 0!==e){const t=function(e){if(""===e)return 144e5;try{const t=JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))),n=1e3*(t.exp-t.iat);if(!isFinite(n))throw new Error("invalid expiration");return Math.max(n-3e5,3e5)}catch(t){return s.logError(`${e} is invalid: ${t.message}`),144e5}}(e);this._cache={token:e,monoValidThru:performance.now()+t,wallValidThru:Date.now()+t},clearTimeout(this._tid),this._tid=setTimeout((()=>this.reset()),t),s.logInfo(`Cached for ${t} ms: ${e}`)}else this._cache={token:"",monoValidThru:-1/0,wallValidThru:-1/0},clearTimeout(this._tid),s.logInfo("Cache dropped")}_fetch(e,t){return s.logNormal(`Fetching a new token, grabSession=${e}`),(0,r.fetch)("/quote_token/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e?"grabSession=true":""}).then((e=>{if(!e.ok)throw new Error(`Response status is not ok: ${e.status}`);return e.json().then(String)}),(n=>{if(t>=3)throw n;return s.logWarn("Request failed, will retry"),function(e){return new Promise((t=>setTimeout(t,1e3*e)))}(t).then((()=>this._fetch(e,t+1)))}))}}},394093:(e,t,n)=>{var i;n.d(t,{AlertEditorAbortReason:()=>i}),function(e){e.AlertIsInvalid="alert-is-invalid",e.AlertsMaintenance="alerts-maintenance",e.ChartModelNotFound="chart-model-not-found",e.IsAlreadyPresent="is-already-present",e.MainSeriesIsATR="main-series-is-atr",e.MainSeriesIsInReplay="main-series-is-in-replay",e.MainSeriesIsOffline="main-series-is-offline",e.SourceIsDangerous="source-is-dangerous",e.SymbolInfoTimeout="symbol-info-timeout",e.SymbolIsInvalid="symbol-is-invalid",
e.SymbolCurrencyConverted="symbol-currency-converted",e.SymbolUnitConverted="symbol-unit-converted",e.SymbolCurrencyAndUnitConverted="symbol-currency-and-unit-converted",e.SymbolIsEconomics="symbol-is-economics",e.UnsupportedResolution="unsupported-resolution",e.ManualAbort="manual-abort",e.MisleadingPriceScale="misleading-price-scale",e.ResolutionIsTicks="resolution-is-ticks"}(i||(i={}))},862297:(e,t,n)=>{n.d(t,{ensureResolvedSymbolInfo:()=>g,ensureSeriesIsNotOffline:()=>m,getAlertDialogType:()=>v,shouldAbortAlertEditor:()=>f,showAbortExplainingDialog:()=>A});var i=n(444372),o=n(779923),r=n(394093),s=n(444331),a=n(223699),l=n(583912),u=n(537133),c=n(781310),d=n(552279);const h=(0,n(594949).getAlertsTrackers)().maintenance;function v(e){return e.alert?e.type||"edit_alert":"create_alert"}function f(e){var t;if(h.value())return r.AlertEditorAbortReason.AlertsMaintenance;if(!e.alert&&!e.dataSourceHub)return r.AlertEditorAbortReason.ChartModelNotFound;if(!u.alertEditorInvocationHandler.isAllowedToInvoke(e))return r.AlertEditorAbortReason.IsAlreadyPresent;const n=null===(t=e.dataSourceHub)||void 0===t?void 0:t.mainSeries();if(n&&b(n))return r.AlertEditorAbortReason.MainSeriesIsOffline;if(n&&function(e){return 4===e.status()}(n))return r.AlertEditorAbortReason.SymbolIsInvalid;if(n&&n.isConvertedToOtherCurrency()&&n.isConvertedToOtherUnit())return r.AlertEditorAbortReason.SymbolCurrencyAndUnitConverted;if(n&&n.isConvertedToOtherCurrency())return r.AlertEditorAbortReason.SymbolCurrencyConverted;if(n&&n.isConvertedToOtherUnit())return r.AlertEditorAbortReason.SymbolUnitConverted;const i=v(e);if("create_alert"===i&&n&&function(e){const t=e.stateForAlert().styleInputs;return"style"in t&&"ATR"===t.style}(n))return r.AlertEditorAbortReason.MainSeriesIsATR;if("create_alert"===i&&n&&function(e){return e.isInReplay()}(n))return r.AlertEditorAbortReason.MainSeriesIsInReplay;if("create_alert"===i&&n&&function(e){return(0,s.isEconomicSymbol)(e.symbolInfo())}(n))return r.AlertEditorAbortReason.SymbolIsEconomics;const o=n?n.interval():l.linking.interval.value();return"create_alert"===i&&a.Interval.isTicks(o)?r.AlertEditorAbortReason.ResolutionIsTicks:"create_alert"!==i||(0,c.canPlaceAlertOnResolution)(o)?null:r.AlertEditorAbortReason.UnsupportedResolution}function b(e){return 0===e.status()}function A(e,t){if(_.has(e))return;_.add(e);const s=()=>_.delete(e),a=function(e){return new Map([[r.AlertEditorAbortReason.UnsupportedResolution,"alertsOnSeconds"]]).get(e)||null}(e);if(a)return void(0,d.reloginOrGoPro)({feature:a,actionAfterClose:s});const l=function(e,t){const o=i.t(null,void 0,n(900850)),s=i.t(null,void 0,n(488322)),a=i.t(null,void 0,n(468988));return new Map([[r.AlertEditorAbortReason.AlertsMaintenance,{title:i.t(null,void 0,n(243322)),text:i.t(null,void 0,n(98333)),buttonText:a}],[r.AlertEditorAbortReason.MainSeriesIsOffline,{title:o,text:("create_alert"===t?i.t(null,void 0,n(680644)):i.t(null,void 0,n(878717)))+". "+i.t(null,void 0,n(443167))+".",buttonText:a}],[r.AlertEditorAbortReason.SymbolIsInvalid,{title:o,
text:"create_alert"===t?i.t(null,void 0,n(396472)):i.t(null,void 0,n(601230)),buttonText:a}],[r.AlertEditorAbortReason.SymbolCurrencyAndUnitConverted,{title:i.t(null,void 0,n(535871)),text:"create_alert"===t?i.t(null,void 0,n(39546)):i.t(null,void 0,n(588989)),buttonText:i.t(null,void 0,n(875139))}],[r.AlertEditorAbortReason.SymbolCurrencyConverted,{title:i.t(null,void 0,n(203470)),text:"create_alert"===t?i.t(null,void 0,n(499303)):i.t(null,void 0,n(8180)),buttonText:i.t(null,void 0,n(875139))}],[r.AlertEditorAbortReason.SymbolUnitConverted,{title:i.t(null,void 0,n(806212)),text:"create_alert"===t?i.t(null,void 0,n(433335)):i.t(null,void 0,n(615119)),buttonText:i.t(null,void 0,n(875139))}],[r.AlertEditorAbortReason.SymbolIsEconomics,{title:i.t(null,void 0,n(282076)),text:i.t(null,void 0,n(914407)),buttonText:i.t(null,void 0,n(875139))}],[r.AlertEditorAbortReason.MainSeriesIsATR,{title:i.t(null,void 0,n(347599)),text:i.t(null,void 0,n(862688)),buttonText:a}],[r.AlertEditorAbortReason.MainSeriesIsInReplay,{title:i.t(null,void 0,n(198447)),text:i.t(null,void 0,n(881565)),buttonText:i.t(null,void 0,n(875139))}],[r.AlertEditorAbortReason.ResolutionIsTicks,{title:i.t(null,void 0,n(915469)),text:i.t(null,void 0,n(867501)),buttonText:i.t(null,void 0,n(875139))}]]).get(e)||{title:o,text:s,buttonText:a}}(e,t);(0,o.showWarning)({...l,onClose:s})}const _=new Set;function m(e){return new Promise((t=>{if(!b(e))return void t();const n=()=>{b(e)||(e.onStatusChanged().unsubscribe(null,n),t())};e.onStatusChanged().subscribe(null,n)}))}function g(e){return new Promise((t=>{if(e.symbolInfo())return void t();e.dataEvents().symbolResolved().subscribe(null,(()=>{e.symbolInfo()&&t()}),!0)}))}},429589:(e,t,n)=>{n.r(t),n.d(t,{invokeAlertEditor:()=>v,invokeAlertEditorWithOnlineSeries:()=>b});var i=n(650151),o=n(862297),r=n(949307),s=n(394093),a=n(726778),l=n(201089),u=n(125226),c=n(537133),d=n(206242);const h=(0,l.getLogger)("Alerts.Price.InvokeAlertEditor");function v(e){(0,d.getAlertsTrackers)().maintenance.syncOnUserAction();const t=(0,o.shouldAbortAlertEditor)(e);if(null!==t)return t!==s.AlertEditorAbortReason.IsAlreadyPresent&&(0,o.showAbortExplainingDialog)(t,(0,o.getAlertDialogType)(e)),h.logWarn(`Aborted: ${t}`),void(e.onAborted&&e.onAborted(t));const{unlockInvocation:a,abortSignal:l}=c.alertEditorInvocationHandler.lockInvocation(e);!(0,u.isFeatureEnabled)("alerts-editor-use-facade")||e.silent?Promise.all([Promise.resolve().then(n.bind(n,908287)),Promise.all([n.e(68716),n.e(46574),n.e(16392),n.e(56122),n.e(24028),n.e(25977),n.e(68647),n.e(62750),n.e(42292),n.e(88124),n.e(44581),n.e(3657),n.e(47944),n.e(41339),n.e(73017),n.e(17540),n.e(1335),n.e(38617),n.e(15716),n.e(93202),n.e(60273)]).then(n.t.bind(n,612708,19)),(0,r.getPriceAlertsDispatcher)(),f(e,a,l)]).then((async e=>{const[{getAlertSession:t},{AlertEditor:n},o,r]=e,s=(0,i.ensureNotNull)(t().user.value());await s.twoFactorTracker.sync(),new n(o,r)
}),a):Promise.all([Promise.resolve().then(n.bind(n,908287)),Promise.all([n.e(68716),n.e(46574),n.e(16392),n.e(2741),n.e(56122),n.e(39774),n.e(22666),n.e(5993),n.e(62253),n.e(92191),n.e(34465),n.e(32109),n.e(72639),n.e(9817),n.e(69121),n.e(53842),n.e(4015),n.e(92108),n.e(88194),n.e(87845),n.e(89842),n.e(48986),n.e(68992),n.e(93502),n.e(81643),n.e(13152),n.e(36884),n.e(5145),n.e(38669),n.e(84281),n.e(63987),n.e(3436),n.e(73954),n.e(34545),n.e(49205),n.e(6209),n.e(47981),n.e(90592),n.e(60123),n.e(22486),n.e(47047),n.e(89434),n.e(18511),n.e(24028),n.e(26053),n.e(17301),n.e(75058),n.e(52455),n.e(99872),n.e(19512),n.e(50487),n.e(962),n.e(62750),n.e(42292),n.e(88124),n.e(68985),n.e(44581),n.e(3657),n.e(47944),n.e(41339),n.e(73017),n.e(17540),n.e(1335),n.e(38617),n.e(95216),n.e(76317),n.e(15716),n.e(80018),n.e(18118),n.e(93202),n.e(77895)]).then(n.bind(n,370495)),f(e,a,l)]).then((async([{getAlertSession:e},{invokeDialogAlertEditor:t},n])=>{const o=(0,i.ensureNotNull)(e().user.value());await o.twoFactorTracker.sync(),t(n,o)}),a)}function f(e,t,n){return(e.series?(0,a.hasUserAccessToDataSource)(e.series):Promise.resolve(!0)).then((i=>{const{onDestroy:o}=e,r={...e,abortSignal:n,onDestroy:()=>{t(),o&&o()}};return i||(delete r.series,delete r.value),r}))}function b(e){e.dataSourceHub?(0,o.ensureSeriesIsNotOffline)(e.dataSourceHub.mainSeries()).then((()=>{v(e)})):v(e)}},537133:(e,t,n)=>{n.d(t,{ALERT_DIALOG_CREATE_INVOCATION_ID:()=>s,alertEditorInvocationHandler:()=>l});var i=n(650151),o=n(129025),r=n(862297);const s=-1;class a{constructor(){this._state=new o.WatchedValue(!1)}subscribe(e){this._state.subscribe(e)}unsubscribe(e){this._state.unsubscribe(e)}value(){return this._state.value()}abort(){this._state.setValue(!0)}}const l=new class{constructor(){this._dialogInvocations=new o.WatchedValue(new Map)}getDialogInvocations(){return this._dialogInvocations}isAllowedToInvoke(e){return e.silent||!this._dialogInvocations.value().has(u(e))}lockInvocation(e){if(e.silent)return{unlockInvocation:()=>{}};const t=u(e),n=new a,i=new Map(this._dialogInvocations.value());return i.set(t,n),this._dialogInvocations.setValue(i),{abortSignal:n,unlockInvocation:()=>{const e=new Map(this._dialogInvocations.value());e.delete(t),this._dialogInvocations.setValue(e)}}}};function u(e){return"create_alert"===(0,r.getAlertDialogType)(e)?s:(0,i.ensureDefined)(e.alert).id}},726778:(e,t,n)=>{function i(e){return r().then((t=>t.hasUserAccessToDataSource(e)))}function o(e){return r().then((t=>t.filterAccessibleDataSources(e)))}n.d(t,{filterAccessibleDataSources:()=>o,hasUserAccessToDataSource:()=>i});const r=()=>Promise.all([n.e(68716),n.e(46574),n.e(24028),n.e(87896),n.e(42292),n.e(88124),n.e(44581),n.e(3657),n.e(41339),n.e(73017),n.e(95503),n.e(83441)]).then(n.bind(n,827019))},781310:(e,t,n)=>{n.d(t,{canPlaceAlertOnResolution:()=>o.canPlaceAlertOnResolution,isAlertResolutionEqual:()=>r,isWidgetAlertResolutionEqual:()=>s});var i=n(223699),o=n(695242);function r(e,t){return e.get("crossInterval")||i.Interval.isEqual(e.get("resolution"),t)}function s(e,t){
return e.crossInterval||i.Interval.isEqual(e.resolution,t)}},594949:(e,t,n)=>{n.d(t,{getAlertSession:()=>i.getAlertSession,getAlertsTrackers:()=>o.getAlertsTrackers});var i=n(908287),o=n(206242)},206242:(e,t,n)=>{n.r(t),n.d(t,{getAlertsTrackers:()=>u});var i=n(895171),o=n(359663),r=(n(659863),n(694839)),s=n(129025);class a{constructor(e,t){this._unsetMaintenanceTimeoutId=null,this._onAliveMaintenanceChange=e=>{if(e)this._clearMaintenanceUnsetTimeout(),this._lastMaintenanceUnsetReason=null,this._state.setValue(!0);else if(this._config.autoUnsetMaintenanceTimeout){const e=this._config.autoUnsetMaintenanceTimeout;this._unsetMaintenanceTimeoutId=setTimeout((()=>this._syncMaintenanceState("timeout")),(t=e.from,n=e.to,Math.floor(Math.sqrt(Math.random())*(n-t)+t)))}var t,n},this._maintenanceValue=e,this._config=t,this._state=new s.WatchedValue(this._maintenanceValue.value()),this._lastMaintenanceUnsetReason=this._state.value()?null:"initial_operated",this._maintenanceValue.subscribe(this._onAliveMaintenanceChange)}destroy(){this._clearMaintenanceUnsetTimeout(),this._maintenanceValue.unsubscribe(this._onAliveMaintenanceChange)}value(){return this._state.value()}syncOnUserAction(){this._syncMaintenanceState("user_action")}subscribe(e){this._state.subscribe(e)}unsubscribe(e){this._state.unsubscribe(e)}lastMaintenanceUnsetReason(){return this._lastMaintenanceUnsetReason}_syncMaintenanceState(e){this._clearMaintenanceUnsetTimeout();const t=this._state.value(),n=this._maintenanceValue.value();t!==n&&(this._lastMaintenanceUnsetReason=n?null:"user_action"===e?"user_action":"auto_unset",this._state.setValue(n))}_clearMaintenanceUnsetTimeout(){this._unsetMaintenanceTimeoutId&&(clearTimeout(this._unsetMaintenanceTimeoutId),this._unsetMaintenanceTimeoutId=null)}}class l{constructor(e){this._setOfflineTimeout=null,this._onOnline=()=>{this._clearSetOfflineTimeout(),this._state.setValue(!1)},this._onOffline=()=>{this._setOfflineTimeout=setTimeout((()=>this._syncOfflineState()),1e4)},this._isOffline=e,this._state=new s.WatchedValue(this._isOffline()),window.addEventListener("online",this._onOnline),window.addEventListener("offline",this._onOffline)}value(){return this._state.value()}subscribe(e){this._state.subscribe(e)}unsubscribe(e){this._state.unsubscribe(e)}destroy(){this._clearSetOfflineTimeout(),window.removeEventListener("online",this._onOnline),window.removeEventListener("offline",this._onOffline)}_syncOfflineState(){this._clearSetOfflineTimeout(),this._state.setValue(this._isOffline())}_clearSetOfflineTimeout(){this._setOfflineTimeout&&(clearTimeout(this._setOfflineTimeout),this._setOfflineTimeout=null)}}const u=(0,i.default)((()=>{const e=new o.FeatureToggleWatchedValue("alerts-maintenance",!1),t=(0,r.getAlertConfig)(),n=new a(e,t),i=new l((()=>!window.navigator.onLine));return{maintenance:n,offline:i,anyTrackerFired:()=>n.value()||i.value()}}))}}]);