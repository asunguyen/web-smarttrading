(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[19922],{669738:e=>{e.exports={}},550041:e=>{e.exports={"text-button":"text-button-H6_2ZGVv",link:"link-H6_2ZGVv",content:"content-H6_2ZGVv","text-button-brand-small":"text-button-brand-small-H6_2ZGVv",background:"background-H6_2ZGVv","with-start-icon":"with-start-icon-H6_2ZGVv","with-end-icon":"with-end-icon-H6_2ZGVv","icon-only":"icon-only-H6_2ZGVv","start-icon":"start-icon-H6_2ZGVv","end-icon":"end-icon-H6_2ZGVv",hovered:"hovered-H6_2ZGVv","states-without-bg":"states-without-bg-H6_2ZGVv","disable-active-state-styles":"disable-active-state-styles-H6_2ZGVv",dimmed:"dimmed-H6_2ZGVv",selected:"selected-H6_2ZGVv",caret:"caret-H6_2ZGVv",activated:"activated-H6_2ZGVv","typography-semibold18px":"typography-semibold18px-H6_2ZGVv","typography-semibold16px":"typography-semibold16px-H6_2ZGVv","typography-semibold14px":"typography-semibold14px-H6_2ZGVv","typography-regular14px":"typography-regular14px-H6_2ZGVv","typography-regular16px":"typography-regular16px-H6_2ZGVv","text-button-brand-medium":"text-button-brand-medium-H6_2ZGVv","text-button-brand-large":"text-button-brand-large-H6_2ZGVv","text-button-gray-small":"text-button-gray-small-H6_2ZGVv","text-button-gray-medium":"text-button-gray-medium-H6_2ZGVv","text-button-gray-large":"text-button-gray-large-H6_2ZGVv","text-button-light-gray-small":"text-button-light-gray-small-H6_2ZGVv","text-button-light-gray-medium":"text-button-light-gray-medium-H6_2ZGVv","text-button-light-gray-large":"text-button-light-gray-large-H6_2ZGVv"}},678370:e=>{e.exports={"intent-default":"intent-default-EZuD3gZZ","intent-danger":"intent-danger-EZuD3gZZ","intent-warning":"intent-warning-EZuD3gZZ","intent-success":"intent-success-EZuD3gZZ","icon-wrapper-size-small":"icon-wrapper-size-small-EZuD3gZZ","icon-wrapper-size-medium":"icon-wrapper-size-medium-EZuD3gZZ","icon-wrapper-size-large":"icon-wrapper-size-large-EZuD3gZZ","icon-wrapper":"icon-wrapper-EZuD3gZZ",icon:"icon-EZuD3gZZ"}},348535:e=>{e.exports={container:"container-TCHLKPuQ","container-danger":"container-danger-TCHLKPuQ","light-title":"light-title-TCHLKPuQ","light-icon":"light-icon-TCHLKPuQ",icon:"icon-TCHLKPuQ",header:"header-TCHLKPuQ","light-container-danger":"light-container-danger-TCHLKPuQ","container-warning":"container-warning-TCHLKPuQ","light-container-warning":"light-container-warning-TCHLKPuQ","container-success":"container-success-TCHLKPuQ","light-container-success":"light-container-success-TCHLKPuQ","container-default":"container-default-TCHLKPuQ","light-container-default":"light-container-default-TCHLKPuQ","text-wrap":"text-wrap-TCHLKPuQ","light-text-wrap":"light-text-wrap-TCHLKPuQ","close-button":"close-button-TCHLKPuQ","light-close-button":"light-close-button-TCHLKPuQ",informerBody:"informerBody-TCHLKPuQ",mainProblem:"mainProblem-TCHLKPuQ","header-inline":"header-inline-TCHLKPuQ","header-new-line":"header-new-line-TCHLKPuQ"}},696235:e=>{e.exports={solutionLink:"solutionLink-SzoXymiX"}},908803:e=>{e.exports={widgetContainer:"widgetContainer-dU2ga07h",
widgetContainerWide:"widgetContainerWide-dU2ga07h",hidden:"hidden-dU2ga07h"}},490433:e=>{e.exports={widgetContainer:"widgetContainer-_qqQIz_4",hidden:"hidden-_qqQIz_4"}},891665:e=>{e.exports={container:"container-FyGzXH1q",checkBoxes:"checkBoxes-FyGzXH1q",checkboxContainer:"checkboxContainer-FyGzXH1q",tabs:"tabs-FyGzXH1q",label:"label-FyGzXH1q"}},628649:e=>{e.exports={container:"container-Yvm0jjs7",containerCell:"containerCell-Yvm0jjs7",firstRow:"firstRow-Yvm0jjs7",secondRow:"secondRow-Yvm0jjs7",negativeValue:"negativeValue-Yvm0jjs7",positiveValue:"positiveValue-Yvm0jjs7",title:"title-Yvm0jjs7",additionalPercent:"additionalPercent-Yvm0jjs7"}},454047:e=>{e.exports={legendContainer:"legendContainer-xOy3zRsH",reportContainer:"reportContainer-xOy3zRsH",chartContainer:"chartContainer-xOy3zRsH"}},264461:e=>{e.exports={reportContainer:"reportContainer-fu2S4cdI"}},321788:e=>{e.exports={root:"root-a4wW8zoD",row:"row-a4wW8zoD",solution:"solution-a4wW8zoD",rowStatic:"rowStatic-a4wW8zoD",cell:"cell-a4wW8zoD",cellSmallPadding:"cellSmallPadding-a4wW8zoD",title:"title-a4wW8zoD",wrapped:"wrapped-a4wW8zoD",noWrapped:"noWrapped-a4wW8zoD",negativeValue:"negativeValue-a4wW8zoD",headCell:"headCell-a4wW8zoD",headSmallPadding:"headSmallPadding-a4wW8zoD",staticBackground:"staticBackground-a4wW8zoD",percentValue:"percentValue-a4wW8zoD",titleContainer:"titleContainer-a4wW8zoD"}},241047:e=>{e.exports={colorBox:"colorBox-vDeYm6DY"}},490131:e=>{e.exports={reportViewContainer:"reportViewContainer-ts4QAqi9"}},492972:e=>{e.exports={section:"section-ZXUB0Tzt",isOpen:"isOpen-ZXUB0Tzt",container:"container-ZXUB0Tzt",title:"title-ZXUB0Tzt",arrow:"arrow-ZXUB0Tzt",expanded:"expanded-ZXUB0Tzt",minimizedData:"minimizedData-ZXUB0Tzt",minimizedName:"minimizedName-ZXUB0Tzt",minimizedValue:"minimizedValue-ZXUB0Tzt",sectionList:"sectionList-ZXUB0Tzt",elemContainer:"elemContainer-ZXUB0Tzt",elemData:"elemData-ZXUB0Tzt",elemTitle:"elemTitle-ZXUB0Tzt",colorBox:"colorBox-ZXUB0Tzt",symbolLogo:"symbolLogo-ZXUB0Tzt"}},685187:e=>{e.exports={root:"root-GcyAnig1",headCell:"headCell-GcyAnig1",tableWrapper:"tableWrapper-GcyAnig1",wrapperCell:"wrapperCell-GcyAnig1",wrapperValueCell:"wrapperValueCell-GcyAnig1",valueCell:"valueCell-GcyAnig1",valueCellContainer:"valueCellContainer-GcyAnig1",barNav:"barNav-GcyAnig1",hovered:"hovered-GcyAnig1",barNavIcon:"barNavIcon-GcyAnig1",barNavButton:"barNavButton-GcyAnig1",openCell:"openCell-GcyAnig1",invisibleText:"invisibleText-GcyAnig1",border:"border-GcyAnig1",profitData:"profitData-GcyAnig1",row:"row-GcyAnig1",openPosition:"openPosition-GcyAnig1",rightAlign:"rightAlign-GcyAnig1",negativeValue:"negativeValue-GcyAnig1",percentValue:"percentValue-GcyAnig1",cancelCursor:"cancelCursor-GcyAnig1",static:"static-GcyAnig1"}},681357:e=>{e.exports={container:"container-r0ls5Y5h",emptyStateIcon:"emptyStateIcon-r0ls5Y5h",warningHint:"warningHint-r0ls5Y5h",warningHint_hide:"warningHint_hide-r0ls5Y5h"}},260984:e=>{e.exports={container:"container-wrHEkq3b",hint:"hint-wrHEkq3b",link:"link-wrHEkq3b"}},782430:e=>{e.exports={
container:"container-yrIMi47q",title:"title-yrIMi47q",title_normal:"title_normal-yrIMi47q",icon:"icon-yrIMi47q",text:"text-yrIMi47q",text_large:"text_large-yrIMi47q",action:"action-yrIMi47q"}},342335:e=>{e.exports={"icon-wrapper":"icon-wrapper-dikdewwx","with-tooltip":"with-tooltip-dikdewwx","no-active-state":"no-active-state-dikdewwx"}},573606:e=>{e.exports={"square-tab-button":"square-tab-button-huvpscfz",selected:"selected-huvpscfz","disable-active-state-styles":"disable-active-state-styles-huvpscfz","disable-focus-outline":"disable-focus-outline-huvpscfz","size-medium":"size-medium-huvpscfz","tab-hidden-content":"tab-hidden-content-huvpscfz","size-small":"size-small-huvpscfz","size-xsmall":"size-xsmall-huvpscfz",fake:"fake-huvpscfz",content:"content-huvpscfz","tab-content":"tab-content-huvpscfz"}},77819:e=>{e.exports={"arrow-icon":"arrow-icon-nV6fm1zO",dropped:"dropped-nV6fm1zO"}},744012:e=>{e.exports={"css-value-square-tabs-xsmall-gap":"4px","css-value-square-tabs-small-gap":"8px","css-value-square-tabs-medium-gap":"12px"}},792331:e=>{e.exports={"css-value-square-tabs-xsmall-gap":"4px","css-value-square-tabs-small-gap":"8px","css-value-square-tabs-medium-gap":"12px","scroll-wrap":"scroll-wrap-mf1FlhVw","enable-scroll":"enable-scroll-mf1FlhVw","square-tabs":"square-tabs-mf1FlhVw",content:"content-mf1FlhVw","size-xsmall":"size-xsmall-mf1FlhVw","square-tab-button":"square-tab-button-mf1FlhVw","end-icon-wrap":"end-icon-wrap-mf1FlhVw","size-small":"size-small-mf1FlhVw","size-medium":"size-medium-mf1FlhVw"}},176406:(e,t,n)=>{"use strict";n.d(t,{TextAnchorButton:()=>l,TextButton:()=>a.TextButton});var r=n(622032),a=n(106257),i=n(50959),o=n(14388),s=n(551080);function l(e){const{reference:t,className:n,isSelected:a,isDimmed:l,children:c,startIcon:u,startIconAriaAttrs:d,showCaret:p,color:h,endIcon:m,endIconAriaAttrs:g,size:y,typography:v,iconOnly:f,statesWithoutBg:b,isActivated:_,renderComponent:C=o.CustomComponentDefaultLink,...w}=e;return i.createElement(C,{...w,className:(0,r.getTextButtonClasses)({className:n,isSelected:a,isDimmed:l,startIcon:u,showCaret:p,endIcon:m,color:h,size:y,typography:v,iconOnly:f,isLink:!0,isActivated:_}),reference:(0,s.isomorphicRef)(t)},i.createElement(r.TextButtonContent,{showCaret:p,startIcon:u,startIconAriaAttrs:{...d},endIcon:m,endIconAriaAttrs:{...g},statesWithoutBg:b},c))}},622032:(e,t,n)=>{"use strict";n.d(t,{TextButtonContent:()=>p,getTextButtonClasses:()=>d});var r=n(50959),a=n(497754),i=n(83436),o=n(728804),s=n(602948),l=n(550041),c=n.n(l);const u={small:"regular14px",medium:"semibold16px",large:"semibold18px"},d=e=>{const t=(0,r.useContext)(o.CustomBehaviourContext),{className:n,isSelected:i,isDimmed:s,isHovered:l,size:d="medium",color:p,startIcon:h,endIcon:m,showCaret:g,enableActiveStateStyles:y=t.enableActiveStateStyles,typography:v,iconOnly:f,isLink:b=!1,isActivated:_}=e
;return a(n,c()["text-button"],b&&c().link,i&&c().selected,s&&c().dimmed,l&&c().hovered,c()[`text-button-${p}-${d}`],h&&c()["with-start-icon"],f&&c()["icon-only"],(g||m)&&c()["with-end-icon"],!y&&c()["disable-active-state-styles"],v?c()[`typography-${v}`]:c()[`typography-${u[d]}`],_&&c().activated)};function p(e){return r.createElement(r.Fragment,null,r.createElement("span",{className:a(c().background,e.statesWithoutBg&&c()["states-without-bg"])}),e.startIcon&&r.createElement(i.Icon,{...e.startIconAriaAttrs,className:c()["start-icon"],icon:e.startIcon}),r.createElement("span",{className:c().content},e.children),(e.endIcon||e.showCaret)&&(e=>r.createElement(i.Icon,{...e.showCaret?void 0:e.endIconAriaAttrs,className:a(c()["end-icon"],e.showCaret&&c().caret),icon:e.showCaret?s:e.endIcon}))(e))}},106257:(e,t,n)=>{"use strict";n.d(t,{TextButton:()=>i});var r=n(50959),a=n(622032);function i(e){const{reference:t,className:n,isSelected:i,isHovered:o,isDimmed:s,children:l,startIcon:c,startIconAriaAttrs:u,showCaret:d,color:p,endIcon:h,endIconAriaAttrs:m,size:g,typography:y,iconOnly:v,statesWithoutBg:f,isActivated:b,..._}=e;return r.createElement("button",{..._,className:(0,a.getTextButtonClasses)({className:n,isSelected:i,isHovered:o,startIcon:c,showCaret:d,endIcon:h,color:p,size:g,typography:y,iconOnly:v,isDimmed:s,isActivated:b}),ref:t},r.createElement(a.TextButtonContent,{showCaret:d,startIcon:c,startIconAriaAttrs:{...u},endIcon:h,endIconAriaAttrs:{...m},statesWithoutBg:f},l))}},248770:(e,t,n)=>{"use strict";n.d(t,{useSafeMobileTouch:()=>i});var r=n(50959),a=n(167175);function i(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{t(a.mobiletouch)}),[]),e}},328963:(e,t,n)=>{"use strict";n.d(t,{IconQuestionInformation:()=>v});var r=n(50959),a=n(497754),i=n(8626),o=n(83436),s=n(482353),l=n(527941),c=n(499084),u=n(530162),d=n(678370),p=n.n(d);const h="small",m={info:l,question:s,check:c,exclamation:u};function g(e,t){return t?m[t]:"success"===e?m.check:m.exclamation}const y=r.forwardRef(((e,t)=>r.createElement("span",{...e,ref:t,className:a(e.className,p()["no-active-state"])}))),v=r.forwardRef(((e,t)=>{const{icon:n,intent:s="default",ariaLabel:l,tooltip:c,className:u,renderComponent:d=y,tabIndex:m=0,size:v=h,onFocus:f,onBlur:b,onClick:_,...C}=e;return r.createElement(d,{className:a(u,p()["icon-wrapper"],p()[`intent-${s}`],p()[`icon-wrapper-size-${v}`]),title:c,"aria-label":l,ref:t,tabIndex:m,onFocus:f,onBlur:b,onClick:_,...(0,i.filterDataProps)(C)},r.createElement(o.Icon,{"aria-hidden":!0,icon:g(s,n),className:p().icon}))}))},420548:(e,t,n)=>{"use strict";n.d(t,{Informer:()=>m});var r=n(50959),a=n(497754),i=n(83436),o=n(4908),s=n(8626),l=n(530162),c=n(527941),u=n(499084),d=n(348535),p=n.n(d);const h={danger:l,warning:l,success:u,default:c};function m(e){const{informerIntent:t,content:n,className:l,header:c,isIconShown:u=!0,isCloseButtonShown:d,icon:m,onCloseClick:g,closeButtonLabel:y="Close",headerPlacement:v="inline",children:f,isLight:b}=e;return r.createElement("div",{
className:a(p().container,p()[`container-${t}`],b&&p()[`light-container-${t}`],l),...(0,s.filterDataProps)(e),...(0,s.filterAriaProps)(e)},r.createElement("div",{className:p().informerBody},n&&r.createElement("div",{className:p().mainProblem},u&&r.createElement(i.Icon,{className:a(p().icon,b&&p()["light-icon"]),icon:null!=m?m:h[t]}),r.createElement("div",{className:a(p()["text-wrap"],b&&p()["light-text-wrap"])},c&&r.createElement("span",{className:a(b&&p()["light-title"],p().header,p()[`header-${b?"new-line":v}`])},c),r.createElement("span",null," ",n))),f),d&&r.createElement(o.CloseButton,{"aria-label":y,onClick:g,className:a(b&&p()["light-close-button"],p()["close-button"]),size:b?"xxsmall":"xsmall",preservePaddings:!b}))}},280708:(e,t,n)=>{"use strict";n.d(t,{useTabsMainHandlers:()=>p});var r=n(50959),a=n(763341),i=n(846503),o=n(892487),s=n(269269),l=n(325520),c=n(718083),u=n(662929),d=n(283657);function p(e,t,n){const{id:p,items:h,activationType:m,orientation:g,disabled:y,onActivate:v,isActive:f,overflowBehaviour:b,enableActiveStateStyles:_,tablistLabelId:C,tablistLabel:w}=t,S=(0,i.useMobileTouchState)(),T=(0,o.useOverflowBehaviour)(b),k=(0,r.useRef)(!1),E=(0,r.useCallback)((e=>e.id),[]),D=null!=_?_:!S,{visibleItems:I,hiddenItems:R,containerRefCallback:x,innerContainerRefCallback:H,moreButtonRef:V,setItemRef:P}=(0,s.useCollapsible)(h,E,f),N="collapse"===T?I:h,B=(0,r.useMemo)((()=>"collapse"===T?R:[]),[T,R]),z=(0,r.useCallback)((e=>B.includes(e)),[B]),{isOpened:O,open:M,close:A,onButtonClick:F}=(0,c.useDisclosure)({id:p,disabled:y}),{tabsBindings:L,tablistBinding:q,scrollWrapBinding:W,onActivate:Z,onHighlight:G,isHighlighted:j}=(0,l.useTabs)({id:p,items:[...N,...B],activationType:m,orientation:g,disabled:y,tablistLabelId:C,tablistLabel:w,scrollIntoViewOptions:n.scrollIntoViewOptions,onActivate:v,isActive:f,isCollapsed:z,isRtl:n.isRtl,isDisclosureOpened:O}),$=B.find(j),U=(0,r.useCallback)((()=>{const e=h.find(f);e&&G(e)}),[G,f,h]),Q=(0,r.useCallback)((e=>L.find((t=>t.id===e.id))),[L]),K=(0,r.useCallback)((()=>{A(),U(),k.current=!0}),[A,U]),Y=(0,r.useCallback)((()=>{$&&(Z($),G($,250))}),[Z,G,$]);W.ref=(0,u.useMergedRefs)([W.ref,x]),q.ref=(0,u.useMergedRefs)([q.ref,H]),q.onKeyDown=(0,a.createSafeMulticastEventHandler)((0,d.useKeyboardEventHandler)([(0,d.useKeyboardClose)(O,K),(0,d.useKeyboardActionHandler)([13,32],Y,(0,r.useCallback)((()=>Boolean($)),[$]))]),q.onKeyDown);const X=(0,r.useCallback)((e=>{k.current=!0,F(e)}),[k,F]),J=(0,r.useCallback)((e=>{e&&Z(e)}),[Z]);return(0,r.useEffect)((()=>{k.current?k.current=!1:($&&!O&&M(),!$&&O&&A())}),[$,O,M,A]),{enableActiveStateStyles:D,moreButtonRef:V,setItemRef:P,getBindings:Q,handleMoreButtonClick:X,handleCollapsedItemClick:J,scrollWrapBinding:W,overflowBehaviour:T,tablistBinding:q,visibleTabs:N,hiddenTabs:B,handleActivate:Z,isMobileTouch:S,getItemId:E,isDisclosureOpened:O,isHighlighted:j,closeDisclosure:A}}},892487:(e,t,n)=>{"use strict";n.d(t,{useOverflowBehaviour:()=>o});var r=n(586240),a=n(222463),i=n(846503);function o(e){const t=(0,
a.useSafeMatchMedia)(r["media-mf-phone-landscape"],!0),n=(0,i.useMobileTouchState)();return null!=e?e:n||!t?"scroll":"collapse"}},80934:(e,t,n)=>{"use strict";n.d(t,{ChartWarningHint:()=>l});var r=n(50959),a=n(444372),i=n(860037),o=n(420548),s=n(260984);function l(e){const{text:t,warningHeader:l,warningType:c="default",solutionId:u,solutionText:d,onClose:p,warningIcon:h}=e;return r.createElement("div",{className:s.hint},r.createElement(o.Informer,{isCloseButtonShown:!0,closeButtonLabel:a.t(null,{context:"action"},n(768508)),className:s.container,header:l,onCloseClick:p,informerIntent:"default"===c?"warning":"danger",icon:h,content:r.createElement(r.Fragment,null,r.createElement("span",null,t," "),u&&r.createElement("a",{className:s.link,href:`/support/solutions/${u}/`,onClick:e=>{e.preventDefault(),(0,i.showSupportDialog)({solutionId:u})}},d||a.t(null,void 0,n(718429))))}))}},583835:(e,t,n)=>{"use strict";n.d(t,{useLogos:()=>i});var r=n(14325),a=n(795394);function i(e,t){return(0,r.useQuotesCachedData)(e,["logoid","currency-logoid","base-currency-logoid"],{},a.snapshoter,t)}},837657:(e,t,n)=>{"use strict";n.d(t,{isSeparatorItem:()=>a});var r=n(173777);function a(e){return(0,r.isSeparatorItem)(e)}},898960:(e,t,n)=>{"use strict";n.d(t,{EmptyStateBlock:()=>l});var r=n(50959),a=n(497754),i=n.n(a),o=n(782430);function s(e){const{title:t,tagName:n,titleSize:a}=e,s=n||"strong";return r.createElement(s,{className:i()(o.title,o[`title_${a}`])},t)}function l(e){return r.createElement("div",{className:a(o.container,e.className)},r.createElement("div",{className:a(o.icon,e.iconClass)}),e.title&&r.createElement(s,{title:e.title,titleSize:e.titleSize,tagName:e.titleTagName}),e.text&&r.createElement("div",{className:a(o.text,"large"===e.textSize&&o.text_large)},e.text),e.action&&r.createElement("div",{className:o.action},e.action))}},517744:(e,t,n)=>{"use strict";n.d(t,{usePrevious:()=>a});var r=n(50959);function a(e){const t=(0,r.useRef)(null);return(0,r.useEffect)((()=>{t.current=e}),[e]),t.current}},14325:(e,t,n)=>{"use strict";n.d(t,{useQuotesCachedData:()=>s});var r=n(50959),a=n(984306),i=n(316230),o=n(837657);function s(e,t,n,s,c){const[u,d]=(0,r.useState)((()=>{if(void 0===e||(0,o.isSeparatorItem)(e))return l(n,t);const r=c?null:s().getSnapshotSync(e,new Set(t));return null===r||"error"===r.status?l(n,t):(0,a.default)(r.values,t)}));return(0,r.useEffect)((()=>{if(void 0===e||(0,o.isSeparatorItem)(e))return;let r=!1;return s().getSnapshot(e,new Set(t)).then((e=>{if(r)return;const o="error"===e.status?l(n,t):(0,a.default)(e.values,t);d((e=>(0,i.default)(o,e)?e:o))})),()=>{r=!0}}),[e,s]),u}function l(e,t){return e}},137982:(e,t,n)=>{"use strict";n.d(t,{IconQuestionInformation:()=>d,IconQuestionInformationButton:()=>h,IconQuestionInformationLink:()=>p});var r=n(50959),a=n(497754),i=n(328963),o=n(248770),s=n(267521);var l=n(309103),c=n(342335),u=n.n(c);const d=(0,r.forwardRef)(((e,t)=>{const{className:n,onClick:c=l.tooltipClickHandler,doNotShowTooltipOnTouch:d,...p}=e,{tooltip:h,className:m,...g}=function(e,t=null){
const{showTooltip:n,hideTooltip:a,onClick:i,doNotShowTooltipOnTouch:l=!1}=e,c=(0,s.useFunctionalRefObject)(t),u=(0,o.useSafeMobileTouch)(),d=u&&l?void 0:e.tooltip;return(0,r.useEffect)((()=>{const e=()=>{var e;null===(e=null==c?void 0:c.current)||void 0===e||e.blur()};return document.addEventListener("scroll",e,!0),()=>document.removeEventListener("scroll",e,!0)}),[c]),{onBlur:(0,r.useCallback)((e=>{a&&a()}),[a]),onFocus:(0,r.useCallback)((e=>{!e.target.matches(":hover")&&n&&e.target.matches(":focus-visible")&&n(e.currentTarget,{tooltipDelay:200})}),[n]),onClick:(0,r.useCallback)((e=>{var t;u&&(null===(t=null==c?void 0:c.current)||void 0===t||t.focus()),i&&i(e)}),[i,c,u]),tooltip:d,className:void 0!==d?"apply-common-tooltip":void 0,ref:c}}({tooltip:e.tooltip,doNotShowTooltipOnTouch:d,showTooltip:l.showOnElement,hideTooltip:l.hide,onClick:c},t);return r.createElement(i.IconQuestionInformation,{className:a(n,u()["icon-wrapper"],h&&u()["with-tooltip"],m),tooltip:h,...p,...g})})),p=(0,r.forwardRef)(((e,t)=>{const{href:n,rel:a,target:i,...o}=e,s=(0,r.useMemo)((()=>(0,r.forwardRef)(((e,t)=>r.createElement("a",{href:n,rel:a,target:i,ref:t,...e})))),[n,a,i]);return r.createElement(d,{...o,renderComponent:s,ref:t,doNotShowTooltipOnTouch:!0})})),h=(0,r.forwardRef)(((e,t)=>{const{className:n,withActiveState:i,...o}=e,s=(0,r.useMemo)((()=>(0,r.forwardRef)(((e,t)=>r.createElement("button",{...e,ref:t,type:"button"})))),[]);return r.createElement(d,{...o,className:a(n,!i&&u()["no-active-state"]),renderComponent:s,ref:t})}))},55220:(e,t,n)=>{"use strict";n.d(t,{SquareTabs:()=>D});var r=n(50959),a=n(497754),i=n(444372),o=n(997382),s=n(280708),l=n(551080),c=n(728804);const u=(0,r.createContext)("small");n(586240),n(435697);var d=n(83436),p=n(792331);function h({endIcon:e,children:t,className:n,"aria-hidden":a}){return r.createElement("span",{"aria-hidden":a,className:n},t&&r.createElement("span",{className:p.content},t),e&&r.createElement(d.Icon,{className:p["end-icon-wrap"],icon:e,"aria-hidden":!0}))}var m=n(573606);const g=(0,r.forwardRef)(((e,t)=>{const n=r.useContext(u),i=(0,r.useContext)(c.CustomBehaviourContext),{id:o,active:s,fake:l,theme:d=m,enableActiveStateStyles:p=i.enableActiveStateStyles,hideFocusOutline:g=!1,endIcon:y,children:v,...f}=e;return r.createElement("button",{...f,id:o,ref:t,className:a(d["square-tab-button"],s&&d.selected,d[`size-${n}`],l&&d.fake,!p&&d["disable-active-state-styles"],g&&d["disable-focus-outline"])},r.createElement(h,{endIcon:y,className:m["tab-content"]},v),r.createElement(h,{"aria-hidden":!0,endIcon:y,className:m["tab-hidden-content"]},v))}));g.displayName="SquareTabButton";const y=(0,r.forwardRef)(((e,t)=>{const{item:n,highlighted:a,handleItemRef:i,onClick:o,...s}=e,c=(0,r.useCallback)((()=>{o&&o(n)}),[o,n]),u=(0,r.useCallback)((e=>{i&&i(n,e),(0,l.isomorphicRef)(t)(e)}),[n,i,t]);return r.createElement(g,{...s,id:n.id,onClick:c,ref:u,endIcon:n.endIcon},n.label)}));y.displayName="SquareTab";var v=n(662929),f=n(217802),b=n(634993),_=n(602948),C=n(77819);function w(e){const{isDropped:t=!1}=e
;return r.createElement(d.Icon,{icon:_,className:a(C["arrow-icon"],t&&C.dropped)})}function S(e){const{disabled:t,isOpened:n,hideFocusOutline:a,fake:i,items:o,buttonContent:s,buttonRef:l,buttonTheme:c,isHighlighted:u,onButtonClick:d,onItemClick:p,onClose:h}=e,m=(0,r.useRef)(null),y=(0,v.useMergedRefs)([l,m]);return r.createElement(f.PopupMenuDisclosureView,{buttonRef:m,listboxTabIndex:-1,isOpened:n,onClose:h,listboxAria:{"aria-hidden":!0},button:r.createElement(g,{"aria-hidden":!0,disabled:t,active:n,onClick:d,ref:y,tabIndex:-1,theme:c,hideFocusOutline:a,fake:i},s,r.createElement(w,{isDropped:n})),popupChildren:o.map((e=>r.createElement(b.PopupMenuItem,{key:e.id,onClick:p,onClickArg:e,isActive:u(e),label:e.label,isDisabled:e.disabled,dontClosePopup:!0})))})}var T=n(557505),k=n(31341),E=n(744012);function D(e){const{disabled:t,moreButtonContent:l=i.t(null,void 0,n(141610)),size:c="small",theme:d=T.defaultTheme,className:p,style:h,"data-name":m="square-tabs-buttons"}=e,{enableActiveStateStyles:g,moreButtonRef:v,setItemRef:f,getBindings:b,handleMoreButtonClick:_,handleCollapsedItemClick:C,scrollWrapBinding:w,overflowBehaviour:D,tablistBinding:I,visibleTabs:R,hiddenTabs:x,handleActivate:H,isMobileTouch:V,getItemId:P,isDisclosureOpened:N,isHighlighted:B,closeDisclosure:z}=(0,s.useTabsMainHandlers)(o.TabNames.SquareButtonTabs,e,{isRtl:k.isRtl,scrollIntoViewOptions:{additionalScroll:parseInt(E[`css-value-square-tabs-${c}-gap`])}});return r.createElement(u.Provider,{value:c},r.createElement("div",{...w,className:a(d["scroll-wrap"],"scroll"===D&&d["enable-scroll"],p),style:h,"data-name":m},r.createElement("div",{...I,className:a(d["square-tabs"],d[`size-${c}`])},R.map((e=>{var t;const{"aria-disabled":n,...a}=null!==(t=b(e))&&void 0!==t?t:{};return r.createElement(y,{...a,key:e.id,item:e,onClick:()=>H(e),theme:d,enableActiveStateStyles:g,hideFocusOutline:V,ref:f(P(e)),...e.dataId&&{"data-id":e.dataId}})})),x.map((e=>{var t;const{"aria-disabled":n,...a}=null!==(t=b(e))&&void 0!==t?t:{};return r.createElement(y,{...a,key:e.id,item:e,theme:d,enableActiveStateStyles:g,fake:!0})})),r.createElement(S,{disabled:t,isOpened:N,items:x,buttonContent:l,buttonRef:v,buttonTheme:d,isHighlighted:B,onButtonClick:_,onItemClick:C,onClose:z,hideFocusOutline:V,fake:0===x.length}))))}},557505:(e,t,n)=>{"use strict";n.d(t,{defaultTheme:()=>o});var r=n(995683),a=n(792331),i=n(573606);const o=(0,r.mergeThemes)(i,a)},995683:(e,t,n)=>{"use strict";function r(e,t,n={}){return Object.assign({},e,function(e,t,n={}){const r=Object.assign({},t);for(const a of Object.keys(t)){const i=n[a]||a;i in e&&(r[a]=[e[i],t[a]].join(" "))}return r}(e,t,n))}n.d(t,{mergeThemes:()=>r})},275276:e=>{e.exports={wrapper:"wrapper-XkwdvnHr",emptyStateIcon:"emptyStateIcon-XkwdvnHr"}},852386:e=>{e.exports={strategyGroup:"strategyGroup-zf0MHBzY",fixedContent:"fixedContent-zf0MHBzY",select:"select-zf0MHBzY",strategyInfo:"strategyInfo-zf0MHBzY",historyParams:"historyParams-zf0MHBzY",historyParamsWide:"historyParamsWide-zf0MHBzY",generateReportBtn:"generateReportBtn-zf0MHBzY",
disableTab:"disableTab-zf0MHBzY",staticWrapper:"staticWrapper-zf0MHBzY",supportButton:"supportButton-zf0MHBzY",staticSupportButton:"staticSupportButton-zf0MHBzY",tabsContainer:"tabsContainer-zf0MHBzY",tabNoOutline:"tabNoOutline-zf0MHBzY",container:"container-zf0MHBzY",staticContainer:"staticContainer-zf0MHBzY",containerNarrow:"containerNarrow-zf0MHBzY",containerWide:"containerWide-zf0MHBzY"}},167442:e=>{e.exports={deepHistoryContainer:"deepHistoryContainer-GTDrlhrf",switchGroup:"switchGroup-GTDrlhrf",switchTitle:"switchTitle-GTDrlhrf",deepHistorySolution:"deepHistorySolution-GTDrlhrf"}},901662:e=>{e.exports={dropdownButton:"dropdownButton-EPWwke1U",dropdownBtn:"dropdownBtn-EPWwke1U",singleStrategy:"singleStrategy-EPWwke1U",contentWrapper:"contentWrapper-EPWwke1U",title:"title-EPWwke1U",textEllipsis:"textEllipsis-EPWwke1U"}},620536:e=>{e.exports={container:"container-pBnggzT8",separator:"separator-pBnggzT8"}},737340:e=>{e.exports={wrapper:"wrapper-zlamjTrA",emptyStateIcon:"emptyStateIcon-zlamjTrA"}},380768:e=>{e.exports={backtestingWarningContainer:"backtestingWarningContainer-pF2GLGzv",backtestingHeadWrapper:"backtestingHeadWrapper-pF2GLGzv",staticHeadWrapper:"staticHeadWrapper-pF2GLGzv"}},839044:(e,t,n)=>{"use strict";n.d(t,{trackBottomPanelButtonClick:()=>l,trackStrategyTesterButtonClick:()=>c});var r=n(776734),a=n(740254),i=n(833813);const o={Overview:"overview","List of Trades":"trades","Performance Summary":"summary",Properties:"properties"};function s(e){(0,r.getTracker)().then((t=>{null!==t&&t.trackBottomToolbarButtonClick(e)}))}function l(e){const t=[e.button];e.visibility&&t.push(e.visibility),e.option&&t.push(e.option),s(t.join(" "))}function c(e,t){const n=["strategy_tester"];if((0,a.enabled)(i.ProductFeatures.DEEP_HISTORY_BACKTEST)&&n.push(e),(null==t?void 0:t.activeTab)&&n.push(o[t.activeTab]),null==t?void 0:t.button){const e=function(e){switch(e){case"Overview":case"List of Trades":case"Performance Summary":case"Properties":return o[e];default:return e}}(t.button),r=t.isButtonOpen?`${e}_open`:e;n.push(r)}s(n.join(" "))}},319922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BacktestingWidget:()=>va});var r=n(650151),a=n(50959),i=n(500962),o=n(497754),s=n.n(o),l=n(444372),c=n(631078),u=n(728804),d=n(583912),p=n(345848),h=n(373571),m=n(707957),g=n(167975),y=n(783375),v=n(876332),f=n(517744),b=n(130551),_=n(827710);const C=["run_mode","exclude_from_report"];function w(e,t){const n=new _.MetaInfoHelper(e.metaInfo()),r=e.inputs(t),a={};function i(e){if(e.isHidden)return;const t=e.internalID||e.id;if(-1!==C.indexOf(t))return;const n=r[e.id];a[t]=(0,b.isObject)(n)?n.v:n}return n.getUserEditableInputs().forEach(i),n.hasUserEditableProperties()&&e.metaInfo().inputs.forEach(i),a}function S(e,t=!1,n){return e.isChildStudy()?T(e).map((e=>({study:e.getStudyName(),id:e.sourceId(),inputs:t?w(e,n):e.inputs(n)}))):[]}function T(e,t=new Set){return e.parentSources().forEach((e=>{t.add(e),T(e,t)})),Array.from(t.values())}var k=n(62802),E=n(80934),D=n(860037),I=n(1500);function R(){
const e=k.getInt("backtesting.deepHistoryHintTimestamp"),t=e?Number(e):null;return!!t&&!function(e){return(new Date).getTime()-e>864e5}(t)}var x=n(696235);function H(e){const{solutionId:t}=e,r=a.useCallback((e=>{e.preventDefault(),(0,D.showSupportDialog)({solutionId:t})}),[t]);return a.createElement(a.Fragment,null," ",a.createElement("a",{className:x.solutionLink,href:`?solution=${t}`,onClick:r},l.t(null,void 0,n(718429))))}function V(e){let t="";const r=function(e){switch(e){case"nonStandard":case"deepHistoryDataError":return I.solutionIds.STRATEGY_UNREALISTIC_RESULTS;case"lookaheadFutureData":return I.solutionIds.STRATEGY_FUTURE_DATA;case"deepHistory":return I.solutionIds.DEEP_BACKTESTING_WIDGET;case"deepHistoryFetchError":return I.solutionIds.DEEP_BACKTESTING_AVAILABLE_DATA}}(e);switch(e){case"nonStandard":t=l.t(null,void 0,n(250711));break;case"lookaheadFutureData":t=l.t(null,void 0,n(187097));break;case"deepHistory":t=l.t(null,void 0,n(526489));break;case"deepHistoryDataError":t=l.t(null,void 0,n(722594));break;case"deepHistoryFetchError":t=l.t(null,void 0,n(945723))}return a.createElement(a.Fragment,null,t,a.createElement(H,{solutionId:r}))}function P(e,t,n){return{isDeepHistory:1===e,hasLookaheadFutureData:n,isRangeBasedStyle:t}}function N(e){const{removeCb:t}=e,[r,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[d,p]=(0,a.useState)(R()),h=(0,a.useCallback)((e=>{let t;const n=!e.isDeepHistory&&!r,a=e.isDeepHistory&&!o,i=e.isRangeBasedStyle||8===e.chartStyle&&!e.isFillOrdersOnStandardOhlc,s=n||a;if(e.isDeepHistory&&!d)t="deepHistory";else if(e.hasLookaheadFutureData&&!c)t="lookaheadFutureData";else if(i&&s)t="nonStandard";else if(e.hasDeepHistoryError)t="deepHistoryDataError";else{if(!e.hasDeepHistoryFetchError)return null;t="deepHistoryFetchError"}return t}),[r,c,d,o]),m=h(e);if(null===m)return a.createElement(a.Fragment,null);const g="deepHistory"!==m?l.t(null,void 0,n(697174)):l.t(null,void 0,n(885456));return a.createElement(E.ChartWarningHint,{warningType:e.warningType,warningHeader:g,text:e.errorText&&e.errorText.length>0?e.errorText:V(m),onClose:()=>{const n=h(e);"nonStandard"===n?e.isDeepHistory&&d?s(!0):i(!0):"lookaheadFutureData"===n?u(!0):"deepHistory"!==n||d||(p(!0),k.setValue("backtesting.deepHistoryHintTimestamp",(new Date).getTime())),t&&t()}})}var B=n(898960),z=n(540975),O=n(275276),M=n(776734);const A=[];async function F(e,t){const n=await(0,M.getTracker)(),r={event_name:e,event_param:t?JSON.stringify(t):null,user_plan:window.user.pro_plan||(window.is_authenticated?"free":"visitor")};if(n){if(A.length>0){for(const e of A)n.trackBacktestingEvent(e);A.length=0}n.trackBacktestingEvent(r)}else A.push(r)}function L(e){const{studyMarket:t,height:r}=e,i=(0,c.useWatchedValueReadonly)({watchedValue:r});return a.createElement("div",{className:O.wrapper},i>100&&a.createElement(B.EmptyStateBlock,{iconClass:i>300?O.emptyStateIcon:void 0,title:l.t(null,void 0,n(876809)),text:l.t(null,void 0,n(307104)),action:a.createElement(z.Button,{className:O.button,onClick:function(){
t&&!t.visible().value()&&(F("click_button",{item_id:"load_strategy"}),t.show(void 0,"built-ins","strategies"))}},l.t(null,void 0,n(815399)))}))}var q=n(552279),W=n(740254),Z=n(833813),G=n(322160),j=n(643528),$=n(915812),U=n(265005),Q=n(960337),K=n(768985),Y=n(668669),X=n(223699);const J={widgetType:0,symbol:"",extendedSymbol:"",deepHistoryDateRange:{dateRange:{from:new Date,to:new Date},dateBounds:{dateFromMax:new Date,dateToMin:new Date}},resolution:new X.Interval(X.ResolutionKind.Days,1),strategy:null,strategies:[],deepHistoryCurrentRequestParams:null,deepHistoryPrevRequestParams:null,generateReportButtonEnabled:!0,strategyHintProps:{},timezone:null,tzProperty:null,minTickProperty:null,activeReportTab:"Overview",formatter:null,csvReportProgress:!1,userInputsState:null,chartStyle:"",pointValue:1,chartCurrency:"",minTick:"1",layoutType:1,quickDeepHistory:!1,setWidgetType:e=>{},setDeepHistoryDateRange:e=>{},setStrategy:e=>{},setGenerateReportButtonEnabled:e=>{},setErrorHint:e=>{},setActiveReportTab:e=>{},setCSVReportProgress:e=>{},onGenerateButtonClick:()=>{}},ee=a.createContext(J),te={date_range:!1,chart_settings:!1,strategy_properties:!1,strategy_inputs:!1},ne={scrollTop:0,scrollLeft:0},re="backtesting";function ae(e,t){if(null===e)return!0;const n=!ie(e.deepHistoryDateRange,t.deepHistoryDateRange),r=!ie(e.strategyInputsState,t.userInputsState),a=(i=e.timezone,o=t.timezone,!(null===i&&null===o||null!==i&&null!==o&&i.name()===o.name()));var i,o;const s=e.strategy!==t.strategy,l=e.extendedSymbol!==t.extendedSymbol,c=e.resolution.value()!==t.resolution.value();return n||r||a||s||l||c}function ie(e,t){return JSON.stringify(e)===JSON.stringify(t)}function oe(e,t){const n=se(new Date);let r=se(e.from),a=se(e.to);if(n.getTime()<a.getTime()&&(a=n),t.isIntraday()||t.isRange())return{dateRange:{from:r,to:a},dateBounds:{dateFromMax:a,dateToMin:r}};const i=t.inMilliseconds();return r.getTime()>a.getTime()-i&&(r=new Date(a.getTime()-i)),{dateRange:{from:r,to:a},dateBounds:{dateFromMax:new Date(a.getTime()-t.inMilliseconds()),dateToMin:new Date(r.getTime()+t.inMilliseconds())}}}function se(e){return new Date(e.setHours(0,0,0,0))}function le(e){const t=function(e){const t=ue();if(!t||!t.dateRange)return null;const{from:n,to:r}=t.dateRange;return oe({from:new Date(1e3*n),to:new Date(1e3*r)},e)}(e);if(t)return{...t,dateRange:{from:se(t.dateRange.from),to:se(t.dateRange.to)}};return oe({from:new Date((new Date).setMonth((new Date).getMonth()-12)),to:new Date},e)}function ce(e){const t=ue();k.setJSON(re,{...t,...e})}function ue(){return k.getJSON(re)}function de(e){const t=function(e){const t=e.from.getTime();if(e.to&&e.to.getTime()>=e.from.getTime()){const n=e.to.getTime();return{from:Math.round(t/1e3),to:Math.round(n/1e3)}}return null}(e);t&&ce({dateRange:t})}function pe(){ce({scroll_settings_list_of_trades:ne})}var he=n(620536);const me="1800-01-01";function ge(e){const{resolution:t,deepHistoryDateRange:r,firstBarTime:i}=e,{setDeepHistoryDateRange:o}=(0,a.useContext)(ee),[s,c]=(0,a.useState)(new Date(me));(0,a.useEffect)((()=>{
r.dateRange.from.getTime()<s.getTime()&&u({from:new Date(s),to:r.dateRange.to},t),r.dateRange.to.getTime()<s.getTime()&&u({from:r.dateRange.from,to:new Date},t)}),[s]),(0,a.useEffect)((()=>{i?(i>r.dateRange.from.getTime()&&u({from:new Date(i),to:r.dateRange.to},t),c(new Date(i))):c(new Date(me))}),[i]);const u=(0,a.useCallback)(((e,t)=>{o(oe(e,t))}),[]),d=(0,a.useCallback)(((e,t)=>{de(e),u(e,t)}),[]);return a.createElement("div",{className:he.container},a.createElement("div",{className:he.datePickerContainer},a.createElement("div",{className:he.datePickerWrapper},a.createElement(K.DatePicker,{InputComponent:Y.DateInput,initial:r.dateRange.from,onPick:function(e){if(e){const n=se(e);d({from:n,to:r.dateRange.to},t)}},minDate:s,maxDate:r.dateBounds.dateFromMax,size:"xsmall",endSlotComponent:({onSelectDate:e})=>a.createElement($.SquareButton,{variant:"secondary",onClick:()=>{i?(c(new Date(i)),d({from:new Date(i),to:r.dateRange.to},t)):(c(new Date(me)),d({from:new Date(me),to:r.dateRange.to},t)),e(s)},stretch:!0},l.t(null,void 0,n(942055))),revertInvalidData:!0}))),a.createElement("div",{className:he.separator},"—"),a.createElement("div",null,a.createElement("div",{className:he.datePickerWrapper},a.createElement(K.DatePicker,{InputComponent:Y.DateInput,initial:r.dateRange.to,onPick:function(e){if(e){const n=se(e);d({from:r.dateRange.from,to:n},t)}},minDate:r.dateBounds.dateToMin,maxDate:new Date,size:"xsmall",endSlotComponent:({onSelectDate:e})=>a.createElement($.SquareButton,{variant:"secondary",onClick:()=>{d({from:r.dateRange.from,to:new Date},t),e(new Date)},stretch:!0},l.t(null,void 0,n(777166))),revertInvalidData:!0}))))}var ye=n(458692),ve=n(634993),fe=n(217802),be=n(176406),_e=n(919476),Ce=n(901662);function we(e){const{strategy:t,strategies:r,onChangeStrategy:i}=e,o=(0,_e.decodeHTMLEntities)(t.metaInfo().shortDescription),c=l.t(o,{context:"study"},n(168716)),{isOpened:u,close:d,onButtonClick:p,buttonRef:h}=(0,ye.useDisclosure)({}),[m,g]=(0,a.useState)(t.id());return(0,a.useEffect)((()=>{g(t.id())}),[t]),a.createElement(a.Fragment,null,1===r.length?a.createElement("div",{"data-strategy-title":c,className:s()(Ce.singleStrategy,Ce.title,Ce.textEllipsis,"apply-overflow-tooltip"),title:c},c):a.createElement(fe.PopupMenuDisclosureView,{onClose:d,buttonRef:h,isOpened:u,button:a.createElement(be.TextButton,{"data-strategy-title":c,className:Ce.dropdownBtn,typography:"semibold14px",reference:h,onClick:p,color:"gray",size:"small",showCaret:!0},c),popupChildren:a.createElement(a.Fragment,null,r.map((e=>{const t=l.t(e.metaInfo().shortDescription,{context:"study"},n(168716));return a.createElement(ve.PopupMenuItem,{key:e.id(),label:t,onClick:()=>(e=>{d();const t=r.find((t=>t.id()===e));t&&(g(t.id()),i(t))})(e.id()),isActive:e.id()===m})})))}))}var Se=n(137982);function Te(e){var t;const{solutionId:r,className:i,tooltip:o,ariaLabel:s,disableHref:c=!1}=e,u=a.useCallback((e=>{e.preventDefault(),(0,D.showSupportDialog)({solutionId:r})}),[r]),d=null!==(t=null!=s?s:o)&&void 0!==t?t:l.t(null,void 0,n(790263))
;return a.createElement(Se.IconQuestionInformationLink,{href:c?"#":`/support/solutions/${r}`,onClick:u,className:i,tooltip:o,ariaLabel:d,icon:"question"})}var ke=n(826300),Ee=n(692831),De=n(788872),Ie=n(49437);const Re="properties_sections_dh",xe="properties_sections_qs";function He(e,t){return{percentNumber:"string"==typeof t?parseFloat(t):t,valueNumber:"string"==typeof e?parseFloat(e):e}}function Ve(e){return e+"Percent"}function Pe(e,t){return"string"==typeof t&&(t=parseFloat(t)),"string"!=typeof e&&e.isNegative?e.isNegative(null!=t?t:0):(null!=t?t:0)<0}function Ne(e,t){if(t)return te;const n=Ie.TVLocalStorage.getItem("backtesting");if(!n)return te;const r=1===e?Re:xe,a=JSON.parse(n);return a&&a[r]?a[r]:te}function Be(e,t,n){if(n)return;ce({[1===t?Re:xe]:e})}function ze(e){if(!e)return null;const t=e.activeChartWidget.value();return t.layoutId()+"_"+t.id()}var Oe=n(919892),Me=n(731042),Ae=n(988124),Fe=n.n(Ae),Le=n(157954),qe=n(716714);const We=new Le.DateFormatter("yyyy-MM-dd"),Ze=new qe.TimeFormatter(qe.hourMinuteFormat),Ge=new qe.TimeFormatter(qe.hourMinuteSecondFormat),je=new qe.TimeFormatter(qe.hourMinuteSecondMillisecFormat);function $e(e,t){return t?t.offset_utc(e):0}function Ue(e,t,n,r,a){const i=$e(e,r),o=new Date(e+i),s=o.getMilliseconds();if(!t)return We.format(o);const l=a?" ":" ";return n?s>0?We.format(o)+l+je.format(o):We.format(o)+l+Ge.format(o):We.format(o)+l+Ze.format(o)}function Qe(e,t,n){if(n){const n=$e(e,t);return new Date(e+n).getTime()}{const t=new Date(e);return(0,Ae.set_hms)(t,0,0,0,0),t.getTime()}}const Ke={contracts:l.t(null,void 0,n(689469)),percentOfEquity:l.t(null,void 0,n(726939)),dateRange:l.t(null,void 0,n(66174)),symbolInfo:l.t(null,void 0,n(665986)),strategyProperties:l.t(null,void 0,n(153914)),strategyInputs:l.t(null,void 0,n(503076)),tradingRange:l.t(null,void 0,n(413837)),backtestingRange:l.t(null,void 0,n(866178)),symbol:l.t(null,void 0,n(589053)),timeframe:l.t(null,void 0,n(578396)),chartType:l.t(null,void 0,n(93440)),pointValue:l.t(null,void 0,n(13193)),currency:l.t(null,void 0,n(50985)),tickSize:l.t(null,void 0,n(672076)),precision:l.t(null,void 0,n(173947)),initialCapital:l.t(null,void 0,n(565534)),orderSize:l.t(null,void 0,n(854589)),pyramiding:l.t(null,void 0,n(293571)),commission:l.t(null,void 0,n(744521)),slippage:l.t(null,void 0,n(161206)),verifyPriceForLimitOrders:l.t(null,void 0,n(154009)),marginForLongPos:l.t(null,void 0,n(550681)),marginForShortPos:l.t(null,void 0,n(907475)),recalculate:l.t(null,void 0,n(563209)),afterOrderFilled:l.t(null,void 0,n(217713)),onEveryTick:l.t(null,void 0,n(321088)),onBarClose:l.t(null,void 0,n(252965)),useBarMagnifier:l.t(null,void 0,n(132528)),backtestingPrecision:l.t(null,void 0,n(80107)),on:l.t(null,void 0,n(350467)),off:l.t(null,void 0,n(723618)),orders:l.t(null,{context:"Pyramiding: count orders"},n(501256)),ticks:l.t(null,{context:"slippage ... ticks"},n(461379))};var Ye=n(724377),Xe=n(841262),Je=n(413744),et=n(526075),tt=n(227695);class nt{constructor(e,t,n){this._strategy=e,this._timezone=n
;const r=new _.MetaInfoHelper(e.metaInfo());this._strategyInputs=r.getUserEditableInputs(),this._strategyInputsProperties=e.properties().childs().inputs,this._isIntraday=t.isIntraday(),this._isSeconds=t.isSeconds()}getStrategyInputs(){if(0===this._strategyInputs.length)return{title:Ke.strategyInputs,sectionType:"strategy_inputs",minimizedData:[],data:[]};let e=[];return(0,tt.getInputGroups)(this._strategyInputs).forEach((t=>{e=e.concat(this._getInputGroupValue(t))})),{title:Ke.strategyInputs,sectionType:"strategy_inputs",minimizedData:e.reduce(((e,t)=>t.short&&t.short.length?e.concat(t.short):e),[]),data:e}}_getSingleInputData(e){var t;if("color"===e.type){let t=this._strategyInputsProperties.childs()[e.id].value();const n=(0,Ye.tryParseRgb)(t);return n&&(t=(0,Ye.rgbToHexString)(n)),{title:e.name,type:"color",value:t}}if("time"===e.type){const t=this._strategyInputsProperties.childs()[e.id].value();return{title:e.name,value:Ue(t,this._isIntraday,this._isSeconds,this._timezone,!0)}}if("session"===e.type){const t=this._strategyInputsProperties.childs()[e.id].value(),[n,r]=(0,Xe.parseValue)(t);return{title:e.name,value:`${n} — ${r}`}}if("bool"===e.type){const t=this._strategyInputsProperties.childs()[e.id].value();return{title:e.name,value:t?Ke.on:Ke.off}}if("symbol"===e.type){const t=this._strategyInputsProperties.childs()[e.id].value();return{title:e.name,value:(0,Je.getInternalSymbolName)(t,this._strategy)}}if(et.StudyMetaInfo.isSourceInput(e)){const n=this._strategyInputsProperties.childs()[e.id].value(),r=e.options;return Array.isArray(r)&&-1!==r.indexOf(n)?{title:e.name,value:n}:{title:e.name,value:(null===(t=this._strategy.parentSourceForInput(n))||void 0===t?void 0:t.name())||""}}return{title:e.name,value:this._strategyInputsProperties.childs()[e.id].value()}}_getInlineInputRows(e){const t=[];return e.children.forEach((e=>{const n=this._getSingleInputData(e);if(null!==n)if(n.title)t.push({title:n.title,short:[{name:n.title,value:n.value}],cells:[{type:n.type,value:n.value}]});else if(t.length){const e=t[t.length-1];e.cells.push({value:n.value,type:n.type}),e.short||(e.short=[]),e.short.push({value:n.value})}})),t}_getInputGroupValue(e,t=[]){const n=[];if((0,tt.isInputInlines)(e)){const n=this._getInlineInputRows(e);n.length&&t.push(...n)}else if((0,tt.isGroup)(e))e.children.forEach((e=>{if((0,tt.isGroup)(e))return void n.push(e);const r=this._getSingleInputData(e);null!==r&&t.push({title:r.title,short:[{name:r.title,value:r.value}],cells:[{type:r.type,value:r.value}]})})),n.forEach((e=>{this._getInputGroupValue(e,t)}));else{const n=this._getSingleInputData(e);null!==n&&t.push({title:n.title,short:[{name:n.title,value:n.value}],cells:[{type:n.type,value:n.value}]})}return t}}var rt=n(444331);function at(e){return Object.keys(e).reduce(((t,n)=>{const r=e[n];return{...t,[n]:(0,b.isObject)(r)?r.v:r}}),{})}function it(e){return null===e?null:{strategy:at(w(e)),dependencies:S(e,!0).map((e=>at(e.inputs)))}}function ot(e){return null===e||void 0===e.minmov||void 0===e.pricescale?null:(0,
rt.createSeriesFormatter)(e,"default").format(e.minmov/e.pricescale)}function st(e){return e&&e.currency_code||null}function lt(e,t){const r=e.strategy;if(null===t||null===r)return[];const a=new _.MetaInfoHelper(r.metaInfo()),i=a.getStrategyProperties(),o=a.getUserEditableInputs(),s=r.properties().childs().inputs,c=[];if(t.settings&&c.push(function(e,t){const n=t.resolution.isIntraday(),r=t.resolution.isSeconds(),a=null===e.trade.from?"":Ue(e.trade.from,n,r,t.timezone,!0),i=null===e.trade.to?"":Ue(e.trade.to,n,r,t.timezone,!0),o=null===e.backtest.from?"":Ue(e.backtest.from,n,r,t.timezone,!0),s=null===e.backtest.to?"":Ue(e.backtest.to,n,r,t.timezone,!0),l=""===a&&""===i,c=l?" — ":`${a} — ${i}`,u=""===o&&""===s,d=u?" — ":`${o} — ${s}`,p=[];l||p.push({name:Ke.tradingRange,value:c});u||p.push({name:Ke.backtestingRange,value:d});return{title:Ke.dateRange,sectionType:"date_range",minimizedData:p,data:[{title:Ke.tradingRange,cells:[{value:c}]},{title:Ke.backtestingRange,cells:[{value:d}]}]}}(t.settings.dateRange,e)),c.push(function(e){const t=(0,Oe.decodeExtendedSymbol)(e.symbol).symbol,r="string"==typeof t?t:t.symbol,a=(0,Me.getTranslatedResolutionModel)(e.resolution.value()).hint,i=[{name:Ke.symbol,value:r},{name:Ke.timeframe,value:a},{name:Ke.chartType,value:e.chartStyle}];e.chartCurrency&&i.push({name:Ke.currency,value:e.chartCurrency});e.minTick&&i.push({name:Ke.tickSize,value:e.minTick});const o=e.minTickProperty?function(e){const t=e.value();if(!t)return null;if("default"===t)return l.t(null,void 0,n(204329));const r=t.split(",");return`${r[1]}/${r[0]}`}(e.minTickProperty):null;o&&i.push({name:Ke.precision,value:o});const s={title:Ke.symbolInfo,sectionType:"chart_settings",minimizedData:i,data:[{title:Ke.symbol,cells:[{type:"symbol",value:r}]},{title:Ke.timeframe,cells:[{value:a}]},{title:Ke.chartType,cells:[{value:e.chartStyle}]},{title:Ke.pointValue,cells:[{value:e.pointValue}]}]};e.chartCurrency&&s.data.push({title:Ke.currency,cells:[{value:e.chartCurrency}]});e.minTick&&s.data.push({title:Ke.tickSize,cells:[{value:e.minTick}]});o&&s.data.push({title:Ke.precision,cells:[{value:o}]});return s}(e)),o.length>0){const t=new nt(r,e.resolution,e.timezone);c.push(t.getStrategyInputs())}return c.push(function(e,t,r){const a=e=>{var n;const a=null===(n=t[e])||void 0===n?void 0:n.id;if(a)return a?String(r.childs()[a].value()):void 0},i=[],o=[];let s=a("currency");"NONE"===s&&(s=e||"");const c=function(e,t){switch(e){case"percent":return"%";case"cash_per_order":return t?" "+l.t(null,{replace:{currency:t}},n(791272)):"";case"cash_per_contract":return t?" "+l.t(null,{replace:{currency:t}},n(547896)):"";default:return""}}(a("commission_type")||"",s),u=function(e,t){switch(e){case"fixed":return" "+Ke.contracts;case"cash_per_order":return t?" "+t:"";case"percent_of_equity":return Ke.percentOfEquity;default:return""}
}(a("default_qty_type")||"",s),d=a("backtest_fill_limits_assumption"),p=a("initial_capital"),h=a("default_qty_value"),m=a("pyramiding"),g=a("commission_value"),y=a("slippage"),v=a("margin_long"),f=a("margin_short"),b=a("calc_on_order_fills"),_=a("calc_on_every_tick"),C=a("process_orders_on_close"),w=a("use_bar_magnifier");if(p){const e=`${p} ${s}`;i.push({name:Ke.initialCapital,value:e}),o.push({title:Ke.initialCapital,cells:[{value:e}]})}if(h){const e=h+u;i.push({name:Ke.orderSize,value:e}),o.push({title:Ke.orderSize,cells:[{value:e}]})}if(m){const e=`${m} ${Ke.orders}`;i.push({name:Ke.pyramiding,value:e}),o.push({title:Ke.pyramiding,cells:[{value:e}]})}if(g){const e=g+c;i.push({name:Ke.commission,value:e}),o.push({title:Ke.commission,cells:[{value:e}]})}if(y){const e=`${y} ${Ke.ticks}`;i.push({name:Ke.slippage,value:e}),o.push({title:Ke.slippage,cells:[{value:e}]})}d&&o.push({title:Ke.verifyPriceForLimitOrders,cells:[{value:`${d} ${Ke.ticks}`}]});v&&f&&o.push({title:Ke.marginForLongPos,cells:[{value:`${v}%`}]},{title:Ke.marginForShortPos,cells:[{value:`${f}%`}]});b&&o.push({title:`${Ke.recalculate} ${Ke.afterOrderFilled}`,cells:[{value:b?Ke.on:Ke.off}]});_&&o.push({title:`${Ke.recalculate} ${Ke.onEveryTick}`,cells:[{value:_?Ke.on:Ke.off}]});C&&o.push({title:`${Ke.recalculate} ${Ke.onBarClose}`,cells:[{value:C?Ke.on:Ke.off}]});w&&o.push({title:`${Ke.backtestingPrecision}. ${Ke.useBarMagnifier}`,cells:[{value:w?Ke.on:Ke.off}]});return{title:Ke.strategyProperties,sectionType:"strategy_properties",minimizedData:i,data:o}}(e.chartCurrency,i,s)),c}const ct={reportsData:null,propertiesTableData:null,listOfTradesTableProps:{columns:[{key:"tr",title:l.t(null,void 0,n(889516)),dataType:De.DataType.Number,sortDirection:function(){var e;const t=ue();return null!==(e=null==t?void 0:t.sort_direction_list_of_trades)&&void 0!==e?e:null}()||De.SortDirection.Descend},{key:"type",title:l.t(null,void 0,n(158416)),dataType:De.DataType.Object},{key:"sg",title:l.t(null,void 0,n(397251)),dataType:De.DataType.Object},{key:"dt",title:l.t(null,void 0,n(59536)),dataType:De.DataType.Object},{key:"pr",title:l.t(null,void 0,n(25684)),dataType:De.DataType.Object},{key:"cr",title:l.t(null,void 0,n(689469)),dataType:De.DataType.String},{key:"tp",title:l.t(null,void 0,n(486323)),dataType:De.DataType.Object},{key:"cp",title:l.t(null,void 0,n(806557)),dataType:De.DataType.Object},{key:"rn",title:l.t(null,void 0,n(831555)),dataType:De.DataType.Object},{key:"dd",title:l.t(null,void 0,n(424488)),dataType:De.DataType.Object}],data:[],sortingMode:De.SortingMode.Single,rowKeyField:"id",virtualScrolling:{enabled:!0,scrollTop:function(){const e=ue();return(null==e?void 0:e.scroll_settings_list_of_trades)||ne}().scrollTop}}};function ut(){return(0,a.createContext)({...ct,setReportsData:()=>{},tableDispatch:()=>{},reset:()=>{}})}function dt(e){return(0,ke.createSlice)({name:e,initialState:ct,reducers:{setReportsData:(e,t)=>{const{data:n,properties:r}=t.payload;e.reportsData=n,e.reportsData&&(e.propertiesTableData=lt(r,n)),
n&&n.trades&&(e.listOfTradesTableProps.data=n.trades.map(((e,t)=>{const n=function(e){if("object"!=typeof e||!e)return e;if("tp"in e)return e;const t=e.pfp,n=e.pf;return e.tp={p:t,v:n},e}(e);return{rawItem:e,tr:`${t+1}`,type:n,sg:n,dt:n,pr:n,cr:`${e.q}`,tp:n,cp:n,rn:n,dd:n,id:t}})))},updateListOfTradesTableProps:(e,t)=>{e.listOfTradesTableProps=(0,Ee.kaReducer)(e.listOfTradesTableProps,t.payload)},reset:()=>ct}})}function pt(e){const{userInputsState:t,chartCurrency:n,resolution:r,chartStyle:i,pointValue:o,strategy:s,timezone:l,minTick:c,symbol:u}=(0,a.useContext)(ee),[d,p]=(0,a.useReducer)(e.reducer,ct),h=(0,a.useCallback)((t=>{p(e.actions.setReportsData(t))}),[]),m=(0,a.useCallback)((t=>{p(e.actions.updateListOfTradesTableProps(t))}),[]),g=(0,a.useCallback)((()=>{p(e.actions.reset())}),[]);return(0,a.useEffect)((()=>{s&&p(e.actions.updateListOfTradesTableProps({type:De.ActionType.ScrollTable,scrollTop:0}))}),[t,n,r,i,o,s,l,c,u]),[d,{setReportsData:h,tableDispatch:m,reset:g}]}const ht=ut(),mt=dt("backtestingDataDeepHistory");function gt(e){const[t,n]=pt(mt),r=(0,a.useContext)(ee),{deepHistoryPrevRequestParams:i}=r,o=ae(i,r)?null:t.reportsData;return a.createElement(ht.Provider,{value:{...t,...n,reportsData:o}},e.children)}var yt=n(694553),vt=n(167442);const ft=l.t(null,void 0,n(181216));function bt(e){const{enabled:t,onSwitch:n}=e;return a.createElement("div",{className:vt.deepHistoryContainer},a.createElement("div",{className:vt.switchGroup},a.createElement(yt.Switch,{checked:t,onChange:n}),a.createElement("div",{className:s()(vt.switchTitle,vt.textEllipsis)},ft),a.createElement(Te,{solutionId:I.solutionIds.DEEP_BACKTESTING,className:vt.deepHistorySolution})))}var _t=n(191035),Ct=n(385319),wt=n(396607),St=n(839044),Tt=n(852386);const kt=(0,a.createContext)({logSnowplowEvent:(...e)=>{}});function Et(e){return a.createElement(kt.Provider,{value:{logSnowplowEvent:e.snowplowLogger}},e.children)}const Dt=l.t(null,void 0,n(37260)),It=l.t(null,void 0,n(158496)),Rt=l.t(null,void 0,n(61401)),xt=l.t(null,void 0,n(873369)),Ht=l.t(null,void 0,n(389517)),Vt=l.t(null,void 0,n(108700)),Pt=l.t(null,void 0,n(631811)),Nt=l.t(null,void 0,n(125769)),Bt={Overview:Dt,"Performance Summary":It,"List of Trades":Rt,Properties:xt},zt=[{id:"Overview",label:Bt.Overview},{id:"Performance Summary",label:Bt["Performance Summary"]},{id:"List of Trades",label:Bt["List of Trades"]},{id:"Properties",label:Bt.Properties}];function Ot(e){const{widgetType:t,strategy:r,strategies:i,deepHistoryDateRange:o,resolution:l,chartWidgetCollection:c,trackEvent:u,onGenerateReportClickCb:d,generateReportButtonEnabled:p,isStatic:h,activeReportTab:m,csvReportProgress:g,firstBarTime:y,layoutType:v}=e,{setWidgetType:f,setStrategy:b,setActiveReportTab:_}=(0,a.useContext)(ee),C=a.useContext(kt),{reportsData:w}=(0,a.useContext)(ht),S=null!==w,T=c&&c.activeChartWidget.value(),[k,E]=(0,a.useState)(),D=1===t,R=0===t||S,x=(0,a.useCallback)((e=>m===e.id),[m]),H=(0,a.useCallback)((e=>{_(e.id),C.logSnowplowEvent("click_tab",{item_id:e.id})}),[_,C]),V=(0,a.useCallback)((()=>{
null!==r&&p&&d()}),[d,p]),P=(0,a.useCallback)((()=>{{const e=D?"deep_history_on":"deep_history_off";(0,St.trackStrategyTesterButtonClick)(e)}D?f(0):(0,q.runOrGoPro)((()=>{f(1)}),Z.ProductFeatures.DEEP_HISTORY_BACKTEST,{feature:"deepHistoryBacktest"})}),[D,f]);return(0,a.useEffect)((()=>(r&&E(r),k&&r&&k.id()!==r.id()&&b(r),()=>{})),[r]),a.createElement(a.Fragment,null,a.createElement("div",{className:s()(Tt.container,h&&Tt.staticContainer,D&&(0===v?Tt.containerNarrow:Tt.containerWide))},a.createElement("div",{className:Tt.strategyGroup},k&&a.createElement(we,{strategies:i,strategy:k,onChangeStrategy:b}),!h&&a.createElement("div",{className:Tt.fixedContent},a.createElement(j.LightButton,{startIcon:_t,variant:"ghost",onClick:function(){if(null===r)return;C.logSnowplowEvent("click_button",{item_id:"settings"}),(0,St.trackStrategyTesterButtonClick)(D?"deep_history_on":"deep_history_off",{activeTab:m,button:"settings",isButtonOpen:!0});T&&T.showChartPropertiesForSource(r)},size:"small",className:"apply-common-tooltip",title:Ht,iconOnly:!0}),!D&&a.createElement(j.LightButton,{startIcon:Ct,variant:"ghost",onClick:function(){if(null===r)return;u("Alert Dialog"),(0,St.trackStrategyTesterButtonClick)(D?"deep_history_on":"deep_history_off",{activeTab:m,button:"create_alert",isButtonOpen:!0});window.runOrSignIn((async()=>{const{invokeAlertEditorWithOnlineSeries:e}=await Promise.all([n.e(32327),n.e(8287),n.e(22172)]).then(n.bind(n,429589));e({dataSourceHub:c?c.activeChartWidget.value().model().model():void 0,series:r,actionSource:"strategy_tester_add_alert"})}),{source:"Strategy widget alert button"})},size:"small",className:"apply-common-tooltip",title:Vt,iconOnly:!0}),"Overview"===m||D&&!S||!g&&a.createElement(j.LightButton,{startIcon:wt,variant:"ghost",onClick:function(){C.logSnowplowEvent("click_button",{item_id:"csv"}),(0,St.trackStrategyTesterButtonClick)(D?"deep_history_on":"deep_history_off",{activeTab:m,button:"download"});(0,W.enabled)(Z.ProductFeatures.EXPORT_CHART_DATA)?e.onCSVReportRequest&&e.onCSVReportRequest.fire():(0,Q.createGoProDialog)({feature:"backtestingExport"})},size:"small",className:"apply-common-tooltip",title:Nt,iconOnly:!0}),g&&a.createElement(j.LightButton,{variant:"ghost",size:"small"},a.createElement(U.Loader,{size:"small"})))),h&&a.createElement("div",{className:Tt.staticSupportButton},a.createElement(Te,{solutionId:I.solutionIds.BACKTESTING_WIDGET,className:Tt.supportButton})),!h&&a.createElement(bt,{enabled:D,onSwitch:P}),!h&&a.createElement("div",{className:s()(Tt.historyParams,!D&&"i-hidden",1===v&&Tt.historyParamsWide)},a.createElement(ge,{deepHistoryDateRange:o,resolution:l,firstBarTime:y}),a.createElement($.SquareButton,{className:Tt.generateReportBtn,size:"xsmall",onClick:V,disabled:!p},Pt))),a.createElement("div",{className:Tt.tabsContainer},a.createElement(G.UnderlineButtonTabs,{id:"report-tabs",items:zt,onActivate:H,isActive:x,disabled:!R,size:"xsmall",overflowBehaviour:"none"})))}function Mt(e){return{se:l.t(null,void 0,n(871181)),sx:l.t(null,void 0,n(150631)),
le:l.t(null,void 0,n(593916)),lx:l.t(null,void 0,n(819530))}[e]||e}const At="Etc/UTC";function Ft(e,t,n){const r=function(e,t){let n=e.value();return n&&"exchange"===n&&t&&(n=t),n||At}(e,t);if(n&&r===n.name())return n;if(!Fe())throw new ReferenceError("PineJsCalendar is undefined");const a=Fe().get_timezone(r);return a.is_valid()?a:null}function Lt(e){e.strategy&&ce({strategy_id:e.strategy.id()});const t=ae(e.deepHistoryPrevRequestParams,e);return(t||e.strategy)&&pe(),{...e,generateReportButtonEnabled:t}}function qt(e,t){var n,a,i,o;switch(t.type){case"updateSymbol":const s=null===e.minTickProperty?null:ot(t.symbolInfo),l=t.symbolInfo?t.symbolInfo.timezone:null,c=e.tzProperty?Ft(e.tzProperty,l,e.timezone):e.timezone;return Lt({...e,timezone:c,chartCurrency:t.chartCurrency,minTick:s,chartStyle:t.chartStyle,pointValue:t.pointValue,symbol:t.symbolStr,strategyHintProps:t.strategyHintProps,formatter:t.formatter,resolution:t.resolution,extendedSymbol:t.extendedSymbol});case"onUpdateChartStyle":return{...e,chartStyle:t.chartStyle};case"setWidgetType":return Lt({...e,widgetType:t.widgetType,strategyHintProps:P(t.widgetType,t.isRangeBasedStyle,null===(n=e.strategy)||void 0===n?void 0:n.metaInfo().lookaheadFutureData)});case"setDeepHistoryDateRange":const u=null===(a=t.deepHistoryDateRange.dateRange)||void 0===a?void 0:a.from.getTime(),d=null===(i=t.deepHistoryDateRange.dateRange)||void 0===i?void 0:i.to.getTime(),p=e.deepHistoryDateRange.dateRange.from.getTime(),h=e.deepHistoryDateRange.dateRange.to.getTime();if(u===p&&d===h)return e;const m={...e.deepHistoryDateRange,...t.deepHistoryDateRange};return Lt({...e,deepHistoryDateRange:m});case"setResolution":return function(e,t){if(e.resolution.value()===t.resolution.value())return e;const n=oe(e.deepHistoryDateRange.dateRange,t.resolution);return Lt({...e,resolution:t.resolution,deepHistoryDateRange:n})}(e,t);case"setStrategy":return t.selectedStrategyManager.setSelectedStrategy(t.strategy),Lt({...e,strategy:t.strategy,generateReportButtonEnabled:!0,userInputsState:it(t.strategy)});case"onGenerateButtonClick":return e.generateReportButtonEnabled&&1===e.widgetType?((0,St.trackStrategyTesterButtonClick)(1===e.widgetType?"deep_history_on":"deep_history_off",{activeTab:e.activeReportTab,button:"generate_report"}),{...e,generateReportButtonEnabled:!1,deepHistoryPrevRequestParams:null,deepHistoryCurrentRequestParams:{resolution:e.resolution,symbol:e.symbol,extendedSymbol:e.extendedSymbol,strategy:e.strategy,deepHistoryDateRange:e.deepHistoryDateRange,strategyInputsState:(0,r.ensureNotNull)(it(e.strategy)),timezone:e.timezone,excludeTrades:!0}}):e;case"updateStateOnChartChange":return function(e,t){const n=t.resolution,r=t.symbolInfo?t.symbolInfo.timezone:null,a=t.tzProperty?Ft(t.tzProperty,r,e.timezone):e.timezone,i=oe(e.deepHistoryDateRange.dateRange,n),o=t.selectedStrategyManager.updateSelectedStrategy(t.newStrategies,t.chartChanged,t.strategyToSelect);return Lt({...e,resolution:n,timezone:a,
strategyHintProps:P(e.widgetType,t.isRangeBasedStyle,null==o?void 0:o.metaInfo().lookaheadFutureData),formatter:t.formatter,chartStyle:t.chartStyle,chartCurrency:t.chartCurrency,pointValue:t.pointValue,minTick:t.minTick,deepHistoryDateRange:i,strategy:o,strategies:t.newStrategies,symbol:t.symbolStr,extendedSymbol:t.extendedSymbol,userInputsState:it(o),tzProperty:t.tzProperty,minTickProperty:t.minTickProperty})}(e,t);case"onTimezoneChange":return Lt({...e,timezone:Ft(t.tzProperty,t.symbolInfoTimezone,e.timezone)});case"onMinTickChange":const g=null===e.minTickProperty?null:ot(t.symbolInfo);return{...e,formatter:t.formatter,minTick:g};case"setGenerateReportButtonEnabled":return{...e,generateReportButtonEnabled:t.enabled};case"setActiveReportTab":return 1===e.widgetType?((0,St.trackStrategyTesterButtonClick)("deep_history_on",{button:t.reportTab,isButtonOpen:!0}),{...e,activeReportTab:t.reportTab,strategyHintProps:{isDeepHistory:!0,isRangeBasedStyle:t.isRangeBasedStyle,hasLookaheadFutureData:e.strategyHintProps.hasLookaheadFutureData}}):((0,St.trackStrategyTesterButtonClick)("deep_history_off",{button:t.reportTab,isButtonOpen:!0}),{...e,activeReportTab:t.reportTab});case"onDeepHistoryDataUpdate":return{...e,deepHistoryPrevRequestParams:e.deepHistoryCurrentRequestParams,deepHistoryCurrentRequestParams:null,strategyHintProps:{isDeepHistory:!0,isRangeBasedStyle:t.isRangeBasedStyle,hasLookaheadFutureData:e.strategyHintProps.hasLookaheadFutureData}};case"setStrategyHintProps":return{...e,strategyHintProps:t.strategyHintProps,generateReportButtonEnabled:null!==(o=t.generateReportButtonEnabled)&&void 0!==o?o:e.generateReportButtonEnabled};case"setCSVReportInProgress":return{...e,csvReportProgress:t.inProgress};case"onUserInputsChange":const y=it(e.strategy);return Lt({...e,userInputsState:y,generateReportButtonEnabled:!0});case"onLayoutWidthChange":const v=t.width<1279?1:0;return{...e,layoutType:v};default:return e}}class Wt{constructor(e,t,n){this._chartStrategyMap={},this._currentChartId=n,this._strategies=e,this.setSelectedStrategy(t)}setSelectedStrategy(e){null!==this._currentChartId&&(this._chartStrategyMap[this._currentChartId]=e?e.id():null)}setCurrentChartId(e){this._currentChartId=e}updateSelectedStrategy(e,t,n){const r=this._strategies;if(this._strategies=e,t)return this._setCurrentOrDefaultStrategy();if(n)return n;const a=this._setNewStrategy(r);return null!==a?a:this._setCurrentOrDefaultStrategy()}_setCurrentOrDefaultStrategy(){const e=this._getCurrentStrategy();if(null!==e)return e;const t=this._strategies[0]||null;return this.setSelectedStrategy(t),t}_setNewStrategy(e){const t=this._getNewStrategy(e);return t?(this.setSelectedStrategy(t),t):null}_getCurrentStrategy(){if(null===this._currentChartId)return null;const e=this._chartStrategyMap[this._currentChartId];if(!e)return null;for(let t=0;t<this._strategies.length;t++)if(this._strategies[t].id()===e)return this._strategies[t];return null}_getNewStrategy(e){const t=this._strategies.find((t=>-1===e.indexOf(t)));return null!=t?t:null}}const Zt={
0:l.t(null,void 0,n(16812)),1:l.t(null,void 0,n(463528)),2:l.t(null,void 0,n(301277)),14:l.t(null,void 0,n(938397)),15:l.t(null,void 0,n(79511)),3:l.t(null,void 0,n(542097)),16:l.t(null,void 0,n(134911)),9:l.t(null,void 0,n(661582)),10:l.t(null,void 0,n(117712)),12:l.t(null,void 0,n(631994)),13:l.t(null,void 0,n(636018))};function Gt(e,t){switch(t){case 0:case 1:case 2:case 14:case 15:case 3:case 16:case 9:case 10:case 12:case 13:return Zt[t];default:return e.statusProvider({}).getSplitTitle().chartStyle}}var jt=n(443549),$t=n(737340);function Ut(e){const t=(0,c.useWatchedValueReadonly)({watchedValue:e.height});return a.createElement(a.Fragment,null,a.createElement("div",{className:$t.wrapper},a.createElement(B.EmptyStateBlock,{iconClass:t>300?$t.emptyStateIcon:void 0,title:l.t(null,void 0,n(246992)),text:l.t(null,void 0,n(631425))})))}var Qt=n(763532),Kt=n(958067);function Yt(e){return e?" "+e:""}function Xt(e,t,n){const r=new Date;n=n.replace(/\s/g,"_");const a=`${t=t.replace(/\s/g,"_")}_${n}_${Kt.dateFormatFunctions["yyyy-MM-dd"](r,!0)}.csv`;(0,Qt.saveTextFile)(a,e,"text/csv; charset=utf-8")}class Jt{constructor(e,t){this._strategyName=e,this._currentData=t}renderCSVReport(){if(this._currentData){const e=this._createPropertiesDataForCSV(this._currentData);Xt(this._getPropertiesDataCSVString(e),this._strategyName,"Properties")}}_getPropertiesDataCSVString(e){return[[(0,Qt.escapeCSVValue)(l.t(null,void 0,n(767369))),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(660187)))].join(","),...Object.values(e).map((e=>{const t=e.cells.reduce(((e,t)=>e+t.value),"");return[(0,Qt.escapeCSVValue)(e.title),(0,Qt.escapeCSVValue)(t)].join(",")}))].join("\r\n")}_createPropertiesDataForCSV(e){const t={};let n=0;for(let r=0;r<e.length;r++){const a=e[r].data;for(let e=0;e<a.length;e++)if(a[e].cells.length>1){const r=a[e].cells;for(let i=0;i<r.length;i++){const o={title:0===i?a[e].title:"",cells:Array(r[i])};t[n]=o,n++}}else t[n]=a[e],n++}return t}}function en(e){return 0!==e}function tn(e){return e<0}const nn={drawdown:{_gaEvent:"Overview",settings:{title:l.t(null,void 0,n(37260)),miniChartMinHeight:78,overviewPerformanceFields:["netProfit","totalTrades","percentProfitable","profitFactor","maxStrategyDrawDown","avgTrade","avgBarsInTrade"]}},performance:{_gaEvent:"Performance Summary",settings:{title:l.t(null,void 0,n(158496)),fields:{netProfit:{title:l.t(null,void 0,n(975990)),desc:l.t(null,void 0,n(542422)),unit:"currency",isNegative:tn,solutionId:43000681684},grossProfit:{title:l.t(null,void 0,n(366612)),unit:"currency",solutionId:43000681686},grossLoss:{title:l.t(null,void 0,n(747872)),unit:"currency",isNegative:en,solutionId:43000681688},maxStrategyRunUp:{title:l.t(null,void 0,n(486036)),unit:"currency",isNegative:en,solutionId:43000682585},maxStrategyDrawDown:{title:l.t(null,void 0,n(95059)),desc:l.t(null,void 0,n(215468)),unit:"currency",isAlwaysNegative:()=>!0,solutionId:43000681690},buyHoldReturn:{title:l.t(null,void 0,n(60438)),unit:"currency",solutionId:43000681691},sharpeRatio:{title:l.t(null,void 0,n(927307)),
solutionId:43000681694},sortinoRatio:{title:l.t(null,void 0,n(348882)),solutionId:43000681697},profitFactor:{title:l.t(null,void 0,n(798994)),desc:l.t(null,void 0,n(932254)),isNegative:e=>e<1,solutionId:43000681698},maxContractsHeld:{title:l.t(null,void 0,n(887127)),unit:"pc",solutionId:43000681700},openPL:{title:l.t(null,void 0,n(792941)),unit:"currency",solutionId:43000681701},commissionPaid:{title:l.t(null,void 0,n(971800)),unit:"currency",solutionId:43000681703},totalTrades:{title:l.t(null,void 0,n(923166)),desc:l.t(null,void 0,n(721035)),unit:"pc",isNegative:tn,solutionId:43000681704},totalOpenTrades:{title:l.t(null,void 0,n(394734)),unit:"pc",solutionId:43000681711},numberOfWiningTrades:{title:l.t(null,void 0,n(990826)),unit:"pc",solutionId:43000681712},numberOfLosingTrades:{title:l.t(null,void 0,n(903799)),unit:"pc",solutionId:43000681713},percentProfitable:{title:l.t(null,void 0,n(990298)),desc:l.t(null,void 0,n(921608)),unit:"percent",isNegative:tn,solutionId:43000681714},avgTrade:{title:l.t(null,void 0,n(857761)),desc:l.t(null,void 0,n(537736)),unit:"currency",isNegative:tn,solutionId:43000681715},avgWinTrade:{title:l.t(null,void 0,n(39940)),unit:"currency",solutionId:43000681717},avgLosTrade:{title:l.t(null,void 0,n(157209)),unit:"currency",isNegative:en,solutionId:43000681718},ratioAvgWinAvgLoss:{title:l.t(null,void 0,n(59261)),solutionId:43000681719},largestWinTrade:{title:l.t(null,void 0,n(368480)),unit:"currency",solutionId:43000681720},largestLosTrade:{title:l.t(null,void 0,n(814866)),unit:"currency",isNegative:en,solutionId:43000681722},avgBarsInTrade:{title:l.t(null,void 0,n(206933)),desc:l.t(null,void 0,n(158181)),unit:"pc",solutionId:43000681723},avgBarsInWinTrade:{title:l.t(null,void 0,n(801361)),unit:"pc",solutionId:43000681725},avgBarsInLossTrade:{title:l.t(null,void 0,n(994499)),unit:"pc",solutionId:43000681726},marginCalls:{title:l.t(null,void 0,n(709048)),unit:"pc",solutionId:43000681727}}}},trades:{_gaEvent:"List of Trades",settings:{title:l.t(null,void 0,n(61401))}},properties:{_gaEvent:"Properties",settings:{title:l.t(null,void 0,n(873369))}}};var rn=n(31341);function an(e){let{value:t}=e;if(null==t)return"";const{unit:r,dataCurrency:a,chartCurrency:i,formatter:o=null,isCSVReport:s=!1}=e;let c=l.t(null,void 0,n(343088)),u="",d=1;switch(t="number"==typeof t?t:parseFloat(t),r){case"series":if(c=o?o.format(t):t.toString(),s)break;i&&(u=" "+i);break;case"currency":if(c=t<Math.pow(10,-2)?(()=>{for(let e=2;e<=8;e++){const n=on(t,e);if(0!==n)return n.toFixed(e)}return"0"})():on(t,2).toFixed(2),s)break;let e=parseFloat(c);if(d=Math.sign(e),-1===d&&(e*=d),c=e.toFixed(2),a){u="none"===a.toLowerCase()?"":" "+a}else u=" ?";break;case"percent":let n=on(100*t,2);if(c=n.toString(),s)break;d=Math.sign(n),-1===d&&(n*=d),c=n.toString(),u="%";break;case"pc":c=Math.round(t).toString();break;default:let r=on(t,3);if(c=r.toString(),s)break;d=Math.sign(r),-1===d&&(r*=d),c=r.toString()}s||(c=function(e){const t=".",n=e.split(t);let r=n[0];const a=n[1];if(r.length<=3)return n.join(".");const i=" ",o=[]
;for(;r.length>3;)o.push(r.slice(-3)),r=r.slice(0,r.length-3);if(o.reverse(),a)return r.concat(i,o.join(i),t,a);return r.concat(i,o.join(i))}(c));let p=c+u;return-1===d&&(p="−"+p),(0,rn.forceLTRStr)(p)}function on(e,t){const n=parseFloat(Math.pow(10,t||0).toFixed(t<0?-t:0));return Math.round(e*n)/n}const sn=["all","long","short"],ln=nn.performance.settings.fields;class cn{constructor(e,t,n,r,a){this._performanceData=e,this._dataCurrency=r,this._chartCurrency=n,this._formatter=a,this._strategyName=t}renderCSVReport(){const e=this._createPerformanceDataForCSV();Xt(this._getPerformanceDataCSVString(e,this._dataCurrency),this._strategyName,"Performance Summary")}_createPerformanceDataForCSV(){const e=Object.keys(ln),t={};let n={};for(let r=0;r<e.length;r++){const a=e[r],i=Ve(a);let o=!1,s=ln[a].title||"";n.title=s;for(let e=0;e<sn.length;e++){const s=sn[e],l=He(this._performanceData[s][a],this._performanceData[s][i]);void 0!==l.valueNumber&&(n[`${sn[e]}`]=this._makeCSVReportCellValue(a,l.valueNumber,void 0),void 0!==l.percentNumber&&(n[`${sn[e]}Percent`]=this._makeCSVReportCellValue(a,l.valueNumber,l.percentNumber)),o=!0),2===e&&(t[`${r}`]=n,n={})}if(!o){s=ln[a].title||"";const e=He(this._performanceData[a],this._performanceData[i]),o=this._makeCSVReportCellValue(a,e.valueNumber,void 0);void 0!==e.percentNumber&&(n[`${sn[0]}Percent`]=this._makeCSVReportCellValue(a,e.valueNumber,e.percentNumber)),n.title=s,n[`${sn[0]}`]=o,t[`${r}`]=n,n={}}}return t}_getPerformanceDataCSVString(e,t){const r=Yt(t),a=Yt("%");return[[(0,Qt.escapeCSVValue)(""),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(695271))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(695271))+`${a}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(273064))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(273064))+`${a}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(777851))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(777851))+`${a}`)].join(","),...Object.values(e).map((e=>[(0,Qt.escapeCSVValue)(e.title?e.title:""),(0,Qt.escapeCSVValue)(e.all?e.all:""),(0,Qt.escapeCSVValue)(e.allPercent?e.allPercent:""),(0,Qt.escapeCSVValue)(e.long?e.long:""),(0,Qt.escapeCSVValue)(e.longPercent?e.longPercent:""),(0,Qt.escapeCSVValue)(e.short?e.short:""),(0,Qt.escapeCSVValue)(e.shortPercent?e.shortPercent:"")].join(",")))].join("\r\n")}_makeCSVReportCellValue(e,t,r){if(null==t)return l.t(null,void 0,n(343088));const a=ln[e];return an(null==r?{value:t,unit:a.unit,dataCurrency:this._dataCurrency,chartCurrency:this._chartCurrency,formatter:this._formatter,isCSVReport:!0}:{value:r,unit:"percent",dataCurrency:this._dataCurrency,chartCurrency:this._chartCurrency,formatter:this._formatter,isCSVReport:!0})}}const un=["x","e"];class dn{constructor(e,t,n,r,a,i,o){this._tradesData=e,this._strategyName=t,this._timezone=n,this._isSeconds=r.isSeconds(),this._isIntraday=r.isIntraday(),this._chartCurrency=a,this._formatter=o,this._dataCurrency=i}async renderCSVReport(){const e=[];let t=0;for(;t<this._tradesData.length;)await new Promise((n=>setTimeout((()=>{this._createTradesDataForCSV(this._tradesData,t,t+100,e),
t+=100,n()}),0)));if(e.length){Xt(this._getTradesDataCSVString(e,this._dataCurrency),this._strategyName,"List of Trades")}}_createTradesDataForCSV(e,t,n,r){const a=Math.min(n,e.length);for(let n=t;n<a;n++){const t=this._createTradesDataItem(e[n]);for(const e of t)r.push(e)}}_getTradesDataCSVString(e,t){const r=Yt(t),a=Yt(this._chartCurrency),i=Yt("%");return[[(0,Qt.escapeCSVValue)(l.t(null,void 0,n(889516))),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(158416))),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(397251))),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(59536))),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(25684))+`${a}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(689469))),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(486323))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(486323))+`${i}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(806557))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(806557))+`${i}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(831555))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(831555))+`${i}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(424488))+`${r}`),(0,Qt.escapeCSVValue)(l.t(null,void 0,n(424488))+`${i}`)].join(","),...e.map((e=>[(0,Qt.escapeCSVValue)(e.trade?e.trade:""),(0,Qt.escapeCSVValue)(e.type?e.type:""),(0,Qt.escapeCSVValue)(e.signal?e.signal:""),(0,Qt.escapeCSVValue)(e.date?e.date:""),(0,Qt.escapeCSVValue)(e.price?e.price:""),(0,Qt.escapeCSVValue)(e.contracts?e.contracts:""),(0,Qt.escapeCSVValue)(e.profit?e.profit:""),(0,Qt.escapeCSVValue)(e.profitPercent?e.profitPercent:""),(0,Qt.escapeCSVValue)(e.cumProfit?e.cumProfit:""),(0,Qt.escapeCSVValue)(e.cumProfitPercent?e.cumProfitPercent:""),(0,Qt.escapeCSVValue)(e.runUp?e.runUp:""),(0,Qt.escapeCSVValue)(e.runUpPercent?e.runUpPercent:""),(0,Qt.escapeCSVValue)(e.drawdown?e.drawdown:""),(0,Qt.escapeCSVValue)(e.drawdownPercent?e.drawdownPercent:"")].join(",")))].join("\r\n")}_makeTradeProfitCellCSVReportImpl(e,t,n){if(!e&&void 0!==t[n]&&"number"==typeof t[n].v){const e=an({value:t[n].v,unit:"currency",dataCurrency:this._dataCurrency,chartCurrency:this._chartCurrency,formatter:this._formatter,isCSVReport:!0});return"number"==typeof t[n].p?{value:e,percent:an({value:t[n].p,unit:"percent",dataCurrency:this._dataCurrency,chartCurrency:this._chartCurrency,formatter:this._formatter,isCSVReport:!0})}:e}return""}_getOrderDate(e){return Ue(e,this._isIntraday||!1,this._isSeconds||!1,this._timezone,!0)}_createTradesDataItem(e){const t=e.rawItem,r=new Array(un.length);let a=!1;const i=!t.x.c;for(let o=0;o<un.length;o++){const s=un[o],c=!t[s].c;!a&&c&&(a=!0);const u=this._makeTradeProfitCellCSVReportImpl(a,t,"tp"),d=this._makeTradeProfitCellCSVReportImpl(a,t,"cp"),p=this._makeTradeProfitCellCSVReportImpl(a,t,"rn"),h=this._makeTradeProfitCellCSVReportImpl(a,t,"dd");r[o]={trade:e.tr.toString(),type:Mt(t[s].tp),signal:c&&l.t(null,void 0,n(539280))||t[s].c,date:!c&&t[s].tm&&this._getOrderDate(t[s].tm)||"",price:!c&&t[s].p&&an({value:t[s].p,unit:"series",dataCurrency:this._dataCurrency,chartCurrency:this._chartCurrency,formatter:this._formatter,isCSVReport:!0})||"",
contracts:!i&&!a&&t.q.toString()||"",profit:!i&&u.value||"",profitPercent:!i&&u.percent||"",cumProfit:!i&&d.value||"",cumProfitPercent:!i&&d.percent||"",runUp:!i&&p.value||"",runUpPercent:!i&&p.percent||"",drawdown:!i&&h.value||"",drawdownPercent:!i&&h.percent||""}}return r}}var pn=n(489964);function hn(e){const{strategy:t,activeReportTab:n,symbol:r,resolution:i,chartStyle:o,pointValue:s,chartCurrency:l,minTick:c,timezone:u,onCSVReportRequest:d,hidden:p,reportsData:h,tableData:m}=e,g=(0,a.useRef)(e);g.current=e,(0,a.useEffect)((()=>{function t(){const{setCSVReportProgress:t}=g.current,n=g.current.strategy,r=g.current.reportsData,a=g.current.activeReportTab;if(null===n||!r)return;const o=n.metaInfo().description,s=r.currency,l=g.current.chartCurrency,c=g.current.formatter;switch(a){case"Overview":break;case"Properties":t(!0);const n=lt(e,r);new Jt(o,n).renderCSVReport(),t(!1);break;case"Performance Summary":const a=r.performance;if(!s||!a)return;t(!0),new cn(a,o,l,s,c).renderCSVReport(),t(!1);break;case"List of Trades":const d=pn.kaPropsUtils.getData(m);d&&s&&(t(!0),new dn(d,o,u,i,l,s,c).renderCSVReport().then((()=>{t(!1)})))}}if(!p)return d.subscribe(null,t),()=>{d.unsubscribe(null,t)}}),[d,n,l,h,i,o,s,m,t,u,c,r,p])}var mn=n(314802);const gn=()=>{},yn="~m~";class vn{constructor(e,t={}){this.sessionid=null,this.connected=!1,this._timeout=null,this._base=e,this._options={timeout:t.timeout||2e4,connectionType:t.connectionType}}connect(){this._socket=new WebSocket(this._prepareUrl()),this._socket.onmessage=e=>{if("string"!=typeof e.data)throw new TypeError(`The WebSocket message should be a string. Recieved ${Object.prototype.toString.call(e.data)}`);this._onData(e.data)},this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)}send(e){this._socket&&this._socket.send(this._encode(e))}disconnect(){this._clearIdleTimeout(),this._socket&&(this._socket.onmessage=gn,this._socket.onclose=gn,this._socket.onerror=gn,this._socket.close())}_clearIdleTimeout(){null!==this._timeout&&(clearTimeout(this._timeout),this._timeout=null)}_encode(e){let t,n="";const r=Array.isArray(e)?e:[e],a=r.length;for(let e=0;e<a;e++)t=null===r[e]||void 0===r[e]?"":vn._stringify(r[e]),n+=yn+t.length+yn+t;return n}_decode(e){const t=[];let n,r;do{if(e.substring(0,3)!==yn)return t;n="",r="";const a=(e=e.substring(3)).length;for(let t=0;t<a;t++){if(r=Number(e.substring(t,t+1)),Number(e.substring(t,t+1))!==r){e=e.substring(n.length+yn.length),n=Number(n);break}n+=r}t.push(e.substring(0,n)),e=e.substring(n)}while(""!==e);return t}_onData(e){this._setTimeout();const t=this._decode(e),n=t.length;for(let e=0;e<n;e++)this._onMessage(t[e])}_setTimeout(){this._clearIdleTimeout(),this._timeout=setTimeout(this._onTimeout.bind(this),this._options.timeout)}_onTimeout(){this.disconnect(),this._onDisconnect({code:4e3,reason:"socket.io timeout",wasClean:!1})}_onMessage(e){
this.sessionid?this._checkIfHeartbeat(e)?this._onHeartbeat(e.slice(3)):this._checkIfJson(e)?this._base.onMessage(JSON.parse(e.slice(3))):this._base.onMessage(e):(this.sessionid=e,this._onConnect())}_checkIfHeartbeat(e){return this._checkMessageType(e,"h")}_checkIfJson(e){return this._checkMessageType(e,"j")}_checkMessageType(e,t){return e.substring(0,3)==="~"+t+"~"}_onHeartbeat(e){this.send("~h~"+e)}_onConnect(){this.connected=!0,this._base.onConnect()}_onDisconnect(e){this._clear(),this._base.onDisconnect(e),this.sessionid=null}_clear(){this.connected=!1}_prepareUrl(){const e=bn(this._base.host);if(e.pathname+="socket.io/websocket",e.protocol="wss:",e.searchParams.append("from",window.location.pathname.slice(1,50)),e.searchParams.append("date",window.BUILD_TIME||""),(0,mn.isOnMobileAppPage)("any")&&e.searchParams.append("client","mobile"),this._options.connectionType&&e.searchParams.append("type",this._options.connectionType),window.WEBSOCKET_PARAMS_ANALYTICS){const{ws_page_uri:t,ws_ancestor_origin:n}=window.WEBSOCKET_PARAMS_ANALYTICS;t&&e.searchParams.append("page-uri",t),n&&e.searchParams.append("ancestor-origin",n)}return e.href}_onClose(e){this._clearIdleTimeout(),this._onDisconnect(e)}_onError(e){this._clearIdleTimeout(),this._clear(),this._base.emit("error",[e]),this.sessionid=null}static _stringify(e){return"[object Object]"===Object.prototype.toString.call(e)?"~j~"+JSON.stringify(e):String(e)}}class fn{constructor(e,t){this.host=e,this._connecting=!1,this._events={},this.transport=this._getTransport(t)}isConnected(){return!!this.transport&&this.transport.connected}isConnecting(){return this._connecting}connect(){this.isConnected()||(this._connecting&&this.disconnect(),this._connecting=!0,this.transport.connect())}send(e){this.transport&&this.transport.connected&&this.transport.send(e)}disconnect(){this.transport&&this.transport.disconnect()}on(e,t){e in this._events||(this._events[e]=[]),this._events[e].push(t)}offAll(){this._events={}}onMessage(e){this.emit("message",[e])}emit(e,t=[]){if(e in this._events){const n=this._events[e].concat(),r=n.length;for(let e=0;e<r;e++)n[e].apply(this,t)}}onConnect(){this.clear(),this.emit("connect")}onDisconnect(e){this.emit("disconnect",[e])}clear(){this._connecting=!1}_getTransport(e){return new vn(this,e)}}function bn(e){const t=-1!==e.indexOf("/")?new URL(e):new URL("wss://"+e);if("wss:"!==t.protocol&&"https:"!==t.protocol)throw new Error("Invalid websocket base "+e);return t.pathname.endsWith("/")||(t.pathname+="/"),t.search="",t.username="",t.password="",t}var _n=n(978137);const Cn=Number(window.TELEMETRY_WS_ERROR_LOGS_THRESHOLD)||0;class wn{constructor(e,t={}){this._queueStack=[],this._logsQueue=[],this._telemetryObjectsQueue=[],this._reconnectCount=0,this._redirectCount=0,this._errorsCount=0,this._errorsInfoSent=!1,this._connectionStart=null,this._connectionEstablished=null,this._reconnectTimeout=null,this._onlineCancellationToken=null,this._isConnectionForbidden=!1,this._initialHost=t.initialHost||null,this._suggestedHost=e,this._proHost=t.proHost,
this._reconnectHost=t.reconnectHost,this._noReconnectAfterTimeout=!0===t.noReconnectAfterTimeout,this._dataRequestTimeout=t.dataRequestTimeout,this._connectionType=t.connectionType,this._doConnect(),t.pingRequired&&-1===window.location.search.indexOf("noping")&&this._startPing()}connect(){this._tryConnect()}resetCounters(){this._reconnectCount=0,this._redirectCount=0}setLogger(e,t){this._logger=e,this._getLogHistory=t,this._flushLogs()}setTelemetry(e){this._telemetry=e,this._telemetry.reportSent.subscribe(this,this._onTelemetrySent),this._flushTelemetry()}onReconnect(e){this._onReconnect=e}isConnected(){return!!this._socket&&this._socket.isConnected()}isConnecting(){return!!this._socket&&this._socket.isConnecting()}on(e,t){return!!this._socket&&("connect"===e&&this._socket.isConnected()?t():"disconnect"===e?this._disconnectCallbacks.push(t):this._socket.on(e,t),!0)}getSessionId(){return this._socket&&this._socket.transport?this._socket.transport.sessionid:null}send(e){return this.isConnected()?(this._socket.send(e),!0):(this._queueMessage(e),!1)}getConnectionEstablished(){return this._connectionEstablished}getHost(){const e=this._tryGetProHost();return null!==e?e:this._reconnectHost&&this._reconnectCount>3?this._reconnectHost:this._suggestedHost}getReconnectCount(){return this._reconnectCount}getRedirectCount(){return this._redirectCount}getConnectionStart(){return this._connectionStart}disconnect(){this._clearReconnectTimeout(),(this.isConnected()||this.isConnecting())&&(this._propagateDisconnect(),this._disconnectCallbacks=[],this._closeSocket())}forbidConnection(){this._isConnectionForbidden=!0,this.disconnect()}allowConnection(){this._isConnectionForbidden=!1,this.connect()}isMaxRedirects(){return this._redirectCount>=20}isMaxReconnects(){return this._reconnectCount>=20}getPingInfo(){return this._pingInfo||null}_tryGetProHost(){return window.TradingView&&window.TradingView.onChartPage&&"battle"===window.environment&&!this._redirectCount&&-1===window.location.href.indexOf("ws_host")?this._initialHost?this._initialHost:void 0!==window.user&&window.user.pro_plan?this._proHost||this._suggestedHost:null:null}_queueMessage(e){0===this._queueStack.length&&this._logMessage(0,"Socket is not connected. Queued a message"),this._queueStack.push(e)}_processMessageQueue(){0!==this._queueStack.length&&(this._logMessage(0,"Processing queued messages"),this._queueStack.forEach(this.send.bind(this)),this._logMessage(0,"Processed "+this._queueStack.length+" messages"),this._queueStack=[])}_onDisconnect(e){this._noReconnectAfterTimeout||null!==this._reconnectTimeout||(this._reconnectTimeout=setTimeout(this._tryReconnect.bind(this),5e3)),this._clearOnlineCancellationToken();let t="disconnect session:"+this.getSessionId();e&&(t+=", code:"+e.code+", reason:"+e.reason,1005===e.code&&this._sendTelemetry("websocket_code_1005")),this._logMessage(0,t),this._propagateDisconnect(e),this._closeSocket(),this._queueStack=[]}_closeSocket(){null!==this._socket&&(this._socket.offAll(),this._socket.disconnect(),this._socket=null)}_logMessage(e,t){
const n={method:e,message:t};this._logger?this._flushLogMessage(n):(n.message=`[${(new Date).toISOString()}] ${n.message}`,this._logsQueue.push(n))}_flushLogMessage(e){switch(e.method){case 2:this._logger.logDebug(e.message);break;case 3:this._logger.logError(e.message);break;case 0:this._logger.logInfo(e.message);break;case 1:this._logger.logNormal(e.message)}}_flushLogs(){this._flushLogMessage({method:1,message:"messages from queue. Start."}),this._logsQueue.forEach((e=>{this._flushLogMessage(e)})),this._flushLogMessage({method:1,message:"messages from queue. End."}),this._logsQueue=[]}_sendTelemetry(e,t){const n={event:e,params:t};this._telemetry?this._flushTelemetryObject(n):this._telemetryObjectsQueue.push(n)}_flushTelemetryObject(e){this._telemetry.sendChartReport(e.event,e.params,!1)}_flushTelemetry(){this._telemetryObjectsQueue.forEach((e=>{this._flushTelemetryObject(e)})),this._telemetryObjectsQueue=[]}_doConnect(){this._socket&&(this._socket.isConnected()||this._socket.isConnecting())||(this._clearOnlineCancellationToken(),this._host=this.getHost(),this._socket=new fn(this._host,{timeout:this._dataRequestTimeout,connectionType:this._connectionType}),this._logMessage(0,"Connecting to "+this._host),this._bindEvents(),this._disconnectCallbacks=[],this._connectionStart=performance.now(),this._connectionEstablished=null,this._socket.connect(),performance.mark("SWSC",{detail:"Start WebSocket connection"}),this._socket.on("connect",(()=>{performance.mark("EWSC",{detail:"End WebSocket connection"}),performance.measure("WebSocket connection delay","SWSC","EWSC")})))}_propagateDisconnect(e){const t=this._disconnectCallbacks.length;for(let n=0;n<t;n++)this._disconnectCallbacks[n](e||{})}_bindEvents(){this._socket&&(this._socket.on("connect",(()=>{const e=this.getSessionId();if("string"==typeof e){const t=JSON.parse(e);if(t.redirect)return this._redirectCount+=1,this._suggestedHost=t.redirect,this.isMaxRedirects()&&this._sendTelemetry("redirect_bailout"),void this._redirect()}this._connectionEstablished=performance.now(),this._processMessageQueue(),this._logMessage(0,"connect session:"+e)})),this._socket.on("disconnect",this._onDisconnect.bind(this)),this._socket.on("close",this._onDisconnect.bind(this)),this._socket.on("error",(e=>{this._logMessage(0,new Date+" session:"+this.getSessionId()+" websocket error:"+JSON.stringify(e)),this._sendTelemetry("websocket_error"),this._errorsCount++,!this._errorsInfoSent&&this._errorsCount>=Cn&&(void 0!==this._lastConnectCallStack&&(this._sendTelemetry("websocket_error_connect_stack",{text:this._lastConnectCallStack}),delete this._lastConnectCallStack),void 0!==this._getLogHistory&&this._sendTelemetry("websocket_error_log",{text:this._getLogHistory(50).join("\n")}),this._errorsInfoSent=!0)})))}_redirect(){this.disconnect(),this._reconnectWhenOnline()}_tryReconnect(){this._tryConnect()&&(this._reconnectCount+=1)}_tryConnect(){return!this._isConnectionForbidden&&(this._clearReconnectTimeout(),
this._lastConnectCallStack=new Error(`WebSocket connect stack. Is connected: ${this.isConnected()}.`).stack||"",!this.isConnected()&&(this.disconnect(),this._reconnectWhenOnline(),!0))}_clearOnlineCancellationToken(){this._onlineCancellationToken&&(this._onlineCancellationToken(),this._onlineCancellationToken=null)}_clearReconnectTimeout(){null!==this._reconnectTimeout&&(clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null)}_reconnectWhenOnline(){if(navigator.onLine)return this._logMessage(0,"Network status: online - trying to connect"),this._doConnect(),void(this._onReconnect&&this._onReconnect());this._logMessage(0,"Network status: offline - wait until online"),this._onlineCancellationToken=(0,_n.callWhenOnline)((()=>{this._logMessage(0,"Network status changed to online - trying to connect"),this._doConnect(),this._onReconnect&&this._onReconnect()}))}_onTelemetrySent(e){"websocket_error"in e&&(this._errorsCount=0,this._errorsInfoSent=!1)}_startPing(){if(this._pingIntervalId)return;const e=bn(this.getHost());e.pathname+="ping",e.protocol="https:";let t=0,n=0;const r=e=>{this._pingInfo=this._pingInfo||{max:0,min:1/0,avg:0};const r=(new Date).getTime()-e;r>this._pingInfo.max&&(this._pingInfo.max=r),r<this._pingInfo.min&&(this._pingInfo.min=r),t+=r,n++,this._pingInfo.avg=t/n,n>=10&&this._pingIntervalId&&(clearInterval(this._pingIntervalId),delete this._pingIntervalId)};this._pingIntervalId=setInterval((()=>{const t=(new Date).getTime(),n=new XMLHttpRequest;n.open("GET",e,!0),n.send(),n.onreadystatechange=()=>{n.readyState===XMLHttpRequest.DONE&&200===n.status&&r(t)}}),1e4)}}var Sn=n(459685),Tn=n(799402),kn=n(201089),En=n(129025),Dn=n(175203);class In{constructor(){this.loading=new En.WatchedValue(!1),this.loadingComplete=new m.Delegate,this.onError=new m.Delegate,this._timeStart=0,this._data=new En.WatchedValue(null),this._dataHandler=null}getCurrentData(){return this._data.value()}onData(e,t){this._dataHandler&&this._data.unsubscribe(this._dataHandler),this._dataHandler=e,this._data.subscribe(this._dataHandler),t&&this._dataHandler(this._data.value())}destroy(){null!==this._dataHandler&&this._data.unsubscribe(this._dataHandler),this._data.deleteValue(),this._dataHandler=null}setDataReqTimeStart(){this._timeStart=(new Date).getTime()}sendTelemetryTimeout(e){const t=(new Date).getTime()-this._timeStart;Dn.telemetry.sendChartReport(e,{value:t})}_setData(e){this._data.setValue(e)}}const Rn=(0,kn.getLogger)("Backtesting.DeepHistory");class xn extends In{constructor(e,t){super(),this._wsConnection=null,this._sessionid=null,this._intentionalSocketClose=!1,this._wsHost=window.WEBSOCKET_HOST_FOR_DEEP_BACKTESTING,this._requestId=0,this._bindListeners=()=>{null!==this._wsConnection&&(this._wsConnection.on("connect",this._onConnect),this._wsConnection.on("message",this._onMessage),this._wsConnection.on("disconnect",this._onDisconnect),this._wsConnection.onReconnect(this._bindListeners))},this._onConnect=async()=>{if(null===this._wsConnection)return;const e=this._wsConnection.getSessionId();if(!e)return
;Rn.logInfo("session_id: "+e);const t=JSON.parse(e);this._sessionid=t.session_id,this._sessionid&&(await this._setAuthToken(),this._historyCreateSession(),this._switchTimezone(),this._requestHistoryData())},this._onDisconnect=()=>{!0!==this._intentionalSocketClose||(this._intentionalSocketClose=!1)},this._onMessage=async e=>{var t;const n=JSON.parse(e),r=n.m;if("critical_error"===r||"request_error"===r){const e=n.p[2]||n.p,a=JSON.stringify(e);return Rn.logError("request_error: "+a),this._sendTelemetryCounter("deep_strategy_error",{reason:a||r}),"not_allowed"===e?(this._sendRequest("history_delete_session",[this._sessionid]),null===(t=this._authTokenManager)||void 0===t||t.reset(),void await this._onConnect()):(this._onError({error:"DefaultError",msg:e}),void(this._setDataRequestInProgress&&this._setDataRequestInProgress(!1)))}"request_data"===r&&(0,Sn.unpackNonSeriesData)(n.p[2].ns.d).then((e=>{if(null===e||!0===e.indexes_replace)return void this.loading.setValue(!1);const t=JSON.stringify(e).slice(0,500);if(!e.data||0===Object.keys(e.data).length)return Rn.logError("response: "+t),this._onError({error:"FetchError"}),void this._sendTelemetryCounter("deep_strategy_error",{reason:t});this.sendTelemetryTimeout("deep_strategy_time_frame"),this._sendTelemetryCounter("deep_strategy_loaded"),Rn.logNormal("response: "+t),this._setData(e.data.report),this._closeWSConnection(),this._setDataRequestInProgress(!1),this.loading.setValue(!1)}))},this._setContextIntoErrorMessage=({ctx:e,error:t})=>Object.keys(e).reduce(((t,n)=>t.replace(`{${n}}`,`${e[n]}`)),t),this._options=e,this._setDataRequestInProgress=t,Rn.logInfo("host: "+this._wsHost),this._wsConnection=new wn(this._wsHost,{noReconnectAfterTimeout:!0,dataRequestTimeout:6e4}),this._setDataRequestInProgress&&this._setDataRequestInProgress(!0),this._bindListeners(),this.loading.setValue(!0)}destroy(){super.destroy(),this._intentionalSocketClose=!0,null!==this._wsConnection&&(this._sendRequest("history_delete_session",[this._sessionid]),this._wsConnection.disconnect())}_setAuthToken(){return new Promise((e=>{this._authTokenManager||(this._authTokenManager=new Tn.AuthToken),this._authTokenManager.get().then((t=>{this._sendRequest("set_auth_token",[t]),e()}))}))}_requestHistoryData(){if(null===this._options.strategy)return;const e=this._options.deepHistoryDateRange.dateRange.from.getTime(),t=this._options.deepHistoryDateRange.dateRange.to.getTime(),n=this._requestId++,r=this._options.extendedSymbol,a=this._options.strategy.getStudyName(),i={from_to:{from:Math.floor(e/1e3),to:Math.floor(t/1e3)}},o=S(this._options.strategy,void 0,{patchSosInputs:!0}),s=this._options.resolution,l=s.isRange()?"1":s.value(),c=this._options.strategy.inputs({patchSosInputs:!0});if(this._options.excludeTrades){this._options.strategy.metaInfo().inputs.some((e=>"exclude_from_report"===e.name&&(c[e.id].v="LISTOFORDERS",!0)))}const u={session_id:this._sessionid,request_id:n,symbol:r,resolution:l,data_range:0,calc_range:JSON.stringify(i),study:a,study_inputs:JSON.stringify(c),deps:JSON.stringify(o)}
;Rn.logInfo("request_history_data: "+JSON.stringify(u)),this.setDataReqTimeStart(),this._sendRequest("request_history_data",[this._sessionid,n,r,l,0,i,a,c,o])}_historyCreateSession(){this._sendRequest("history_create_session",[this._sessionid])}_switchTimezone(){this._options.resolution.isIntraday()&&null!==this._options.timezone&&this._options.timezone.name()!==At&&this._sendRequest("switch_timezone",[this._sessionid,this._options.timezone.name()])}_onError({error:e,msg:t},n){const r={error:e};t&&("string"==typeof t?r.msg=t.split(":")[0]:(null==t?void 0:t.ctx)&&(null==t?void 0:t.error)&&(r.msg=this._setContextIntoErrorMessage(t))),n||this._closeWSConnection(),this.loading.setValue(!1),this.onError.fire(r)}_sendRequest(e,t){if(null===this._wsConnection)return;const n={m:e,p:t},r=JSON.stringify(n);this._wsConnection.send(r)}_closeWSConnection(){null!==this._wsConnection&&(Rn.logInfo("wsConnection.disconnect"),this._wsConnection.disconnect())}_sendTelemetryCounter(e,t={}){const n={count:1,additional:{symbol:this._options.symbol,resolution:this._options.resolution.value(),...t}};Dn.telemetry.sendChartReport(e,n)}}function Hn(e){const t=60*e.dateRange.from.getTimezoneOffset()*1e3;return{...e,dateRange:{from:new Date(e.dateRange.from.getTime()-t),to:new Date(e.dateRange.to.getTime()+864e5-t)}}}var Vn=n(83436),Pn=n(316909),Nn=n(685187),Bn=n(177042);const zn=l.t(null,void 0,n(192014)),On=["x","e"];function Mn(e,t){return[e,t].join("-")}function An(e){const{cell:t,tradersType:n,formatValue:r,chartCurrency:i,dataCurrency:o,formatter:l}=e;return null===t.valueNumber||null===t.percentNumber?a.createElement(a.Fragment,null):a.createElement("div",{className:s()(Nn.profitData,Nn.rightAlign,Nn.cell)},void 0!==t.valueNumber&&a.createElement("div",{className:s()((t.valueNumber<0||"dd"===n)&&Nn.negativeValue)},r({value:t.valueNumber,unit:"currency",dataCurrency:o,chartCurrency:i,formatter:l})),void 0!==t.percentNumber&&a.createElement("div",{className:s()(Nn.percentValue,(t.percentNumber<0||"dd"===n)&&Nn.negativeValue)},r({value:t.percentNumber,unit:"percent",dataCurrency:o,chartCurrency:i,formatter:l})))}function Fn(e){var t;const{formatValue:r,getOrderDate:i,gotoDate:o,onCellClickEvent:c,height:u,timezone:d,intraday:p,chartCurrency:h,dataCurrency:m,formatter:g,isStatic:y,tableDispatch:v,showBarNav:f,...b}=e,_=(0,a.useRef)(null),C=null===(t=b.virtualScrolling)||void 0===t?void 0:t.scrollTop,[w,S]=(0,a.useState)(null);(0,a.useEffect)((()=>{var e;null===(e=_.current)||void 0===e||e.scrollTo({top:C,behavior:"auto"})}),[C]);const T=(0,a.useCallback)(((e,t,n)=>()=>{if(!f)return;const r=Mn(t.rowKeyValue,e);S(n?r:null)}),[f]),k=(0,a.useCallback)(((e,t)=>{c();const n=Qe(e,d,p);o(n,"se"===t||"lx"===t)}),[c,o,d,p]),E=(0,a.useCallback)((e=>{const{value:t}=e;if("tr"===e.field)return a.createElement("span",null,t);const o=s()("apply-overflow-tooltip","apply-overflow-tooltip--check-children","apply-overflow-tooltip--allow-text",Nn.valueCellContainer);if("type"===e.field)return a.createElement(a.Fragment,null,On.map((n=>{
const r=w===Mn(e.rowKeyValue,n);return a.createElement("div",{className:o,key:n+t[n].tp,onMouseOver:T(n,e,!0),onMouseOut:T(n,e,!1)},a.createElement("div",{className:s()(Nn.barNav,{[Nn.hovered]:r})},f&&a.createElement(Pn.ToolWidgetIconButton,{icon:a.createElement(Vn.Icon,{icon:Bn,className:Nn.barNavIcon}),className:Nn.barNavButton,"data-name":"button-navigate-to-bar",onClick:()=>k(t[n].tm,t[n].tp),title:zn})),a.createElement("div",{className:s()("ka-cell",Nn.valueCell,"x"===n&&Nn.border)},a.createElement("span",null,Mt(t[n].tp))))})));if("sg"===e.field)return a.createElement(a.Fragment,null,On.map((r=>{const i=!t[r].c,c=i?l.t(null,void 0,n(539280)):t[r].c;return a.createElement("div",{className:o,key:r+t[r].c},a.createElement("div",{className:s()("ka-cell",Nn.valueCell,i&&Nn.openPosition,"x"===r&&Nn.border),onMouseOver:T(r,e,!0),onMouseOut:T(r,e,!1)},a.createElement("span",null,c)))})));if("dt"===e.field)return a.createElement(a.Fragment,null,On.map((n=>{const r=!t[n].c,l=!r&&t[n].tm&&i(t[n].tm)||"Open";return a.createElement("div",{className:o,key:n+t[n].tm},a.createElement("div",{className:s()("ka-cell",r?Nn.openCell:Nn.valueCell,"x"===n&&Nn.border),onMouseOver:T(n,e,!0),onMouseOut:T(n,e,!1)},a.createElement("span",{className:r?Nn.invisibleText:void 0},l)))})));if("pr"===e.field)return a.createElement(a.Fragment,null,On.map((n=>{const i=!t[n].c,l=!i&&"number"==typeof t[n].p&&r({value:t[n].p,unit:"series",dataCurrency:m,chartCurrency:h,formatter:g})||"Open";return a.createElement("div",{className:o,key:n+t[n].p},a.createElement("div",{className:s()("ka-cell",Nn.rightAlign,i?Nn.openCell:Nn.valueCell,"x"===n&&Nn.border),onMouseOver:T(n,e,!0),onMouseOut:T(n,e,!1)},a.createElement("span",{className:i?Nn.invisibleText:void 0},l)))})));if("cr"===e.field)return a.createElement("div",{className:Nn.rightAlign},a.createElement("span",null,t));const c=function(e,t,n){if(e||!t[n])return{};const r=t[n].v;return t[n].p?{valueNumber:r,percentNumber:t[n].p}:{valueNumber:r}}(!1,t,e.field);return a.createElement(An,{cell:c,tradersType:e.field,formatValue:r,dataCurrency:m,chartCurrency:h,formatter:g})}),[T,h,i,m,r,w,k,f,g]),D=(e,{baseFunc:t})=>{t(e)};return u<=0?a.createElement(a.Fragment,null):a.createElement(Ee.Table,{...b,dispatch:e=>{var t;if(e.type===De.ActionType.UpdateSortDirection){const e=b.columns[0].sortDirection===De.SortDirection.Descend?De.SortDirection.Ascend:De.SortDirection.Descend;ce({sort_direction_list_of_trades:e}),null===(t=_.current)||void 0===t||t.scrollTo({top:0,left:0,behavior:"auto"})}v(e)},virtualScrolling:{...b.virtualScrolling,tbodyHeight:u,itemHeight:98},childComponents:{rootDiv:{elementAttributes:()=>({className:Nn.root})},table:{elementAttributes:()=>({"data-selector":"table",style:{tableLayout:"auto"}})},tableWrapper:{elementAttributes:()=>({className:s()(Nn.tableWrapper,y&&Nn.static),onScroll:D,ref:_,style:{maxHeight:u}})},headCell:{elementAttributes:({column:{key:e}})=>{const t=["pr","cr","tp","cp","rn","dd"].includes(e);return{className:s()(Nn.headCell,t&&Nn.rightAlign)}},content:e=>{
if("tr"!==e.column.key)return e.column.title}},cell:{content:E,elementAttributes:({column:{key:e}})=>{const t=["type","sg","dt","pr"].includes(e);return{className:s()(!t&&Nn.wrapperCell,t&&Nn.wrapperValueCell)}}},dataRow:{elementAttributes:()=>({className:Nn.row})}}})}var Ln=n(681357);function qn(e){const{emptyBlockText:t,header:n,text:r,solutionId:i}=e,o=(0,a.useRef)(null);return a.createElement(a.Fragment,null,a.createElement(B.EmptyStateBlock,{className:Ln.container,iconClass:Ln.emptyStateIcon,text:t}),a.createElement("div",{ref:o,className:Ln.warningHint},a.createElement(E.ChartWarningHint,{warningHeader:n,text:r,solutionId:i,onClose:()=>{var e;null===(e=o.current)||void 0===e||e.classList.add(Ln.warningHint_hide)}})))}const Wn=l.t(null,void 0,n(180526)),Zn=l.t(null,void 0,n(697174)),Gn=l.t(null,void 0,n(389414));function jn(){return a.createElement(qn,{emptyBlockText:Wn,header:Zn,text:Gn,solutionId:I.solutionIds.BACKTESTING_NO_DATA})}function $n(e){const{height:t,reportsData:n,isStatic:r,gotoDate:i,dataCurrency:o,isDeepHistory:s,...l}=e,{timezone:u,resolution:d,chartCurrency:p,formatter:h}=(0,a.useContext)(ee),m=d.isIntraday(),g=d.isSeconds(),y=(0,c.useWatchedValueReadonly)({watchedValue:t});if(!function(e){return Boolean(e&&e.trades&&e.trades.length)}(n))return a.createElement(jn,null);return a.createElement(Fn,{...l,height:y,isStatic:r,gotoDate:i,timezone:u,formatValue:an,getOrderDate:function(e,t=!1){return Ue(e,m,g,u,t)},dataCurrency:o,chartCurrency:p,formatter:h,intraday:d.isIntraday(),onCellClickEvent:function(){(0,St.trackStrategyTesterButtonClick)(s?"deep_history_on":"deep_history_off",{activeTab:"List of Trades",button:"click_on_list"})},showBarNav:!s&&!r})}const Un={drawDown:!0,equity:!0,buyHold:!1};var Qn=n(139501),Kn=n(149511),Yn=n(246733),Xn=n(909740),Jn=n(61499),er=n(422333);const tr=(e,t)=>or(e.addHistogramSeries(t)),nr=(e,t)=>or(e.addBaselineSeries(t)),rr=(e,t)=>or(e.addLineSeries(t));function ar(e){let t=-1/0;for(const n of null!=e?e:[])t=Math.max(t,n.value);return t}const ir={below:10,above:10};function or(e){let t=.01;return e.applyOptions({autoscaleInfoProvider:n=>{const r=n();if(null===r)return r;r.margins=ir;const a=function(e){const t=e.maxValue-e.minValue;if(0===t||t>=.1)return.01;const n=Math.floor(-Math.log10(t))+1;return Math.min(.01,1/Math.pow(10,n))}(r.priceRange);return a!==t&&(t=a,e.applyOptions({priceFormat:{type:"price",minMove:a,precision:-Math.log10(a)}})),r}}),e}function sr(e,t){if(!Array.isArray(e))return[];const n=t?-1:1;return e.map(((e,t)=>({value:e*n,time:Date.UTC(1970+t+1,1)/1e3})))}const lr={textColor:(0,Kn.getHexColorByName)("color-cold-gray-900"),drawDown:{color:(0,Yn.applyAlpha)("#9013FE",.25)},equity:{topFillColor1:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-minty-green-400"),.31),topFillColor2:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-minty-green-400"),.1),topLineColor:(0,Kn.getHexColorByName)("color-minty-green-400"),bottomLineColor:(0,Kn.getHexColorByName)("color-ripe-red-500"),bottomFillColor1:(0,Yn.applyAlpha)((0,
Kn.getHexColorByName)("color-ripe-red-400"),.05),bottomFillColor2:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-ripe-red-400"),.5)},buyHold:{color:(0,Kn.getHexColorByName)("color-tv-blue-500")}},cr={textColor:(0,Kn.getHexColorByName)("color-cold-gray-300"),drawDown:{color:(0,Yn.applyAlpha)("#9013FE",.25)},equity:{topFillColor1:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-minty-green-400"),.31),topFillColor2:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-minty-green-400"),.1),topLineColor:(0,Kn.getHexColorByName)("color-minty-green-400"),bottomLineColor:(0,Kn.getHexColorByName)("color-ripe-red-500"),bottomFillColor1:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-ripe-red-400"),.05),bottomFillColor2:(0,Yn.applyAlpha)((0,Kn.getHexColorByName)("color-ripe-red-400"),.5)},buyHold:{color:(0,Kn.getHexColorByName)("color-tv-blue-500")}};function ur(){return Xn.watchedTheme.value()===Jn.StdTheme.Dark?cr:lr}class dr{constructor(e){this._container=e.container,this._chart=(0,Qn.createChart)(e.container,function(){const e=ur();return{grid:{horzLines:{visible:!1},vertLines:{visible:!1}},timeScale:{borderVisible:!1,lockVisibleTimeRangeOnResize:!0,tickMarkFormatter:(e,t,n)=>(new Date(1e3*e).getUTCFullYear()-1970).toString(),minBarSpacing:.001},layout:{background:{type:Qn.ColorType.Solid,color:"transparent"},textColor:e.textColor,fontSize:12,fontFamily:er.CHART_FONT_FAMILY},localization:{timeFormatter:e=>(new Date(1e3*e).getUTCFullYear()-1970).toString()},leftPriceScale:{visible:!0,scaleMargins:{top:0,bottom:0},borderVisible:!1,entireTextOnly:!0},rightPriceScale:{visible:!0,scaleMargins:{top:0,bottom:0},borderVisible:!1,entireTextOnly:!0},handleScale:{axisPressedMouseMove:{time:!1,price:!1},mouseWheel:!1,pinch:!1,axisDoubleClickReset:!1},handleScroll:{mouseWheel:!1,horzTouchDrag:!1,vertTouchDrag:!1,pressedMouseMove:!1},crosshair:{mode:Qn.CrosshairMode.Normal},autoSize:!0}}()),this._seriesVisibility=e.visibility,this._onClick=e.onClick,this._updatePriceAxesVisibility();const t=function(e){const t=ur(),n={type:"price",minMove:.01};return{drawDown:{priceFormat:n,priceLineVisible:!1,lastValueVisible:!1,priceScaleId:"right",visible:e.drawDown,...t.drawDown},equity:{priceFormat:n,priceLineVisible:!1,lastValueVisible:!1,priceScaleId:"left",lineWidth:1,visible:e.equity,crosshairMarkerVisible:!1,...t.equity},buyHold:{priceFormat:n,priceLineVisible:!1,lastValueVisible:!1,priceScaleId:"left",lineWidth:1,visible:e.buyHold,crosshairMarkerVisible:!1,...t.buyHold}}}(e.visibility);this._series={drawDown:tr(this._chart,t.drawDown),equity:nr(this._chart,t.equity),buyHold:rr(this._chart,t.buyHold)},this._watchedThemeSpawn=Xn.watchedTheme.spawn(),this._watchedThemeSpawn.subscribe((()=>{const e=ur();this._series.drawDown.applyOptions(e.drawDown),this._series.equity.applyOptions(e.equity),this._series.buyHold.applyOptions(e.buyHold),this._chart.applyOptions({layout:{textColor:e.textColor}})})),this._chart.subscribeClick(this._onClick),this.update(e.data,e.percentage)}update(e,t){
const n=sr(t?e.drawDownPercent:e.drawDown,!0),r=sr(t?e.equityPercent:e.equity,!1),a=sr(t?e.buyHoldPercent:e.buyHold,!1);this._series.drawDown.setData(n),this._series.equity.setData(r),this._series.buyHold.setData(a),n.length>0&&this._series.drawDown.applyOptions({base:ar(n)}),r.length>0&&this._series.equity.applyOptions({baseValue:{type:"price",price:r[0].value}});const i=Math.max(n.length,r.length,a.length);i>0&&this._chart.timeScale().setVisibleLogicalRange({from:0,to:i-1})}destroy(){this._chart.remove(),this._watchedThemeSpawn.destroy(),this._chart.unsubscribeClick(this._onClick)}toggleHideChart(e){Object.keys(e).forEach((t=>{const n=e[t];this._series[t].applyOptions({visible:n}),this._seriesVisibility[t]=n})),this._updatePriceAxesVisibility()}onResize(){this._chart.applyOptions({width:this._container.clientWidth,height:this._container.clientHeight})}_updatePriceAxesVisibility(){const e=this._seriesVisibility;this._chart.priceScale("left").applyOptions({visible:e.equity||e.buyHold}),this._chart.priceScale("right").applyOptions({visible:e.drawDown})}}var pr=n(628649);function hr(e){const{overviewFields:t,performanceFields:n,performanceData:r,formatValue:i,formatter:o,chartCurrency:s,dataCurrency:l}=e;return a.createElement("div",{className:pr.container},t.map((e=>{const t=n[e];if(!t)return;const c=void 0!==r.all[e]?r.all[e]:r[e],u=Ve(e),d=r.all[u]||r[u];return a.createElement(mr,{key:t.title,perfFieldMetaInfo:t,value:c,valuePercent:d,dataCurrency:l,chartCurrency:s,formatter:o,formatValue:i})})))}function mr(e){const{perfFieldMetaInfo:t,value:r,valuePercent:i,formatValue:o,dataCurrency:c,chartCurrency:u,formatter:d}=e,[p,h]=function(){if("currency"===t.unit)return t.isAlwaysNegative?[s()(pr.negativeValue),s()(pr.negativeValue)]:Pe(t,r)?Pe(t,i)?[s()(pr.negativeValue),s()(pr.negativeValue)]:[s()(pr.negativeValue),s()(pr.positiveValue)]:Pe(t,i)?[s()(pr.positiveValue),s()(pr.negativeValue)]:[s()(pr.positiveValue),s()(pr.positiveValue)];if("percent"===t.unit)return Pe(t,r)?[s()(pr.negativeValue),""]:[s()(pr.positiveValue),""];if(!t.unit){if(r>1)return[s()(pr.positiveValue),""];if(r<1)return[s()(pr.negativeValue),""]}return["",""]}();return a.createElement("div",{className:pr.containerCell},a.createElement("div",{className:pr.firstRow},a.createElement("div",{className:pr.title},t.title),a.createElement(Se.IconQuestionInformation,{icon:"info",tooltip:t.desc,ariaLabel:t.desc||""})),a.createElement("div",{className:pr.secondRow},function(){const e=o({value:r,unit:t.unit,dataCurrency:c,chartCurrency:u,formatter:d}),m=o({value:i,unit:"percent",dataCurrency:c,chartCurrency:u,formatter:d});return""===e&&""===m?a.createElement("div",{className:p},l.t(null,void 0,n(343088))):a.createElement(a.Fragment,null,a.createElement("div",{className:p},e),a.createElement("div",{className:s()(h,pr.additionalPercent)},m))}()))}var gr=n(182120),yr=n(55220),vr=n(223414),fr=n(162819),br=n(34995),_r=n(891665);const Cr=[{label:l.t(null,void 0,n(129520)),id:"absolute",disabled:!1},{label:l.t(null,void 0,n(936014)),id:"percent",disabled:!1}]
;function wr(e){const{onTypeSelect:t,onClick:r,dataType:i,chartVisibility:o}=e,[s,c]=(0,a.useState)((()=>{const e=Cr.find((e=>e.id===i));return e||Cr[0]})),u=(0,a.useCallback)((e=>{c(e),t(e.id)}),[c]),d=(0,a.useCallback)((e=>s.id===e.id),[s]);return a.createElement("div",{className:_r.container},a.createElement("div",{className:_r.checkBoxes},a.createElement(gr.Checkbox,{label:a.createElement(Sr,{label:l.t(null,void 0,n(959005)),icon:fr}),onChange:()=>{r("equity")},checked:o.equity}),a.createElement(gr.Checkbox,{label:a.createElement(Sr,{label:l.t(null,void 0,n(424488)),icon:br}),onChange:()=>{r("drawDown")},checked:o.drawDown}),a.createElement(gr.Checkbox,{label:a.createElement(Sr,{label:l.t(null,void 0,n(492126)),icon:vr}),onChange:()=>{r("buyHold")},checked:o.buyHold})),a.createElement("div",{className:_r.tabs},a.createElement(yr.SquareTabs,{id:"backtesting-drawdown-overview-tabs",items:Cr,size:"xsmall",onActivate:u,isActive:d,enableActiveStateStyles:!1,overflowBehaviour:"none"})))}function Sr(e){return a.createElement("div",{className:_r.checkboxContainer},a.createElement("span",{className:_r.label},e.label),a.createElement(Vn.Icon,{icon:e.icon}))}var Tr=n(454047);const kr=nn.drawdown.settings,Er=!0,Dr=!0;function Ir(e){const{reportsData:t,gotoDate:n}=e,{timezone:i,resolution:o,chartCurrency:s,formatter:l}=(0,a.useContext)(ee),c=(0,a.useRef)(null),u=(0,a.useRef)(null);function d(t,n){return e.persistSettings?k.getJSON(t,n):n}function p(t,n){e.persistSettings&&k.setJSON(t,n)}const[h,m]=(0,a.useState)(d("backtesting_overview_data_type",kr.dataType||"absolute")),[g,y]=(0,a.useState)(d("backtesting_overview_visibility",Un)),v=Boolean(t&&t.performance&&t.drawDown&&t.equity&&t.drawDown.length>=2&&t.equity.length>=2);return(0,a.useEffect)((()=>()=>{Er&&u.current&&(u.current.destroy(),u.current=null)}),[Er]),(0,a.useEffect)((()=>{function e(e){if(!t)return;const r=e.logical,a=t.trades?t.trades[r]:null;if(a){const e=a.x.tm,t=a.x.tp,r=Qe(e,i,o.isIntraday());n(r,"se"===t||"lx"===t)}}if(Er)return!v&&u.current?(u.current.destroy(),void(u.current=null)):void(u.current?u.current.update((0,r.ensureNotNull)(t),"percent"===h):c.current&&(u.current=new dr({data:(0,r.ensureNotNull)(t),container:c.current,percentage:"percent"===h,visibility:g,onClick:e})))}),[h,t,Er,v]),(0,a.useEffect)((()=>{u.current&&u.current.toggleHideChart(g)}),[g]),v?a.createElement("div",{className:Tr.reportContainer},a.createElement(hr,{overviewFields:nn.drawdown.settings.overviewPerformanceFields,performanceFields:nn.performance.settings.fields,formatValue:an,performanceData:(0,r.ensureNotNull)(t).performance,dataCurrency:(0,r.ensureNotNull)(t).currency,chartCurrency:s,formatter:l}),a.createElement("div",{className:Tr.chartContainer,ref:c}),Dr&&a.createElement("div",{className:Tr.legendContainer},a.createElement(wr,{onTypeSelect:e=>{p("backtesting_overview_data_type",e),m(e)},onClick:e=>{const t=g[e];p("backtesting_overview_visibility",{...g,[e]:!t}),y({...g,[e]:!t})},chartVisibility:g,dataType:h}))):a.createElement(jn,null)}
var Rr=n(481058),xr=n(689612),Hr=n(894729),Vr=n(583835),Pr=n(241047);function Nr(e){const t=e.color;return a.createElement("span",{className:o(Pr.colorBox,e.className),style:{backgroundColor:t}})}var Br=n(492972);function zr(e){const t=(0,Vr.useLogos)(e.value);return a.createElement(a.Fragment,null,a.createElement(Hr.SymbolLogo,{className:Br.symbolLogo,logoId:t.logoid,baseCurrencyLogoId:t["base-currency-logoid"],currencyLogoId:t["currency-logoid"],size:"xsmall"}),a.createElement("span",null,e.value))}function Or(e){return a.createElement("li",{className:Br.elemContainer},a.createElement("span",{className:Br.elemTitle},a.createElement("span",{className:"apply-overflow-tooltip"},e.title)),a.createElement("span",{className:Br.elemData},a.createElement(Mr,{...e})))}function Mr(e){return a.createElement(a.Fragment,null,e.cells.map(((e,t)=>a.createElement(Ar,{elem:e,index:t,key:t}))))}function Ar(e){if("color"===e.elem.type)return a.createElement(a.Fragment,{key:e.index},void 0!==e.index&&0!==e.index&&a.createElement("div",null,", "),a.createElement(Nr,{color:e.elem.value,className:Br.colorBox}));if("symbol"===e.elem.type)return a.createElement(a.Fragment,{key:e.index},void 0!==e.index&&0!==e.index&&a.createElement("div",null,", "),a.createElement(zr,{...e.elem}));const t=e.elem.title?`${e.elem.title}: `:"";return 0===e.index?a.createElement("div",{key:e.index},t,e.elem.value):a.createElement("div",{key:e.index},", ",t,e.elem.value)}function Fr(e){const t=e.cells.length-1;return a.createElement("span",{className:Br.minimizedData},e.cells.map(((e,n)=>a.createElement(a.Fragment,{key:(e.name||"")+e.value+n},e.name&&a.createElement("span",{className:Br.minimizedName},e.name,": "),a.createElement("span",{className:Br.minimizedValue},e.value,n<t&&", ")))))}function Lr(e){const{title:t,data:n,toggleExpanded:r,sectionType:i,expanded:s}=e;return a.createElement("div",{className:o(Br.section,s&&Br.expanded)},a.createElement("button",{className:o(Br.container,s&&Br.expanded),onClick:function(){r(i)},type:"button","aria-controls":(0,Rr.createDomId)(e.title),"aria-expanded":s},a.createElement(Vn.Icon,{className:o(Br.arrow,s&&Br.expanded),icon:xr}),a.createElement("span",{className:Br.title},t),!s&&a.createElement(Fr,{cells:e.minimizedData})),s&&a.createElement("ul",{id:(0,Rr.createDomId)(t),className:Br.sectionList},n.map(((e,t)=>a.createElement(Or,{...e,key:t})))))}const qr=a.memo((e=>{const{data:t,selectedSections:n,setSelectedSections:r}=e;return a.createElement(a.Fragment,null,t.map((e=>a.createElement(Lr,{key:e.title,expanded:n[e.sectionType],toggleExpanded:r,...e}))))}));var Wr=n(490131);function Zr(e){const{data:t,...n}=e;return t?t.length?a.createElement("div",{className:Wr.reportViewContainer},a.createElement(qr,{...n,data:t})):a.createElement(jn,null):a.createElement(a.Fragment,null)}var Gr=n(321788);function jr(e){const{dataNumberCell:t,fieldMetaInfo:r,formatValue:i,dataCurrency:s,chartCurrency:c,formatter:u}=e,d=function(e,t){const a=new Array;if(null==e)return a.push(l.t(null,void 0,n(343088))),a;if(a.push(i({value:e,
unit:r.unit,dataCurrency:s,chartCurrency:c,formatter:u})),null==t)return a;return a.push(i({value:t,unit:"percent",dataCurrency:s,chartCurrency:c,formatter:u})),a}(t.valueNumber,t.percentNumber);return a.createElement("div",{className:Gr.value},a.createElement(a.Fragment,null,d.map((e=>{const t=e.includes("−")||parseFloat(e)<0,n=e.includes("%"),i=r.title+e;return a.createElement("div",{className:o(t&&Gr.negativeValue,n&&Gr.percentValue),key:i.replace(/\s/g,"_")},e)}))))}n(936902);const $r={key:"Invisible",title:"",dataType:De.DataType.Object},Ur={columns:[{key:"Title",title:l.t(null,void 0,n(767369)),dataType:De.DataType.Object},{key:"All",title:l.t(null,void 0,n(695271)),dataType:De.DataType.Object},{key:"Long",title:l.t(null,void 0,n(273064)),dataType:De.DataType.Object},{key:"Short",title:l.t(null,void 0,n(777851)),dataType:De.DataType.Object}],rowKeyField:"id"};function Qr(e){const{fields:t,performanceData:r,formatValue:i,isStatic:o,layoutType:c,chartCurrency:u,dataCurrency:d,formatter:p}=e,[h,m]=(0,a.useState)(Ur),g=Object.keys(t).map(((e,t)=>({Title:e,All:e,Long:e,Short:e,Invisible:void 0,id:t})));(0,a.useEffect)((()=>{m(0===c?{...h,columns:h.columns.concat([$r])}:{...h,columns:h.columns.filter((e=>"Invisible"!==e.key))})}),[c]);return a.createElement(Ee.Table,{...h,data:g,dispatch:e=>{m((t=>(0,Ee.kaReducer)(t,e)))},childComponents:{rootDiv:{elementAttributes:()=>({className:Gr.root})},table:{elementAttributes:()=>({"data-selector":"table",style:{}})},tableWrapper:{elementAttributes:()=>({style:{overflow:"visible"}})},headCell:{elementAttributes:()=>({className:s()(Gr.headCell,o&&Gr.staticBackground,1===c&&Gr.headSmallPadding)})},cell:{content:e=>{if("Invisible"===e.field)return a.createElement(a.Fragment,null);const h=e.value;if("Title"===e.field){const e=t[h].solutionId;return a.createElement("div",{className:Gr.titleContainer},a.createElement("div",{className:s()("apply-overflow-tooltip",Gr.title,0!==c||o?Gr.wrapped:Gr.noWrapped)},t[h].title),e&&a.createElement(Te,{solutionId:e,className:Gr.solution,tooltip:l.t(null,void 0,n(308014))}))}{const n=Ve(h),o=e.field.toLowerCase(),s=He(r[o][h],r[o][n]);if(void 0!==s.valueNumber)return a.createElement(jr,{dataNumberCell:s,fieldMetaInfo:t[h],formatValue:i,dataCurrency:d,chartCurrency:u,formatter:p});if("All"===e.field){const e=He(r[h],r[n]);return a.createElement(jr,{dataNumberCell:e,fieldMetaInfo:t[h],formatValue:i,dataCurrency:d,chartCurrency:u,formatter:p})}return a.createElement(a.Fragment,null)}},elementAttributes:()=>({className:s()(Gr.cell,1===c&&Gr.cellSmallPadding)})},dataRow:{elementAttributes:()=>({className:s()(Gr.row,o&&Gr.staticBackground,o&&Gr.rowStatic)})}}})}var Kr=n(264461);const Yr=nn.performance.settings;function Xr(e){const{isStatic:t,dataCurrency:n,performanceData:r}=e,{layoutType:i,chartCurrency:o,formatter:s}=(0,a.useContext)(ee);return r?a.createElement("div",{className:Kr.reportContainer},a.createElement(Qr,{fields:Yr.fields,isStatic:t,layoutType:i,formatValue:an,chartCurrency:o,dataCurrency:n,formatter:s,performanceData:r
})):a.createElement(jn,null)}var Jr=n(908803);function ea(e){const{onCSVReportRequest:t,activeChartChanged:n,persistSettings:r,gotoDate:i,onError:o,hidden:l,onData:c,height:u,width:d}=e,p=(0,a.useContext)(ee),{listOfTradesTableProps:h,propertiesTableData:m,tableDispatch:g,reportsData:y,reset:v}=(0,a.useContext)(ht),{activeReportTab:f,layoutType:b,timezone:_,formatter:C,resolution:w,extendedSymbol:S}=p,T=(0,a.useRef)(!1),[k,E]=function(e){const[t,n]=(0,a.useState)(!1),[r,i]=(0,a.useState)(void 0),o=(0,a.useContext)(ee),{setReportsData:s}=(0,a.useContext)(ht),{deepHistoryCurrentRequestParams:l,timezone:c,resolution:u,symbol:d,strategy:p,chartCurrency:h,minTick:m,minTickProperty:g,pointValue:y,chartStyle:v}=o;return(0,a.useEffect)((()=>{if(!l)return;const t=e=>{i(e||{error:"DefaultError",msg:""})},r={...l,deepHistoryDateRange:Hn(l.deepHistoryDateRange)},a=new xn(r,e.setDataRequestInProgress);return a.loading.subscribe(n,{callWithLast:!0}),a.onError.subscribe(null,t),a.onData((t=>{t&&(e.onData(t),s({data:t,properties:{strategy:p,resolution:u,timezone:c,symbol:d,chartCurrency:h,minTick:m,minTickProperty:g,pointValue:y,chartStyle:v}}))}),!0),()=>{a.loading.unsubscribe(n),a.onError.unsubscribe(null,t),a.destroy(),n(!1)}}),[l,p,u,c,d,h,m,g,y,v]),[t,r]}({onData:c,setDataRequestInProgress:e=>{T.current=e}});hn({...p,onCSVReportRequest:t,reportsData:y,hidden:l,tableData:h});const[D,I]=(0,a.useState)((()=>Ne(1))),R=(0,a.useRef)(!1),x=e=>{I({...D,[e]:!D[e]})};if((0,a.useEffect)((()=>{R.current&&(R.current=!1,Be(D,1))}),[D]),(0,a.useEffect)((()=>{!0===T.current&&v()}),[S,w,C,_,l,u,d,v]),(0,a.useEffect)((()=>{E&&o(E)}),[E]),(0,a.useEffect)((()=>{function e(){T.current&&(T.current=!1,v())}return n.subscribe(null,e),()=>{n.subscribe(null,e)}}),[n]),!y&&!k&&!l)return a.createElement(Ut,{height:u});return a.createElement("div",{className:s()("backtesting-content-wrapper",1===b?Jr.widgetContainerWide:Jr.widgetContainer,l&&Jr.hidden)},k&&a.createElement(jt.Spinner,{size:"large"}),!k&&function(){if(!y||l)return a.createElement(a.Fragment,null);switch(f){case"Performance Summary":return a.createElement(Xr,{performanceData:y.performance,dataCurrency:y.currency,isStatic:!1});case"Properties":return a.createElement(Zr,{data:m,selectedSections:D,setSelectedSections:x});case"Overview":return a.createElement(Ir,{isStatic:!1,width:d,height:u,gotoDate:i,reportsData:y,persistSettings:r});case"List of Trades":return a.createElement($n,{...h,tableDispatch:g,isStatic:!1,isDeepHistory:!0,height:u,gotoDate:i,reportsData:y,dataCurrency:null==y?void 0:y.currency})}}())}var ta=n(823127);class na extends In{constructor(e){var t;super(),this._onData=e=>{switch(e&&e.method){case"data_update":this._updateData((0,r.ensureDefined)(e.nonSeriesData));break;case"study_loading":this.setDataReqTimeStart(),this.loading.setValue(!0);break;case"study_completed":this.sendTelemetryTimeout("strategy_time_frame"),this.loading.setValue(!1);break;case"study_error":this.onError.fire()}},this._strategy=e,this._setData(this._strategy.reportData()),
null===(t=this._strategy)||void 0===t||t.watchedData.subscribe(this._onData,{callWithLast:!0})}destroy(){var e;super.destroy(),null===(e=this._strategy)||void 0===e||e.watchedData.unsubscribe(this._onData),this._strategy=null}_updateData(e){if(!0===e.indexes_replace)return;let t=e&&e.data&&e.data.report;const n=this.getCurrentData();e.isUpdate&&n&&(t=ta.extend({},n,t)),n&&t===n||this._setData(t)}}const ra=dt("backtestingDataQuotes"),aa=ut();function ia(e){const[t,n]=pt(ra);return a.createElement(aa.Provider,{value:{...t,...n}},e.children)}var oa=n(490433);function sa(e){var t,n;const r=(0,a.useContext)(ee),{reportsData:i,listOfTradesTableProps:o,propertiesTableData:l,tableDispatch:c}=(0,a.useContext)(aa),{strategy:u,activeReportTab:d,setDeepHistoryDateRange:p,quickDeepHistory:h}=r,m=(null===(t=null==i?void 0:i.settings)||void 0===t?void 0:t.dateRange.backtest.from)||null,g=(null===(n=null==i?void 0:i.settings)||void 0===n?void 0:n.dateRange.backtest.to)||null,[y,v]=function(){const[e,t]=(0,a.useState)(!1),[n,r]=(0,a.useState)(void 0),{setReportsData:i}=(0,a.useContext)(aa),o=(0,a.useContext)(ee),{strategy:s,resolution:l,timezone:c,symbol:u,chartCurrency:d,minTick:p,minTickProperty:h,pointValue:m,chartStyle:g}=o;return(0,a.useEffect)((()=>{if(null===s)return;const e=e=>{e&&i({data:e,properties:{strategy:s,resolution:l,timezone:c,symbol:u,chartCurrency:d,minTick:p,minTickProperty:h,pointValue:m,chartStyle:g}})},n=n=>{r(n||{error:"DefaultError",msg:""}),e(null),t(!1)},a=new na(s);return a.loading.subscribe(t,{callWithLast:!0}),a.onError.subscribe(null,n),a.onData(e,!0),()=>{t(!1),a.loading.unsubscribe(t),a.onError.unsubscribe(null,n),a.destroy()}}),[s,l,c,u,d,p,h,m,g]),[e,n]}();hn({...r,onCSVReportRequest:e.onCSVReportRequest,hidden:e.hidden,reportsData:i,tableData:o});const[f,b]=(0,a.useState)((()=>Ne(0,e.isStatic))),_=(0,a.useRef)(!1),C=e=>{b({...f,[e]:!f[e]})};return(0,a.useEffect)((()=>{const e=ue();m&&g&&h&&!(null==e?void 0:e.dateRange)&&p({dateRange:{from:new Date(m),to:new Date(g)}})}),[p,m,h,g,u]),(0,a.useEffect)((()=>{_.current&&(_.current=!1,Be(f,1))}),[f]),(0,a.useEffect)((()=>{v&&e.onError&&e.onError(v)}),[v]),a.createElement("div",{className:s()("backtesting-content-wrapper",oa.widgetContainer,e.hidden&&oa.hidden,e.isStatic&&oa.staticContainer)},y&&a.createElement(jt.Spinner,{size:"large"}),!y&&function(){if(e.hidden)return a.createElement(a.Fragment,null);switch(d){case"Performance Summary":return a.createElement(Xr,{performanceData:null==i?void 0:i.performance,isStatic:e.isStatic,dataCurrency:null==i?void 0:i.currency});case"Properties":return a.createElement(Zr,{data:l,selectedSections:f,setSelectedSections:C});case"Overview":return a.createElement(Ir,{width:e.width,height:e.height,reportsData:i,isStatic:e.isStatic,gotoDate:e.gotoDate,persistSettings:e.persistSettings});case"List of Trades":return a.createElement($n,{...o,tableDispatch:c,height:e.height,reportsData:i,isDeepHistory:!1,isStatic:e.isStatic,gotoDate:e.gotoDate,dataCurrency:null==i?void 0:i.currency})}}())}var la=n(125226),ca=n(380768)
;const ua=l.t(null,void 0,n(180526)),da=l.t(null,void 0,n(535372)),pa=l.t(null,void 0,n(365634));function ha(e){(0,p.trackEvent)("Strategy Tester","BP Strategy Tester "+e)}function ma(e,t){const n=e.symbolInfo();return t.formatter=(0,r.ensureNotNull)(e.formatter()),t.userInputsState=it(t.strategy),t.chartCurrency=st(n),t.minTick=ot(n),t}let ga;function ya(e){const{bridge:t,strategyDispatcher:i,chartWidgetCollection:o,visibility:p}=e,b=(0,la.isFeatureEnabled)("enable_quick_deep_history"),_=(0,a.useRef)(new m.Delegate),C=t.isStatic||!1,w=(0,r.ensureNotNull)(i.model()).model(),S=w.mainSeries(),k=(0,a.useRef)(new m.Delegate),[E,D]=(0,a.useState)();let I=null;const R=(0,c.useWatchedValueReadonly)({watchedValue:p}),x=e.activeStrategy||e.strategies[0]||null,[H,V]=(0,a.useReducer)(qt,{widgetType:0,symbol:e.symbol,extendedSymbol:e.extendedSymbol,deepHistoryDateRange:e.deepHistoryDateRange,resolution:e.resolution,strategy:x,strategies:e.strategies,deepHistoryCurrentRequestParams:null,deepHistoryPrevRequestParams:null,generateReportButtonEnabled:!0,strategyHintProps:{isRangeBasedStyle:e.isRangeBasedStudy,hasLookaheadFutureData:null==x?void 0:x.metaInfo().lookaheadFutureData},tzProperty:e.tzProperty,timezone:e.timezone,minTickProperty:e.minTickProperty,activeReportTab:"Overview",csvReportProgress:!1,chartStyle:Gt(S,o.activeChartStyle.value()),pointValue:S.pointValue(),layoutType:!C&&t.width.value()<1279?1:0,formatter:null,userInputsState:null,chartCurrency:null,minTick:null},ma.bind(null,S)),[B,z]=(0,a.useState)(1),O=0!==H.strategies.length,M=null!==H.strategy,A=1===H.widgetType&&H.resolution.isTicks(),q=M&&!H.resolution.isTicks()&&H.generateReportButtonEnabled;!function(e,t,n){const r=(0,a.useRef)([]),i=(0,a.useRef)(e),o=(0,f.usePrevious)(e);(0,a.useEffect)((()=>()=>{i.current&&(i.current.properties().unsubscribe(null,s),i.current=null),c(),r.current=[]}),[]);const s=(0,a.useCallback)((()=>{setTimeout((()=>{n({type:"onUserInputsChange"})}),0)}),[]),l=(0,a.useCallback)((()=>{0!==r.current.length&&r.current.forEach((e=>{e.properties().subscribe(null,s)}))}),[]),c=(0,a.useCallback)((()=>{0!==r.current.length&&r.current.forEach((e=>{e.properties().unsubscribe(null,s)}))}),[]);(0,a.useEffect)((()=>{var t;if(!e)return c(),r.current=[],void(i.current&&(i.current.properties().unsubscribe(null,s),i.current=null));i.current&&e.id()===i.current.id()&&o||(null===(t=i.current)||void 0===t||t.properties().unsubscribe(null,s),i.current=e,i.current.properties().subscribe(null,s));const n=function(){if(!e)return[];const t=T(e);return 0===t.length?[]:t.length!==r.current.length?t:r.current.every(((e,n)=>e.id()===t[n].id()))?r.current:t}();(n.length!==r.current.length||n.some(((e,t)=>e.id()!==r.current[t].id())))&&(c(),r.current=n,l())}),[e,t,r,i,s])}(H.strategy,H.userInputsState,V),function(e){const t=()=>{e(window.is_authenticated?0:2)};(0,a.useEffect)((()=>(window.loginStateChange.subscribe(null,t),()=>window.loginStateChange.unsubscribe(null,t))),[])}(z);const W=(0,
a.useMemo)((()=>new Wt(H.strategies,H.strategy,ze(o))),[]),Z=function(e,t,n,i){const o=(0,r.ensureNotNull)(e.model()).model().mainSeries(),s=(0,a.useRef)(o);return null===s.current&&(s.current=o),(0,a.useEffect)((()=>{const a=(a,o,l,c,u)=>{const d=(0,r.ensureNotNull)(e.model()).mainSeries(),p=d.symbolInfo(),h=d.properties().childs().minTick;t.setCurrentChartId(ze(n)),i({type:"updateStateOnChartChange",newStrategies:o,symbolInfo:p,minTickProperty:h,selectedStrategyManager:t,chartChanged:l,strategyToSelect:u,resolution:d.intervalObj(),isRangeBasedStyle:d.isRangeBasedStyle(),tzProperty:d.model().properties().childs().timezone,formatter:d.formatter(),chartCurrency:st(d.symbolInfo()),chartStyle:Gt(d,n.activeChartStyle.value()),pointValue:d.pointValue(),minTick:ot(p),symbolStr:d.proSymbol(),extendedSymbol:d.getSymbolString()}),l&&(s.current=d)};return e.change().subscribe(null,a),()=>{e.change().unsubscribe(null,a),s.current=null}}),[]),s.current}(i,W,o,V);(0,a.useEffect)((()=>{const e=e=>{V({type:"onLayoutWidthChange",width:e})};return C||t.width.subscribe(e),()=>{C||t.width.unsubscribe(e)}}),[]),(0,a.useEffect)((()=>{function e(){k.current.fire()}function t(){clearTimeout(ga),ga=setTimeout((()=>{Z&&V({type:"onUpdateChartStyle",chartStyle:Gt(Z,o.activeChartStyle.value())})}),200)}return o.activeChartWidget.subscribe(e),C||(d.linking.proSymbol.subscribe(j),o.activeChartStyle.subscribe(t)),()=>{o.activeChartWidget.unsubscribe(e),d.linking.proSymbol.unsubscribe(j),o.activeChartStyle.unsubscribe(t)}}),[Z]),(0,a.useEffect)((()=>((0,v.getQuoteSessionInstance)("full").subscribe("FirstBarTime",H.symbol,(e=>{const{values:t}=e;H.resolution.isDWM()&&t.first_bar_time_1d?D(1e3*t.first_bar_time_1d):H.resolution.isSeconds()&&t.first_bar_time_1s?D(1e3*t.first_bar_time_1s):(H.resolution.isMinutes()||H.resolution.isMinuteHours())&&t.first_bar_time_1m?D(1e3*t.first_bar_time_1m):D(new Date(me).getTime())})),()=>{(0,v.getQuoteSessionInstance)("full").unsubscribe("FirstBarTime",H.symbol)})),[H.resolution,H.symbol]),(0,a.useEffect)((()=>{if(!Z)return;const e=e=>{var t;V({type:"onTimezoneChange",symbolInfoTimezone:(null===(t=Z.symbolInfo())||void 0===t?void 0:t.timezone)||null,tzProperty:e})};return null===H.tzProperty||C||H.tzProperty.subscribe(null,e),()=>{null===H.tzProperty||C||H.tzProperty.unsubscribe(null,e)}}),[H.tzProperty,Z]),(0,a.useEffect)((()=>{function e(e){Z&&e&&V({type:"onMinTickChange",symbolInfo:Z.symbolInfo(),formatter:Z.formatter()})}if(Z)return null===H.minTickProperty||C||H.minTickProperty.subscribe(null,e),()=>{null===H.minTickProperty||C||H.minTickProperty.unsubscribe(null,e)}}),[H.minTickProperty,Z]),(0,a.useEffect)((()=>{var e;if(!C)return H.strategy&&i.setActiveStrategy(H.strategy),null===(e=t.container)||void 0===e||e.addEventListener("contextmenu",$),()=>{var e;i.unsetActiveStrategy(),null===(e=t.container)||void 0===e||e.removeEventListener("contextmenu",$)}}),[H.strategy,w]),(0,a.useEffect)((()=>{z((()=>{if(!R)return 1;const e=!window.is_authenticated&&!C;return!O||e?2:0}))}),[R,O]);const G=(0,a.useCallback)((()=>{
var e;if(!Z)return;const t=Z.symbolInfo();V({type:"updateSymbol",symbolInfo:t,chartCurrency:st(t),chartStyle:Gt(Z,o.activeChartStyle.value()),pointValue:Z.pointValue(),symbolStr:Z.proSymbol(),extendedSymbol:Z.getSymbolString(),strategyHintProps:P(H.widgetType,Z.isRangeBasedStyle(),null===(e=H.strategy)||void 0===e?void 0:e.metaInfo().lookaheadFutureData),formatter:Z.formatter(),resolution:Z.intervalObj()})}),[Z]),j=(0,a.useCallback)((()=>{clearTimeout(ga),ga=setTimeout((()=>{G()}),200)}),[G]);(0,a.useEffect)((()=>{function e(){V({type:"setResolution",resolution:this.intervalObj()})}if(!C&&Z)return clearTimeout(ga),Z.dataEvents().symbolResolved().subscribe(null,j),Z.onIntervalChanged().subscribe(Z,e),Z.onRestarted().subscribe(Z,G),Z.currencyChanged().subscribe(null,j),Z.properties().childs().sessionId.subscribe(null,j),Z.properties().childs().dividendsAdjustment.subscribe(null,G),()=>{C||(Z.dataEvents().symbolResolved().unsubscribe(null,j),Z.onIntervalChanged().unsubscribe(Z,e),Z.onRestarted().unsubscribe(Z,G),Z.currencyChanged().unsubscribe(null,j),Z.properties().childs().sessionId.unsubscribe(null,j),Z.properties().childs().dividendsAdjustment.unsubscribe(null,G))}}),[Z,j]);const $=e=>{e.preventDefault();const t=[],r=new h.Action({actionId:"Chart.Dialogs.ShowIndicatorProperties",options:{label:(0,g.appendEllipsis)(l.t(null,void 0,n(546205))),onExecute:()=>{const e=o.activeChartWidget.value();H.strategy&&e.showChartPropertiesForSource(H.strategy)}}});t.push(r);const a=new h.Action({actionId:"Chart.Indicator.PineSource",options:{label:(0,g.appendEllipsis)(l.t(null,void 0,n(658623))),onExecute:()=>{if(!H.strategy)return;const e={scriptIdPart:H.strategy.metaInfo().scriptIdPart};window.TradingView.bottomWidgetBar&&window.TradingView.bottomWidgetBar.activateScriptEditorTab(e)}}});t.push(a),y.ContextMenuManager.showMenu(t,e)},U=(0,a.useCallback)((e=>{Z&&V({type:"setActiveReportTab",reportTab:e,isRangeBasedStyle:Z.isRangeBasedStyle()})}),[Z]),Q=(0,a.useCallback)((e=>{V({type:"setStrategyHintProps",strategyHintProps:{hasDeepHistoryError:"DefaultError"===e.error,hasDeepHistoryFetchError:"FetchError"===e.error,errorText:e.msg,warningType:"notaccurate"},generateReportButtonEnabled:!0})}),[]),K=(0,a.useCallback)((e=>{V({type:"setStrategyHintProps",strategyHintProps:e})}),[]),Y=(0,a.useCallback)((e=>{V({type:"setDeepHistoryDateRange",deepHistoryDateRange:e})}),[]),X=(0,a.useCallback)((e=>{V({type:"setStrategy",strategy:e,selectedStrategyManager:W})}),[w]),J=(0,a.useCallback)((e=>{V({type:"setGenerateReportButtonEnabled",enabled:e})}),[]),te=(0,a.useCallback)((()=>{V({type:"onGenerateButtonClick"}),C||F("report",null)}),[C]);const ne=(0,a.useCallback)((e=>{Z&&null!==e&&V({type:"onDeepHistoryDataUpdate",isRangeBasedStyle:Z.isRangeBasedStyle()})}),[Z]),re=(0,a.useCallback)((e=>{V({type:"setCSVReportInProgress",inProgress:e})}),[]);function ae(e,t){if(C)return;const n=o.activeChartWidget.value().model().model(),r=n.mainSeries();n.gotoTime(e).then((e=>{void 0===e?r.clearGotoDateResult():(I&&clearTimeout(I),r.setGotoDateResult(e,t),
I=setTimeout((()=>{r&&(r.clearGotoDateResult(),n.updateSource(r),I=null)}),5e3))}))}(0,a.useEffect)((()=>{!C&&R&&F("view",null)}),[R,C]);return a.createElement(ee.Provider,{value:{...H,quickDeepHistory:b,setDeepHistoryDateRange:Y,setStrategy:X,setGenerateReportButtonEnabled:J,setErrorHint:Q,setActiveReportTab:U,onGenerateButtonClick:te,setCSVReportProgress:re,setWidgetType:function(e){Z&&(V({type:"setWidgetType",widgetType:e,isRangeBasedStyle:Z.isRangeBasedStyle()}),1===e&&q&&te())}}},a.createElement(Et,{snowplowLogger:C?()=>{}:F},a.createElement(ia,null,a.createElement(gt,null,a.createElement(u.CustomBehaviourContext.Provider,{value:window.TradingView.onChartPage?u.presetPlatform:u.presetDefault},{1:a.createElement(a.Fragment,null),2:a.createElement(L,{studyMarket:t.studyMarket,height:t.height}),0:a.createElement(a.Fragment,null,M&&a.createElement("div",{className:s()(ca.backtestingHeadWrapper,C&&ca.staticHeadWrapper)},a.createElement(Ot,{...H,generateReportButtonEnabled:q,chartWidgetCollection:o,trackEvent:ha,onGenerateReportClickCb:te,onCSVReportRequest:_.current,isStatic:C,layoutType:H.layoutType,firstBarTime:E})),A&&a.createElement(qn,{emptyBlockText:ua,header:pa,text:da}),!A&&a.createElement(a.Fragment,null,a.createElement(sa,{width:t.width,height:t.height,isStatic:C,hidden:1===H.widgetType,onCSVReportRequest:_.current,gotoDate:ae,persistSettings:!t.isStatic}),!C&&a.createElement(ea,{width:t.width,height:t.height,onData:ne,gotoDate:ae,hidden:0===H.widgetType,onError:Q,onCSVReportRequest:_.current,activeChartChanged:k.current,persistSettings:!t.isStatic}),a.createElement("div",{className:ca.backtestingWarningContainer},a.createElement(N,{...H.strategyHintProps,chartStyle:o.activeChartStyle.value(),isFillOrdersOnStandardOhlc:!!(null===(oe=null===(ie=H.userInputsState)||void 0===ie?void 0:ie.strategy)||void 0===oe?void 0:oe.fill_orders_on_standard_ohlc),removeCb:()=>K({})}))))}[B])))));var ie,oe}n(669738);class va{constructor(e){if(this._deepHistoryContainer=document.createElement("div"),this._visibility=new En.WatchedValue(!0),!(this instanceof va))throw new Error("BacktestingWidget is a constructor");this._bridge=e,this._dispatcher=e.backtestingStrategyDispatcher,this._deepHistoryContainer.classList.add("backtesting","deep-history"),e.container.append(this._deepHistoryContainer),this._dispatcher.ready().then(this._init.bind(this))}show(){this._deepHistoryContainer&&this._visibility.setValue(!0)}hide(){this._deepHistoryContainer&&this._visibility.setValue(!1)}destroy(){var e;this._deepHistoryContainer&&(e=this._deepHistoryContainer,requestAnimationFrame((()=>{i.unmountComponentAtNode(e)})))}_init(){var e;const t=(0,r.ensureNotNull)(this._dispatcher.model()).model(),n=this._dispatcher.strategies(),o=t.mainSeries(),s=o.intervalObj(),l=le(s),c=this._dispatcher.recentlyAddedStrategy()||function(e){const t=ue(),n=null==t?void 0:t.strategy_id;if(!n)return null;return e.find((e=>e.id()===n))||null
}(n),u=o.isRangeBasedStyle(),d=t.properties().childs().timezone,p=Ft(d,(null===(e=o.symbolInfo())||void 0===e?void 0:e.timezone)||null),h=o.properties().childs().minTick;var m,g;m=this._deepHistoryContainer,g={visibility:this._visibility,bridge:this._bridge,strategyDispatcher:this._dispatcher,chartWidgetCollection:this._bridge.chartWidgetCollection,resolution:s,activeStrategy:c,strategies:n,symbol:o.proSymbol(),extendedSymbol:o.getSymbolString(),deepHistoryDateRange:l,isRangeBasedStudy:u,tzProperty:d,timezone:p,minTickProperty:h},i.render(a.createElement(ya,g),(0,r.ensureNotNull)(m))}}},689612:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M7.83 3.92 12.28 9l-4.45 5.08-1.13-1L10.29 9l-3.6-4.09 1.14-.99Z"/></svg>'},385319:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M4.56 2a2.56 2.56 0 0 0-1.97 4.19c.7-1.6 2-2.9 3.6-3.6A2.54 2.54 0 0 0 4.56 2zM1 4.56c0 1.07.47 2.03 1.22 2.68A7.01 7.01 0 0 0 9 16v-1a6 6 0 1 1 6-6h1c0-.6-.08-1.2-.22-1.76a3.55 3.55 0 1 0-5.02-5.02 7.01 7.01 0 0 0-3.52 0A3.55 3.55 0 0 0 1 4.56zm10.81-1.97c1.6.7 2.9 2 3.6 3.6a2.56 2.56 0 0 0-3.6-3.6zM9 5v4H6v1h4V5H9zm4 8v-3h1v3h3v1h-3v3h-1v-3h-3v-1h3z"/></svg>'},191035:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 4a2 2 0 0 0 1.59-.79c.5.14.98.34 1.42.6L12 4a2 2 0 0 0 2.2 2c.25.43.45.9.59 1.41a2 2 0 0 0 0 3.18c-.14.5-.34.98-.6 1.42a2 2 0 0 0-2.18 2.18c-.44.26-.92.46-1.42.6a2 2 0 0 0-3.18 0c-.5-.14-.98-.34-1.42-.6L6 14a2 2 0 0 0-2.2-2 5.96 5.96 0 0 1-.59-1.41 2 2 0 0 0 0-3.18c.14-.5.34-.98.6-1.42L4 6a2 2 0 0 0 2-2.2c.43-.25.9-.45 1.41-.59A2 2 0 0 0 9 4zm1.53-1.83c-.29-.07-.54.16-.7.4a1 1 0 0 1-1.65 0c-.17-.24-.42-.47-.7-.4a6.9 6.9 0 0 0-2.27.94c-.23.15-.26.47-.22.75L5 4a1 1 0 0 1-1.14.99c-.28-.04-.6-.01-.75.22a6.96 6.96 0 0 0-.94 2.26c-.07.29.16.54.4.7a1 1 0 0 1 0 1.65c-.24.17-.47.42-.4.7.18.82.5 1.59.94 2.27.15.23.47.26.75.22L4 13a1 1 0 0 1 .99 1.14c-.04.28-.01.6.22.75.68.44 1.45.76 2.26.94.29.07.54-.16.7-.4a1 1 0 0 1 1.65 0c.17.24.42.47.7.4a6.9 6.9 0 0 0 2.27-.94c.23-.15.26-.47.22-.75a1 1 0 0 1 1.13-1.13c.28.04.6.01.75-.22.44-.68.76-1.45.94-2.26.07-.29-.16-.54-.4-.7a1 1 0 0 1 0-1.65c.24-.17.47-.42.4-.7a6.96 6.96 0 0 0-.94-2.27c-.15-.23-.47-.26-.75-.22a1 1 0 0 1-1.13-1.13c.04-.28.01-.6-.22-.75a6.96 6.96 0 0 0-2.26-.94zM9 12a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/></svg>'},396607:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 4.09V11h1V4.09l2.67 2.29.66-.76-3.5-3-.33-.28-.33.28-3.5 3 .66.76L9 4.08ZM4 14v-3H3v3a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1v-3h-1v3H4Z"/></svg>'},499084:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm3.87-12.15c.36.2.49.66.28 1.02l-4 7a.75.75 0 0 1-1.18.16l-3-3a.75.75 0 1 1 1.06-1.06l2.3 2.3 3.52-6.14a.75.75 0 0 1 1.02-.28Z"/></svg>'},530162:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"/></svg>'},527941:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM8 6a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm1 2c.49 0 1 .59 1 1v3.01c0 .42-.51.99-1 .99s-1-.57-1-.99V9c0-.41.51-1 1-1Z"/></svg>'},482353:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16Zm0-3a1 1 0 1 1 0-2 1 1 0 0 1 0 2ZM6 7.5a3 3 0 1 1 6 0c0 .96-.6 1.48-1.17 1.98-.55.48-1.08.95-1.08 1.77h-1.5c0-1.37.7-1.9 1.33-2.38.49-.38.92-.71.92-1.37C10.5 6.67 9.82 6 9 6s-1.5.67-1.5 1.5H6Z"/></svg>'},162819:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="m12.95 6.28-.45-.9-.45.9-1.55 3.1-.55-1.1-.45-.9-.45.9-2 4 .9.44 1.55-3.1.55 1.1.45.9.45-.9 1.55-3.1 2.55 5.1.9-.44-3-6ZM2.5 15H3v-1h-.5v1ZM4 15h1v-1H4v1Zm2 0h1v-1H6v1Zm2 0h1v-1H8v1Zm2-1v1h1v-1h-1Zm2 0v1h1v-1h-1Zm2 1h1v-1h-1v1Zm2 0h1v-1h-1v1Zm2 0h1v-1h-1v1Zm2 0h1v-1h-1v1Zm2 0h1v-1h-1v1Zm2 0h1v-1h-1v1Zm2 0h.5v-1H26v1ZM4.05 18.28l1-2 .9.44-1 2-.9-.44Zm19.9-5.56 1-2-.9-.44-1 2 .9.44Zm-6 3.56-.9.44 2 4 .45.9.45-.9 2-4-.9-.44-1.55 3.1-1.55-3.1Z"/></svg>'},223414:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M11.98 16.69 17.2 12h3.04l4.14-4.67-.74-.66L19.78 11H16.8L12 15.31 9 12.3l-4.35 4.36.7.7L9 13.71l2.98 2.98Z"/></svg>'},34995:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M12 7v14h5V7h-5Zm4 1h-3v12h3V8ZM19 15v6h5v-6h-5Zm4 1h-3v4h3v-4ZM5 12h5v9H5v-9Zm1 1h3v7H6v-7Z"/></svg>'},177042:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M14 9.5a.5.5 0 0 0 1 0V7.02A6.5 6.5 0 0 1 20.98 13H18.5a.5.5 0 0 0 0 1h2.48A6.5 6.5 0 0 1 15 19.98V17.5a.5.5 0 0 0-1 0v2.48A6.5 6.5 0 0 1 8.02 14h2.48a.5.5 0 0 0 0-1H8.02A6.5 6.5 0 0 1 14 7.02V9.5zm1-3.48V4.5a.5.5 0 0 0-1 0v1.52A7.5 7.5 0 0 0 7.02 13H5.5a.5.5 0 0 0 0 1h1.52A7.5 7.5 0 0 0 14 20.98v1.52a.5.5 0 0 0 1 0v-1.52A7.5 7.5 0 0 0 21.98 14h1.52a.5.5 0 0 0 0-1h-1.52A7.5 7.5 0 0 0 15 6.02z"/></svg>'}}]);