"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[20507],{371573:(t,e,i)=>{var n=i(678515),o=n.min,r=n.max,s=i(379048).MarkLocation;function a(){}a.prototype._locationToY=function(t,e,i){i||(i=0);var n,a=[],l=this._provider.priceScale();switch(t){case s.AboveBar:n=TradingView.HIGH_PLOT;break;case s.BelowBar:n=TradingView.LOW_PLOT}var d=this._provider.firstValue();i>=1&&(i-=1);for(var h=-i;h<=i;h++){var c=this._provider.series().bars().valueAt(e+h);if(null!==c){var u=c[n];a.push(l.priceToCoordinate(u,d))}}switch(t){case s.AboveBar:return o(a)-15;case s.BelowBar:return r(a)+15}},t.exports=a},535698:(t,e,i)=>{i.d(e,{TextRenderer:()=>R,calculateLabelPosition:()=>u,getTextBoundaries:()=>f,needTextExclusionPath:()=>p,wordWrap:()=>g});var n=i(86441),o=i(650151),r=i(934026),s=i(31341),a=i(315801),l=i(787123),d=i(389137),h=i(199471),c=i(458963);function u(t,e,i,o,r){const s=.5*(e.x+i.x);let a=i.y;return e.y>i.y?(a-=t.height/2+o.y,a=Math.max(t.height/2,a)):(a+=t.height/2+o.y,a=Math.min(r-t.height/2,a)),new n.Point(s,a)}function f(t,e,i){if(t.isOutOfScreen(e,i))return null;const n=t.getPolygonPoints();return 0===n.length?null:n}function p(t){const e=t.getLinesInfo().lines;if(e.length%2==0)return!1;if(""===e[Math.floor(e.length/2)].trim())return!1;return!0}function g(t,e,i){i=(0,d.isString)(i)?parseInt(i):i,t+="";const n=!(0,d.isNumber)(i)||!isFinite(i)||i<=0?t.split(/\r\n|\r|\n|$/):t.split(/[^\S\r\n]*(?:\r\n|\r|\n|$)/);if(n[n.length-1]||n.pop(),!(0,d.isNumber)(i)||!isFinite(i)||i<=0)return n;const o=[];for(let t=0;t<n.length;t++){const r=n[t],s=(0,h.measureText)(r,e).width;if(s<=i){o.push(r);continue}const a=r.split(/([-)\]},.!?:;])|(\s+)/);let l=0;for(;a.length;){let t=~~(i/s*(a.length+2)/3);if(t<=0||(0,h.measureText)(a.slice(0,3*t-1).join(""),e).width<=i)for(;(0,h.measureText)(a.slice(0,3*(t+1)-1).join(""),e).width<=i;)t++;else for(;t>0&&(0,h.measureText)(a.slice(0,3*--t-1).join(""),e).width>i;);if(t>0)o.push(a.slice(0,3*t-1).join("")),a.splice(0,3*t);else{const t=a[0]+(a[1]||"");if(l=1===l?1:~~(i/(0,h.measureText)(t,e).width*t.length),(0,h.measureText)(t.substring(0,l),e).width<=i)for(;(0,h.measureText)(t.substring(0,l+1),e).width<=i;)l++;else for(;l>1&&(0,h.measureText)(t.substring(0,--l),e).width>i;);l<1&&(l=1),o.push(t.substring(0,l)),a[0]=t.substring(l),a[1]=""}if((0,h.measureText)(a.join(""),e).width<=i){o.push(a.join(""));break}}}return o}function _(t,e,i){if(0===i)return t.clone();const o=(t.x-e.x)*Math.cos(i)-(t.y-e.y)*Math.sin(i)+e.x,r=(t.x-e.x)*Math.sin(i)+(t.y-e.y)*Math.cos(i)+e.y;return new n.Point(o,r)}function x(t,e){const i=Math.round(e+2*b(t)+2*m(t));return i%2?i+1:i}function w(t,e){return S(t)*e+T(t)*(e-1)+2*y(t)+2*v(t)}function v(t){return void 0!==t.boxPaddingVert?t.boxPaddingVert*P(t):void 0!==t.boxPadding?t.boxPadding*P(t):S(t)/3}function m(t){return void 0!==t.boxPaddingHorz?t.boxPaddingHorz*P(t):void 0!==t.boxPadding?t.boxPadding*P(t):S(t)/3}function y(t){return(t.backgroundVertInflate||0)*P(t)}function b(t){return(t.backgroundHorzInflate||0)*P(t)}function T(t){
return(t.padding||0)*P(t)}function S(t){return Math.ceil(C(t)*P(t))}function C(t){return t.fontsize||t.fontSize||30}function P(t){const e=Math.min(1,Math.max(.2,Math.min(t.scaleX||1,t.scaleY||1)));if(1===e)return e;const i=C(t);return Math.ceil(e*i)/i}class R{constructor(t,e){this._data=null,this._internalData=null,this._boxSize=null,this._polygonPoints=null,this._linesInfo=null,this._fontInfo=null,this._hittest=e||new a.HitTestResult(a.HitTarget.MovePoint,{areaName:a.AreaName.Text}),void 0!==t&&this.setData(t)}setData(t){null!==t?(t.horzTextAlign||(t.horzTextAlign=t.horzAlign),!function(t,e){if(null===t||null===e)return null===t==(null===e);if(void 0===t.points!=(void 0===e.points))return!1;if(void 0!==t.points&&void 0!==e.points){if(t.points.length!==e.points.length)return!1;for(let o=0;o<t.points.length;++o)if(i=t.points[o],n=e.points[o],i.x!==n.x||i.y!==n.y)return!1}var i,n;return t.text===e.text&&t.vertAlign===e.vertAlign&&t.horzAlign===e.horzAlign&&t.horzTextAlign===e.horzTextAlign&&t.font===e.font&&t.offsetX===e.offsetX&&t.offsetY===e.offsetY&&t.bold===e.bold&&t.italic===e.italic&&t.fontsize===e.fontsize&&t.fontSize===e.fontSize&&t.backgroundRoundRect===e.backgroundRoundRect&&t.forceTextAlign===e.forceTextAlign&&t.wordWrapWidth===e.wordWrapWidth&&t.forceCalculateMaxLineWidth===e.forceCalculateMaxLineWidth&&t.padding===e.padding&&t.scaleY===e.scaleY&&t.scaleX===e.scaleX&&t.highlightBorder===e.highlightBorder&&t.backgroundHorzInflate===e.backgroundHorzInflate&&t.backgroundVertInflate===e.backgroundVertInflate&&t.boxPadding===e.boxPadding&&t.boxPaddingVert===e.boxPaddingVert&&t.boxPaddingHorz===e.boxPaddingHorz&&t.angle===e.angle&&t.maxHeight===e.maxHeight&&(0,d.deepEquals)(t.boxShadow,e.boxShadow)[0]}(this._data,t)?(this._data=t,this._internalData=null,this._boxSize=null,this._polygonPoints=null,this._linesInfo=null,this._fontInfo=null):this._data=t):this._data=null}hitTest(t){return null===this._data||void 0===this._data.points||0===this._data.points.length?null:(0,r.pointInPolygon)(t,this.getPolygonPoints())?this._hittest:null}doesIntersectWithBox(t){return null!==this._data&&void 0!==this._data.points&&0!==this._data.points.length&&(0,r.pointInBox)(this._data.points[0],t)}measure(){if(null===this._data)return{width:0,height:0};const t=this._getBoxSize();return{width:t.boxWidth,height:t.boxHeight}}rect(){if(null===this._data)return{x:0,y:0,width:0,height:0};const t=this._getInternalData();return{x:t.boxLeft,y:t.boxTop,width:t.boxWidth,height:t.boxHeight}}isOutOfScreen(t,e){if(null===this._data||void 0===this._data.points||0===this._data.points.length)return!0;const i=this._getInternalData();if(i.boxLeft+i.boxWidth<0||i.boxLeft>t){const i=(0,n.box)(new n.Point(0,0),new n.Point(t,e));return this.getPolygonPoints().every((t=>!(0,r.pointInBox)(t,i)))}return!1}setPoints(t,e){(0,o.ensureNotNull)(this._data).points=t,this._hittest=e||new a.HitTestResult(a.HitTarget.MovePoint)}fontStyle(t){return null===this._data?"":this._getFontInfo().fontStyle}wordWrap(t,e,i){return g(t,i||this.fontStyle(),e)}draw(t,e){
if(null===this._data||void 0===this._data.points||0===this._data.points.length)return;if(this.isOutOfScreen(e.cssWidth,e.cssHeight))return;const i=e.pixelRatio,n=this._getInternalData(),o=this._getRotationPoint().scaled(i);t.save(),t.translate(o.x,o.y),t.rotate(this._data.angle||0),t.translate(-o.x,-o.y);const r=this._getFontInfo().fontSize;t.textBaseline=n.textBaseLine,t.textAlign=n.textAlign,t.font=this.fontStyle();const{scaledLeft:s,scaledRight:a,scaledTop:d,scaledBottom:u}=function(t,e){const i=Math.round(t.boxLeft*e),n=Math.round(t.boxTop*e);return{scaledLeft:i,scaledRight:i+Math.round(t.boxWidth*e),scaledTop:n,scaledBottom:n+Math.round(t.boxHeight*e)}}(n,i);if(this._data.backgroundColor||this._data.borderColor||this._data.highlightBorder&&this._data.wordWrapWidth){const e=this._data.borderWidth||Math.max(r/12,1),n=Math.round(e*i),o=n/2;let h=!1;if(this._data.boxShadow){t.save();const{shadowColor:e,shadowBlur:i,shadowOffsetX:n=0,shadowOffsetY:o=0}=this._data.boxShadow;t.shadowColor=e,t.shadowBlur=i,t.shadowOffsetX=n,t.shadowOffsetY=o,h=!0}if(this._data.backgroundRoundRect)this._data.backgroundColor&&((0,l.drawRoundRect)(t,s,d,a-s,u-d,this._data.backgroundRoundRect*i),t.fillStyle=this._data.backgroundColor,t.fill(),h&&(t.restore(),h=!1)),this._data.borderColor&&((0,l.drawRoundRect)(t,s-o,d-o,a-s+n,u-d+n,this._data.backgroundRoundRect*i+n),t.strokeStyle=this._data.borderColor,t.lineWidth=n,t.stroke(),h&&(t.restore(),h=!1));else if(this._data.backgroundColor&&(t.fillStyle=this._data.backgroundColor,t.fillRect(s,d,a-s,u-d),h&&(t.restore(),h=!1)),this._data.borderColor||this._data.highlightBorder){let e;this._data.borderColor?(t.strokeStyle=this._data.borderColor,e=n):(t.strokeStyle=this._data.color,(0,l.setLineStyle)(t,c.LINESTYLE_DASHED),e=Math.max(1,Math.floor(i))),t.lineWidth=e,t.beginPath(),t.moveTo(s-e/2,d-e/2),t.lineTo(s-e/2,u+e/2),t.lineTo(a+e/2,u+e/2),t.lineTo(a+e/2,d-e/2),t.lineTo(s-e/2,d-e/2),t.stroke(),h&&t.restore()}}t.fillStyle=this._data.color;const f=(s+Math.round(n.textStart*i))/i,p=.05*r;let g=(d+Math.round((n.textTop+p)*i))/i;const _=T(this._data),x=this.getLinesInfo();for(const e of x.lines)(0,h.drawScaled)(t,i,i,(()=>t.fillText(e,f,g))),g+=r+_;t.restore()}getPolygonPoints(){if(null!==this._polygonPoints)return this._polygonPoints;if(null===this._data)return[];const t=this._data.angle||0,{boxLeft:e,boxTop:i,boxWidth:o,boxHeight:r}=this._getInternalData(),s=this._getRotationPoint();return this._polygonPoints=[_(new n.Point(e,i),s,t),_(new n.Point(e+o,i),s,t),_(new n.Point(e+o,i+r),s,t),_(new n.Point(e,i+r),s,t)],this._polygonPoints}getLinesInfo(){if(null===this._linesInfo){const t=(0,o.ensureNotNull)(this._data);let e=this.wordWrap(t.text,t.wordWrapWidth);if(void 0!==t.maxHeight){const i=function(t){const e=(0,o.ensureDefined)(t.maxHeight),i=S(t),n=T(t);return Math.floor((e+n)/(i+n))}(t);e.length>i&&(e=e.slice(0,i))}this._linesInfo={linesMaxWidth:this._getLinesMaxWidth(e),lines:e}}return this._linesInfo}_getLinesMaxWidth(t){const e=this.fontStyle()
;if(null!==this._data&&this._data.wordWrapWidth&&!this._data.forceCalculateMaxLineWidth)return this._data.wordWrapWidth*P(this._data);let i=0;for(const n of t)i=Math.max(i,(0,h.measureText)(n,e).width);return i}_getInternalData(){if(null!==this._internalData)return this._internalData;const t=(0,o.ensureNotNull)(this._data),e=this._getBoxSize(),i=e.boxWidth,n=e.boxHeight,r=(0,o.ensureDefined)(t.points)[0];let a=r.y;switch(t.vertAlign){case"bottom":a-=n+t.offsetY;break;case"middle":a-=n/2;break;case"top":a+=t.offsetY}let l=r.x;const d=m(t),h=v(t),c=b(t)+d;let u;const f=a+(y(t)+h)+S(t)/2;let p;switch(t.horzAlign){case"left":l+=t.offsetX;break;case"center":l-=i/2;break;case"right":l-=i+t.offsetX}switch((0,o.ensureDefined)(t.horzTextAlign)){case"left":p="start",u=l+c,(0,s.isRtl)()&&(t.forceTextAlign?p="left":(u=l+i-c,p="right"));break;case"center":p="center",u=l+i/2;break;case"right":p="end",u=l+i-c,(0,s.isRtl)()&&t.forceTextAlign&&(p="right")}return this._internalData={boxLeft:l,boxTop:a,boxWidth:i,boxHeight:n,textStart:u-l,textTop:f-a,textAlign:p,textBaseLine:"middle"},this._internalData}_getFontInfo(){if(null===this._fontInfo){const t=(0,o.ensureNotNull)(this._data),e=S(t),i=(t.bold?"bold ":"")+(t.italic?"italic ":"")+e+"px "+t.font;this._fontInfo={fontStyle:i,fontSize:e}}return this._fontInfo}_getBoxSize(){if(null===this._boxSize){const t=this.getLinesInfo(),e=(0,o.ensureNotNull)(this._data);this._boxSize={boxWidth:x(e,t.linesMaxWidth),boxHeight:w(e,t.lines.length)}}return this._boxSize}_getRotationPoint(){const{boxLeft:t,boxTop:e,boxWidth:i,boxHeight:r}=this._getInternalData(),{horzAlign:s,vertAlign:a}=(0,o.ensureNotNull)(this._data);let l,d;switch(s){case"center":l=t+i/2;break;case"left":l=t;break;case"right":l=t+i}switch(a){case"middle":d=e+r/2;break;case"top":d=e;break;case"bottom":d=e+r}return new n.Point(l,d)}}},209406:(t,e,i)=>{i.r(e),i.d(e,{BackgroundPaneView:()=>l});var n=i(650151),o=i(142119),r=i(199471),s=i(246733);class a{constructor(t){this._data=t}hitTest(t){return null}draw(t,e){}drawBackground(t,e){const i=this._data,n=(0,s.generateColor)(this._data.color,this._data.transparency),o=e.pixelRatio,a=Math.round(i.x1*o),l=Math.round(i.x2*o);(0,r.fillRect)(t,a,0,l-a,e.physicalHeight,n)}}class l{constructor(t,e,i){this._data=[],this._invalidated=!0,this._provider=t,this._model=e,this._data=[]}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new o.CompositeRenderer;for(const e of this._data)t.append(new a(e));return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().backgrounds();if(0===i.size)return;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return;const r=o.firstBar(),s=o.lastBar(),a=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().backgrounds);i.forEach(((t,i)=>{const o=(0,n.ensureDefined)(a.childs()[i]).childs();if(!o.visible.value())return;let l,d;t.forEach((t=>{
const i=null!==t.start?t.start:(0,n.ensureNotNull)(e.points().range().value()).firstIndex,a=t.stop;if(a<r||s<i)return;let h=e.indexToCoordinate(i)-.5*e.barSpacing();const c=e.indexToCoordinate(a)+.5*e.barSpacing();d===i-1&&(h=l||h),l=c,d=a,h<0&&c<0||h>e.width()&&c>e.width()||this._data.push({x1:h,x2:c,color:o.color.value(),transparency:o.transparency.value()})}))}))}}},277150:(t,e,i)=>{i.r(e),i.d(e,{DwgBoxPaneView:()=>P,getDwgBoxDrawPattern:()=>C});var n=i(650151),o=i(86441),r=i(151149),s=i(371573),a=i.n(s),l=i(206395),d=i(92245),h=i(327714),c=i(934026),u=i(315801),f=i(787123),p=i(535698),g=i(173501);function _(t,e){const i=t.style.extendLeft?0:t.leftTop.x,n=t.style.extendRight?e:t.rightBottom.x;return(0,o.box)((0,o.point)(i,t.leftTop.y),(0,o.point)(n,t.rightBottom.y))}class x{constructor(t){this._textRenderer=new p.TextRenderer,this._locs=t}draw(t,e){const{pixelRatio:i,physicalWidth:o}=e;t.lineCap="butt";const r=Math.max(1,Math.floor(i));this._locs.forEach((s=>{const{backgroundColor:a,borderColor:l,extendLeft:d,extendRight:c,borderWidth:u,dashPattern:p,text:_}=s.style,x=Math.round(u*i),w=d?-x:Math.round(s.leftTop.x*i),v=Math.round(s.leftTop.y*i),m=c?o+x:Math.round(s.rightBottom.x*i),y=Math.round(s.rightBottom.y*i);if((0,f.fillRectWithBorder)({context:t,horizontalPixelRatio:i,verticalPixelRatio:i,mediaSize:(0,h.size)({width:e.cssWidth,height:e.cssHeight}),bitmapSize:(0,h.size)({width:e.physicalWidth,height:e.physicalHeight})},w,v,m,y,r,void 0===a?void 0:{color:a},void 0===l||0===u?void 0:{color:l,borderWidth:x,borderMode:"inner",dashPattern:p}),_){const i=Math.abs(s.rightBottom.x-s.leftTop.x),o=Math.abs(s.rightBottom.y-s.leftTop.y),r=Math.min(s.rightBottom.x,s.leftTop.x),a=Math.min(s.rightBottom.y,s.leftTop.y);"auto"!==_.fontSizeMode&&"auto"!==_.wordWrap||(t.save(),t.beginPath(),t.rect(r*e.pixelRatio,a*e.pixelRatio,i*e.pixelRatio,o*e.pixelRatio),t.clip());const l={textSizeMode:_.fontSizeMode,fontSize:_.fontSize},d={horizontalTextAlignment:_.horizontalTextAlignment,verticalTextAlignment:_.verticalTextAlignment,text:_.text,textColor:_.textColor,sizeOptions:l,fontType:s.style.fontType},h=(0,g.textBoxData)(r,a,i,o,d);h.wordWrapWidth="auto"===_.wordWrap?Math.max(1,i-(0,n.ensureDefined)(h.fontSize)/6):void 0,this._textRenderer.setData(h),this._textRenderer.draw(t,e),"auto"===_.fontSizeMode&&t.restore()}}))}hitTest(t,e){for(const i of this._locs)if((0,c.pointInBox)(t,_(i,e.cssWidth)))return new u.HitTestResult(u.HitTarget.Regular);return null}}var w=i(368135),v=i(983898);class m extends v.AbstractMapContainer{constructor(t){super(),this._maxSize=t,this._keysQueue=[]}get(t){const e=this._keysForData(t);if(null===e)return null;const[i,n,o]=e,r=(0,v.getDefault2)(this._map,i,n,new Map);let s=r.get(o);return void 0!==s||(this._size>=this._maxSize?this._deleteFirstKey():++this._size,this._keysQueue.push(e),s=this._createValueItem(t),r.set(o,s)),s}_deleteFirstKey(){const t=(0,n.ensureDefined)(this._keysQueue.shift()),[e,i,o]=t,r=(0,n.ensureDefined)(this._map.get(e)),s=(0,n.ensureDefined)(r.get(i));s.delete(o),
0===s.size&&r.delete(i),0===r.size&&this._map.delete(e)}}var y=i(422333);const b={bold:!1,italic:!1,font:y.CHART_FONT_FAMILY};class T extends m{constructor(t,e=b){super(t),this._fontOptions=e,this._measureCanvas=document.createElement("canvas"),this._measureContext=(0,n.ensureNotNull)(this._measureCanvas.getContext("2d"))}_keysForData(t){return[t.lines.join("\n"),t.boxWidth,t.boxHeight]}_createValueItem(t){return(0,g.calculateFontSizeForBox)(this._measureContext,this._fontOptions,t.lines,t.boxWidth,t.boxHeight)}}const S=new Map([[l.DwgBoxStyle.Solid,[]],[l.DwgBoxStyle.Dashed,[5,6]],[l.DwgBoxStyle.Dotted,[1,2]]]);function C(t){const e=S.get(t);if(void 0===e)throw new Error(`Unsupported box style: ${t}`);return e}class P extends(a()){constructor(t,e,i){super(),this._invalidated=!0,this._rgbaFromInteger=(0,r.rgbaFromIntegerCached)(),this._cacheByFontType=new Map([[l.DwgBoxFontType.Monospace,new T(5e3,{...b,font:y.CHART_MONOSPACE_FONT_FAMILY})],[null,new T(5e3)]]),this._graphicsProvider=t,this._model=e,this._renderer=null}update(){this._invalidated=!0}renderer(t,e){return this._invalidated&&(this._renderer=null,this._invalidated=!1,this._updateRenderer(e,t)),this._renderer}_updateRenderer(t,e){const i=this._graphicsProvider.priceScale(),r=this._model.timeScale();if(!i||i.isEmpty()||r.isEmpty())return;const s=this._graphicsProvider.graphics().dwgboxes();if(0===s.size)return;if(null===this._model.timeScale().visibleBarsStrictRange())return;const a=this._graphicsProvider.properties().childs().palettes.childs(),l=this._graphicsProvider.metaInfo().isRGB;if(!l&&(void 0===a||void 0===a.palette_common))return;const h=l?void 0:(0,n.ensureDefined)(a.palette_common).childs().colors.childs(),c=this._graphicsProvider.firstValue();if(null===c)return;const u={x1:0,y1:0,x2:0,y2:0,extend:d.DwgExtend.None},f=[],p=(0,n.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwgboxes);s.forEach(((s,a)=>{(0,n.ensureDefined)(p.childs()[a]).childs().visible.value()&&s.forEach((n=>{if(null===n.backgroundColorIndex&&null===n.borderColorIndex)return;let s,a,p;if(l?(s=null===n.backgroundColorIndex?void 0:this._rgbaFromInteger(n.backgroundColorIndex),a=null===n.borderColorIndex?void 0:this._rgbaFromInteger(n.borderColorIndex),p=null===n.textColorIndex?void 0:this._rgbaFromInteger(n.textColorIndex)):(s=null!==n.backgroundColorIndex?h[n.backgroundColorIndex].childs().color.value():void 0,a=null!==n.borderColorIndex?h[n.borderColorIndex].childs().color.value():void 0,p=null!==n.textColorIndex?h[n.textColorIndex].childs().color.value():void 0),void 0===s&&void 0===a)return;const g=(0,d.convertPointsToScreenDimension)(n.left,n.top,n.right,n.bottom,n.extend,i,r,t,c,u);if(null===g)return;const{x1:_,x2:x,y1:w,y2:v,extend:m}=g,y=Math.min(_,x),b=Math.max(_,x),T=Math.min(w,v),S=Math.max(w,v),P={borderWidth:n.borderWidth,borderColor:a,backgroundColor:s,dashPattern:C(n.borderStyle),extendLeft:(0,d.isExtendInSameDirection)(m,d.DwgExtend.Left),extendRight:(0,d.isExtendInSameDirection)(m,d.DwgExtend.Right),
text:this._getTextStyleData(n,p,b-y,S-T),fontType:n.fontType},R={leftTop:new o.Point(Math.min(y,b),T),rightBottom:new o.Point(Math.max(y,b),S),style:P},D=R.rightBottom.x<-R.style.borderWidth&&!R.style.extendRight,M=R.leftTop.x>t+R.style.borderWidth&&!R.style.extendLeft,L=R.rightBottom.y<-R.style.borderWidth,I=R.leftTop.y>e+R.style.borderWidth;D||M||L||I||f.push(R)}))})),this._renderer=new x(f)}_getTextStyleData(t,e,i,o){const r=t.fontSize,s=t.text&&e?{text:t.text,wordWrap:t.wordWrap,textColor:e,horizontalTextAlignment:t.horizontalTextAlignment,verticalTextAlignment:t.verticalTextAlignment}:void 0;if(s&&r){const e=s;if(t.fontSize===w.PlotSymbolSize.Auto){const r={lines:(0,p.wordWrap)((0,n.ensureDefined)(t.text),"",void 0),boxWidth:i,boxHeight:o};e.fontSizeMode="auto";const s=(0,n.ensureDefined)(this._cacheByFontType.get(t.fontType));e.fontSize=(0,n.ensureNotNull)(s.get(r))}else e.fontSizeMode="fixed",e.fontSize=r;return e}}}},531536:(t,e,i)=>{i.r(e),i.d(e,{DwgLabelPaneView:()=>B});var n=i(650151),o=i(151149),r=i(142119),s=i(119914),a=i(111595),l=i(594931),d=i(506366),h=i(992885),c=i(618241),u=i(778190),f=i(86441),p=i(379730);class g extends p.PaneRendererLabelBase{_calcBoundingBox(t){const e=t.x,i=t.x+t.shapeWidth,n=t.y-t.shapeHeight+t.vertOffset,o=t.y+t.vertOffset,r=new f.Point(e,n),s=new f.Point(i,o);return(0,f.box)(r,s)}_drawItemShape(t,e,i){const n=e.pixelRatio,o=this._lineWidth(e)%2?.5:0,r=this._getArrowSize(i),s=Math.round(i.x*n)+o,a=Math.round((i.y+i.vertOffset)*n)+o,l=Math.round((i.x+r)*n)+o,d=Math.round((i.y+i.vertOffset-r)*n)+o,h=Math.round((i.y+i.vertOffset-2*r)*n)+o;t.moveTo(l,d),t.lineTo(s,a),t.lineTo(l,h);const c=Math.round((i.y+i.vertOffset-i.shapeHeight-r)*n)+o,u=Math.round((i.x+i.shapeWidth+r)*n)+o;this._drawCorner(t,l,c,p.CornerVectorsClockwise.leftUp,n),this._drawCorner(t,u,c,p.CornerVectorsClockwise.rightUp,n),this._drawCorner(t,u,d,p.CornerVectorsClockwise.rightDown,n),t.lineTo(l,d)}_getArrowSize(t){return t.stepX/Math.sqrt(2)}_getHorizontalTextOffset(t){return t.shapeWidth/2+this._getArrowSize(t)}_getVerticalTextOffset(t){return-t.shapeHeight/2-this._getArrowSize(t)}}class _ extends p.PaneRendererLabelBase{_calcBoundingBox(t){const e=t.x,i=t.x+t.shapeWidth,n=t.y+t.vertOffset,o=t.y+t.shapeHeight+t.vertOffset,r=new f.Point(e,n),s=new f.Point(i,o);return(0,f.box)(r,s)}_drawItemShape(t,e,i){const n=e.pixelRatio,o=this._lineWidth(e)%2?.5:0,r=this._getArrowSize(i),s=Math.round(i.x*n)+o,a=Math.round((i.y+i.vertOffset)*n)+o,l=Math.round((i.x+r)*n)+o,d=Math.round((i.y+i.vertOffset+2*r)*n)+o,h=Math.round((i.y+i.vertOffset+r)*n)+o,c=Math.round((i.x+i.shapeWidth+r)*n)+o,u=Math.round((i.y+i.vertOffset+i.shapeHeight+r)*n)+o;t.moveTo(l,d),t.lineTo(s,a),t.lineTo(l,h),this._drawCorner(t,c,h,p.CornerVectorsClockwise.rightUp,n),this._drawCorner(t,c,u,p.CornerVectorsClockwise.rightDown,n),this._drawCorner(t,l,u,p.CornerVectorsClockwise.leftDown,n),t.lineTo(l,d)}_getArrowSize(t){return t.stepX/Math.sqrt(2)}_getHorizontalTextOffset(t){return t.shapeWidth/2+this._getArrowSize(t)}_getVerticalTextOffset(t){
return t.shapeHeight/2+this._getArrowSize(t)}}class x extends p.PaneRendererLabelBase{_calcBoundingBox(t){const e=t.x-t.shapeWidth,i=t.x,n=t.y-t.shapeHeight+t.vertOffset,o=t.y+t.vertOffset,r=new f.Point(e,n),s=new f.Point(i,o);return(0,f.box)(r,s)}_drawItemShape(t,e,i){const n=e.pixelRatio,o=this._lineWidth(e)%2?.5:0,r=this._getArrowSize(i),s=Math.round(i.x*n)+o,a=Math.round((i.y+i.vertOffset)*n)+o,l=Math.round((i.x-r)*n)+o,d=Math.round((i.y+i.vertOffset-2*r)*n)+o,h=Math.round((i.y+i.vertOffset-r)*n)+o,c=Math.round((i.x-i.shapeWidth-r)*n)+o,u=Math.round((i.y+i.vertOffset-i.shapeHeight-r)*n)+o;t.moveTo(l,d),t.lineTo(s,a),t.lineTo(l,h),this._drawCorner(t,c,h,p.CornerVectorsClockwise.leftDown,n),this._drawCorner(t,c,u,p.CornerVectorsClockwise.leftUp,n),this._drawCorner(t,l,u,p.CornerVectorsClockwise.rightUp,n),t.lineTo(l,d)}_getArrowSize(t){return t.stepX/Math.sqrt(2)}_getVerticalTextOffset(t){return-t.shapeHeight/2-this._getArrowSize(t)}_getHorizontalTextOffset(t){return-t.shapeWidth/2-this._getArrowSize(t)}}class w extends p.PaneRendererLabelBase{_calcBoundingBox(t){const e=t.x-t.shapeWidth,i=t.x,n=t.y+t.vertOffset,o=t.y+t.shapeHeight+t.vertOffset,r=new f.Point(e,n),s=new f.Point(i,o);return(0,f.box)(r,s)}_drawItemShape(t,e,i){const n=e.pixelRatio,o=this._lineWidth(e)%2?.5:0,r=this._getArrowSize(i),s=Math.round(i.x*n)+o,a=Math.round((i.y+i.vertOffset)*n)+o,l=Math.round((i.x-r)*n)+o,d=Math.round((i.y+i.vertOffset+r)*n)+o,h=Math.round((i.y+i.vertOffset+2*r)*n)+o,c=Math.round((i.x-i.shapeWidth-r)*n)+o,u=Math.round((i.y+i.vertOffset+i.shapeHeight+r)*n)+o;t.moveTo(l,d),t.lineTo(s,a),t.lineTo(l,h),this._drawCorner(t,l,u,p.CornerVectorsClockwise.rightDown,n),this._drawCorner(t,c,u,p.CornerVectorsClockwise.leftDown,n),this._drawCorner(t,c,d,p.CornerVectorsClockwise.leftUp,n),t.lineTo(l,d)}_getArrowSize(t){return t.stepX/Math.sqrt(2)}_getHorizontalTextOffset(t){return-t.shapeWidth/2-this._getArrowSize(t)}_getVerticalTextOffset(t){return t.shapeHeight/2+this._getArrowSize(t)}}var v=i(29164),m=i(815555),y=i(821885),b=i(600642);class T extends y.PaneRendererAbstractFillStrokeShape{setItems(t,e){this._setBaseData(t,e);for(const t of this._items)0===t.vertOffset&&(t.textVertOffset=0)}_drawItemText(t,e,i){var n;const o=this._getTextCache(i);if(null===o)return;const r=i.x,s=i.y+i.textVertOffset,a=(null===(n=i.style)||void 0===n?void 0:n.textColor)||this._textColor,l=i.vertOffset,d={style:{fillStyle:a},location:{x:r,y:s,horzAlign:b.HorizontalAlign.Center,vertAlign:l>0?b.VerticalAlign.Top:b.VerticalAlign.Bottom}};o.paintTo(t,e,d)}_calcBoundingBox(t){const e=t.vertOffset,i=this._getTextCache(t);if(!i)return;const n=i.textImageWidth,o=i.textImageHeight,r=n/2,s=t.y+t.textVertOffset,a=e>0?0:-o,l=e>0?o:0,d=new f.Point(t.x-r,s+a),h=new f.Point(t.x+r,s+l);return(0,f.box)(d,h)}}class S extends u.PaneRendererLabelCenter{_drawItemText(t,e,i){var o,r;const s=this._getTextCache(i);if(null===s)return
;const a=i.textHorizOffset||0,l=i.x+a,d=i.vertOffset,h=i.y+d+i.textVertOffset,c=(null===(o=i.style)||void 0===o?void 0:o.textColor)||this._textColor,u=(null===(r=i.style)||void 0===r?void 0:r.borderColor)||this._borderColor,f={style:{fillStyle:(0,n.ensureDefined)(c),strokeStyle:(0,n.ensureDefined)(u),lineWidth:4},location:{x:l,y:h,horzAlign:b.HorizontalAlign.Center,vertAlign:b.VerticalAlign.Middle}};s.paintTo(t,e,f)}_drawItemShape(t,e,i){}}var C=i(294024),P=i(368135),R=i(318041),D=i(539163),M=i(422333),L=i(470130);const I={[C.DwgLabelTextAlign.Left]:"left",[C.DwgLabelTextAlign.Center]:"center",[C.DwgLabelTextAlign.Right]:"right"};function z(t,e,i){switch(function(t){if(t.length<2)return 0;let e=Math.abs(t[0].x-t[1].x);for(let i=2;i<Math.min(5,t.length);++i)e=Math.max(e,Math.abs(t[i-1].x-t[i].x));return e<30?2:e<60?1:0}(t)){case 0:return t;case 1:const n=t.length;return t.filter(((t,o)=>(e-i+(n-o))%2==0));case 2:return[]}}class B{constructor(t,e,i){this._rendererTypeByStyle=new Map([[C.DwgLabelStyle.Arrowdown,a.PaneRendererArrowDown],[C.DwgLabelStyle.Arrowup,a.PaneRendererArrowUp],[C.DwgLabelStyle.Circle,l.PaneRendererCircleShape],[C.DwgLabelStyle.Cross,d.PaneRendererCrossShape],[C.DwgLabelStyle.Diamond,h.PaneRendererDiamond],[C.DwgLabelStyle.Flag,c.PaneRendererFlagShape],[C.DwgLabelStyle.LabelDown,u.PaneRendererLabelDown],[C.DwgLabelStyle.LabelUp,u.PaneRendererLabelUp],[C.DwgLabelStyle.LabelLeft,u.PaneRendererLabelLeft],[C.DwgLabelStyle.LabelRight,u.PaneRendererLabelRight],[C.DwgLabelStyle.LabelCenter,u.PaneRendererLabelCenter],[C.DwgLabelStyle.LabelLeftUp,_],[C.DwgLabelStyle.LabelLeftDown,g],[C.DwgLabelStyle.LabelRightUp,w],[C.DwgLabelStyle.LabelRightDown,x],[C.DwgLabelStyle.Square,v.PaneRendererSquare],[C.DwgLabelStyle.Triangleup,s.PaneRendererTriangleApexUp],[C.DwgLabelStyle.Triangledown,s.PaneRendererTriangleApexDown],[C.DwgLabelStyle.Xcross,m.PaneRendererXCross],[C.DwgLabelStyle.None,T],[C.DwgLabelStyle.TextOutline,S]]),this._invalidated=!0,this._rgbaFromInteger=(0,o.rgbaFromIntegerCached)(),this._graphicsProvider=t,this._model=e,this._renderer=new r.CompositeRenderer,this._textCache=new R.TextImageCachesContainer(5e3),this._isFundamental=(0,L.isFundamentalStudyMetaInfo)(t.metaInfo())}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._invalidated=!1,this._updateViewInternal(this._model.timeScale().barSpacing())),this._renderer}_shiftLabels(){if(!this._isFundamental)return!1;const t=this._graphicsProvider.metaInfo();if(1!==t.plots.length)return!1;const e=this._graphicsProvider.properties().childs().styles.childs()[t.plots[0].id].childs().plottype.value();return e===P.LineStudyPlotStyle.StepLine||e===P.LineStudyPlotStyle.StepLineWithDiamonds}_updateViewInternal(t){this._renderer.clear();const e=this._graphicsProvider.priceScale(),i=this._model.timeScale();if(!e||e.isEmpty()||i.isEmpty())return;const o=this._shiftLabels()?i.barSpacing()/2:0,r=this._graphicsProvider.graphics().dwglabels(),s=i.visibleBarsStrictRange(),a=this._graphicsProvider.firstValue()
;if(0===r.size||null===s||null===a)return;const l=s.firstBar(),d=s.lastBar(),h=Math.round(t*D.DwgLabelPaneViewConstants.AUTO_SIZE_MULT);let c=null;const u=[],f=(0,n.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwglabels);r.forEach(((t,i)=>{if(!(0,n.ensureDefined)(f.childs()[i]).childs().visible.value())return;const r=t.size;let s=-1;t.forEach((t=>{s+=1;const i=t.x;if(i<l||d<i)return;let f,p;if(this._graphicsProvider.metaInfo().isRGB)f=null===t.colorIndex?void 0:this._rgbaFromInteger(t.colorIndex),p=null===t.textColorIndex?void 0:this._rgbaFromInteger(t.textColorIndex);else{const e=this._graphicsProvider.properties().childs().palettes.childs();if(void 0===e||void 0===e.palette_common)return;const i=e.palette_common.childs(),n=null===t.colorIndex?null:i.colors.childs()[t.colorIndex],o=null===t.textColorIndex?null:i.colors.childs()[t.textColorIndex];if(void 0===n||void 0===o)return;f=null===n?void 0:n.childs().color.value(),p=null===o?void 0:o.childs().color.value()}if(void 0===f&&void 0===p)return;const g=t.size,_=t.style,x=(0,D.calculateLabelHeight)(D.DwgLabelPaneViewConstants.NORMAL_SIZE,g,h),w=this._getInvertedYloc(t.yloc,e.isInverted()),v=void 0===p?"":t.text,m=I[t.textAlign],y=t.tooltip,b="monospace"===t.fontType?M.CHART_MONOSPACE_FONT_FAMILY:M.CHART_FONT_FAMILY,T=x*D.DwgLabelPaneViewConstants.FONT_SIZE_MULT,S=Math.round(.16666666666666666*T),C=v.length?(0,n.ensureNotNull)(this._textCache.get({text:v,bold:!1,italic:!1,font:b,fontSize:T,lineSpacing:S,align:m})).textImageHeight:0,P=this._getLocationData({index:i,price:t.y,yloc:w,size:x,style:_,firstValue:a,hideShape:void 0===f||"n"===_,textHeight:C}),R={x:P.x0+o,y:P.y0,width:P.shapeWidth,height:P.shapeHeight,vertOffset:P.vertOffset,text:v,fontSize:P.fontSize,font:b,style:{color:f,borderColor:f,textColor:p},textAlign:m,lineSpacing:S,tooltip:y};let L;P.style!==c?(L={items:[],allItemsIncludingInvisibleSize:r,endVisibleItemIndex:s,style:P.style},u.push(L),c=P.style):L=u[u.length-1],L.items.push(R),L.endVisibleItemIndex=s}))})),u.forEach((e=>{let i=e.items;if(this._isFundamental)switch(e.style){case C.DwgLabelStyle.LabelUp:case C.DwgLabelStyle.LabelDown:case C.DwgLabelStyle.LabelLeft:case C.DwgLabelStyle.LabelRight:case C.DwgLabelStyle.LabelCenter:case C.DwgLabelStyle.LabelLeftUp:case C.DwgLabelStyle.LabelLeftDown:case C.DwgLabelStyle.LabelRightUp:case C.DwgLabelStyle.LabelRightDown:case C.DwgLabelStyle.TextOutline:i=z(i,e.allItemsIncludingInvisibleSize,e.endVisibleItemIndex)}const o=new((0,n.ensureDefined)(this._rendererTypeByStyle.get(e.style)))({items:i,barSpacing:t},{textCache:this._textCache,skipRenderingOptimizations:!0});this._renderer.append(o)}))}_getLocationData(t){const e=D.DwgLabelPaneViewConstants,i=t.size*e.FONT_SIZE_MULT,n=this._model.timeScale(),o=this._graphicsProvider.priceScale(),r=n.indexToCoordinate(t.index);let s=NaN;if(t.yloc===C.DwgLabelYloc.Price||t.yloc===C.DwgLabelYloc.Auto)s=o.priceToCoordinate(t.price,t.firstValue);else{
const e=t.yloc===C.DwgLabelYloc.AboveBar?2:3,i=this._graphicsProvider.series().bars().valueAt(t.index);if(null!==i){const n=i[e];null!=n&&(s=o.priceToCoordinate(n,t.firstValue))}}const a=t.size*e.SHAPE_WIDTH_MULT,l=t.size*e.SHAPE_HEIGHT_MULT,d=t.hideShape?.5*l:(t.style===C.DwgLabelStyle.TextOutline?1.1:1.2)*l;return{x0:r,y0:s,shapeWidth:a,shapeHeight:l,vertOffset:d*this._getYLocSign(t.yloc,s,o.height(),d,t.textHeight),fontSize:i,style:t.hideShape?C.DwgLabelStyle.None:t.style}}_getYLocSign(t,e,i,n,o){switch(t){case C.DwgLabelYloc.Price:return 0;case C.DwgLabelYloc.AboveBar:return-1;case C.DwgLabelYloc.BelowBar:return 1;case C.DwgLabelYloc.Auto:return i<130?e>.5*i?-1:1:-Math.sign(e-i+n+2*o)}}_getInvertedYloc(t,e){if(e){if(t===C.DwgLabelYloc.AboveBar)return C.DwgLabelYloc.BelowBar;if(t===C.DwgLabelYloc.BelowBar)return C.DwgLabelYloc.AboveBar}return t}}},262831:(t,e,i)=>{i.r(e),i.d(e,{DwgLineFillPaneView:()=>f});var n=i(650151),o=i(86441),r=i(151149),s=i(92245),a=i(142119),l=i(194483),d=i(315801);const h={x1:0,y1:0,x2:0,y2:0,extend:s.DwgExtend.None},c={x1:0,y1:0,x2:0,y2:0,extend:s.DwgExtend.None};function u(t,e,i,n){const r=e.subtract(t).normalized();if(Math.abs(r.x)>Math.abs(r.y)){const e=(i-t.x)/r.x;return new o.Point(t.addScaled(r,e).x,t.addScaled(r,e).y)}{const e=(n-t.y)/r.y;return new o.Point(t.addScaled(r,e).x,t.addScaled(r,e).y)}}class f{constructor(t,e,i){this._data=[],this._invalidated=!0,this._rgbaFromInteger=(0,r.rgbaFromIntegerCached)(),this._provider=t,this._model=e,this._hitTestResult=void 0!==i?new d.HitTestResult(d.HitTarget.Custom,i):new d.HitTestResult(d.HitTarget.Regular)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new a.CompositeRenderer;for(const e of this._data){const i=new l.PolygonRenderer(this._hitTestResult);i.setData(e),t.append(i)}return t}_updateViewInternal(){this._data=[];const t=this._provider.properties().childs().palettes,e=this._provider.metaInfo().isRGB;if((void 0===t||void 0===t.childs().palette_common)&&!e)return;const i=e?void 0:(0,n.ensureDefined)(t.childs().palette_common).childs(),r=this._provider.priceScale(),a=this._model.timeScale();if(!r||r.isEmpty()||a.isEmpty())return;if(null===a.visibleBarsStrictRange())return;const l=this._provider.firstValue();if(null===l)return;const d=this._provider.graphics().dwglines(),f=this._provider.graphics().dwglinefills();if(0===f.size||0===d.size)return;const p=new Map;d.forEach((t=>{t.forEach((t=>{p.set(t.id,t)}))}));const g=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().dwglinefills);f.forEach(((t,d)=>{(0,n.ensureDefined)(g.childs()[d]).childs().visible.value()&&t.forEach((t=>{const n=p.get(t.line1),d=p.get(t.line2);if(n&&d){const f=function(t,e,i,n,r){const a=n.width(),l=(0,s.convertPointsToScreenDimension)(t.x1,t.y1,t.x2,t.y2,t.extend,i,n,a,r,h),d=(0,s.convertPointsToScreenDimension)(e.x1,e.y1,e.x2,e.y2,e.extend,i,n,a,r,c);if(null===l||null===d)return null
;let f=new o.Point(l.x1,l.y1),p=new o.Point(l.x2,l.y2),g=new o.Point(d.x1,d.y1),_=new o.Point(d.x2,d.y2);if((0,o.equalPoints)(f,p)||(0,o.equalPoints)(g,_))return[f,p,_,g];const x=(0,s.isExtendInSameDirection)(l.extend,s.DwgExtend.Left),w=(0,s.isExtendInSameDirection)(l.extend,s.DwgExtend.Right),v=(0,s.isExtendInSameDirection)(d.extend,s.DwgExtend.Left),m=(0,s.isExtendInSameDirection)(d.extend,s.DwgExtend.Right),y=x&&v,b=w&&m,T=i.height(),S=-a,C=2*a,P=-T,R=2*T;let D=S,M=C;f.x>p.x&&(D=C,M=S);let L=P,I=R;f.y>p.y&&(L=R,I=P);let z=S,B=C;g.x>_.x&&(z=C,B=S);let A=P,H=R;return g.y>_.y&&(A=R,H=P),(y||null===t.x1&&x)&&(f=u(p,f,D,L)),(y||null===e.x1&&v)&&(g=u(_,g,z,A)),(b||null===t.x2&&w)&&(p=u(f,p,M,I)),(b||null===e.x2&&m)&&(_=u(g,_,B,H)),[f,p,_,g]}(n,d,r,a,l);if(null!==f){let n;if(e)n=this._rgbaFromInteger(t.colorIndex);else{const e=i.colors.childs()[t.colorIndex];n=e?e.childs().color.value():"transparent"}this._data.push({points:f,fillBackground:!0,filled:!0,backcolor:n,color:n,linewidth:0,linestyle:0})}}}))}))}}},591393:(t,e,i)=>{i.r(e),i.d(e,{DwgLinePaneView:()=>v});var n=i(650151),o=i(86441),r=i(151149),s=i(371573),a=i.n(s),l=i(92245),d=i(204652),h=i(315801),c=i(239589),u=i(258940);const f={[u.DwgLineStyle.Solid]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!1,drawRightArrow:!1},[u.DwgLineStyle.Dashed]:{dashPattern:[5,6],dashPatternSize:11,drawLeftArrow:!1,drawRightArrow:!1},[u.DwgLineStyle.Dotted]:{dashPattern:[1,2],dashPatternSize:3,drawLeftArrow:!1,drawRightArrow:!1},[u.DwgLineStyle.LeftArrow]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!0,drawRightArrow:!1},[u.DwgLineStyle.RightArrow]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!1,drawRightArrow:!0},[u.DwgLineStyle.BothArrow]:{dashPattern:[],dashPatternSize:0,drawLeftArrow:!0,drawRightArrow:!0}},p=new Map;function g(t,e){let i=p.get(t);void 0===i&&(i=new Map,p.set(t,i));let n=i.get(e);return void 0===n&&(n=t.map((t=>t*e)),i.set(e,n)),n}function _(t,e,i,n,o){if(i.subtract(e).length()<1)return;const r=(0,c.getArrowPoints)(e,i,n,!0);for(const e of r)t.moveTo(e[0].x*o,e[0].y*o),t.lineTo(e[1].x*o,e[1].y*o)}class x{constructor(t){this._data=null!=t?t:null}setData(t){this._data=t}draw(t,e){if(null===this._data)return;t.lineCap="butt";const i=e.pixelRatio;for(const[e,n]of this._data.itemsByColor){let o;t.strokeStyle=e;for(const e of n){const n=f[e.style],r=g(n.dashPattern,e.width*i);void 0!==o&&o.lineWidth===e.width&&o.pattern===r||(void 0!==o?(t.stroke(),o.lineWidth=e.width,o.pattern=r):o={lineWidth:e.width,pattern:r},t.beginPath(),t.lineWidth=e.width*i,t.setLineDash(r)),t.moveTo(e.extP1.x*i,e.extP1.y*i),t.lineTo(e.extP2.x*i,e.extP2.y*i);const s=e.width;n.drawLeftArrow&&_(t,e.p2,e.p1,s,i),n.drawRightArrow&&_(t,e.p1,e.p2,s,i)}void 0!==o&&t.stroke()}}hitTest(t){if(null===this._data)return null;const e=(0,c.interactionTolerance)().line,{items:i,itemCount:n}=this._data;let o=0;for(const r of i){if(o===n)break;const i=Math.max(e,r.width/2);if((0,d.distanceToSegment)(r.extP1,r.extP2,t).distance<=i)return new h.HitTestResult(h.HitTarget.Regular);o+=1}return null}}
var w=i(466289);class v extends(a()){constructor(t,e,i){super(),this._locationDataCache=[],this._invalidated=!0,this._renderer=new x,this._rgbaFromInteger=(0,r.rgbaFromIntegerCached)(),this._graphicsProvider=t,this._model=e}update(){this._invalidated=!0}renderer(t,e){return this._invalidated&&(this._invalidated=!1,this._updateRenderer(e,t)),this._renderer}_updateRenderer(t,e){this._renderer.setData(null);const i=this._graphicsProvider.priceScale(),r=this._model.timeScale();if(!i||i.isEmpty()||r.isEmpty())return;const s=this._graphicsProvider.graphics().dwglines();if(0===s.size)return;if(null===this._model.timeScale().visibleBarsStrictRange())return;const a=this._graphicsProvider.firstValue();if(null===a)return;const d={x1:0,y1:0,x2:0,y2:0,extend:l.DwgExtend.None},h=new Map;let c=0;const u=(0,n.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwglines);for(const[p,g]of s){if((0,n.ensureDefined)(u.childs()[p]).childs().visible.value())for(const n of g){if(null===n.colorIndex)continue;let s;if(this._graphicsProvider.metaInfo().isRGB)s=this._rgbaFromInteger(n.colorIndex);else{const t=this._graphicsProvider.properties().childs().palettes;if(void 0===t||void 0===t.childs().palette_common)continue;s=t.childs().palette_common.childs().colors.childs()[n.colorIndex].childs().color.value()}if(void 0===s)continue;const u=(0,l.convertPointsToScreenDimension)(n.x1,n.y1,n.x2,n.y2,n.extend,i,r,t,a,d);if(null===u)continue;const{x1:p,x2:g,y1:_,y2:x,extend:v}=u,m=v===l.DwgExtend.Both||v===l.DwgExtend.Left,y=v===l.DwgExtend.Both||v===l.DwgExtend.Right,b=new o.Point(p,_),T=new o.Point(g,x),S=(0,w.intersectLineWithViewport)(b,T,m,y,t,e,f[n.style].dashPatternSize*n.width);if(null===S)continue;let C;this._locationDataCache.length>c?(C=this._locationDataCache[c],C.p1=b,C.p2=T,C.extP1=S[0],C.extP2=S[1],C.width=n.width>0?n.width:1,C.style=n.style):(C={p1:b,p2:T,extP1:S[0],extP2:S[1],width:n.width>0?n.width:1,style:n.style},this._locationDataCache.push(C));let P=h.get(s);void 0===P&&(P=[],h.set(s,P)),P.push(C),c+=1}}this._renderer.setData({items:this._locationDataCache,itemCount:c,itemsByColor:h})}}},806468:(t,e,i)=>{i.r(e),i.d(e,{DwgPolylinePaneView:()=>C});var n=i(650151),o=i(86441),r=i(151149),s=i(422300),a=i(448874),l=i(204652),d=i(710455),h=i(315801),c=i(239589),u=i(640073);const f={[u.DwgPolylineStyle.Solid]:[],[u.DwgPolylineStyle.Dashed]:[5,6],[u.DwgPolylineStyle.Dotted]:[1,2],[u.DwgPolylineStyle.ArrowLeft]:[],[u.DwgPolylineStyle.ArrowRight]:[],[u.DwgPolylineStyle.ArrowBoth]:[]},p=(0,a.default)(((t,e)=>f[t].map((t=>t*e))),((t,e)=>`${t}_${e}`));function g(t,e){let i=!0;for(const n of e.points)i?(t.moveTo(n.x,n.y),i=!1):t.lineTo(n.x,n.y)}function _(t,e){for(const i of e.bezierCurves){const[e,n,o,r]=i;t.lineTo(e.x,e.y),t.bezierCurveTo(n.x,n.y,o.x,o.y,r.x,r.y)}}function x(t,e,i,n){if(i.subtract(e).length()<1)return;const o=(0,c.getArrowPoints)(e,i,n,!0);for(const e of o)t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y)}class w extends d.MediaCoordinatesPaneRenderer{constructor(t){super(),this._data=null!=t?t:null}
setData(t){this._data=t}hitTest(t){if(null===this._data)return null;const e=(0,c.interactionTolerance)().line;for(const i of this._data.items){const n=Math.max(e,i.width/2);if(i.curved)for(const e of i.bezierCurves){const[i,o,r,a]=e;if((0,s.cubicBezierHitTest)(i,o,r,a,t,n))return new h.HitTestResult(h.HitTarget.Regular)}else for(let e=1;e<i.points.length;e+=1){const o=i.points[e],r=i.points[e-1];if((0,l.distanceToSegment)(r,o,t).distance<=n)return new h.HitTestResult(h.HitTarget.Regular)}}return null}_drawImpl(t){if(null===this._data)return;const e=t.context;e.lineCap="butt";for(const t of this._data.items){e.strokeStyle=t.color;const i=Math.max(1,t.width),n=p(t.style,i);e.lineWidth=i,e.setLineDash(n),e.beginPath(),t.curved?_(e,t):g(e,t),t.closed&&e.closePath(),t.fillColor&&(e.fillStyle=t.fillColor,e.fill()),t.leftArrowPoints&&x(e,t.leftArrowPoints[0],t.leftArrowPoints[1],i),t.rightArrowPoints&&x(e,t.rightArrowPoints[0],t.rightArrowPoints[1],i),e.stroke()}}}function v(t){return t===u.DwgPolylineStyle.ArrowLeft||t===u.DwgPolylineStyle.ArrowBoth}function m(t){return t===u.DwgPolylineStyle.ArrowRight||t===u.DwgPolylineStyle.ArrowBoth}function y(t){return(0,o.point)(t.x,t.y)}function b(t){return{x:t.x,y:t.y}}function T(t){return t.map(y)}function S(t){const e=[],i=t.points,n=t.closed,o=i.length,r=n?o-1:o-2;let a=i[o-1];for(let t=0;t<=r;t+=1){const s=i[t],l=i[(t+1)%o],d=i[(t+2)%o],h=(l.x-a.x)/3,c=(l.y-a.y)/3,u=(d.x-s.x)/3,f=(d.y-s.y)/3,p=[s,{x:s.x+h,y:s.y+c},{x:l.x-u,y:l.y-f},l];n||(0===t?(p[1].x=(s.x+p[2].x)/2,p[1].y=(s.y+p[2].y)/2):t===r&&(p[2].x=(l.x+p[1].x)/2,p[2].y=(l.y+p[1].y)/2)),e.push(p),a=s}const l=t.style;let d,h;if(v(l)){const[t,i,n,o]=T(e[0]);d=[b((0,s.cubicBezierPoint)(t,i,n,o,.1)),b(t)]}if(m(l)){const[t,i,o,r]=T(e[e.length-(n?2:1)]);h=[b((0,s.cubicBezierPoint)(t,i,o,r,.9)),b(r)]}return{bezierCurvePoints:e,leftArrowPoints:d,rightArrowPoints:h}}class C{constructor(t,e,i){this._invalidated=!0,this._renderer=new w,this._curvedLinesDataCache=new WeakMap,this._rgbaFromInteger=(0,r.rgbaFromIntegerCached)(),this._graphicsProvider=t,this._model=e}update(){this._invalidated=!0}renderer(t,e){return this._invalidated&&(this._invalidated=!1,this._updateRenderer(e,t)),this._renderer}_updateRenderer(t,e){this._renderer.setData(null);const i=this._graphicsProvider.priceScale(),r=this._model.timeScale();if(!i||i.isEmpty()||r.isEmpty())return;const s=this._graphicsProvider.graphics().dwgpolylines();if(0===s.size)return;const a=this._model.timeScale().visibleBarsStrictRange();if(null===a)return;const l=this._graphicsProvider.firstValue();if(null===l)return;const d=t=>(0,o.point)(r.indexToCoordinate(t.x),i.priceToCoordinate(t.y,l)),h=t=>t.map(d),c=(0,n.ensureDefined)(this._graphicsProvider.properties().childs().graphics.childs().dwgpolylines),f=[],p=this._graphicsProvider.metaInfo().isRGB;let g;if(!p){const t=this._graphicsProvider.properties().childs().palettes;if(void 0===t||void 0===t.childs().palette_common)return;g=t.childs().palette_common.childs().colors.childs()}for(const[t,e]of s){if((0,
n.ensureDefined)(c.childs()[t]).childs().visible.value())for(const t of e){if(!(0,u.isDwgPolylineInBarsRange)(t,a))continue;let e,i;if(p?(e=this._rgbaFromInteger(t.color),null!==t.fillColor&&(i=this._rgbaFromInteger(t.fillColor))):(e=g[t.color].childs().color.value(),null!==t.fillColor&&(i=g[t.fillColor].childs().color.value())),void 0!==e)if(!t.curved||t.points.length<3){const n=t.points.map(d),o=v(t.style)&&n.length>1?[n[1],n[0]]:void 0,r=m(t.style)&&n.length>1?[n[n.length-2],n[n.length-1]]:void 0;f.push({...t,curved:!1,points:n,color:e,fillColor:i,leftArrowPoints:o,rightArrowPoints:r})}else{let n=this._curvedLinesDataCache.get(t);void 0===n&&(n=S(t),this._curvedLinesDataCache.set(t,n));const o=n.bezierCurvePoints.map(h);let r,s;if(n.leftArrowPoints){const t=d(n.leftArrowPoints[0]),e=d(n.leftArrowPoints[1]);r=[e.add(t.subtract(e).normalized().scaled(10)),e]}if(n.rightArrowPoints){const t=d(n.rightArrowPoints[0]),e=d(n.rightArrowPoints[1]);s=[e.add(t.subtract(e).normalized().scaled(10)),e]}f.push({...t,curved:!0,bezierCurves:o,leftArrowPoints:r,rightArrowPoints:s,color:e,fillColor:i})}}}this._renderer.setData({items:f})}}},760269:(t,e,i)=>{i.r(e),i.d(e,{DwgTablePaneView:()=>w});var n=i(650151),o=i(151149),r=i(142119),s=i(86441),a=i(983898),l=i(422333),d=i(315801),h=i(535698),c=i(294162),u=i(511131),f=i(173501),p=i(590836);function g(t,e,i,n){const o=new h.TextRenderer;e.cells.forEach((e=>{if(e.merged)return;const r=i.cells[e.cell.row][e.cell.column],s=i.position.x+r.offsetX,a=i.position.y+r.offsetY,l=function(t,e,i,n,o){return(0,f.textBoxData)(t,e,i,n,{horizontalTextAlignment:o.cell.horizontalTextAlignment,verticalTextAlignment:o.cell.verticalTextAlignment,text:o.cell.text,textColor:o.style.textColor,sizeOptions:{textSizeMode:"fixed",fontSize:o.cell.fontSize},fontType:o.cell.fontType})}(s/n.pixelRatio,a/n.pixelRatio,r.width/n.pixelRatio,r.height/n.pixelRatio,e);t.save();const d=new Path2D;d.rect(s,a,r.width,r.height),t.clip(d,"evenodd"),o.setData(l),o.draw(t,n),t.restore()}))}class _{constructor(t){this._data=null,this._widthsCaches=new Map,this._precalculated=null,this.setData(t),this._measureCanvas=document.createElement("canvas"),this._measureCtx=(0,n.ensureNotNull)(this._measureCanvas.getContext("2d"))}setData(t){this._data=t,this._precalculated=null}draw(t,e){if(null===this._data)return;const i=this._precalculateData(e),n=this._data;!function(t,e,i){t.fillStyle=e.style.backgroundColor,t.fillRect(i.position.x,i.position.y,i.totalWidth,i.totalHeight)}(t,n,i),function(t,e,i){e.cells.forEach((e=>{if(e.merged)return;const n=i.cells[e.cell.row][e.cell.column],o=i.position.x+n.offsetX,r=i.position.y+n.offsetY,s=n.width,a=n.height;t.fillStyle=e.style.backgroundColor,t.fillRect(o,r,s,a)}))}(t,n,i),g(t,n,i,e),function(t,e,i,n){if(e.table.borderWidth>0){const o=Math.max(1,Math.round(e.table.borderWidth*n.pixelRatio));t.fillStyle=e.style.borderColor;for(let n=0;n<e.table.columns;n++)for(let r=0;r<e.table.rows;r++){const e=i.cells[r][n]
;null===e.mergedMainCell&&(e.height>0&&e.endRow<i.lastNonEmptyRowEnd&&t.fillRect(i.position.x+e.offsetX,i.position.y+e.offsetY+e.height,e.width+(e.endColumn<i.lastNonEmptyColumnEnd?o:0),o),e.width>0&&e.endColumn<i.lastNonEmptyColumnEnd&&t.fillRect(i.position.x+e.offsetX+e.width,i.position.y+e.offsetY,o,e.height))}}}(t,n,i,e),function(t,e,i,n){if(e.table.frameWidth>0){const o=Math.max(1,Math.round(e.table.frameWidth*n.pixelRatio));t.fillStyle=e.style.frameColor,t.fillRect(i.position.x-o,i.position.y-o,i.totalWidth+2*o,o),t.fillRect(i.position.x-o,i.position.y+i.totalHeight,i.totalWidth+2*o,o),t.fillRect(i.position.x-o,i.position.y-o+o,o,i.totalHeight),t.fillRect(i.position.x+i.totalWidth,i.position.y,o,i.totalHeight)}}(t,n,i,e)}hitTest(t,e){if(null===this._data)return null;const i=this._precalculateData(e),n=this._data,o=e.pixelRatio,r=t.x*o,s=t.y*o,a=Math.max(1,n.table.frameWidth*o);if(!(r>=i.position.x-a&&r<=i.position.x+i.totalWidth+2*a&&s>=i.position.y-a&&s<=i.position.y+i.totalHeight+2*a))return null;const l=i.cellsWithTooltip.find((t=>{const e=i.position.x+t.offsetX,n=i.position.y+t.offsetY;return r>=e&&r<=e+t.width&&s>=n&&s<=n+t.height})),h=void 0===l?void 0:{tooltip:{...l.tooltip,rect:{x:(i.position.x+l.offsetX)/o,y:(i.position.y+l.offsetY)/o,w:l.width/o,h:l.height/o}}};return new d.HitTestResult(d.HitTarget.Regular,h)}_precalculateData(t){var e,i;if(null!==this._precalculated)return this._precalculated;const o=(0,n.ensureNotNull)(this._data);let r=-1,a=-1;const l=Array.from({length:o.table.rows},((t,e)=>Array.from({length:o.table.columns},((t,i)=>({mergedMainCell:null,nextColumnCell:null,nextRowCell:null,startColumn:i,endColumn:i,startRow:e,endRow:e,width:0,height:0,offsetX:0,offsetY:0,colSpan:-1,rowSpan:-1,merged:!1,empty:!0}))))),d=[];o.cells.forEach((e=>{if(e.merged){return void(l[e.cell.row][e.cell.column].empty=!1)}const i=Math.ceil(this._cellWidth(t,e,o)*t.pixelRatio),n=Math.ceil(this._cellHeight(t,e,o)*t.pixelRatio),r=e.cell.row,s=e.cell.row+e.cell.rowSpan-1,a=e.cell.column,h=e.cell.column+e.cell.colSpan-1,c=e.cell.colSpan,u=e.cell.rowSpan;let f=null;for(let t=e.cell.row;t<Math.min(e.cell.row+e.cell.rowSpan,o.table.rows);++t)for(let p=e.cell.column;p<Math.min(e.cell.column+e.cell.colSpan,o.table.columns);++p){const o=l[t][p],g=t!==r||p!==a;g||(f=o,void 0!==e.cell.tooltip&&""!==e.cell.tooltip&&(o.tooltip={content:{type:"text",data:e.cell.tooltip}},d.push(o))),o.mergedMainCell=g?f:null,o.startRow=r,o.endRow=s,o.startColumn=a,o.endColumn=h,o.width=i,o.height=n,o.colSpan=c,o.rowSpan=u,o.empty=!1}}));const h=0===o.table.borderWidth?0:Math.max(1,Math.round(o.table.borderWidth*t.pixelRatio)),c=Math.max(1,Math.round(20*t.pixelRatio)),u=Math.max(1,Math.round(5*t.pixelRatio));for(let t=0;t<o.table.columns;++t){let e=[],i=!1,n=!1;for(let s=0;s<o.table.rows;++s){const o=l[s][t];o.empty?n=!0:(i=!0,r=t),null===o.mergedMainCell?(e.forEach((t=>t.nextRowCell=o)),e=[o]):e.push(o)}if(i&&n)for(let e=0;e<o.table.rows;++e){const i=l[e][t];i.empty&&(i.width=c)}}for(let t=0;t<o.table.rows;++t){let e=[],i=!1,n=!1
;for(let r=0;r<o.table.columns;++r){const o=l[t][r];o.empty?n=!0:(i=!0,a=t),null===o.mergedMainCell?(e.forEach((t=>t.nextColumnCell=o)),e=[o]):e.push(o)}if(i&&n)for(let e=0;e<o.table.columns;++e){const i=l[t][e];i.empty&&(i.height=u)}}let f=0,p=0,g=0;for(let t=0;t<o.table.columns;++t){const i=[];let n=!1;for(let r=0;r<o.table.rows;++r){const o=l[r][t];if(o.endColumn===t){const t=null!==(e=o.mergedMainCell)&&void 0!==e?e:o;g=Math.max(g,t.offsetX+t.width),i.push(t),n=n||!t.empty}}for(const t of i)t.width+=g-(t.offsetX+t.width),f=Math.max(f,t.offsetX+t.width);if(i.length>0){const e=n&&r>t?h:0;for(let i=0;i<o.table.rows;++i){const n=l[i][t];null!==n.nextColumnCell&&(n.nextColumnCell.offsetX=Math.max(n.nextColumnCell.offsetX,g+e))}}}let _=0;for(let t=0;t<o.table.rows;++t){const e=[];let n=!1;for(let r=0;r<o.table.columns;++r){const o=l[t][r];if(o.endRow===t){const t=null!==(i=o.mergedMainCell)&&void 0!==i?i:o;_=Math.max(_,t.offsetY+t.height),e.push(t),n=n||!t.empty}}for(const t of e)t.height+=_-(t.offsetY+t.height),p=Math.max(p,t.offsetY+t.height);if(e.length>0){const e=n&&a>t?h:0;for(let i=0;i<o.table.columns;++i){const n=l[t][i];null!==n.nextRowCell&&(n.nextRowCell.offsetY=Math.max(n.nextRowCell.offsetY,_+e))}}}const x=function(t,e,i,n){const o=Math.round(10*e.pixelRatio);let r=0;t.table.position.startsWith("top_")?r=o:t.table.position.startsWith("middle_")?r=Math.round((e.physicalHeight-n)/2):t.table.position.startsWith("bottom_")&&(r=e.physicalHeight-o-n);let a=0;return t.table.position.endsWith("left")?a=o:t.table.position.endsWith("center")?a=Math.round((e.physicalWidth-i)/2):t.table.position.endsWith("right")&&(a=e.physicalWidth-i-o),new s.Point(a,r)}(o,t,f,p);return this._precalculated={position:x,totalWidth:f,totalHeight:p,cells:l,cellsWithTooltip:d,lastNonEmptyColumnEnd:r,lastNonEmptyRowEnd:a},this._precalculated}_cellWidth(t,e,i){const o=e.cell.widthInPercentsOfPaneWidth;if(e.merged||""===e.cell.text&&0===o)return 0;if(o){return(t.cssWidth-20)*o/100}const r=e.cell.text.split("\n"),s=(0,n.ensureDefined)(f.fontSizes.get(e.cell.fontSize)),d=(0,a.getDefault2)(this._widthsCaches,e.cell.fontType,s,new c.TextWidthCache);this._measureCtx.font=(0,u.makeFont)(s,e.cell.fontType===p.DwgTableCellFontType.Monospace?l.CHART_MONOSPACE_FONT_FAMILY:l.CHART_FONT_FAMILY);const h=r.map((t=>d.measureText(this._measureCtx,t)));return Math.max(...h)+2*i.table.borderWidth+2*s/3}_cellHeight(t,e,i){const o=e.cell.heightInPercentOfPaneHeight;if(e.merged||""===e.cell.text&&0===o)return 0;if(o){return(t.cssHeight-20)*o/100}const r=e.cell.text.split("\n").length,s=(0,n.ensureDefined)(f.fontSizes.get(e.cell.fontSize));return s*r+s*(2/3)+2*i.table.borderWidth}}function x(t){t.allCells.forEach((e=>{var i;if(e.cell.rowSpan>1||e.cell.colSpan>1)for(let n=e.cell.row;n<e.cell.row+e.cell.rowSpan;++n)for(let o=e.cell.column;o<e.cell.column+e.cell.colSpan;++o){const r=null===(i=t.cellsByRowAndColumn.get(n))||void 0===i?void 0:i.get(o);void 0!==r&&r!==e&&(r.merged=!0)}}))}class w{constructor(t,e,i){this._invalidated=!0,this._data=[],this._renderers=[],
this._rgbaFromInteger=(0,o.rgbaFromIntegerCached)(),this._source=t}renderer(){this._invalidated&&(this._invalidated=!1,this._updateViewInternal());const t=new r.CompositeRenderer;return this._data.forEach(((e,i)=>{this._renderers.length<=i?this._renderers.push(new _(e)):this._renderers[i].setData(e),t.append(this._renderers[i])})),this._renderers.splice(this._data.length),t}update(){this._invalidated=!0}_updateViewInternal(){this._data=[];const t=this._source.properties().childs().palettes.childs(),e=this._source.metaInfo().isRGB;if((void 0===t||void 0===t.palette_common)&&!e)return;const i=e?void 0:(0,n.ensureDefined)(t.palette_common).childs(),o=this._source.graphics().dwgtables(),r=this._source.graphics().dwgtablecells(),s=new Map;r.forEach(((t,n)=>{t.forEach((t=>{let n,o,r=s.get(t.tableId);if(void 0===r&&(r={allCells:[],cellsByRowAndColumn:new Map},s.set(t.tableId,r)),e)n=this._rgbaFromInteger(t.backgroundColorIndex),o=this._rgbaFromInteger(t.textColorIndex);else{const e=i.colors.childs()[t.backgroundColorIndex],r=i.colors.childs()[t.textColorIndex];if(!r)return;n=e?e.childs().color.value():"transparent",o=r.childs().color.value()}const a={cell:t,merged:!1,style:{backgroundColor:n,textColor:o}};r.allCells.push(a);let l=r.cellsByRowAndColumn.get(t.row);void 0===l&&(l=new Map,r.cellsByRowAndColumn.set(t.row,l)),l.set(t.column,a)}))})),s.forEach(x);const a=(0,n.ensureDefined)(this._source.properties().childs().graphics.childs().dwgtables);o.forEach(((t,o)=>{(0,n.ensureDefined)(a.childs()[o]).childs().visible.value()&&t.forEach((t=>{var n,o;let r,a,l;if(e)r=this._rgbaFromInteger(t.backgroundColorIndex),a=this._rgbaFromInteger(t.borderColorIndex),l=this._rgbaFromInteger(t.frameColorIndex);else{const e=i.colors.childs()[t.backgroundColorIndex],n=i.colors.childs()[t.borderColorIndex],o=i.colors.childs()[t.frameColorIndex];r=e?e.childs().color.value():"transparent",a=n?n.childs().color.value():"transparent",l=o?o.childs().color.value():"transparent"}this._data.push({table:t,style:{backgroundColor:r,borderColor:a,frameColor:l},cells:null!==(o=null===(n=s.get(t.id))||void 0===n?void 0:n.allCells)&&void 0!==o?o:[]})}))}))}}},670751:(t,e,i)=>{i.r(e),i.d(e,{HHistPaneView:()=>c});var n=i(724377),o=i(650151),r=i(315801),s=i(396372),a=i(142119),l=i(535698),d=i(348966),h=i(246733);class c{constructor(t,e,i,n,o=!1,r=!1){this._invalidated=!0,this._histBoxBgStyle=null,this._provider=t,this._model=e,this._histBoxBgStyle=null!=n?n:null,this._extendToBarsEndings=o,this._alwaysVisible=r,this._rendererData={histograms:[],styles:{}},this._textData=[],this._hhistRenderer=new d.HHistRenderer(this._rendererData)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new a.CompositeRenderer;t.append(this._hhistRenderer);for(const e of this._textData)t.append(new l.TextRenderer(e,new r.HitTestResult(r.HitTarget.Regular)));return t}_resetRenderersData(){this._rendererData.histograms=[],this._rendererData.styles={},this._rendererData.histBoxBgColor=void 0,this._textData=[]}
_prepareStyles(){var t,e;const i=(0,o.ensureDefined)(this._provider.graphicsInfo().hhists),n=Object.keys(i),r=(0,o.ensureDefined)(this._provider.properties().childs().graphics.childs().hhists),a=(null===(e=null===(t=this._provider.properties().child("inputs"))||void 0===t?void 0:t.child("volume"))||void 0===e?void 0:e.value())===s.HHistVolumeMode.Delta;for(const t of n){const e=(0,o.ensureDefined)(r.childs()[t]).childs(),n=(0,o.ensureDefined)(i[t]);if(a)this._rendererData.styles[t+"UpDominate"]={colors:u(e.colors[0].value(),e.transparencies[0].value()),visible:e.visible.value(),percentWidth:e.percentWidth.value(),location:n.location,direction:e.direction.value(),showValues:e.showValues.value(),addToTotalValue:!1,valuesColor:e.valuesColor.value()},this._rendererData.styles[t+"DownDominate"]={colors:u(e.colors[1].value(),e.transparencies[1].value()),visible:e.visible.value(),percentWidth:e.percentWidth.value(),location:n.location,direction:e.direction.value(),showValues:e.showValues.value(),addToTotalValue:!1,valuesColor:e.valuesColor.value()};else{const i=(0,h.generateColor)(e.colors[0].value(),e.transparencies[0].value()),o=e.colors[1]?(0,h.generateColor)(e.colors[1].value(),e.transparencies[1].value()):i;this._rendererData.styles[t]={colors:[i,o],visible:e.visible.value(),percentWidth:e.percentWidth.value(),location:n.location,direction:e.direction.value(),showValues:e.showValues.value(),addToTotalValue:!0,valuesColor:e.valuesColor.value()}}}if(this._histBoxBgStyle){const t=this._histBoxBgStyle.childs();this._rendererData.histBoxBgColor=(0,h.generateColor)(t.color.value(),t.transparency.value())}}_updateViewInternal(){this._resetRenderersData();const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;if(null===this._provider.firstValue())return;const i=this._provider.graphics().hhistsByTimePointIndex();if(0===i.size)return;const n=e.visibleBarsStrictRange();if(null===n)return;const r=n.firstBar(),s=n.lastBar();this._prepareStyles(),(0,o.ensureDefined)(i).forEach(((i,n)=>{let o=1/0,a=-1/0;i.forEach((t=>{o=Math.min(o,t.firstBarTime),a=Math.max(a,t.lastBarTime)})),!this._alwaysVisible&&(a<r||o>s)||this._updateDataForRenderers(i,t,e)}))}_updateDataForRenderers(t,e,i){var n,r;if(t.size<=0)return;let a=null;if(t.forEach((t=>{a=a||t})),null===a)return;let l=a;t.forEach((t=>{t.priceLow<l.priceLow&&(l=t)}));const h=(null===(r=null===(n=this._provider.properties().child("inputs"))||void 0===n?void 0:n.child("volume"))||void 0===r?void 0:r.value())===s.HHistVolumeMode.Delta,c=function(t,e,i){const n=i?e.barSpacing()/2:0;return(0,d.range)(e.indexToCoordinate(t.firstBarTime)-n,e.indexToCoordinate(t.lastBarTime)+n)}(a,i,this._extendToBarsEndings),u=(0,o.ensureNotNull)(this._provider.firstValue()),f=[];t.forEach((t=>{null==t.rate[t.rate.length-1]&&t.rate.splice(-1,1);let i=[],n=[],o=t.styleId;if(h){const[e,r,s]=t.rate[0]>t.rate[1]?[t.rate[1],t.rate[0],"UpDominate"]:[t.rate[0],t.rate[1],"DownDominate"];i=[r-e,e,e],n=[r-e],o+=s}else i=t.rate,n=t.rate;const r=function(t,e,i){return(0,
d.range)(e.priceToCoordinate(t.priceHigh,i),e.priceToCoordinate(t.priceLow,i))}(t,e,u);f.push({height:r.max-r.min,y:r.min,subBarValues:i,displayedValues:n,styleId:o})})),f.sort(((t,e)=>t.y-e.y)),this._rendererData.histograms.push({xRange:c,yRange:(0,d.range)(f[0].y,f[f.length-1].y+f[f.length-1].height),bars:f})}}function u(t,e){let i;if((0,h.isHexColor)(t))i=100-e;else{const o=(0,n.tryParseRgba)(t);i=100-(null!==o?(0,h.alphaToTransparency)(o[3]):e)}return[(0,h.generateColor)(t,100-i,!0),(0,h.generateColor)(t,100-i/2,!0),(0,h.generateColor)(t,100-i/4,!0)]}},348966:(t,e,i)=>{i.d(e,{HHistRenderer:()=>u,fontSizeToStartTextHiding:()=>c,range:()=>h,suggestFontSize:()=>g});var n=i(86441),o=i(724377),r=i(199471),s=i(315801),a=i(396372),l=i(943994),d=i(422333);function h(t,e){return{min:Math.min(t,e),max:Math.max(t,e)}}const c=7.5;class u{constructor(t){this._data=t}hitTest(t,e){const i=this._data;for(const n of i.histograms){if(n.yRange.min>=t.y||t.y>=n.yRange.max)continue;let o=null;for(const r of n.bars){const l=i.styles[r.styleId];if(!l.visible)continue;if(l.location===a.HHistLocation.Absolute&&(n.xRange.min>=t.x||t.x>=n.xRange.max))continue;null===o&&(o=0,n.bars.forEach((t=>{const e=t.subBarValues.reduce(((t,e)=>t+e));o=Math.max(o,e)})));const d=f(n.xRange,l,e.cssWidth),{xBasePoint:h,sign:c,xRangeWidth:u}=d,p=Math.max(l.percentWidth*u/100-r.subBarValues.length,0);let g=h;for(let e=0;e<r.subBarValues.length;e++){const i=r.y,n=r.y+r.height,a=g,l=a+c*(p*r.subBarValues[e]/o);if(g=l,(t.x>=a&&t.x<=l||t.x>=l&&t.x<=a)&&t.y>=i&&t.y<=n)return new s.HitTestResult(s.HitTarget.Regular)}}}return null}draw(t,e){const i=this._data,n=e.pixelRatio;t.save(),i.histograms.forEach((r=>{if(i.histBoxBgColor){t.beginPath(),t.fillStyle=i.histBoxBgColor;const e=Math.round(r.xRange.min*n),o=Math.round(r.yRange.min*n),s=Math.round(r.xRange.max*n)-e,a=Math.round(r.yRange.max*n)-o;t.rect(e,o,s,a),t.fill()}const s=[];let a=0,l=0;r.bars.forEach((t=>{const e=t.subBarValues.reduce(((t,e)=>t+e));a=Math.max(a,e),l+=t.height}));const d=l/r.bars.length,h=function(t,e){return Math.floor(t*e)>=1*e?Math.floor(e):0}(d,n),u=[];if(r.bars.forEach((o=>{const l=i.styles[o.styleId];if(!l.visible)return;if(l.showValues&&l.addToTotalValue)for(let t=0;t<o.subBarValues.length;t++)s[t]=(s[t]||0)+o.subBarValues[t];const d=f(r.xRange,l,e.cssWidth),{xBasePoint:c,sign:g,xRangeWidth:x}=d;if(o.y>e.cssHeight||o.y+o.height<0)return;const w=Math.max(l.percentWidth*x/100-o.subBarValues.length,0);let v=c;for(let e=0;e<o.subBarValues.length;e++){const i=o.y,r=o.y+o.height,s=v,d=s+g*(w*o.subBarValues[e]/a);if(Math.abs(d-s)<.5)continue;v=d,t.beginPath(),t.fillStyle=l.colors[e];const c=Math.round(s*n),u=Math.round(i*n),f=Math.round(d*n)-c,p=Math.max(Math.round(r*n)-u-h,1);t.rect(c,u,f,p),t.fill()}if(!l.showValues)return;const m=p(o.displayedValues,l.direction),y=_(x,o.y,o.height,d,l,m);u.push(y)})),s.length>0){const t=i.styles[r.bars[0].styleId],n=f(r.xRange,t,e.cssWidth),a=p(s,t.direction),l=r.bars[r.bars.length-1],h=_(n.xRangeWidth,l.y+l.height,d,n,t,a);h.color=(0,
o.shiftColor)(h.color,1.5),u.push(h)}const g=Math.min(...u.map((t=>t.fontSize)));if(g>=c)for(const i of u)i.fontSize=g,x(t,e,i)})),t.restore()}}function f(t,e,i){const n=e.location===a.HHistLocation.Absolute,o=e.location===a.HHistLocation.Relative,r=e.direction===a.HHistDirection.LeftToRight,s=e.direction===a.HHistDirection.RightToLeft;let l,d;if(n&&r)l=t.min,d=1;else if(n&&s)l=t.max,d=-1;else if(o&&r)l=0,d=1;else{if(!o||!s)throw new Error(`Unknown location/direction values: ${e.location}/${e.direction}`);l=i,d=-1}var h;return{xBasePoint:l,sign:d,xRangeWidth:o?i:(h=t).max-h.min}}function p(t,e){e===a.HHistDirection.RightToLeft&&(t=t.slice()).reverse();const i=new l.VolumeFormatter;return t.map((t=>i.format(t))).join("x")}function g(t,e,i){return{fontSize:Math.min(Math.round(1.7*t/i.length),Math.round(.6*e)),verticalOffset:.7*e}}function _(t,e,i,o,r,s){const{fontSize:l,verticalOffset:d}=g(t,i,s),h=r.direction===a.HHistDirection.LeftToRight?"left":"right",{xBasePoint:c,sign:u}=o,f=c+3*u,p=e+d;return{text:s,color:r.valuesColor,fontSize:l,align:h,point:new n.Point(f,p)}}function x(t,e,i){const{text:n,color:o,fontSize:s,align:a,point:l}=i;t.font=`${s}px ${d.CHART_FONT_FAMILY}`,t.fillStyle=o,t.textAlign=a,(0,r.drawScaled)(t,e.pixelRatio,e.pixelRatio,(()=>t.fillText(n,l.x,l.y)))}},722669:(t,e,i)=>{i.r(e),i.d(e,{HorizLinePaneView:()=>a});var n=i(650151),o=i(315801),r=i(142119),s=i(9524);class a{constructor(t,e,i,n=!1){this._data=[],this._invalidated=!0,this._provider=t,this._model=e,this._extendToBarsEndings=n,this._hitTestResult=void 0!==i?new o.HitTestResult(o.HitTarget.Custom,i):new o.HitTestResult(o.HitTarget.Regular)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new r.CompositeRenderer;for(const e of this._data){const i=new s.HorizontalLineRenderer;i.setData(e),i.setHitTest(this._hitTestResult),t.append(i)}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().horizlines();if(0===i.size)return;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return;const r=this._provider.firstValue();if(null===r)return;const s=o.firstBar(),a=o.lastBar(),l=this._extendToBarsEndings?e.barSpacing()/2:0,d=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().horizlines);i.forEach(((i,o)=>{const h=(0,n.ensureDefined)(d.childs()[o]).childs();h.visible.value()&&i.forEach((i=>{const o=i.startIndex,d=i.endIndex;!i.extendRight&&Math.max(o,d)<s||!i.extendLeft&&Math.min(o,d)>a||this._data.push({y:t.priceToCoordinate((0,n.ensureDefined)(i.level),r),left:i.extendLeft?void 0:e.indexToCoordinate(o)-l,right:i.extendRight?void 0:e.indexToCoordinate(d)+l,color:h.color.value(),linewidth:h.width.value(),linestyle:h.style.value()})}))}))}}},454112:(t,e,i)=>{i.r(e),i.d(e,{LevelPaneView:()=>c});var n=i(650151),o=i(86441),r=i(315801),s=i(276636),a=i(142119),l=i(9524),d=i(535698),h=i(422333);class c{constructor(t,e,i){
this._data=[],this._textData=[],this._invalidated=!0,this._provider=t,this._model=e}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new a.CompositeRenderer;for(const e of this._data){const i=new l.HorizontalLineRenderer;i.setData(e),t.append(i)}for(const e of this._textData)t.append(new d.TextRenderer(e,new r.HitTestResult(r.HitTarget.Regular)));return t}_updateViewInternal(){this._calcHorzLinesData(),this._calcTextData()}_calcTextData(){this._textData=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().hlines();if(0===i.size)return;const r=this._provider.firstValue();if(null===r)return;const a=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().hlines),l=(0,n.ensureDefined)(this._provider.graphicsInfo().hlines);i.forEach(((i,d)=>{const c=(0,n.ensureDefined)(a.childs()[d]).childs();(0,n.ensureDefined)(l[d]).enableText&&(0,n.ensureDefined)(c.showText).value()&&i.forEach((i=>{const a=t.priceToCoordinate((0,n.ensureDefined)(i.level),r),l=(0,n.ensureDefined)(c.textPos).value(),[d,u]=function(t,e){if(t===s.TextPos.TopLeft||t===s.TextPos.MiddleLeft||t===s.TextPos.BottomLeft)return["left",4];if(t===s.TextPos.TopCenter||t===s.TextPos.MiddleCenter||t===s.TextPos.BottomCenter)return["center",e/2];if(t===s.TextPos.TopRight||t===s.TextPos.MiddleRight||t===s.TextPos.BottomRight)return["right",e];throw new Error("Unsupported TextPos value")}(l,e.width()),[f,p]=function(t,e){if(t===s.TextPos.TopLeft||t===s.TextPos.TopCenter||t===s.TextPos.TopRight)return["bottom",e-4];if(t===s.TextPos.MiddleLeft||t===s.TextPos.MiddleCenter||t===s.TextPos.MiddleRight)return["middle",e-2];if(t===s.TextPos.BottomLeft||t===s.TextPos.BottomCenter||t===s.TextPos.BottomRight)return["top",e];throw new Error("Unsupported TextPos value")}(l,a);this._textData.push({points:[new o.Point(u,p)],offsetX:0,offsetY:0,text:i.text||"",color:c.color.value(),font:h.CHART_FONT_FAMILY,fontsize:(0,n.ensureDefined)(c.fontSize).value(),horzAlign:d,vertAlign:f})}))}))}_calcHorzLinesData(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().hlines();if(0===i.size)return;const o=this._provider.firstValue();if(null===o)return;const r=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().hlines);i.forEach(((e,i)=>{const s=(0,n.ensureDefined)(r.childs()[i]).childs();s.visible.value()&&e.forEach((e=>{const i=t.priceToCoordinate((0,n.ensureDefined)(e.level),o);this._data.push({visible:!0,y:i,color:s.color.value(),linewidth:s.width.value(),linestyle:s.style.value()})}))}))}}},556613:(t,e,i)=>{i.r(e),i.d(e,{LinePaneView:()=>d});var n=i(650151),o=i(86441),r=i(315801),s=i(142119),a=i(855152),l=i(541801);class d{constructor(t,e,i){this._data=[],this._invalidated=!0,this._provider=t,this._model=e,
this._hitTestResult=void 0!==i?new r.HitTestResult(r.HitTarget.Custom,i):new r.HitTestResult(r.HitTarget.Regular)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new s.CompositeRenderer;for(const e of this._data){const i=new l.TrendLineRenderer;i.setData(e),i.setHitTest(this._hitTestResult),t.append(i)}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().lines();if(0===i.size)return;const r=this._model.timeScale().visibleBarsStrictRange();if(null===r)return;const s=this._provider.firstValue();if(null===s)return;const l=r.firstBar(),d=r.lastBar(),h=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().lines);i.forEach(((i,r)=>{const c=(0,n.ensureDefined)(h.childs()[r]).childs();c.visible.value()&&i.forEach((i=>{const r=i.startIndex+(i.startOffset||0),h=i.endIndex+(i.endOffset||0);if(Math.max(r,h)<l||Math.min(r,h)>d)return;const u=e.indexToCoordinate(r),f=e.indexToCoordinate(h),p=t.priceToCoordinate((0,n.ensureDefined)(i.startPrice),s),g=t.priceToCoordinate((0,n.ensureDefined)(i.endPrice),s),_=new o.Point(u,p),x=new o.Point(f,g);this._data.push({points:[_,x],extendleft:!1,extendright:!1,leftend:a.LineEnd.Normal,rightend:a.LineEnd.Normal,color:c.color.value(),linewidth:c.width.value(),linestyle:c.style.value()})}))}))}}},842474:(t,e,i)=>{i.r(e),i.d(e,{PolygonPaneView:()=>d});var n=i(650151),o=i(86441),r=i(315801),s=i(142119),a=i(458963),l=i(194483);class d{constructor(t,e,i){this._data=[],this._invalidated=!0,this._provider=t,this._model=e,this._hitTestResult=void 0!==i?new r.HitTestResult(r.HitTarget.Custom,i):new r.HitTestResult(r.HitTarget.Regular)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new s.CompositeRenderer;for(const e of this._data){const i=new l.PolygonRenderer(this._hitTestResult);i.setData(e),t.append(i)}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().polygons();if(0===i.size)return;const r=this._model.timeScale().visibleBarsStrictRange();if(null===r)return;const s=this._provider.firstValue();if(null===s)return;const l=r.firstBar(),d=r.lastBar(),h=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().polygons),c=(0,n.ensureDefined)(this._provider.graphicsInfo().polygons);i.forEach(((i,r)=>{const u=(0,n.ensureDefined)(h.childs()[r]).childs(),f=(0,n.ensureDefined)(c[r]);100!==u.transparency.value()&&i.forEach((i=>{let r=1/0,h=-1/0;for(const t of i.points){const e=t.index+(t.offset||0);r=Math.min(r,e),h=Math.max(h,e)}if(h<l||d<r)return;const c=i.points.map((i=>{const r=e.indexToCoordinate(i.index+(i.offset||0)),a=t.priceToCoordinate((0,n.ensureDefined)(i.level),s);return new o.Point(r,a)}));this._data.push({points:c,color:u.color.value(),backcolor:u.color.value(),
linewidth:f.showBorder?1:0,linestyle:a.LINESTYLE_SOLID,filled:!0,fillBackground:!0,transparency:u.transparency.value(),mouseTouchable:f.mouseTouchable})}))}))}}},709329:(t,e,i)=>{i.r(e),i.d(e,{ShapeMarkPaneView:()=>x});var n=i(650151),o=i(86441),r=i(379048),s=i(142119),a=i(934026),l=i(315801),d=i(199471);class h{constructor(t){this._data=t}draw(t,e){const i="down"===this._data.direction?1:"up"===this._data.direction?-1:0,n=this._data.point.x,o=this._data.point.y;(0,d.drawScaled)(t,e.pixelRatio,e.pixelRatio,(()=>{t.fillStyle=this._data.color,t.beginPath(),t.arc(n+1,o+2*this._data.size*i,this._data.size,0,2*Math.PI),t.closePath(),t.fill(),t.stroke()}))}hitTest(t){const e="down"===this._data.direction?1:"up"===this._data.direction?-1:0,i=new o.Point(this._data.point.x+.5,this._data.point.y+.5+2*this._data.size*e);return(0,a.pointInCircle)(t,i,this._data.size)?new l.HitTestResult(l.HitTarget.Regular):null}}class c{constructor(t){this._data=t}draw(t,e){const i="down"===this._data.direction?1:"up"===this._data.direction?-1:0,n=this._data.size,r=new o.Point(this._data.point.x-n/2,this._data.point.y-n/2+i*n),s=new o.Point(this._data.point.x+n/2,this._data.point.y+n/2+i*n).subtract(r),a=e.pixelRatio,l=Math.max(1,Math.floor(a)),d=l/2,h=l%2?.5:0,c=Math.round(r.x*a)+h,u=Math.round((r.x+s.x)*a)+h,f=Math.round(r.y*a)+h,p=Math.round((r.y+s.y)*a)+h;t.beginPath(),t.fillStyle=this._data.color,t.rect(c+d,f+d,u-c-l,p-f-l),t.fill(),t.lineWidth=l,t.beginPath(),t.rect(c,f,u-c,p-f),t.stroke()}hitTest(t){const e="down"===this._data.direction?1:"up"===this._data.direction?-1:0,i=this._data.size,n=new o.Point(this._data.point.x-i/2,this._data.point.y-i/2+e*i),r=new o.Point(this._data.point.x+i/2,this._data.point.y+i/2+e*i);return(0,a.pointInBox)(t,(0,o.box)(n,r))?new l.HitTestResult(l.HitTarget.Regular):null}}class u{constructor(t,e){this._data=t,this._arrowDirection=e}draw(t,e){const i=this._arrowDirection,n=this._data.size,o=this._data.color,r=this._data.point.x+1;let s=this._data.point.y;const a=1.1*n;switch(i){case"up":s-=a;break;case"down":s+=a}const l=n/6,h=n/4,c=n/3,u=n/2,f=.6666666*n;(0,d.drawScaled)(t,e.pixelRatio,e.pixelRatio,(()=>{switch(t.fillStyle=o,t.beginPath(),i){case"up":t.moveTo(r,s),t.lineTo(r-u,s+f),t.lineTo(r-h,s+f),t.lineTo(r,s+c),t.lineTo(r+h,s+f),t.lineTo(r+u,s+f),t.lineTo(r,s);break;case"down":t.moveTo(r,s+n),t.lineTo(r-u,s+c),t.lineTo(r-h,s+c),t.lineTo(r,s+f),t.lineTo(r+h,s+c),t.lineTo(r+u,s+c),t.lineTo(r,s+n);break;case"right":t.moveTo(r+l,s),t.lineTo(r-l,s-h),t.lineTo(r-l,s+h),t.lineTo(r+l,s);break;case"left":t.moveTo(r-l,s),t.lineTo(r+l,s-h),t.lineTo(r+l,s+h),t.lineTo(r-l,s)}t.closePath(),t.fill(),t.stroke()}))}hitTest(t){const[e,i,n]=this._hitTriangle();return(0,a.pointInTriangle)(t,e,i,n)?new l.HitTestResult(l.HitTarget.Regular):null}_hitTriangle(){const t=this._data.point.x;let e=this._data.point.y;const i=this._arrowDirection,n=this._data.size,r=1.1*n;switch(i){case"up":e-=r;break;case"down":e+=r}const s=n/6,a=n/4,l=n/3,d=n/2,h=.6666666*n;switch(i){case"up":
return[new o.Point(t,e),new o.Point(t+d,e+h),new o.Point(t-d,e+h)];case"down":return[new o.Point(t,e+n),new o.Point(t+d,e+l),new o.Point(t-d,e+l)];case"right":return[new o.Point(t+s,e),new o.Point(t-s,e-a),new o.Point(t-s,e+a)];case"left":return[new o.Point(t-s,e),new o.Point(t+s,e-a),new o.Point(t+s,e+a)]}}}var f=i(371573),p=i.n(f),g=i(246733);const _=(0,i(201089).getLogger)("Chart.ShapeMarkPaneView");class x extends(p()){constructor(t,e,i){super(),this._data=[],this._invalidated=!0,this._provider=t,this._model=e,this._data=[]}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new s.CompositeRenderer;for(const e of this._data)switch(e.shape){case"circle":t.append(new h(e));break;case"square":t.append(new c(e));break;case"arrowUp":t.append(new u(e,"up"));break;case"arrowDown":t.append(new u(e,"down"));break;case"arrowRight":t.append(new u(e,"right"));break;case"arrowLeft":t.append(new u(e,"left"))}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().shapemarks();if(0===i.size)return;const r=this._model.timeScale().visibleBarsStrictRange();if(null===r)return;const s=this._provider.firstValue();if(null===s)return;const a=r.firstBar(),l=r.lastBar(),d=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().shapemarks),h=(0,n.ensureDefined)(this._provider.graphicsInfo().shapemarks);i.forEach(((i,r)=>{const c=(0,n.ensureDefined)(d.childs()[r]).childs(),u=(0,n.ensureDefined)(h[r]);c.visible.value()&&i.forEach((i=>{const n=i.time;if(n<a||l<n)return;if(null===this._provider.series().bars().valueAt(n))return;const r="left"===u.halign?-(e.barSpacing()/2+1):"right"===u.halign?e.barSpacing()/2+1:0,d=u.location,h=u.shape,f=c.size.value(),p=(0,g.generateColor)(c.color.value(),c.transparency.value()),{x:_,y:x,direction:w}=this._calcCoordsForShape(d,n,f,i.price,s,t,e);switch(h){case"circle":case"square":this._data.push({shape:h,color:p,direction:w,point:new o.Point(_+r,x),size:f});break;case"arrowUp":case"arrowDown":case"arrowRight":case"arrowLeft":this._data.push({shape:h,color:p,point:new o.Point(_+r,x),size:f})}}))}))}_calcCoordsForShape(t,e,i,o,s,a,l){const d=Math.round(l.indexToCoordinate(e));switch(t){case r.MarkLocation.Absolute:return{x:d,y:a.priceToCoordinate((0,n.ensureDefined)(o),s),direction:""};case r.MarkLocation.AbsoluteDown:return{x:d,y:a.priceToCoordinate((0,n.ensureDefined)(o),s),direction:"down"};case r.MarkLocation.AbsoluteUp:return{x:d,y:a.priceToCoordinate((0,n.ensureDefined)(o),s),direction:"up"};case r.MarkLocation.AboveBar:return{x:d,y:this._locationToY(t,e,Math.floor(2*i/l.barSpacing())+1),direction:"up"};case r.MarkLocation.BelowBar:return{x:d,y:this._locationToY(t,e,Math.floor(2*i/l.barSpacing())+1),direction:"down"};default:return _.logWarn("Bad location value: "+t),{x:d,y:this._locationToY(r.MarkLocation.AbsoluteUp,e),direction:"up"}}}}},99490:(t,e,i)=>{i.r(e),i.d(e,{TextMarkPaneView:()=>w})
;var n=i(650151),o=i(86441),r=i(379048),s=i(593885),a=i(142119),l=i(934026),d=i(315801),h=i(199471),c=i(31341);class u{constructor(t,e){this._data=t,this._textCache=e}draw(t,e){if(!this._data)return;const i=f(this._data.direction);let n=this._data.point.x;"left"===this._data.halign?n-=this._data.size:"right"===this._data.halign&&(n+=this._data.size);const o=this._data.point.y;t.font=this._fontStyle();const r=t.measureText(this._data.text).width;this._textCache.textWidth=r;const s=this._data.fontSize;t.textAlign=(0,c.isRtl)()?"right":"left";const a=(0,h.calcTextHorizontalShift)(t,r),l=.65*s,d=1*s;(0,h.drawScaled)(t,e.pixelRatio,e.pixelRatio,(()=>{t.translate(n,o),t.beginPath(),t.moveTo(0,0),t.lineTo(l,d*i),t.lineTo(.5*r+l,d*i),t.lineTo(.5*r+l,(d+1.75*s)*i),t.lineTo(.5*-r-l,(d+1.75*s)*i),t.lineTo(.5*-r-l,d*i),t.lineTo(-l,d*i),t.lineTo(0,0),t.strokeStyle=this._data.borderColor,t.stroke(),t.fillStyle=this._data.color,t.fill(),t.fillStyle=this._data.fontColor,t.fillText(this._data.text,.5*-r+a,i<0?i*d-.5*s:d+1.25*s)}))}hitTest(t){const e=this._textCache.textWidth||0,i=this._data.fontSize,n=f(this._data.direction),r=.65*i,s=1*i;let a=this._data.point.x;"left"===this._data.halign?a-=this._data.size:"right"===this._data.halign&&(a+=this._data.size);const h=this._data.point.y,c=a-.5*e-r,u=a+.5*e+r;let p=h+s*n,g=h+(s+1.75*i)*n;if(g<p){const t=p;p=g,g=t}if((0,l.pointInBox)(t,(0,o.box)(new o.Point(c,p),new o.Point(u,g))))return new d.HitTestResult(d.HitTarget.Regular);const _=[new o.Point(this._data.point.x,this._data.point.y),new o.Point(this._data.point.x+.65*i,this._data.point.y+i*n),new o.Point(this._data.point.x-.65*i,this._data.point.y+i*n)],x=(t.x-_[0].x)*(_[1].y-_[0].y)-(t.y-_[0].y)*(_[1].x-_[0].x);return((t.x-_[1].x)*(_[2].y-_[1].y)-(t.y-_[1].y)*(_[2].x-_[1].x))*x>0&&((t.x-_[2].x)*(_[0].y-_[2].y)-(t.y-_[2].y)*(_[0].x-_[2].x))*x>0?new d.HitTestResult(d.HitTarget.Regular):null}_fontStyle(){return(this._data.bold?"bold ":"")+(this._data.italic?"italic ":"")+`${this._data.fontSize}px ${this._data.font}`}}function f(t){if("up"===t)return 1;if("down"===t)return-1;throw new Error(`${t} is not supported by TriangleTextMarkRenderer`)}class p{constructor(t,e){this._data=t,this._textCache=e}draw(t,e){const i=this._data.point.x,n=this._data.point.y;t.font=this._fontStyle();const o=t.measureText(this._data.text).width;this._textCache.textWidth=o,(0,h.drawScaled)(t,e.pixelRatio,e.pixelRatio,(()=>{switch(t.translate(i,n),t.beginPath(),t.moveTo(0,0),t.textAlign=this._data.halign,this._data.valign){case"middle":t.textBaseline="middle";break;case"top":t.textBaseline="bottom";break;case"bottom":t.textBaseline="hanging"}t.fillStyle=this._data.fontColor,t.fillText(this._data.text,0,0)}))}hitTest(t){let e=this._data.point.x,i=this._data.point.y;const n=this._textCache.textWidth||0,r=this._data.fontSize;switch(this._data.halign){case"right":e-=n;break;case"center":e-=n/2}switch(this._data.valign){case"middle":i-=r/2;break;case"bottom":i-=r}const s=new o.Point(e,i),a=new o.Point(e+n,i+r);return(0,l.pointInBox)(t,(0,
o.box)(s,a))?new d.HitTestResult(d.HitTarget.Regular):null}_fontStyle(){return(this._data.bold?"bold ":"")+(this._data.italic?"italic ":"")+`${this._data.fontSize}px ${this._data.font}`}}var g=i(371573),_=i.n(g),x=i(246733);class w extends(_()){constructor(t,e,i){super(),this._data=[],this._textCache=[],this._invalidated=!0,this._provider=t,this._model=e,this._data=[],this._textCache=[]}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new a.CompositeRenderer;for(let e=0;e<this._data.length;e++){const i=this._data[e],n=this._textCache[e];switch(i.shape){case"triangle":t.append(new u(i,n));break;case"rectangle":t.append(new p(i,n))}}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().textmarks();if(0===i.size)return;const r=this._model.timeScale().visibleBarsStrictRange();if(null===r)return;const a=this._provider.firstValue();if(null===a)return;const l=r.firstBar(),d=r.lastBar(),h=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().textmarks),c=(0,n.ensureDefined)(this._provider.graphicsInfo().textmarks);i.forEach(((i,r)=>{const u=(0,n.ensureDefined)(h.childs()[r]).childs(),f=(0,n.ensureDefined)(c[r]);u.visible.value()&&i.forEach((i=>{var n;let r=i.time;if(r<l||d<r)return;if(null===this._provider.series().bars().valueAt(r))return;r=i.time+(i.offset||0);const h={text:i.text?i.text:"",bold:u.fontBold.value(),italic:u.fontItalic.value(),font:u.fontFamily.value(),fontColor:(0,x.generateColor)(u.fontColor.value(),u.transparency.value()),fontSize:u.fontSize.value()},c=f.location,p=f.shape;switch(p){case s.TextMarkType.Triangle:{const{x:n,y:s,direction:l}=this._calcCoordsForTriangleShape(c,r,50,i.price,a,t,e);this._data.push({shape:p,color:(0,x.generateColor)(u.color.value(),u.transparency.value()),borderColor:"rgb(0, 0, 0)",direction:l,point:new o.Point(n,s),halign:f.halign,size:.5*e.barSpacing(),...h})}break;case s.TextMarkType.Rectangle:{const{x:s,y:l}=this._calcCoordsForRectangleShape(c,r,i.price,a,t,e);this._data.push({shape:p,point:new o.Point(s,l),halign:f.halign,valign:null!==(n=f.valign)&&void 0!==n?n:"middle",...h})}}this._textCache.push({})}))}))}_calcCoordsForTriangleShape(t,e,i,o,s,a,l){const d=Math.round(l.indexToCoordinate(e));switch(t){case r.MarkLocation.Top:return{x:d,y:a.height()-i,direction:"down"};case r.MarkLocation.Bottom:return{x:d,y:i,direction:"up"};case r.MarkLocation.AbsoluteDown:return{x:d,y:a.priceToCoordinate((0,n.ensureDefined)(o),s),direction:"down"};case r.MarkLocation.AbsoluteUp:return{x:d,y:a.priceToCoordinate((0,n.ensureDefined)(o),s),direction:"up"};case r.MarkLocation.AboveBar:return{x:d,y:this._locationToY(t,e),direction:"down"};case r.MarkLocation.BelowBar:default:return{x:d,y:this._locationToY(t,e),direction:"up"}}}_calcCoordsForRectangleShape(t,e,i,o,s,a){const l=Math.round(a.indexToCoordinate(e));switch(t){case r.MarkLocation.AbsoluteDown:
case r.MarkLocation.AbsoluteUp:case r.MarkLocation.Absolute:return{x:l,y:s.priceToCoordinate((0,n.ensureDefined)(i),o)};case r.MarkLocation.AboveBar:case r.MarkLocation.BelowBar:return{x:l,y:this._locationToY(t,e)};case r.MarkLocation.Right:case r.MarkLocation.Left:return{x:a.width(),y:s.priceToCoordinate((0,n.ensureDefined)(i),o)};default:return{x:l,y:this._locationToY(t,e)}}}}},173501:(t,e,i)=>{i.d(e,{calculateFontSizeForBox:()=>h,fontSizes:()=>l,textBoxData:()=>d});var n=i(86441),o=i(422333),r=i(368135),s=i(674981),a=i(511131);const l=new Map;function d(t,e,i,r,s){let a=t,d="left";"center"===s.horizontalTextAlignment?(d="center",a+=i/2):"right"===s.horizontalTextAlignment&&(d="right",a+=i-1);let h=e,c="top";return"center"===s.verticalTextAlignment?(c="middle",h+=r/2):"bottom"===s.verticalTextAlignment&&(c="bottom",h+=r-1),{points:[new n.Point(a,h)],text:s.text,color:s.textColor,vertAlign:c,horzAlign:d,font:"monospace"===s.fontType?o.CHART_MONOSPACE_FONT_FAMILY:o.CHART_FONT_FAMILY,fontSize:"auto"===s.sizeOptions.textSizeMode?s.sizeOptions.fontSize:l.get(s.sizeOptions.fontSize),offsetX:0,offsetY:0}}function h(t,e,i,n,o){const r=function(t,e){return Math.floor(.9*e/(t+.33))}(i.length,o);return(0,s.lowerboundExt)((t=>t),void 0,(o=>function(t,e,i,n){t.font=(0,a.makeFont)(n,e.font,e.italic?"italic ":void 0,e.bold?"bold ":void 0);const o=n/3;return i.reduce(((e,i)=>Math.max(e,t.measureText(i).width+o)),0)}(t,e,i,o)<=n),2,r)-1}l.set(r.PlotSymbolSize.Auto,14),l.set(r.PlotSymbolSize.Tiny,8),l.set(r.PlotSymbolSize.Small,10),l.set(r.PlotSymbolSize.Normal,14),l.set(r.PlotSymbolSize.Large,20),l.set(r.PlotSymbolSize.Huge,36)},149284:(t,e,i)=>{i.r(e),i.d(e,{TrendChannelPaneView:()=>h});var n=i(650151),o=i(86441),r=i(5531),s=i(315801),a=i(142119),l=i(458963),d=i(194483);class h{constructor(t,e,i){this._data=[],this._invalidated=!0,this._provider=t,this._model=e,this._data=[],this._hitTestResult=void 0!==i?new s.HitTestResult(s.HitTarget.Custom,i):new s.HitTestResult(s.HitTarget.Regular)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new a.CompositeRenderer;for(const e of this._data){const i=new d.PolygonRenderer(this._hitTestResult);i.setData(e),t.append(i)}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphics().trendchannels();if(0===i.size)return;const r=this._model.timeScale().visibleBarsStrictRange();if(null===r)return;const s=this._provider.firstValue();if(null===s)return;const a=r.firstBar(),d=r.lastBar(),h=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().trendchannels),u=(0,n.ensureDefined)(this._provider.graphicsInfo().trendchannels);i.forEach(((i,r)=>{const f=(0,n.ensureDefined)(h.childs()[r]).childs(),p=(0,n.ensureDefined)(u[r]);i.forEach((i=>{var r;const h=i.startIndex,u=i.endIndex;if(Math.max(h,u)<a&&!i.extendRight||Math.min(h,u)>d&&!i.extendLeft)return;const g=t.priceToCoordinate((0,
n.ensureDefined)(i.startHighPrice),s),_=t.priceToCoordinate((0,n.ensureDefined)(i.startLowPrice),s),x=t.priceToCoordinate((0,n.ensureDefined)(i.endHighPrice),s),w=x-(g-_),v=e.indexToCoordinate(h),m=e.indexToCoordinate(u),[y,b]=c(new o.Point(v,g),new o.Point(m,x),e.width(),t.height(),i.extendLeft,i.extendRight),[T,S]=c(new o.Point(v,_),new o.Point(m,w),e.width(),t.height(),i.extendLeft,i.extendRight);this._data.push({points:[y,T,S,b],color:f.color.value(),backcolor:f.color.value(),linewidth:null!==(r=p.borderWidth)&&void 0!==r?r:0,linestyle:l.LINESTYLE_SOLID,filled:!0,fillBackground:!0,transparency:i.transparency?Math.min(i.transparency+f.transparency.value(),100):f.transparency.value(),mouseTouchable:!0})}))}))}}function c(t,e,i,n,s,a){if((0,o.equalPoints)(t,e))return[t,e];const l=new o.Point(0,0),d=new o.Point(i,n);if(s){const n=t.subtract(e),s=(0,r.intersectRayAndBox)(t,t.add(n),(0,o.box)(l,d));s?t=s:e=new o.Point(i,e.y)}if(a){const n=e.subtract(t),s=(0,r.intersectRayAndBox)(e,e.add(n),(0,o.box)(l,d));e=s||new o.Point(i,e.y)}return[t,e]}},652742:(t,e,i)=>{i.r(e),i.d(e,{VertLinePaneView:()=>l});var n=i(650151),o=i(315801),r=i(379048),s=i(142119),a=i(758363);class l{constructor(t,e,i){this._data=[],this._invalidated=!0,this._provider=t,this._model=e,this._hitTestResult=void 0!==i?new o.HitTestResult(o.HitTarget.Custom,i):new o.HitTestResult(o.HitTarget.Regular)}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateViewInternal(),this._invalidated=!1);const t=new s.CompositeRenderer;for(const e of this._data){const i=new a.VerticalLineRenderer;i.setData(e),i.setHitTest(this._hitTestResult),t.append(i)}return t}_updateViewInternal(){this._data=[];const t=this._provider.priceScale(),e=this._model.timeScale();if(!t||t.isEmpty()||e.isEmpty())return;const i=this._provider.graphicsInfo().vertlines,o=this._provider.graphics().vertlines();if(0===o.size||void 0===i)return;const s=this._model.timeScale().visibleBarsStrictRange();if(null===s)return;const a=this._provider.firstValue();if(null===a)return;const l=s.firstBar(),d=s.lastBar(),h=(0,n.ensureDefined)(this._provider.properties().childs().graphics.childs().vertlines);o.forEach(((o,s)=>{const c=(0,n.ensureDefined)(h.childs()[s]).childs(),u=(0,n.ensureDefined)(i[s]);if(!c.visible.value())return;let f=0;switch(u.halign){case r.HAlign.Left:f=-e.barSpacing()/2;break;case r.HAlign.Right:f=e.barSpacing()/2}o.forEach((i=>{const o=i.index;o<l||d<o||this._data.push({x:e.indexToCoordinate(o)+f,top:i.extendTop?void 0:t.priceToCoordinate((0,n.ensureDefined)(i.endPrice),a),bottom:i.extendBottom?void 0:t.priceToCoordinate((0,n.ensureDefined)(i.startPrice),a),color:c.color.value(),linewidth:c.width.value(),linestyle:c.style.value()})}))}))}}},554855:(t,e,i)=>{i.r(e),i.d(e,{LinearRegressionPaneView:()=>h});var n=i(315801),o=i(246733),r=i(142119),s=i(402776),a=i(541801),l=i(535698),d=i(295906);class h{constructor(t,e){this._invalidated=!0,this._lines=[],this._pearsonsTextRenderer=new l.TextRenderer,this._pearsons=null,this._model=t,this._source=e}update(){
this._invalidated=!0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const t=new r.CompositeRenderer,e=[this._lines[1],this._lines[0],this._lines[2]],i=[];for(const t of e)t&&i.push(t);for(let r=1;r<i.length;r++){const i=e[r].color,a=e[r].linewidth,l=e[r].linestyle,d=e[r].extendright,h={line1:{color:i,lineStyle:l,lineWidth:a,points:[e[r].points[0],e[r].points[1]]},line2:{color:i,lineStyle:l,lineWidth:a,points:[e[r-1].points[0],e[r-1].points[1]]},extendLeft:!1,extendRight:d,backColor:(0,o.generateColor)(e[r].color,this._source.properties().styles.transparency.value()),skipLines:!0,fillBackground:!0},c=new s.ParallelChannelRenderer(new n.HitTestResult(n.HitTarget.Regular),new n.HitTestResult(n.HitTarget.Regular));c.setData(h),t.append(c)}for(const e of function(t){return t.map((t=>{const e={...t};return e.color=(0,o.resetTransparency)(e.color),e}))}(this._lines)){const i=new a.TrendLineRenderer;i.setData(e),i.setHitTest(new n.HitTestResult(n.HitTarget.Regular)),t.append(i)}return this._pearsons&&(this._pearsons.color=(0,o.resetTransparency)(this._pearsons.color),this._pearsonsTextRenderer.setData(this._pearsons),t.append(this._pearsonsTextRenderer)),t}_updateImpl(){const t=(0,d.prepareLinearRegressionRenderersData)(this._model,this._source);this._lines=t.lines,this._pearsons=t.pearsons}}}}]);