"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[3657],{323109:(e,t,i)=>{i.d(t,{containsBackgroundTimePointIndexes:()=>r,dematerializeBackground:()=>l,isBackgroundInBarsRange:()=>d,materializeBackground:()=>a});var n=i(650151),s=i(732149),o=i(387963);const r=!0;function a(e,t){if(e.start>=t.length||e.stop>=t.length)return null;const i=t[e.start],o=t[e.stop];return o===s.INVALID_TIME_POINT_INDEX?null:((0,n.assert)(i===s.INVALID_TIME_POINT_INDEX||i<=o,"start should not exceed stop"),{start:i===s.INVALID_TIME_POINT_INDEX?null:i,stop:o})}function l(e,t,i){return{id:t,start:(0,o.ensureTimePointIndexIndex)(i.indexOf(null!==e.start?e.start:s.INVALID_TIME_POINT_INDEX)),stop:(0,o.ensureTimePointIndexIndex)(i.indexOf(e.stop))}}function d(e,t){if(null===e.start)return t.firstBar()<=e.stop;const i=Math.min(e.start,e.stop),n=Math.max(e.start,e.stop);return t.contains(i)||t.contains(n)||i<t.firstBar()&&n>t.lastBar()}},206395:(e,t,i)=>{i.d(t,{DwgBoxFontType:()=>o,DwgBoxStyle:()=>n,containsDwgBoxTimePointIndexes:()=>d,dematerializeDwgBox:()=>h,isDwgBoxInBarsRange:()=>u,materializeDwgBox:()=>c});var n,s,o,r=i(732149),a=i(387963),l=i(92245);!function(e){e.Solid="sol",e.Dotted="dot",e.Dashed="dsh",e.LeftArrow="al",e.RightArrow="ar",e.BothArrow="ab"}(n||(n={})),function(e){e.Top="top",e.Center="center",e.Bottom="bottom"}(s||(s={})),function(e){e.Monospace="monospace"}(o||(o={}));const d=!0;function c(e,t){var i,n;if(e.x1>=t.length||e.x2>=t.length||null===e.y1||null===e.y2)return null;let s=t[e.x1],o=t[e.x2];return s===r.INVALID_TIME_POINT_INDEX&&(s=null),o===r.INVALID_TIME_POINT_INDEX&&(o=null),{left:s,right:o,top:e.y1,bottom:e.y2,borderColorIndex:e.c,backgroundColorIndex:e.bc,extend:e.ex,borderStyle:e.st,borderWidth:e.w,text:e.t,wordWrap:e.tw,horizontalTextAlignment:e.tha,verticalTextAlignment:e.tva,fontSize:e.ts,textColorIndex:null!==(i=e.tc)&&void 0!==i?i:null,fontType:null!==(n=e.tf)&&void 0!==n?n:null}}function h(e,t,i){var n,s,o;return{id:t,x1:(0,a.ensureTimePointIndexIndex)(i.indexOf(null!==(n=e.left)&&void 0!==n?n:r.INVALID_TIME_POINT_INDEX)),x2:(0,a.ensureTimePointIndexIndex)(i.indexOf(null!==(s=e.right)&&void 0!==s?s:r.INVALID_TIME_POINT_INDEX)),y1:e.top,y2:e.bottom,c:e.borderColorIndex,bc:e.backgroundColorIndex,ex:e.extend,st:e.borderStyle,w:e.borderWidth,t:e.text,tw:e.wordWrap,tha:e.horizontalTextAlignment,tva:e.verticalTextAlignment,ts:e.fontSize,tf:null!==(o=e.fontType)&&void 0!==o?o:void 0,tc:e.textColorIndex}}function u(e,t){const i=e.extend;if(i===l.DwgExtend.Both)return null===e.left||null===e.right;if(null===e.left||null===e.right)return null!==e.right?e.right<=t.lastBar()&&i===l.DwgExtend.Right:null!==e.left&&(e.left>=t.firstBar()&&i===l.DwgExtend.Left);const n=Math.min(e.left,e.right),s=Math.max(e.left,e.right);if(t.contains(n)||t.contains(s)||n<t.firstBar()&&s>t.lastBar())return!0;const o=e.left<e.right?e.extend===l.DwgExtend.Left:e.extend===l.DwgExtend.Right,r=e.left<e.right?e.extend===l.DwgExtend.Right:e.extend===l.DwgExtend.Left;return s<t.firstBar()&&r||n>t.lastBar()&&o}},
92245:(e,t,i)=>{i.d(t,{DwgExtend:()=>n,convertPointsToScreenDimension:()=>a,doesItemAffectVisibleRange:()=>l,isExtendInSameDirection:()=>r});var n,s=i(650151);function o(e,t){return e===n.None?t:t===n.None?e:e===n.Both||t===n.Both?n.Both:e===t?t:n.Both}function r(e,t){return e===n.Both||e===t}function a(e,t,i,r,a,l,d,c,h,u){let p,m;if(null===e&&null===i){if(a!==n.Right&&a!==n.Both)return null;a=n.Both,p=0,m=c}else null===e?(p=d.indexToCoordinate((0,s.ensureNotNull)(i)-1),a=o(a,n.Left)):p=d.indexToCoordinate(e),null===i?(m=d.indexToCoordinate((0,s.ensureNotNull)(e)-1),a=o(a,n.Right)):m=d.indexToCoordinate(i);const _=p,x=l.priceToCoordinate(t,h),g=m,I=l.priceToCoordinate(r,h);return void 0!==u?(u.x1=_,u.y1=x,u.x2=g,u.y2=I,u.extend=a,u):{x1:_,y1:x,x2:g,y2:I,extend:a}}function l(e,t,i,s,o){let r=!1;switch(i){case n.Both:r=!0;break;case n.Right:r=null===t||null===e||e<=o;break;case n.Left:r=null===t||t>=s;break;default:null!==e&&null!==t?r=(e>=s||t>=s)&&(e<=o||t<=o):null!==e&&null===t?r=e<=o:null===e&&null!==t&&(r=t>=s)}return r}!function(e){e.None="n",e.Left="l",e.Right="r",e.Both="b"}(n||(n={}))},294024:(e,t,i)=>{i.d(t,{DwgLabelStyle:()=>o,DwgLabelTextAlign:()=>n,DwgLabelYloc:()=>s,containsDwgLabelTimePointIndexes:()=>d,dematerializeDwgLabel:()=>h,isDwgLabelInBarsRange:()=>u,materializeDwgLabel:()=>c});var n,s,o,r,a=i(732149),l=i(387963);!function(e){e.Left="left",e.Center="center",e.Right="right"}(n||(n={})),function(e){e.AboveBar="ab",e.BelowBar="bl",e.Price="pr",e.Auto="auto"}(s||(s={})),function(e){e.Xcross="xcr",e.Cross="cr",e.Triangleup="tup",e.Triangledown="tdn",e.Flag="flg",e.Circle="cir",e.Arrowup="aup",e.Arrowdown="adn",e.LabelUp="lup",e.LabelDown="ldn",e.LabelLeft="llf",e.LabelRight="lrg",e.LabelCenter="lcn",e.LabelLeftUp="luplf",e.LabelLeftDown="llwlf",e.LabelRightUp="luprg",e.LabelRightDown="llwrg",e.Square="sq",e.Diamond="dia",e.TextOutline="to",e.None="n"}(o||(o={})),function(e){e.Monospace="monospace"}(r||(r={}));const d=!0;function c(e,t){var i;if(e.x>=t.length)return null;const s=t[e.x];return s===a.INVALID_TIME_POINT_INDEX?null:{x:s,y:e.y,yloc:e.yl,text:e.t,style:e.st,size:e.sz,colorIndex:e.ci,textColorIndex:e.tci,textAlign:e.ta||n.Center,tooltip:e.tt||"",fontType:null!==(i=e.tf)&&void 0!==i?i:null}}function h(e,t,i){var n;return{id:t,x:(0,l.ensureTimePointIndexIndex)(i.indexOf(e.x)),y:e.y,yl:e.yloc,t:e.text,st:e.style,sz:e.size,ci:e.colorIndex,tci:e.textColorIndex,ta:e.textAlign,tt:e.tooltip,tf:null!==(n=e.fontType)&&void 0!==n?n:void 0}}function u(e,t){return t.contains(e.x)}},934393:(e,t,i)=>{i.d(t,{containsDwgLineFillTimePointIndexes:()=>n,dematerializeDwgLineFill:()=>o,materializeDwgLineFill:()=>s});const n=!1;function s(e){return{id:e.id,line1:e.line1,line2:e.line2,colorIndex:e.ci}}function o(e,t){return{id:t,line1:e.line1,line2:e.line2,ci:e.colorIndex}}},258940:(e,t,i)=>{i.d(t,{DwgLineStyle:()=>n,containsDwgLineTimePointIndexes:()=>a,dematerializeDwgLine:()=>d,isDwgLineInBarsRange:()=>c,materializeDwgLine:()=>l});var n,s=i(732149),o=i(387963),r=i(92245);!function(e){e.Solid="sol",
e.Dotted="dot",e.Dashed="dsh",e.LeftArrow="al",e.RightArrow="ar",e.BothArrow="ab"}(n||(n={}));const a=!0;function l(e,t){if(e.x1>=t.length||e.x2>=t.length||null===e.y1||null===e.y2)return null;let i=t[e.x1],n=t[e.x2];return i===s.INVALID_TIME_POINT_INDEX&&(i=null),n===s.INVALID_TIME_POINT_INDEX&&(n=null),null!==i&&null!==n||e.y1===e.y2?{id:e.id,x1:i,y1:e.y1,x2:n,y2:e.y2,style:e.st,extend:e.ex,width:e.w,colorIndex:e.ci}:null}function d(e,t,i){var n,r;const a=(0,o.ensureTimePointIndexIndex)(i.indexOf(null!==(n=e.x1)&&void 0!==n?n:s.INVALID_TIME_POINT_INDEX)),l=(0,o.ensureTimePointIndexIndex)(i.indexOf(null!==(r=e.x2)&&void 0!==r?r:s.INVALID_TIME_POINT_INDEX));return{id:t,x1:a,y1:e.y1,x2:l,y2:e.y2,st:e.style,ex:e.extend,w:e.width,ci:e.colorIndex}}function c(e,t){const i=e.extend;if(i===r.DwgExtend.Both)return!0;if(null===e.x1||null===e.x2)return null!==e.x2?e.x2<=t.lastBar()&&i===r.DwgExtend.Right:null!==e.x1&&(e.x1>=t.firstBar()&&i===r.DwgExtend.Left);const n=Math.min(e.x1,e.x2),s=Math.max(e.x1,e.x2);if(t.contains(n)||t.contains(s)||n<t.firstBar()&&s>t.lastBar())return!0;const o=e.x1<e.x2?e.extend===r.DwgExtend.Left:e.extend===r.DwgExtend.Right,a=e.x1<e.x2?e.extend===r.DwgExtend.Right:e.extend===r.DwgExtend.Left;return s<t.firstBar()&&a||n>t.lastBar()&&o}},640073:(e,t,i)=>{i.d(t,{DwgPolylineStyle:()=>r,containsDwgPolylineTimePointIndexes:()=>o,dematerializeDwgPolyline:()=>l,isDwgPolylineInBarsRange:()=>d,materializeDwgPolyline:()=>a});var n=i(387963),s=i(732149);const o=!0;var r;function a(e,t){const i=[];for(const n of e.points){if(n.x>=t.length)continue;const e=t[n.x];e!==s.INVALID_TIME_POINT_INDEX&&i.push({x:e,y:n.y})}return 0===i.length?null:{id:e.id,points:i,width:e.w,curved:e.crv,closed:e.cls,color:e.c,fillColor:e.fc,style:e.st}}function l(e,t,i){return{id:t,points:e.points.map((e=>{var t;return{x:(0,n.ensureTimePointIndexIndex)(i.indexOf(null!==(t=e.x)&&void 0!==t?t:s.INVALID_TIME_POINT_INDEX)),y:e.y}})),w:e.width,crv:e.curved,cls:e.closed,c:e.color,fc:e.fillColor,st:e.style}}function d(e,t){if(0===e.points.length)return!1;const i=t.firstBar(),n=t.lastBar();let s=!1,o=!1;for(const r of e.points){if(t.contains(r.x))return!0;if(r.x<i?s=!0:r.x>n&&(o=!0),s&&o)return!0}return!1}!function(e){e.Solid="sol",e.Dotted="dot",e.Dashed="dsh",e.ArrowLeft="al",e.ArrowRight="ar",e.ArrowBoth="ab"}(r||(r={}))},590836:(e,t,i)=>{var n,s;i.d(t,{DwgTableCellFontType:()=>s,containsDwgTableCellTimePointIndexes:()=>l,containsDwgTableTimePointIndexes:()=>o,dematerializeDwgTable:()=>a,dematerializeDwgTableCell:()=>c,materializeDwgTable:()=>r,materializeDwgTableCell:()=>d}),function(e){e.Top="top",e.Center="center",e.Bottom="bottom"}(n||(n={})),function(e){e.Monospace="monospace"}(s||(s={}));const o=!1;function r(e,t){return{id:e.id,position:e.pos,rows:e.rows,columns:e.cols,backgroundColorIndex:e.bgc,frameColorIndex:e.frmc,frameWidth:e.frmw,borderColorIndex:e.brdc,borderWidth:e.brdw}}function a(e,t,i){return{id:t,pos:e.position,rows:e.rows,cols:e.columns,bgc:e.backgroundColorIndex,frmc:e.frameColorIndex,frmw:e.frameWidth,
brdc:e.borderColorIndex,brdw:e.borderWidth}}const l=!1;function d(e,t){var i,n,s;return{tableId:e.tid,row:e.row,column:e.col,widthInPercentsOfPaneWidth:e.w,heightInPercentOfPaneHeight:e.h,text:e.t,textColorIndex:e.tc,horizontalTextAlignment:e.tha,verticalTextAlignment:e.tva,fontSize:e.ts,backgroundColorIndex:e.bgc,colSpan:null!==(i=e.colspan)&&void 0!==i?i:1,rowSpan:null!==(n=e.rowspan)&&void 0!==n?n:1,tooltip:e.tt,fontType:null!==(s=e.tf)&&void 0!==s?s:null}}function c(e,t,i){var n;return{id:t,tid:e.tableId,row:e.row,col:e.column,w:e.widthInPercentsOfPaneWidth,h:e.heightInPercentOfPaneHeight,t:e.text,tc:e.textColorIndex,tha:e.horizontalTextAlignment,tva:e.verticalTextAlignment,ts:e.fontSize,bgc:e.backgroundColorIndex,colspan:e.colSpan,rowspan:e.rowSpan,tt:e.tooltip,tf:null!==(n=e.fontType)&&void 0!==n?n:void 0}}},396372:(e,t,i)=>{i.d(t,{HHistDirection:()=>n,HHistLocation:()=>s,HHistVolumeMode:()=>o,containsHHistTimePointIndexes:()=>d,dematerializeHHist:()=>h,isHHistInBarsRange:()=>u,materializeHHist:()=>c});var n,s,o,r=i(650151),a=i(732149),l=i(387963);!function(e){e.LeftToRight="left_to_right",e.RightToLeft="right_to_left"}(n||(n={})),function(e){e.Relative="relative",e.Absolute="absolute"}(s||(s={})),function(e){e.UpDown="Up/Down",e.Total="Total",e.Delta="Delta"}(o||(o={}));const d=!0;function c(e,t){if(e.firstBarTime>=t.length||e.lastBarTime>=t.length)return null;const i=t[e.firstBarTime],n=t[e.lastBarTime];return i===a.INVALID_TIME_POINT_INDEX||n===a.INVALID_TIME_POINT_INDEX?null:((0,r.assert)(i<=n,"firstBarTime should not exceed lastBarTime"),(0,r.assert)(e.priceLow<=e.priceHigh,"priceLow should not exceed priceHigh"),{firstBarTime:i,lastBarTime:n,rate:e.rate,priceHigh:e.priceHigh,priceLow:e.priceLow})}function h(e,t,i){const n=(0,l.ensureTimePointIndexIndex)(i.indexOf(e.firstBarTime)),s=(0,l.ensureTimePointIndexIndex)(i.indexOf(e.lastBarTime));return{id:t,...e,firstBarTime:n,lastBarTime:s}}function u(e,t){const i=Math.min(e.firstBarTime,e.lastBarTime),n=Math.max(e.firstBarTime,e.lastBarTime);return t.contains(i)||t.contains(n)||i<t.firstBar()&&n>t.lastBar()}},921124:(e,t,i)=>{i.d(t,{containsHorizLineTimePointIndexes:()=>r,dematerializeHorizLine:()=>l,isHorizLineInBarsRange:()=>d,materializeHorizLine:()=>a});var n=i(650151),s=i(732149),o=i(387963);const r=!0;function a(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],o=t[e.endIndex];return i===s.INVALID_TIME_POINT_INDEX||o===s.INVALID_TIME_POINT_INDEX?null:((0,n.assert)(i<=o,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:o,level:e.level,extendLeft:e.extendLeft,extendRight:e.extendRight})}function l(e,t,i){const n=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),s=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:n,endIndex:s}}function d(e,t){const i=Math.min(e.startIndex,e.endIndex),n=Math.max(e.startIndex,e.endIndex);if(t.contains(i)||t.contains(n)||i<t.firstBar()&&n>t.lastBar())return!0
;const s=e.startIndex<e.endIndex?e.extendLeft:e.extendRight,o=e.startIndex<e.endIndex?e.extendRight:e.extendLeft;return n<t.firstBar()&&o||i>t.lastBar()&&s}},276636:(e,t,i)=>{var n;i.d(t,{TextPos:()=>n,containsLevelTimePointIndexes:()=>s,dematerializeLevel:()=>r,materializeLevel:()=>o}),function(e){e[e.TopLeft=0]="TopLeft",e[e.TopCenter=1]="TopCenter",e[e.TopRight=2]="TopRight",e[e.MiddleLeft=3]="MiddleLeft",e[e.MiddleCenter=4]="MiddleCenter",e[e.MiddleRight=5]="MiddleRight",e[e.BottomLeft=6]="BottomLeft",e[e.BottomCenter=7]="BottomCenter",e[e.BottomRight=8]="BottomRight"}(n||(n={}));const s=!1;function o(e){return{level:e.level,text:e.text}}function r(e,t,i){return{id:t,...e}}},573947:(e,t,i)=>{i.d(t,{containsLineTimePointIndexes:()=>r,dematerializeLine:()=>l,isLineInBarsRange:()=>d,materializeLine:()=>a});var n=i(650151),s=i(732149),o=i(387963);const r=!0;function a(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],o=t[e.endIndex];return i===s.INVALID_TIME_POINT_INDEX||o===s.INVALID_TIME_POINT_INDEX?null:((0,n.assert)(i<=o,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:o,startOffset:e.startOffset,endOffset:e.endOffset,startPrice:e.startPrice,endPrice:e.endPrice})}function l(e,t,i){const n=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),s=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:n,endIndex:s}}function d(e,t){var i,n;const s=e.startIndex+(null!==(i=e.startOffset)&&void 0!==i?i:0),o=e.endIndex+(null!==(n=e.endOffset)&&void 0!==n?n:0),r=Math.min(s,o),a=Math.max(s,o);return t.contains(s)||t.contains(o)||r<t.firstBar()&&a>t.lastBar()}},700534:(e,t,i)=>{i.d(t,{LiveStudyGraphics:()=>E});var n=i(650151),s=i(707957),o=i(396372),r=i(921124),a=i(329081),l=i(878475),d=i(323109),c=i(294024),h=i(258940),u=i(640073),p=i(206395),m=i(276636),_=i(573947),x=i(14721),g=i(593885),I=i(180857),f=i(590836),w=i(934393),y=i(755470),T=i(952499),v=i(583884),b=i(686242),B=i(130551);function D(e){const t=JSON.parse(e.pp);var i;return(0,n.assert)("s"in(i=t)&&(0,B.isObject)(i.s)&&"l"in i.s&&"c"in i.s&&"e"in i&&(0,B.isObject)(i.e)&&"l"in i.e&&"c"in i.e,"unexpected log source"),{barTime:e.t,time:e.tms,level:e.ll,source:{start:{line:t.s.l,column:t.s.c},end:{line:t.e.l,column:t.e.c}},message:e.m}}function P(e){return{lines:e.l,time:e.t,invocations:e.c}}function C(e){return{total:e.total,profile:e.profile.map(P)}}var S=i(138839),k=i(590713),L=i(2605),z=i(735758);class E{constructor(e={}){this._indexes=[],this._hhistsByTimePointIndex=new Map,this._primitivesCollection=function(e){const t={};for(const i of k.primitiveNames){t[i]=new Map;const n=e[i];if(void 0!==n)for(const e in n)if(n.hasOwnProperty(e))switch(i){case"horizlines":t[i].set(e,new N(r.materializeHorizLine,r.containsHorizLineTimePointIndexes));break;case"vertlines":t[i].set(e,new N(a.materializeVertLine,a.containsVertLineTimePointIndexes));break;case"lines":t[i].set(e,new N(_.materializeLine,_.containsLineTimePointIndexes));break;case"hlines":
t[i].set(e,new N(m.materializeLevel,m.containsLevelTimePointIndexes));break;case"textmarks":t[i].set(e,new N(g.materializeTextMark,g.containsTextMarkTimePointIndexes));break;case"shapemarks":t[i].set(e,new N(x.materializeShapeMark,x.containsShapeMarkTimePointIndexes));break;case"backgrounds":t[i].set(e,new N(d.materializeBackground,d.containsBackgroundTimePointIndexes));break;case"polygons":t[i].set(e,new N(l.materializePolygon,l.containsPolygonTimePointIndexes));break;case"trendchannels":t[i].set(e,new N(I.materializeTrendChannel,I.containsTrendChannelTimePointIndexes));break;case"hhists":t[i].set(e,new N(o.materializeHHist,o.containsHHistTimePointIndexes));break;case"dwglabels":t[i].set(e,new N(c.materializeDwgLabel,c.containsDwgLabelTimePointIndexes));break;case"dwglines":t[i].set(e,new N(h.materializeDwgLine,h.containsDwgLineTimePointIndexes));break;case"dwgpolylines":t[i].set(e,new N(u.materializeDwgPolyline,u.containsDwgPolylineTimePointIndexes));break;case"dwgboxes":t[i].set(e,new N(p.materializeDwgBox,p.containsDwgBoxTimePointIndexes));break;case"dwgtables":t[i].set(e,new N(f.materializeDwgTable,f.containsDwgTableTimePointIndexes));break;case"dwgtablecells":t[i].set(e,new N(f.materializeDwgTableCell,f.containsDwgTableCellTimePointIndexes));break;case"dwglinefills":t[i].set(e,new N(w.materializeDwgLineFill,w.containsDwgLineFillTimePointIndexes));break;case"tpos":t[i].set(e,new N(y.materializeTpo,y.containsTpoTimePointIndexes));break;case"tpoBlockSets":t[i].set(e,new N(T.materializeTpoBlockSet,T.containsTpoBlockSetTimePointIndexes));break;case"tpoLevels":t[i].set(e,new N(v.materializeTpoLevelGroup,v.containsTpoLevelGroupTimePointIndexes));break;case"tpoVolumeRows":t[i].set(e,new N(b.materializeTpoVolumeRow,b.containsTpoVolumeRowTimePointIndexes));break;case"logs":t[i].set(e,new N(D,false));break;case"footprints":t[i].set(e,new N(S.materializeVolumeFootprint,S.containsFootprintTimePointIndexes))}}t.performance.set("performance",new N(C,false));return t}(e),this._tpoBlockSetsByStyleIdAndTpoId=(0,z.setsByStyleIdAndKey)(this._primitivesCollection.tpoBlockSets,(e=>e.tpoId)),this._tpoVolumeRowsByStyleIdAndTpoId=(0,z.setsByStyleIdAndKey)(this._primitivesCollection.tpoVolumeRows,(e=>e.tpoId))}horizlines(){return this._primitivesCollection.horizlines}vertlines(){return this._primitivesCollection.vertlines}lines(){return this._primitivesCollection.lines}hlines(){return this._primitivesCollection.hlines}textmarks(){return this._primitivesCollection.textmarks}shapemarks(){return this._primitivesCollection.shapemarks}backgrounds(){return this._primitivesCollection.backgrounds}polygons(){return this._primitivesCollection.polygons}trendchannels(){return this._primitivesCollection.trendchannels}hhists(){return this._primitivesCollection.hhists}dwglabels(){return this._primitivesCollection.dwglabels}dwglines(){return this._primitivesCollection.dwglines}dwgpolylines(){return this._primitivesCollection.dwgpolylines}dwgboxes(){return this._primitivesCollection.dwgboxes}dwgtables(){return this._primitivesCollection.dwgtables}
dwgtablecells(){return this._primitivesCollection.dwgtablecells}dwglinefills(){return this._primitivesCollection.dwglinefills}tpos(){return this._primitivesCollection.tpos}tpoBlockSets(){return this._primitivesCollection.tpoBlockSets}tpoBlockSetsByStyleAndTpoId(e,t){return this._tpoBlockSetsByStyleIdAndTpoId.get(e,t)}tpoLevels(){return this._primitivesCollection.tpoLevels}tpoVolumeRows(){return this._primitivesCollection.tpoVolumeRows}tpoVolumeRowByStyleAndTpoId(e,t){return this._tpoVolumeRowsByStyleIdAndTpoId.get(e,t)}logs(){return this._primitivesCollection.logs}observableLogs(){return this._primitivesCollection.logs}performance(){return this._primitivesCollection.performance}observablePerformance(){return this._primitivesCollection.performance}footprints(){return this._primitivesCollection.footprints}hhistsByTimePointIndex(){return this._hhistsByTimePointIndex}clear(){this._indexes=[];for(const e of k.primitiveNames)this._primitivesCollection[e].forEach((e=>e.clear()));this._hhistsByTimePointIndex=new Map}extract(){const e=e=>e.extract(),t={indexes:this._indexes,horizlines:M(this._primitivesCollection.horizlines,e),vertlines:M(this._primitivesCollection.vertlines,e),lines:M(this._primitivesCollection.lines,e),hlines:M(this._primitivesCollection.hlines,e),textmarks:M(this._primitivesCollection.textmarks,e),shapemarks:M(this._primitivesCollection.shapemarks,e),backgrounds:M(this._primitivesCollection.backgrounds,e),polygons:M(this._primitivesCollection.polygons,e),trendchannels:M(this._primitivesCollection.trendchannels,e),hhists:M(this._primitivesCollection.hhists,e),dwglabels:M(this._primitivesCollection.dwglabels,e),dwglines:M(this._primitivesCollection.dwglines,e),dwgpolylines:M(this._primitivesCollection.dwgpolylines,e),dwgboxes:M(this._primitivesCollection.dwgboxes,e),dwgtables:M(this._primitivesCollection.dwgtables,e),dwgtablecells:M(this._primitivesCollection.dwgtablecells,e),dwglinefills:M(this._primitivesCollection.dwglinefills,e),tpos:M(this._primitivesCollection.tpos,e),tpoBlockSets:M(this._primitivesCollection.tpoBlockSets,e),tpoLevels:M(this._primitivesCollection.tpoLevels,e),tpoVolumeRows:M(this._primitivesCollection.tpoVolumeRows,e),logs:new Map,performance:new Map,footprints:M(this._primitivesCollection.footprints,e)};return this._hhistsByTimePointIndex=new Map,new L.StaticStudyGraphics("data",t)}replaceIndexesTo(e){this._indexes=e;const t=e=>e.replaceIndexesTo(this._indexes);for(const e of k.primitiveNames)this._primitivesCollection[e].forEach(t);this._hhistsByTimePointIndex=(0,k.splitHHistsByTimePointIndex)(this._primitivesCollection.hhists)}processCommands(e){void 0!==e.erase&&this._processEraseCommands(e.erase),void 0!==e.create&&this._processCreateCommands(e.create)}_processCreateCommands(e){for(const t in e){if(!e.hasOwnProperty(t))continue;const i=t;switch(i){case"horizlines":A(this._indexes,this._primitivesCollection.horizlines,e[i]);break;case"vertlines":A(this._indexes,this._primitivesCollection.vertlines,e[i]);break;case"lines":A(this._indexes,this._primitivesCollection.lines,e[i]);break
;case"hlines":A(this._indexes,this._primitivesCollection.hlines,e[i]);break;case"textmarks":A(this._indexes,this._primitivesCollection.textmarks,e[i]);break;case"shapemarks":A(this._indexes,this._primitivesCollection.shapemarks,e[i]);break;case"backgrounds":A(this._indexes,this._primitivesCollection.backgrounds,e[i]);break;case"polygons":A(this._indexes,this._primitivesCollection.polygons,e[i]);break;case"trendchannels":A(this._indexes,this._primitivesCollection.trendchannels,e[i]);break;case"hhists":A(this._indexes,this._primitivesCollection.hhists,e[i]);break;case"dwglabels":A(this._indexes,this._primitivesCollection.dwglabels,e[i]);break;case"dwglines":A(this._indexes,this._primitivesCollection.dwglines,e[i]);break;case"dwgpolylines":A(this._indexes,this._primitivesCollection.dwgpolylines,e[i]);break;case"dwgboxes":A(this._indexes,this._primitivesCollection.dwgboxes,e[i]);break;case"dwgtables":A(this._indexes,this._primitivesCollection.dwgtables,e[i]);break;case"dwgtablecells":A(this._indexes,this._primitivesCollection.dwgtablecells,e[i]);break;case"dwglinefills":A(this._indexes,this._primitivesCollection.dwglinefills,e[i]);break;case"tpos":A(this._indexes,this._primitivesCollection.tpos,e[i]);break;case"tpoBlockSets":A(this._indexes,this._primitivesCollection.tpoBlockSets,e[i]);break;case"tpoLevels":A(this._indexes,this._primitivesCollection.tpoLevels,e[i]);break;case"tpoVolumeRows":A(this._indexes,this._primitivesCollection.tpoVolumeRows,e[i]);break;case"logs":A(this._indexes,this._primitivesCollection.logs,e[i]);break;case"performance":A(this._indexes,this._primitivesCollection.performance,e[i]);break;case"footprints":A(this._indexes,this._primitivesCollection.footprints,e[i])}}this._hhistsByTimePointIndex=(0,k.splitHHistsByTimePointIndex)(this._primitivesCollection.hhists)}_processEraseCommands(e){for(const t of e)if("all"===t.action)for(const e of k.primitiveNames)this._primitivesCollection[e].forEach((e=>e.clearPrimitives()));else{const e=e=>e.deleteById(t.id);this._primitivesCollection[t.type].forEach(e)}this._hhistsByTimePointIndex=(0,k.splitHHistsByTimePointIndex)(this._primitivesCollection.hhists)}}class N{constructor(e,t){this._primitivesDataById=new Map,this._primitiveById=new Map,this._changed=new s.Delegate,this._cleared=new s.Delegate,this._materializePrimitive=e,this._isRematerializationRequiredWithNewIndexes=t}changed(){return this._changed}cleared(){return this._cleared}forEach(e,t){this._primitiveById.forEach((i=>{e.call(t,i,i,this)}))}has(e){let t=!1;return this._primitiveById.forEach((i=>{t=t||i===e})),t}get size(){return this._primitiveById.size}[Symbol.iterator](){return this._primitiveById.values()}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){return this._primitiveById.values()}hasId(e){return this._primitiveById.has(e)}addData(e,t){const i=[];e.forEach((e=>{this._primitivesDataById.set(e.id,e);const n=this._tryMaterialize(t,e);null!==n&&i.push(n)})),i.length>0&&this._changed.fire({created:i,removed:[]})}deleteById(e){
const t=this._primitiveById.get(e);t&&(this._primitiveById.delete(e),this._primitivesDataById.delete(e),this._changed.fire({created:[],removed:[t]}))}clear(){this.clearPrimitives()}clearPrimitives(){this._primitivesDataById.clear(),this._primitiveById.clear(),this._cleared.fire()}replaceIndexesTo(e){if(!this._isRematerializationRequiredWithNewIndexes)return;const t=Array.from(this._primitiveById.values());this._primitiveById.clear(),this._primitivesDataById.forEach(this._tryMaterialize.bind(this,e),this);const i=Array.from(this._primitiveById.values());this._changed.fire({created:i,removed:t})}extract(){const e=new Set(this._primitivesDataById.values());return this.clearPrimitives(),e}_tryMaterialize(e,t){const i=this._materializePrimitive(t,e);return null!==i&&((0,n.assert)(!this._primitiveById.has(t.id),"primitive with specified id should not exist"),this._primitiveById.set(t.id,i)),i}}function M(e,t){const i=new Map;return e.forEach(((e,n)=>i.set(n,t(e)))),i}function A(e,t,i=[]){for(const s of i){const i=s.styleId,o=t.get(i);(0,n.assert)(void 0!==o,"Every style used by graphics primitive should be declared in study metainfo"),o.addData(s.data,e)}}},878475:(e,t,i)=>{i.d(t,{containsPolygonTimePointIndexes:()=>o,dematerializePolygon:()=>a,isPolygonInBarsRange:()=>l,materializePolygon:()=>r});var n=i(732149),s=i(387963);const o=!0;function r(e,t){for(const i of e.points){if(i.index>=t.length)return null;if(t[i.index]===n.INVALID_TIME_POINT_INDEX)return null}return{points:e.points.map((e=>({index:t[e.index],offset:e.offset,level:e.level})))}}function a(e,t,i){return{id:t,points:e.points.map((e=>({...e,index:(0,s.ensureTimePointIndexIndex)(i.indexOf(e.index))})))}}function l(e,t){var i;if(e.points.some((e=>{var i;return t.contains(e.index+(null!==(i=e.offset)&&void 0!==i?i:0))})))return!0;let n=!1,s=!1;const o=t.firstBar();for(const t of e.points)t.index+(null!==(i=t.offset)&&void 0!==i?i:0)<o?n=!0:s=!0;return n&&s}},387963:(e,t,i)=>{function n(e){if(e<0)throw new Error("TimePointIndexIndex should be non-negative integer");return e}i.d(t,{ensureTimePointIndexIndex:()=>n})},14721:(e,t,i)=>{i.d(t,{containsShapeMarkTimePointIndexes:()=>r,dematerializeShapeMark:()=>l,isShapeMarkInBarsRange:()=>d,materializeShapeMark:()=>a});var n,s=i(732149),o=i(387963);!function(e){e.Circle="circle",e.ArrowUp="arrowUp",e.ArrowDown="arrowDown",e.ArrowRight="arrowRight",e.ArrowLeft="arrowLeft",e.Square="square"}(n||(n={}));const r=!0;function a(e,t){if(e.time>=t.length)return null;const i=t[e.time];return i===s.INVALID_TIME_POINT_INDEX?null:{time:i,price:e.price}}function l(e,t,i){const n=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.time));return{id:t,...e,time:n}}function d(e,t){return t.contains(e.time)}},2605:(e,t,i)=>{i.d(t,{StaticStudyGraphics:()=>P,emptyStudyGraphics:()=>L,loadStudyGraphics:()=>z,saveStudyGraphics:()=>N})
;var n=i(732149),s=i(921124),o=i(329081),r=i(396372),a=i(878475),l=i(323109),d=i(276636),c=i(573947),h=i(14721),u=i(593885),p=i(180857),m=i(294024),_=i(258940),x=i(640073),g=i(206395),I=i(590836),f=i(934393),w=i(755470),y=i(952499),T=i(583884),v=i(686242),b=i(138839),B=i(590713),D=i(735758);class P{constructor(e,t){if(this._indexes=[],this._horizlines=new Map,this._vertlines=new Map,this._lines=new Map,this._hlines=new Map,this._textmarks=new Map,this._shapemarks=new Map,this._backgrounds=new Map,this._polygons=new Map,this._trendchannels=new Map,this._hhists=new Map,this._dwglabels=new Map,this._dwglines=new Map,this._dwgpolylines=new Map,this._dwgboxes=new Map,this._dwgtables=new Map,this._dwgtablecells=new Map,this._dwglinefills=new Map,this._tpos=new Map,this._tpoBlockSets=new Map,this._tpoLevelGroups=new Map,this._tpoVolumeRows=new Map,this._logs=new Map,this._performance=new Map,this._footprints=new Map,"data"===e){const e=t;this._indexes=e.indexes,this._vertlines=C(e.vertlines,this._indexes,o.materializeVertLine),this._horizlines=C(e.horizlines,this._indexes,s.materializeHorizLine),this._polygons=C(e.polygons,this._indexes,a.materializePolygon),this._hhists=C(e.hhists,this._indexes,r.materializeHHist),this._backgrounds=C(e.backgrounds,this._indexes,l.materializeBackground),this._lines=C(e.lines,this._indexes,c.materializeLine),this._hlines=C(e.hlines,this._indexes,d.materializeLevel),this._textmarks=C(e.textmarks,this._indexes,u.materializeTextMark),this._shapemarks=C(e.shapemarks,this._indexes,h.materializeShapeMark),this._trendchannels=C(e.trendchannels,this._indexes,p.materializeTrendChannel),this._dwglabels=C(e.dwglabels,this._indexes,m.materializeDwgLabel),this._dwglines=C(e.dwglines,this._indexes,_.materializeDwgLine),this._dwgpolylines=C(e.dwgpolylines,this._indexes,x.materializeDwgPolyline),this._dwgboxes=C(e.dwgboxes,this._indexes,g.materializeDwgBox),this._dwgtables=C(e.dwgtables,this._indexes,I.materializeDwgTable),this._dwgtablecells=C(e.dwgtablecells,this._indexes,I.materializeDwgTableCell),this._dwglinefills=C(e.dwglinefills,this._indexes,f.materializeDwgLineFill),this._tpos=C(e.tpos,this._indexes,w.materializeTpo),this._tpoBlockSets=C(e.tpoBlockSets,this._indexes,y.materializeTpoBlockSet),this._tpoBlockSetsByStyleIdAndTpoId=(0,D.setsByStyleIdAndKey)(this._tpoBlockSets,(e=>e.tpoId)),this._tpoVolumeRowsByStyleIdAndTpoId=(0,D.setsByStyleIdAndKey)(this._tpoVolumeRows,(e=>e.tpoId)),this._tpoLevelGroups=C(e.tpoLevels,this._indexes,T.materializeTpoLevelGroup),this._tpoVolumeRows=C(e.tpoVolumeRows,this._indexes,v.materializeTpoVolumeRow),this._footprints=C(e.footprints,this._indexes,b.materializeVolumeFootprint)}else if("state"===e){const e=t;this._indexes=e.indexes||[],this._vertlines=S(e.vertlines,this._indexes,o.materializeVertLine),this._horizlines=S(e.horizlines,this._indexes,s.materializeHorizLine),this._polygons=S(e.polygons,this._indexes,a.materializePolygon),this._hhists=S(e.hhists,this._indexes,r.materializeHHist),this._backgrounds=S(e.backgrounds,this._indexes,l.materializeBackground),
this._lines=S(e.lines,this._indexes,c.materializeLine),this._hlines=S(e.hlines,this._indexes,d.materializeLevel),this._textmarks=S(e.textmarks,this._indexes,u.materializeTextMark),this._shapemarks=S(e.shapemarks,this._indexes,h.materializeShapeMark),this._trendchannels=S(e.trendchannels,this._indexes,p.materializeTrendChannel),this._dwglabels=S(e.dwglabels,this._indexes,m.materializeDwgLabel),this._dwglines=S(e.dwglines,this._indexes,_.materializeDwgLine),this._dwgpolylines=S(e.dwgpolylines,this._indexes,x.materializeDwgPolyline),this._dwgboxes=S(e.dwgboxes,this._indexes,g.materializeDwgBox),this._dwgtables=S(e.dwgtables,this._indexes,I.materializeDwgTable),this._dwgtablecells=S(e.dwgtablecells,this._indexes,I.materializeDwgTableCell),this._dwglinefills=S(e.dwglinefills,this._indexes,f.materializeDwgLineFill),this._tpos=S(e.tpos,this._indexes,w.materializeTpo),this._tpoBlockSets=S(e.tpoBlockSets,this._indexes,y.materializeTpoBlockSet),this._tpoLevelGroups=S(e.tpoLevels,this._indexes,T.materializeTpoLevelGroup),this._tpoVolumeRows=S(e.tpoVolumeRows,this._indexes,v.materializeTpoVolumeRow)}this._hhistsByTimePointIndex=(0,B.splitHHistsByTimePointIndex)(this._hhists)}horizlines(){return this._horizlines}vertlines(){return this._vertlines}lines(){return this._lines}hlines(){return this._hlines}textmarks(){return this._textmarks}shapemarks(){return this._shapemarks}backgrounds(){return this._backgrounds}polygons(){return this._polygons}trendchannels(){return this._trendchannels}hhists(){return this._hhists}dwglabels(){return this._dwglabels}dwglines(){return this._dwglines}dwgpolylines(){return this._dwgpolylines}dwgboxes(){return this._dwgboxes}dwgtables(){return this._dwgtables}dwgtablecells(){return this._dwgtablecells}dwglinefills(){return this._dwglinefills}tpos(){return this._tpos}tpoBlockSets(){return this._tpoBlockSets}tpoLevels(){return this._tpoLevelGroups}tpoBlockSetsByStyleAndTpoId(e,t){var i;return null===(i=this._tpoBlockSetsByStyleIdAndTpoId)||void 0===i?void 0:i.get(e,t)}tpoVolumeRows(){return this._tpoVolumeRows}tpoVolumeRowByStyleAndTpoId(e,t){var i;return null===(i=this._tpoVolumeRowsByStyleIdAndTpoId)||void 0===i?void 0:i.get(e,t)}logs(){return this._logs}performance(){return this._performance}footprints(){return this._footprints}hhistsByTimePointIndex(){return this._hhistsByTimePointIndex}}function C(e,t,i){const n=new Map;return e.forEach(((e,s)=>{const o=n.get(s)||new Set;e.forEach((e=>{const n=i(e,t);null!==n&&o.add(n)})),n.set(s,o)})),n}function S(e,t,i){const n=new Map;if(void 0===e)return n;for(const s of e){const e=s.styleId,o=n.get(e)||new Set;s.data.forEach((e=>{const n=i(e,t);null!==n&&o.add(n)})),n.set(e,o)}return n}function k(e,t,i,n,s,o){const r=[];return e.forEach(((e,a)=>{e.forEach((e=>{(null===s||n(e,s))&&function(e,t,i){let n=null;for(const i of e)i.styleId===t&&(n=i);null===n&&(n={styleId:t,data:[]},e.push(n)),n.data.push(i)}(r,a,o(e,t(e),i))}))})),r.length>0?r:void 0}function L(){return new P}function z(e){return new P("state",e)}function E(e,t){return!0}function N(e,t){
const i=function(e){const t=new Set;e.horizlines().forEach(((e,i)=>{e.forEach((e=>{t.add(e.startIndex),t.add(e.endIndex)}))})),e.vertlines().forEach(((e,i)=>{e.forEach((e=>{t.add(e.index)}))})),e.lines().forEach(((e,i)=>{e.forEach((e=>{t.add(e.startIndex),t.add(e.endIndex)}))})),e.textmarks().forEach(((e,i)=>{e.forEach((e=>{t.add(e.time)}))})),e.shapemarks().forEach(((e,i)=>{e.forEach((e=>{t.add(e.time)}))})),e.backgrounds().forEach(((e,i)=>{e.forEach((e=>{t.add(null!==e.start?e.start:n.INVALID_TIME_POINT_INDEX),t.add(e.stop)}))})),e.polygons().forEach(((e,i)=>{e.forEach((e=>{e.points.forEach((e=>{t.add(e.index)}))}))})),e.trendchannels().forEach(((e,i)=>{e.forEach((e=>{t.add(e.startIndex),t.add(e.endIndex)}))})),e.hhists().forEach(((e,i)=>{e.forEach((e=>{t.add(e.firstBarTime),t.add(e.lastBarTime)}))})),e.dwglabels().forEach(((e,i)=>{e.forEach((e=>{t.add(e.x)}))})),e.dwglines().forEach(((e,i)=>{e.forEach((e=>{var i,s;t.add(null!==(i=e.x1)&&void 0!==i?i:n.INVALID_TIME_POINT_INDEX),t.add(null!==(s=e.x2)&&void 0!==s?s:n.INVALID_TIME_POINT_INDEX)}))})),e.dwgpolylines().forEach(((e,i)=>{e.forEach((e=>{var i;for(const s of e.points)t.add(null!==(i=s.x)&&void 0!==i?i:n.INVALID_TIME_POINT_INDEX)}))})),e.dwgboxes().forEach(((e,i)=>{e.forEach((e=>{var i,s;t.add(null!==(i=e.left)&&void 0!==i?i:n.INVALID_TIME_POINT_INDEX),t.add(null!==(s=e.right)&&void 0!==s?s:n.INVALID_TIME_POINT_INDEX)}))})),e.tpos().forEach(((e,i)=>{e.forEach((e=>{t.add(e.firstBarTime),t.add(e.lastBarTime)}))})),e.footprints().forEach((e=>{e.forEach((e=>{t.add(e.index)}))}));const i=Array.from(t);return i.sort(((e,t)=>e-t)),i}(e),B={indexes:i};let D=0;const P=()=>++D,C=e=>e.id;return B.vertlines=k(e.vertlines(),P,i,o.isVertLineInBarsRange,t,o.dematerializeVertLine),B.horizlines=k(e.horizlines(),P,i,s.isHorizLineInBarsRange,t,s.dematerializeHorizLine),B.polygons=k(e.polygons(),P,i,a.isPolygonInBarsRange,t,a.dematerializePolygon),B.hhists=k(e.hhists(),P,i,r.isHHistInBarsRange,t,r.dematerializeHHist),B.backgrounds=k(e.backgrounds(),P,i,l.isBackgroundInBarsRange,t,l.dematerializeBackground),B.lines=k(e.lines(),P,i,c.isLineInBarsRange,t,c.dematerializeLine),B.hlines=k(e.hlines(),P,i,E,t,d.dematerializeLevel),B.textmarks=k(e.textmarks(),P,i,u.isTextMarkInBarsRange,t,u.dematerializeTextMark),B.shapemarks=k(e.shapemarks(),P,i,h.isShapeMarkInBarsRange,t,h.dematerializeShapeMark),B.trendchannels=k(e.trendchannels(),P,i,p.isTrendChannelInBarsRange,t,p.dematerializeTrendChannel),B.dwglabels=k(e.dwglabels(),P,i,m.isDwgLabelInBarsRange,t,m.dematerializeDwgLabel),B.dwglines=k(e.dwglines(),C,i,_.isDwgLineInBarsRange,t,_.dematerializeDwgLine),B.dwgpolylines=k(e.dwgpolylines(),C,i,x.isDwgPolylineInBarsRange,t,x.dematerializeDwgPolyline),B.dwgboxes=k(e.dwgboxes(),P,i,g.isDwgBoxInBarsRange,t,g.dematerializeDwgBox),B.dwgtables=k(e.dwgtables(),C,i,E,t,I.dematerializeDwgTable),B.dwgtablecells=k(e.dwgtablecells(),P,i,E,t,I.dematerializeDwgTableCell),B.dwglinefills=k(e.dwglinefills(),P,i,E,t,f.dematerializeDwgLineFill),B.tpos=k(e.tpos(),C,i,E,t,w.dematerializeTpo),
B.tpoBlockSets=k(e.tpoBlockSets(),P,i,E,t,y.dematerializeTpoBlockSet),B.tpoLevels=k(e.tpoLevels(),P,i,E,t,T.dematerializeTpoLevelGroup),B.tpoVolumeRows=k(e.tpoVolumeRows(),P,i,E,t,v.dematerializeTpoVolumeRow),B.footprints=k(e.footprints(),P,i,E,t,b.dematerializeVolumeFootprint),B}},735758:(e,t,i)=>{function n(e,t){return new s(e,t)}i.d(t,{setsByStyleIdAndKey:()=>n});class s{constructor(e,t){this._setsByStyleIdAndKey=new Map,this._observableCollections=e,this._keyGetter=t}get(e,t){const i=this._observableCollections.get(e);if(!i)return;let n=this._setsByStyleIdAndKey.get(e);if(!n){n=new Map,this._setsByStyleIdAndKey.set(e,n);for(const e of i)this._addPrimitiveToSet(n,e);"cleared"in i&&(i.cleared().subscribe(this,this._clearSetsByKey.bind(this,n)),i.changed().subscribe(this,this._handleCollectionChanges.bind(this,n)))}return n.get(t)}_addPrimitiveToSet(e,t){const i=this._keyGetter(t);let n=e.get(i);n||(n=new Set,e.set(i,n)),n.add(t)}_clearSetsByKey(e){e.clear()}_handleCollectionChanges(e,t){var i;for(const n of t.removed)null===(i=e.get(this._keyGetter(n)))||void 0===i||i.delete(n);for(const i of t.created)this._addPrimitiveToSet(e,i)}}},590713:(e,t,i)=>{i.d(t,{isStudyGraphicsEmpty:()=>o,primitiveNames:()=>n,primitivesZOrders:()=>s,splitHHistsByTimePointIndex:()=>r});const n=["horizlines","vertlines","lines","hlines","textmarks","shapemarks","backgrounds","polygons","trendchannels","hhists","dwglabels","dwglines","dwgpolylines","dwgboxes","dwgtables","dwgtablecells","dwglinefills","tpos","tpoBlockSets","tpoLevels","tpoVolumeRows","logs","performance","footprints"],s=new Map([["logs",-4],["performance",-4],["polygons",-4],["trendchannels",-3],["textmarks",-2],["shapemarks",-2],["backgrounds",-1],["footprints",1],["hlines",1],["horizlines",1],["hhists",1],["dwglinefills",2],["vertlines",3],["lines",3],["dwglines",3],["dwgpolylines",3],["dwgboxes",4],["dwglabels",5],["dwgtables",6],["dwgtablecells",6],["tpos",7],["tpoBlockSets",7],["tpoLevels",7],["tpoVolumeRows",7]]);function o(e){return!n.some((t=>{const i=e[t]();for(const[,e]of i)if(e.size>0)return!0;return!1}))}function r(e){const t=new Map;return e.forEach(((e,i)=>{e.forEach((e=>{const n={...e,styleId:i},s=e.firstBarTime;let o=t.get(s);void 0===o&&(o=new Set,t.set(s,o)),o.add(n)}))})),t}},593885:(e,t,i)=>{i.d(t,{TextMarkType:()=>n,containsTextMarkTimePointIndexes:()=>a,dematerializeTextMark:()=>d,isTextMarkInBarsRange:()=>c,materializeTextMark:()=>l});var n,s,o=i(732149),r=i(387963);!function(e){e.Triangle="triangle",e.Rectangle="rectangle"}(n||(n={})),function(e){e.Verdana="Verdana",e.CourierNew="Courier New",e.TimesNewRoman="Times New Roman",e.Arial="Arial"}(s||(s={}));const a=!0;function l(e,t){if(e.time>=t.length)return null;const i=t[e.time];return i===o.INVALID_TIME_POINT_INDEX?null:{time:i,offset:e.offset,text:e.text,price:e.price}}function d(e,t,i){const n=(0,r.ensureTimePointIndexIndex)(i.indexOf(e.time));return{id:t,...e,time:n}}function c(e,t){var i;return t.contains(e.time+(null!==(i=e.offset)&&void 0!==i?i:0))}},952499:(e,t,i)=>{i.d(t,{
containsTpoBlockSetTimePointIndexes:()=>n,dematerializeTpoBlockSet:()=>o,materializeTpoBlockSet:()=>s});const n=!1;function s(e,t){return{tpoId:e.tpoId,blocks:e.blocks,rowIndex:e.rowIndex}}function o(e,t,i){return{id:t,tpoId:e.tpoId,blocks:e.blocks,rowIndex:e.rowIndex}}},583884:(e,t,i)=>{i.d(t,{containsTpoLevelGroupTimePointIndexes:()=>n,dematerializeTpoLevelGroup:()=>o,materializeTpoLevelGroup:()=>s});const n=!1;function s(e,t){return{tpoId:e.tpoId,tpoPocIndex:e.tpoPocIndex,tpoValIndex:e.tpoValIndex,tpoVahIndex:e.tpoVahIndex,tpoMidpointIndex:e.tpoMidpointIndex,volumePocIndex:e.volumePocIndex,volumeValIndex:e.volumeValIndex,volumeVahIndex:e.volumeVahIndex}}function o(e,t,i){return{id:t,tpoId:e.tpoId,tpoPocIndex:e.tpoPocIndex,tpoValIndex:e.tpoValIndex,tpoVahIndex:e.tpoVahIndex,tpoMidpointIndex:e.tpoMidpointIndex,volumePocIndex:e.volumePocIndex,volumeValIndex:e.volumeValIndex,volumeVahIndex:e.volumeVahIndex}}},686242:(e,t,i)=>{i.d(t,{containsTpoVolumeRowTimePointIndexes:()=>n,dematerializeTpoVolumeRow:()=>o,materializeTpoVolumeRow:()=>s});const n=!1;function s(e,t){return{tpoId:e.tpoId,rowIndex:e.rowIndex,volume:e.volume}}function o(e,t,i){return{id:t,tpoId:e.tpoId,rowIndex:e.rowIndex,volume:e.volume}}},755470:(e,t,i)=>{i.d(t,{containsTpoTimePointIndexes:()=>r,dematerializeTpo:()=>l,materializeTpo:()=>a});var n=i(650151),s=i(732149),o=i(387963);const r=!0;function a(e,t){if(e.firstBarTime>=t.length||e.lastBarTime>=t.length)return null;const i=t[e.firstBarTime],o=t[e.lastBarTime];return i===s.INVALID_TIME_POINT_INDEX||o===s.INVALID_TIME_POINT_INDEX?null:((0,n.assert)(i<=o,"firstBarTime should not exceed lastBarTime"),{id:e.id,firstBarTime:i,lastBarTime:o,priceRange:e.priceRange})}function l(e,t,i){return{id:t,firstBarTime:(0,o.ensureTimePointIndexIndex)(i.indexOf(e.firstBarTime)),lastBarTime:(0,o.ensureTimePointIndexIndex)(i.indexOf(e.lastBarTime)),priceRange:e.priceRange}}},180857:(e,t,i)=>{i.d(t,{containsTrendChannelTimePointIndexes:()=>r,dematerializeTrendChannel:()=>l,isTrendChannelInBarsRange:()=>d,materializeTrendChannel:()=>a});var n=i(650151),s=i(732149),o=i(387963);const r=!0;function a(e,t){if(e.startIndex>=t.length||e.endIndex>=t.length)return null;const i=t[e.startIndex],o=t[e.endIndex];return i===s.INVALID_TIME_POINT_INDEX||o===s.INVALID_TIME_POINT_INDEX?null:((0,n.assert)(i<=o,"startIndex should not exceed endIndex"),{startIndex:i,endIndex:o,extendLeft:e.extendLeft,extendRight:e.extendRight,startHighPrice:e.startHighPrice,startLowPrice:e.startLowPrice,endHighPrice:e.endHighPrice,transparency:e.transparency})}function l(e,t,i){const n=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.startIndex)),s=(0,o.ensureTimePointIndexIndex)(i.indexOf(e.endIndex));return{id:t,...e,startIndex:n,endIndex:s}}function d(e,t){const i=Math.min(e.startIndex,e.endIndex),n=Math.max(e.startIndex,e.endIndex);if(t.contains(i)||t.contains(n)||i<t.firstBar()&&n>t.lastBar())return!0;const s=e.startIndex<e.endIndex?e.extendLeft:e.extendRight,o=e.startIndex<e.endIndex?e.extendRight:e.extendLeft;return n<t.firstBar()&&o||i>t.lastBar()&&s}},
329081:(e,t,i)=>{i.d(t,{containsVertLineTimePointIndexes:()=>o,dematerializeVertLine:()=>a,isVertLineInBarsRange:()=>l,materializeVertLine:()=>r});var n=i(732149),s=i(387963);const o=!0;function r(e,t){if(e.index>=t.length)return null;const i=t[e.index];return i===n.INVALID_TIME_POINT_INDEX?null:{startPrice:e.startPrice,endPrice:e.endPrice,index:i,extendTop:e.extendTop,extendBottom:e.extendBottom}}function a(e,t,i){const n=(0,s.ensureTimePointIndexIndex)(i.indexOf(e.index));return{id:t,...e,index:n}}function l(e,t){return t.contains(e.index)}},138839:(e,t,i)=>{i.d(t,{VolumeFootprintTypeValues:()=>n,containsFootprintTimePointIndexes:()=>r,dematerializeVolumeFootprint:()=>l,materializeVolumeFootprint:()=>a});var n,s=i(732149),o=i(387963);!function(e){e.BuyAndSell="Buy and sell",e.Delta="Delta",e.Total="Total"}(n||(n={}));const r=!0;function a(e,t){if(e.index>=t.length)return null;let i=t[e.index];return i===s.INVALID_TIME_POINT_INDEX&&(i=null),null===i?null:{id:e.id,index:i,poc:e.poc,val:e.val,vah:e.vah,levels:e.levels}}function l(e,t,i){var n;return{id:t,index:(0,o.ensureTimePointIndexIndex)(i.indexOf(null!==(n=e.index)&&void 0!==n?n:s.INVALID_TIME_POINT_INDEX)),poc:e.poc,val:e.val,vah:e.vah,levels:e.levels}}},405721:(e,t,i)=>{i.r(t),i.d(t,{StudyDataSource:()=>p});var n=i(650151),s=i(707957),o=i(195447),r=i(459685),a=i(173220),l=i(989709),d=i(700534),c=i(799567);const h=(0,i(201089).getLogger)("Chart.StudyDataSource");var u;!function(e){e[e.Idle=0]="Idle",e[e.AwaitingConnection=1]="AwaitingConnection",e[e.AwaitingParent=2]="AwaitingParent",e[e.AwaitingFirstDataUpdate=3]="AwaitingFirstDataUpdate",e[e.Active=4]="Active"}(u||(u={}));class p{constructor(e,t,i,n){this._inputs=null,this._status=u.Idle,this._studyId=null,this._turnaroundCounter=1,this._studyStatus={type:c.StudyStatusType.Undefined},this._studyStatusChanged=new s.Delegate,this._dataCleared=new s.Delegate,this._dataUpdated=new s.Delegate,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=e,this._metaInfo=n,this._seriesSource=t,this._turnaroundPrefix=i,this._plots=new o.PlotList((0,l.studyPlotFunctionMap)(n),l.studyEmptyPlotValuePredicate),this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged),this._graphics=new d.LiveStudyGraphics(n.graphics)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged),this._seriesSource.dataEvents().created().unsubscribeAll(this)}metaInfo(){return this._metaInfo}inputs(){return this._inputs}setInputs(e){this._inputs=e,null!==this._studyId&&(this._turnaroundCounter++,this._onStudyStatusChangedTo({type:c.StudyStatusType.Undefined}),this._gateway.modifyStudy(this._studyId,this._turnaround(),e,this._onMessage.bind(this)),this._status===u.Active&&this._changeStatusTo(u.AwaitingFirstDataUpdate))}isStarted(){return this._status!==u.Idle}isActive(){return this._status===u.Active}start(){this.isStarted()?h.logNormal("start: data source is already started, nothing to do"):((0,
n.assert)(null!==this._inputs,"Inputs should be defined when starting a study data source"),this._gateway.isConnected().value()?this._createStudy():this._changeStatusTo(u.AwaitingConnection))}stop(){this.isStarted()?(null!==this._studyId&&(this._gateway.removeStudy(this._studyId),this._studyId=null,this._onStudyStatusChangedTo({type:c.StudyStatusType.Undefined})),this._changeStatusTo(u.Idle)):h.logNormal("stop: data source is already stopped, nothing to do")}studyId(){return this._studyId}studyStatus(){return this._studyStatus}studyStatusChanged(){return this._studyStatusChanged}plots(){return this._plots}graphics(){return this._graphics}clearData(){this._plots.clear(),this._graphics.clear(),this._dataCleared.fire()}stopAndStealData(){(0,n.assert)(this._status===u.Active,"Couldn't steal data from non-active data source"),this.stop();const e=this._plots,t=this._graphics.extract();return this._plots=new o.PlotList((0,l.studyPlotFunctionMap)(this._metaInfo),l.studyEmptyPlotValuePredicate),{plots:e,graphics:t}}dataCleared(){return this._dataCleared}dataUpdated(){return this._dataUpdated}moveData(e){this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>{this._plots.move(e)}))}pendingUpdatesReady(){return this._ongoingDataUpdate}_createStudyError(e){return{type:c.StudyStatusType.Error,errorDescription:this._getStudyErrorDescription(e)}}_getStudyErrorDescription(e){return"string"==typeof e?{error:e.split(":",2)[0]}:e}_changeStatusTo(e){(0,n.assert)(this._status!==e,"Source and destination status should be distinct"),h.logNormal(`Status changed from ${u[this._status]} to ${u[e]}`),this._status=e}_createStudy(){const e=this._seriesSource.instanceId();null!==e?this._createStudyUsingParentId(e):(this._changeStatusTo(u.AwaitingParent),this._seriesSource.dataEvents().created().subscribe(this,this._onSeriesCreated,!0))}_createStudyUsingParentId(e){(0,n.assert)(this._status!==u.Active,'Status should not be "Active" when creating a study'),(0,n.assert)(this._studyStatus.type===c.StudyStatusType.Undefined,'Study status should be "Undefined" when creating a study'),(0,n.assert)(null===this._studyId,"Study id should be empty when creating a study"),this._studyId=(0,a.makeNextStudyId)(),this._gateway.createStudy(this._studyId,this._turnaround(),e,this._metaInfo.fullId+("tv-basicstudies"===this._metaInfo.packageId?"":"!"),(0,n.ensureNotNull)(this._inputs),this._onMessage.bind(this)),this._changeStatusTo(u.AwaitingFirstDataUpdate)}_onGatewayIsConnectedChanged(e){e?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===u.AwaitingConnection&&this._createStudy()}_onGatewayDisconnected(){this._status!==u.Idle&&this._status!==u.AwaitingConnection&&(this._studyId=null,this._changeStatusTo(u.AwaitingConnection),this._studyStatus.type!==c.StudyStatusType.Undefined&&this._onStudyStatusChangedTo({type:c.StudyStatusType.Undefined})),this._turnaroundCounter=1}_onSeriesCreated(){this._status===u.AwaitingParent&&this._createStudyUsingParentId((0,n.ensure)(this._seriesSource.instanceId()))}
_onStudyStatusChangedTo(e){const t=this._studyStatus;this._studyStatus=e,h.logNormal(`Study status type changed from ${c.StudyStatusType[t.type]} to ${c.StudyStatusType[e.type]}`),this._studyStatusChanged.fire(t,e)}_onMessage(e){if("data_update"===e.method){const{customId:t,turnaround:i,plots:s,nonseries:o}=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onDataUpdate(s,(0,n.ensureDefined)(o))}else if("study_loading"===e.method){const[t,i,n]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyLoading(n)}else if("study_completed"===e.method){const[t,i,n]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyCompleted(n)}else if("study_error"===e.method){const[t,i,n,s,o]=e.params;t===this._studyId&&this._checkTurnaround(i)&&this._onStudyError(n,s,o)}else"clear_data"===e.method&&this._checkTurnaround(e.params.turnaround)&&this.clearData()}_onDataUpdate(e,t){const i=(0,r.unpackNonSeriesData)(t.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>i),(()=>i)).then(this._onDataUnpacked.bind(this,e,t.indexes)),this._ongoingDataUpdate}_onDataUnpacked(e,t,i){this._status!==u.Idle&&(this._status===u.AwaitingFirstDataUpdate&&(this._changeStatusTo(u.Active),this.clearData()),this._mergePlots(e),null!==i&&(i.indexes_replace?((0,n.assert)("nochange"!==t),this._graphics.replaceIndexesTo(t)):("nochange"!==t&&this._graphics.replaceIndexesTo(t),void 0!==i.graphicsCmds&&this._graphics.processCommands(i.graphicsCmds))),this._dataUpdated.fire(e,i,t))}_onStudyLoading(e){this._onStudyStatusChangedTo({type:c.StudyStatusType.Loading,startTime:Date.now()})}_onStudyError(e,t,i){this.clearData(),this._onStudyStatusChangedTo(this._createStudyError(e))}_onStudyCompleted(e){this._onStudyStatusChangedTo({type:c.StudyStatusType.Completed})}_mergePlots(e){this._plots.merge(e)}_turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}_checkTurnaround(e){const t=this._turnaround();return e===t||e===this._seriesSource.turnaround()||e===`${this._seriesSource.turnaround()}_${t}`}}},989709:(e,t,i)=>{function n(e){const t=new Map;return e.plots.forEach(((e,i)=>{t.set(e.id,(e=>e[i+1]))})),t}function s(e,t){return null==e[t]}i.d(t,{studyEmptyPlotValuePredicate:()=>s,studyPlotFunctionMap:()=>n})}}]);