"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[44581],{855611:(e,t,i)=>{i.d(t,{FormattersSerializer:()=>u});var n=i(650151),r=i(402084),s=i(943994),o=i(541346);class a{constructor(e){this.type="quoteSessionPrice",this.reset(e)}state(){return this._priceFormatter.state()}reset(e){this._priceFormatter=e||new r.PriceFormatter(100,1,!1)}update(e,t){const i=null!=t.pricescale||null!=t.minmov||null!=t.fractional||null!=t.minmove2,n=null!=e.pricescale&&null!=e.minmov&&null!=e.fractional&&null!=e.minmove2;i&&n&&(this._priceFormatter=new r.PriceFormatter(e.pricescale,e.minmov,e.fractional||!1,e.minmove2))}format(e,t,i){return this._priceFormatter.format(e,t,i)}hasForexAdditionalPrecision(){return this._priceFormatter.hasForexAdditionalPrecision()}static serialize(e){return e.state()}static deserialize(e){const t=new r.PriceFormatter(e.priceScale,e.minMove,e.fractional,e.minMove2);return new a(t)}}const l={price:r.PriceFormatter,volume:s.VolumeFormatter,percentage:o.PercentageFormatter,quoteSessionPrice:a};var u;!function(e){function t(e){return(0,n.ensureDefined)(l[e.type]).deserialize(e.state)}e.serialize=function(e){const t=(0,n.ensureDefined)(l[e.type]);return{type:e.type,state:t.serialize(e)}},e.deserialize=t,e.safeDeserialize=function(e){try{return t(e)}catch(e){return null}}}(u||(u={}))},9027:(e,t,i)=>{i.d(t,{patchSourceState:()=>r});var n=i(444372);function r(e){const t={palettes:{},inputs:[{defval:2,id:"upper diviation",max:500,min:-500,name:n.t(null,void 0,i(572894)),type:"integer"},{defval:-2,id:"lower diviation",max:500,min:-500,name:n.t(null,void 0,i(696882)),type:"integer"},{defval:!0,id:"use upper diviation",name:n.t(null,void 0,i(36834)),type:"bool"},{defval:!0,id:"use lower diviation",name:n.t(null,void 0,i(14072)),type:"bool"},{defval:0,id:"first bar time",max:253370764800,min:0,name:n.t(null,void 0,i(312541)),type:"time"},{defval:0,id:"last bar time",max:253370764800,min:0,name:n.t(null,void 0,i(955034)),type:"time"},{defval:"close",id:"source",name:n.t(null,void 0,i(746147)),options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"}],plots:[],graphics:{},defaults:{inputs:{"first bar time":0,"last bar time":0,"lower diviation":-2,source:"close","upper diviation":2,"use lower diviation":!0,"use upper diviation":!0}},_metainfoVersion:6,description:"Regression Trend",id:"RegressionTrend@tv-basicstudies",is_price_study:!0,shortDescription:"Reg Trend",shortId:"RegressionTrend",version:"2",fullId:"RegressionTrend@tv-basicstudies-2",name:"RegressionTrend@tv-basicstudies"};return e.metaInfo||(e.metaInfo=t),e}},173948:(e,t,i)=>{var n=i(922814);function r(e){var t=JSON.stringify(e);return t=t.replace(/'/g,"\\'")}e.exports={formatCallstudyArg:r,prepareCallStudyArgs:function(e,t){var i={};if(t.isTVScript){var s=t.defaults.inputs.text;i.text=n.patchILTemplate(s,t,e)}else for(var o=Object.keys(e),a=o.length-1;a>=0;a--){var l=o[a],u=e[l]?e[l].id:null;u&&e[u]&&(i[u]=e[u])}return r(i)}}},516684:(e,t,i)=>{
var n=i(823127),r=i(345848).trackEvent,s=i(201089).getLogger("Pine.ScriptLib"),o=i(175203).telemetry,a={fast:["delete","get","is_auth_to_get","is_auth_to_write","parse_title","rename","lib_list"],medium:["list","eval_pine_ex","translate_light"],slow:["process_legacy","publish","save","translate","translate_source","gen_alert"]},l=/[l|L]ines? (\d*)/;function u(e){if("object"==typeof e.reason)return e.reason;if(e.reason2)return e.reason2;const t={errors:[],warnings:[]},i=e.result&&e.result.metaInfo;if(i&&void 0!==i.warnings&&i.warnings.forEach((e=>t.warnings.push({message:e}))),e.reason){(Array.isArray(e.reason)?e.reason:e.reason.split("\n")).forEach((e=>{const i=e.match(l),n=i&&i.length&&Number(i[1]),r={message:e};if("number"==typeof n){r.start={line:n,column:0};const e=r.message.split(": ");e.shift(),r.message=e.join(": ")}t.errors.push(r)}))}return t}var d={getPineFacadeUrl:function(){return window.PINE_URL},PINE_FACADE_URL:function(){return window.PINE_URL}};d.safetyGetReason=u,d._pineFacadeAjax=function(e,t,i,r){s.logNormal("Requesting pine facade scripts, url: "+t);var l=function(e,t){for(var i=Object.keys(a),n=0;n<i.length;n++){var r=a[i[n]].filter((function(t){return-1!==e.indexOf(t)}));if(Boolean(r.length))return i[n]}return!1}(t),u=Date.now(),c=r?void 0:{withCredentials:!0};return n.ajax({url:d.PINE_FACADE_URL()+t,type:e,data:i||{},dataType:"json",xhrFields:c}).done((function(){var e=Date.now()-u;o.sendReport("pine",l+"_group_time_frame",{value:e}),o.sendReport("pine",l+"_group_ok"),s.logNormal("Requesting pine facade scripts finished, url: "+t)})).fail((function(){var e=Date.now()-u;o.sendReport("pine",l+"_group_time_frame",{value:e}),o.sendReport("pine",l+"_group_error"),s.logError("Requesting pine facade scripts failed, url: "+t)}))},d._translateScriptAsyncDone=function(e,t){if(t.error)e.reject(d._readableError(t.error));else if(t.success)e.resolve(t.result.metaInfo,u(t));else{var i=t.result?t.result.metaInfo:null;e.reject(u(t),i)}},d._saveScriptAsyncDone=function(e,t){if(t.error)e.reject(d._readableError(t.error));else if(t.success)e.resolve(t.result.metaInfo,u(t));else{var i=t.result?t.result.metaInfo:null;e.resolve(i,u(t))}},d._generateAlertAsyncDone=function(e,t){if(t.error)e.reject(d._readableError(t.error));else if(t.success)e.resolve(t.result.metaInfo,t.result.IL,t.result.inputs||null,t.result.gen_alert_data||null);else{var i=t.result?t.result.metaInfo:null;e.reject(u(t),i)}},d._readableError=function(e,t){return t},d._anyRequestAsyncFail=function(e,t){try{const i=u(JSON.parse(t.responseText));if(i)return e.reject(i)}catch(e){}0===d.PINE_FACADE_URL().indexOf("http")&&s.logError(t.responseText),e.reject(d._readableError(t.status,t.statusText))},d.getPineSourceCode=function(e,t,i){r("Pine","ScriptLib.getPineSourceCode");var s=n.Deferred(),o="?no_4xx="+!!i,a="/get/"+encodeURIComponent(e)+"/"+t+o;return d._pineFacadeAjax("GET",a).done((function(e,t,i){!1===e.success?s.reject(u(e)):s.resolve(e)})).fail((function(e,t,i){d._anyRequestAsyncFail(s,e)})),s.promise()},d.processLegacy=function(e,t){
r("Pine","ScriptLib.processLegacy");var i=n.Deferred(),s=window.user&&window.user.username,o="/process_legacy/"+encodeURIComponent(e)+"/?user_name="+encodeURIComponent(s),a={};return null!=t&&""!==t&&(a.source=t),d._pineFacadeAjax("POST",o,a).done((function(e,t,n){d._translateScriptAsyncDone(i,e)})).fail((function(e,t,n){d._anyRequestAsyncFail(i,e)})),i.promise()},d.generateAlert=function(e){r("Pine","ScriptLib.generateAlert");var t=n.Deferred(),i=window.user&&window.user.username,s="/gen_alert/?user_name="+encodeURIComponent(i),a={alert_info:e},l=Date.now();return d._pineFacadeAjax("POST",s,a).done((function(e,i,n){o.sendReport("alerts","compilation_ok"),d._generateAlertAsyncDone(t,e)})).fail((function(e,i,n){o.sendReport("alerts","compilation_error"),d._anyRequestAsyncFail(t,e)})).always((function(){var e=Date.now()-l;o.sendReport("alerts","compilation_time_frame",{value:e})})),t.promise()},d.scriptUpdater=function(){return window.scriptUpdater},d.requestUserPublishedScripts=function(e,t){if(r("Pine","ScriptLib.requestUserPublishedScripts"),window.is_authenticated){if(t||!d._userPublishedScriptsDfd){d._userPublishedScriptsDfd=n.Deferred();var i=d._userPublishedScriptsDfd;d._pineFacadeAjax("GET","/list?filter=published").done((function(e,t,n){i.resolve(e)})).fail((function(e){d._anyRequestAsyncFail(i,e)}))}i=d._userPublishedScriptsDfd}else i=n.Deferred().resolve([]);return"function"==typeof e&&i.done(e),i.promise()},d.requestInfoForScripts=function(e){return Promise.all([d._pineFacadeAjax("GET","/list?filter=saved"),d._pineFacadeAjax("GET","/list?filter=addon",void 0,!0)]).then((function(t){var i=t[0],n=t[1];return i.concat(n).filter((function(t){return e.includes(t.scriptIdPart)}))}))},d.requestBuiltinAndUserScripts=function(){r("Pine","ScriptLib.requestBuiltinAndUserScripts"),s.logNormal("Request built-in and user scripts");var e,t=window.user&&window.user.username,i={},n=new Promise((function(t,n){e=t,i.reject=n}));return Promise.all([d._pineFacadeAjax("GET","/list?filter=saved&user_name="+encodeURIComponent(t),void 0,!1),d._pineFacadeAjax("GET","/list?filter=standard",void 0,!0)]).then((function(t){s.logNormal("Request built-in and user scripts finished");var i=t[0],n=t[1];e(i.concat(n))})).catch((function(e){s.logWarn("Request built-in and user scripts finished with fail"),d._anyRequestAsyncFail(i,e)})),n},d.requestScriptInfo=function(e){r("Pine","ScriptLib.requestBuiltinAndUserScripts"),s.logNormal("Request public/user script info");var t=n.Deferred();return d._pineFacadeAjax("GET","/get_script_info/?pine_id="+encodeURIComponent(e)).done((function(e){s.logNormal("Request public/user script info finished"),t.resolve(e)})).fail((function(e){s.logWarn("Request public/user script info finished with fail"),d._anyRequestAsyncFail(t,e)})),t.promise()},d.requestCandlestickScripts=function(){var e;r("Pine","ScriptLib.requestCandlestickScripts"),s.logNormal("Request candlestick scripts");var t={},i=new Promise((function(i,n){e=i,t.reject=n}))
;return d._pineFacadeAjax("GET","/list?filter=candlestick",void 0,!0).done((function(t){s.logNormal("Request candlestick scripts finished"),e(t)})).fail((function(e){s.logWarn("Request candlestick scripts finished with fail"),d._anyRequestAsyncFail(t,e)})),i};var c={time:-1/0,request:null};d.requestFundamentalScripts=function(){if(c.time+6e5>Date.now()&&null!==c.request)return s.logNormal("Return fundamentals from cache"),c.request;s.logNormal("Request fundamental scripts");var e=d._pineFacadeAjax("GET","/list?filter=fundamental",void 0,!1);return e.then((function(e){s.logNormal("Request fundamental scripts finished")})),e.fail((function(e){s.logWarn("Request fundamental scripts finished with fail, resetting cache"),c.request=null})),c.time=Date.now(),c.request=Promise.resolve(e.promise()),c.request},d.publishNew=function(e,t){r("Pine","ScriptLib.publishNew");var i=n.Deferred(),s=window.user&&window.user.username,o="/publish/new/?access="+encodeURIComponent(t)+"&user_name="+encodeURIComponent(s),a={source:e};return d._pineFacadeAjax("POST",o,a).done((function(e,t,n){e.success?i.resolve(e):i.reject(u(e))})).fail((function(e,t,n){d._anyRequestAsyncFail(i,e)})),i.promise()},d.publishNext=function(e,t){s.logNormal("ScriptLib.publishNext","pine"),r("Pine","ScriptLib.publishNext");var i=n.Deferred(),o=window.user&&window.user.username,a="/publish/next/"+encodeURIComponent(t)+"?user_name="+encodeURIComponent(o),l={source:e};return d._pineFacadeAjax("POST",a,l).done((function(e,t,n){e.success||i.reject(u(e)),i.resolve(e)})).fail((function(e,t,n){d._anyRequestAsyncFail(i,e)})),i.promise()},d.lightTranslate=function(e,t){return s.logNormal("ScriptLib.lightTranslate","pine"),r("Pine","ScriptLib.lightTranslate"),new Promise((function(i,n){var r=window.user&&window.user.username,s=`/translate_light/?user_name=${encodeURIComponent(r)}`;t&&(s+=`&pine_id=${encodeURIComponent(t)}`);var o={source:e};d._pineFacadeAjax("POST",s,o).done((function(e,t,r){if(e.success)i(e.result);else{var s=e.result&&u(e.result)||u(e);n(s)}})).fail((function(e,t,i){d._anyRequestAsyncFail({reject:n},e)}))}))},d.getLibList=function(e,t,i){return s.logNormal("ScriptLib.getLibList","pine"),r("Pine","ScriptLib.getLibList"),new Promise((function(n,r){var s="/lib_list?lib_id_prefix="+encodeURIComponent(e);t&&(s+="&ignore_cache=true"),i&&(s+="&ignore_case=true"),d._pineFacadeAjax("GET",s).done((function(e,t,i){n(e)})).fail((function(e,t,i){d._anyRequestAsyncFail({reject:r},e)}))}))},d.getExistingLibraryInfo=async function(e){try{const t=await d.getLibList(e+"/last",!0,!0);if(!t.length)return null;const i=t[0];return{scriptIdPart:i.scriptIdPart,chartId:i.chartId,version:i.version}}catch(e){return null}},e.exports=d},819021:(e,t,i)=>{i.d(t,{migrateMetaInfoAndPropState:()=>d});var n=i(650151),r=i(526075),s=i(389137);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"],a=["DoubleTopCP@tv-basicstudies","BullishFlagCP@tv-basicstudies","HeadAndShouldersCP@tv-basicstudies","TripleTopCP@tv-basicstudies"];class l{targetMetaInfoVersion(){return 53}
migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=53,void 0!==t.defaults&&void 0!==t.defaults.inputs&&(o.includes(t.id)||a.includes(t.id)&&Number(t.version)<156)){const e=t.defaults.inputs["Invert Pattern"];i.id=this._getNewIdStudies(t.id,e)}}migratePropState(e){}_getNewIdStudies(e,t){return e.startsWith("WedgeCP")?t?"WedgeFallingCP@tv-basicstudies":"WedgeRisingCP@tv-basicstudies":e.startsWith("PennantCP")?t?"PennantBearishCP@tv-basicstudies":"PennantBullishCP@tv-basicstudies":e.startsWith("DoubleTopCP")&&t?"DoubleBottomCP@tv-basicstudies":e.startsWith("BullishFlagCP")&&t?"BearishFlagCP@tv-basicstudies":e.startsWith("HeadAndShouldersCP")&&t?"HeadAndShouldersInverseCP@tv-basicstudies":e.startsWith("TripleTopCP")&&t?"TripleBottomCP@tv-basicstudies":e}}const u=[new class{targetMetaInfoVersion(){return 47}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=47,!t.defaults||void 0===t.defaults.precision)return void(i.format={type:"inherit"});const n=t.defaults&&t.defaults.precision,r=(0,s.isNumber)(n)?n:parseInt(n);0===r?i.format={type:"volume"}:isFinite(r)?i.format={type:"price",precision:r}:i.format={type:"inherit"},delete t.defaults.precision}migratePropState(e){}},new class{targetMetaInfoVersion(){return 50}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=50,void 0===t.defaults||void 0===t.defaults.ohlcPlots||void 0===t.ohlcPlots)return;const r=t.ohlcPlots,s=t.defaults.ohlcPlots,o=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).ohlcPlots);for(const e of Object.keys(s)){const t=s[e];if("ohlc_candles"===t.plottype){let i=!1;const n=r[e];void 0!==n&&(i=!!n.drawBorder,delete n.drawBorder),o[e]={borderColor:"#000000",drawBorder:i,...t}}}}migratePropState(e){}},new class{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=53,void 0!==t.defaults){if(void 0!==t.defaults.ohlcPlots&&void 0!==t.ohlcPlots){const e=Object.keys(t.ohlcPlots),r=t.defaults.ohlcPlots,s=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).ohlcPlots);for(const t of e){const e=r[t];if(void 0===e||void 0===e.visible)continue;const i=e.visible?15:0;delete e.visible,s[t]={display:i,...e}}}if(void 0!==t.defaults.styles&&void 0!==t.plots){const e=t.plots.map((e=>e.id)),r=t.defaults.styles,s=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).styles);for(const t of e){const e=r[t];if(void 0===e||void 0===e.visible)continue;const i=e.visible?15:0;delete e.visible,s[t]={display:i,...e}}}}}migratePropState(e){if(e.ohlcPlots)for(const t of Object.keys(e.ohlcPlots)){const i=(0,n.ensureDefined)(e.ohlcPlots[t]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}if(e.styles)for(const t of Object.keys(e.styles)){const i=(0,n.ensureDefined)(e.styles[t]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}}}];function d(e,t){const i=r.StudyMetaInfo.versionOf(e),s=e;void 0===s._serverMetaInfoVersion&&(s._serverMetaInfoVersion=i);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"].includes(e.id);u.forEach((r=>{(i<0||i>=r.targetMetaInfoVersion())&&!o||(r.migrateMetaInfo(e),
void 0!==t&&r.migratePropState(t),(0,n.assert)(e._metainfoVersion===r.targetMetaInfoVersion()))}))}u.push(new l),u.sort((function(e,t){return e.targetMetaInfoVersion()-t.targetMetaInfoVersion()}))},826908:(e,t,i)=>{i.r(t),i.d(t,{EXCLUDED_FOR_ALERT_ID_INPUTS:()=>g,collectDepsForAlert:()=>S,dependenciesForAlerts:()=>I,getInputsForAlertId:()=>y,idForAlert:()=>m,patchChildIdInInputs:()=>v,plotsForAlert:()=>_});var n=i(484156),r=i(650151),s=i(62745),o=i(201089),a=i(96080);var l=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},u=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},i=[];for(var n in e)t.call(e,n)&&i.push(n);return i},d=i(827523),c=i(526075),p=i(368135);const f=(0,o.getLogger)("Chart.Study");function v(e,t,i){void 0!==i&&i.forEach((i=>{const n=e[i];"string"==typeof n?e[i]=h(n,t):(0,s.isExtendedInput)(n)&&(0,s.isExtendedInputSource)(n)?n.v=h((0,s.getInputValue)(n),t):f.logError(`Cannot patch source input, its type is not source: ${JSON.stringify(n)}`)}))}function h(e,t){const[i,n]=e.split("$"),r=t.get(i);return r?r+(void 0===n?"":"$"+n):e}const g=["text","pineFeatures"];function y(e){return(0,n.default)(e,g)}function m(e,t,i){return(0,a.hash)(e+function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var i=t.space||"";"number"==typeof i&&(i=Array(i+1).join(" "));var n,r="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},o=t.cmp&&(n=t.cmp,function(e){return function(t,i){var r={key:t,value:e[t]},s={key:i,value:e[i]};return n(r,s)}}),a=[];return function e(t,n,d,c){var p=i?"\n"+new Array(c+1).join(i):"",f=i?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),void 0!==(d=s.call(t,n,d))){if("object"!=typeof d||null===d)return JSON.stringify(d);if(l(d)){for(var v=[],h=0;h<d.length;h++){var g=e(d,h,d[h],c+1)||JSON.stringify(null);v.push(p+i+g)}return"["+v.join(",")+p+"]"}if(-1!==a.indexOf(d)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}a.push(d);var y=u(d).sort(o&&o(d));for(v=[],h=0;h<y.length;h++){var m=e(d,n=y[h],d[n],c+1);if(m){var _=JSON.stringify(n)+f+m;v.push(p+i+_)}}return a.splice(a.indexOf(d),1),"{"+v.join(",")+p+"}"}}({"":e},"",e,0)}(t)+(null!=i?i:"")).toString()}function _(e,t,i){const n=[p.isLinePlot,p.isShapesPlot,p.isCharsPlot,p.isArrowsPlot,p.isOhlcPlot,p.isAlertConditionPlot];return e.plots.map(((e,t)=>({...e,pinePlotIndex:t}))).filter((e=>!(void 0!==i&&!i.includes(e.id))&&n.some((t=>t(e))))).map((i=>{const n={id:i.id,type:i.type,pinePlotIndex:i.pinePlotIndex,offset:t(i.id)};if(e.styles&&void 0!==e.styles[i.id]){const t=(0,r.ensureDefined)((0,r.ensureDefined)(e.styles)[i.id]);n.title=t.title||"",n.text=t.text||""}return(0,p.isOhlcPlot)(i)&&i.target&&e.ohlcPlots&&e.ohlcPlots[i.target]&&(n.ohlcTitle=(0,r.ensureDefined)((0,r.ensureDefined)(e.ohlcPlots)[i.target]).title),n}))}function S(e,t){const i=[],n=new Map;let s;for(let r=e.length-1;r>=0;r--){const o=e[r],a=(0,
d.extractStudyId)(o.metaInfo().id),l=c.StudyMetaInfo.getStudyIdWithLatestVersion(o.metaInfo());s=o.inputsForAlertState();v(s,n,o.metaInfo().inputs.filter((e=>"source"===e.type)).map((e=>e.id)));const u=m(a,o.metaInfo().isTVScript?y(s):s,t);i.push({id:u,study:l,inputs:s}),n.set(o.id(),u)}const o=i.reverse();return{idForAlert:(0,r.ensureDefined)(o[0].id),inputsForAlert:(0,r.ensureDefined)(s),studyDependencies:o}}function I(e,t){return e.map((e=>{const i=e.inputs(),n=e.metaInfo();let r=c.StudyMetaInfo.cutDollarHash(n.fullId);if("tv-scripting"===n.productId){const e=t.findByIdSync({type:"java",studyId:"Script@tv-scripting"});null!==e&&(r=e.fullId)}const s={id:e.sourceId(),study:r,inputs:i,scriptIdPart:void 0,scriptVersion:void 0};return n.pine?{...s,scriptIdPart:n.scriptIdPart,scriptVersion:n.pine.version}:s}))}},388545:(e,t,i)=>{i.d(t,{StudyVersioning:()=>v});var n=i(294142),r=i(650151).assert,s=i(9027).patchSourceState,o=i(516684),a=i(566119).translateScriptAsync2,l=i(854798).Version,u=i(66974),d=i(526075).StudyMetaInfo,c=i(971417).extractPineId,p=i(819021).migrateMetaInfoAndPropState;const f=1e12;class v extends n.StudyVersioningBase{updateMetaInfo(e){if(!e)return e;r(!e.isTVScript,"This method should update only built-in java indicators metaInfo. For Pine indicators use updateMetaInfoAsync");for(var t=null,i=this._studiesMetainfo,n=0;n<i.length;n++)if(i[n].id===e.id){t=i[n];break}return TradingView.clone(t)}updateMetaInfoAsync(e){if(!e)return{sync:!1,result:Promise.reject("No old metaInfo was given")};var t=new d(e),i=d.versionOf(e);if(e.isTVScript&&!e.pine&&i<d.VERSION_PINE_PROTECT_TV_4164){r(TradingView.isExistent(e.scriptIdPart),"scriptIdPart is missing, study "+JSON.stringify(e));var n=e.scriptIdPart,s=new Promise((function(i,r){o.processLegacy(n,e.TVScriptSourceCode).done((function(e){t.removeDefaults();var n=new d(e);n.createDefaults(),p(n),i(n)})).fail((function(e,t){r(e)}))}));return{sync:!1,result:s}}if(e.isTVScript&&e.pine){if((e._serverMetaInfoVersion||i)<d.CURRENT_METAINFO_FORMAT_VERSION){s=a(e.scriptIdPart,e.pine.version).then((function(e){t.removeDefaults();var i=new d(e.metaInfo);return i.createDefaults(),p(i),i}));return{sync:!1,result:s}}return t.createDefaults(),{sync:!0,result:t}}for(var l=null,u=this._studiesMetainfo,c=0;c<u.length;c++)if(u[c].id===e.id){l=u[c];break}return{sync:!0,result:l?TradingView.clone(l):null}}lastVersionOfStudy(e){return this._studiesMetainfo.find((function(t){return t.id===e})).version}updateStudyInputs(e,t,i,r,s){var o=TradingView.clone(r);if(e in this._migrations){var a,u=l.parse(t);if("last"===i){var d=this.lastVersionOfStudy(e);a=l.parse(d)}else a=l.parse(i);o=this._migrations[e].updateInputs(u,a,o)}if(null==s)return o;for(var c in s)c in o||(o[c]=s[c]);for(var c in o)if(!(c in s)){var p=o[c];n.log.logWarn("Extra input detected, studyId="+e+", versionFrom="+t+", inputId="+c+", inputValue="+p+", removing it and continue..."),delete o[c]}return o}updateStudyState(e,t,i){if(null==e||null==t||null==i)return e;if(e=TradingView.clone(e),
!(t.isTVScript||!!t.pine)&&t.version!==i.version){var r=i&&i.defaults.inputs,s=this.updateStudyInputs(t.id,t.version,i.version,e.inputs,r);e.inputs=s}for(var o=0;o<this._clientMigrations.length;++o){s=this._clientMigrations[o].call(this,t,e.inputs);Object.keys(s).length===Object.keys(e.inputs).length?e.inputs=s:n.log.logWarn("StudyVersioning._clientMigrations application returned bad result. Skipping it...")}var a=d.versionOf(t);if(t.isTVScript&&t.TVScriptSourceCode&&a>=12&&a<=26){var l={};for(o=0;o<t.plots.length;++o){var u=t.plots[o],c=i.plots[o];l[u.id]=c.id}var p=Object.keys(e.styles);for(o=0;o<p.length;++o){var f=p[o],v=e.styles[f];delete e.styles[f];var h=l[f];e.styles[h]=v}var g=Object.keys(e.plots);for(o=0;o<g.length;++o){var y=g[o];f=e.plots[y].id;e.plots[y].id=l[f]}}return e}patchPointsBasedStudyState(e){return v._fixInputsMaxValue(e.state,e.metaInfo),"LineToolRegressionTrend"===e.type&&(e=s(e)),e}patchPointsBasedStudyData(e,t){if(!u.isProd())return t;if(!e||!t)return t;var i=TradingView.clone(t);return"VbPFixed@tv-volumebyprice"===e.id&&e.version&&e.version<=4&&v._patchOldVolumeProfiles(0,i),i}patchStudyData(e,t,i,n){if(!u.isProd())return{data:t,nsData:i,indexes:n};var r=TradingView.clone(t),s=TradingView.clone(i),o=TradingView.clone(n);"VbPVisible@tv-volumebyprice"===e.id&&e.version&&e.version<=4&&v._patchOldVolumeProfiles(0,r.graphics),"VbPSessions@tv-volumebyprice"===e.id&&e.version&&e.version<=4&&v._patchOldVolumeProfiles(0,r.graphics);var a=d.versionOf(e);if(e.isTVScript&&e.TVScriptSourceCode&&a>=12&&a<=26){var l=r.columns;r.columns=[];for(var c=0;c<l.length;++c){var p="plot_"+c;r.columns.push(p)}}return{data:r,nsData:s,indexes:o}}static _patchOldVolumeProfiles(e,t){var i=t.hhists[e].data,n=[];for(var r in i)n=n.concat(i[r]);t.hhists[0].data=n}static _fixInputsOrder(e,t){for(var i=d.getOrderedInputIds(t),n=v.splitInputs(e.inputs),r=n.arr,s=n.obj,o=TradingView.merge({},s),a=0;a<i.length;++a){var l=i[a],u=v.findInputKeyById(r,l);if(null!==u){var c=r[u];o[a]=c}}e.inputs=o}static _verifyInputsMaxValue(e){if(e.inputs)for(var t=0;t<e.inputs.length;t++){var i=e.inputs[t];"integer"===i.type&&(i.max&&i.max>1e12&&n.log.logWarn("Bad integer input max value in metaInfo id="+e.id+" title="+e.description))}}static _fixInputsMaxValue(e,t){if(!TradingView.isAbsent(t)){var i=f;if(t.inputs)for(var n=0;n<t.inputs.length;n++){"integer"===(a=t.inputs[n]).type&&(a.max&&a.max>i&&(a.max=i))}if(e&&e.inputs){var r=v.splitInputs(e.inputs),s=r.arr;for(var o in s){var a;"integer"===(a=s[o]).type&&(a.max&&a.max>i&&(a.max=i))}e.inputs=TradingView.merge(r.obj,r.arr)}}}patchPropsStateAndMetaInfo(e,t,i){"Script$BOOKER"!==t.productId||t.alerts||delete e.alerts,v._fixInputsOrder(e,t),v._fixInputsMaxValue(e,t);var n=v.splitInputs(e.inputs);e.inputs=n.obj;var r=d.versionOf(t);r<d.METAINFO_FORMAT_VERSION_SOS_V2&&t.isChildStudy&&(e.isChildStudy=t.isChildStudy)
;if(t.isTVScript&&t.version<60&&("Script$TV_EARNINGS@tv-scripting"!==t.id&&"Script$TV_DIVIDENDS@tv-scripting"!==t.id&&"Script$TV_SPLITS@tv-scripting"!==t.id||delete t.TVScriptSourceCode),"Volume"!==t.id&&"Volume@tv-basicstudies"!==t.id||0!==t.inputs.length||(t.inputs=[{id:"length",type:"integer",defval:20,min:1,max:1e3}],t.plots.push({id:"vol_ma",type:"line"})),"Volume@tv-basicstudies"===t.id&&t.version&&t.version<=46&&void 0===e.styles.vol.transparency&&(e.styles.vol.transparency=e.transparency||87),"PivotPointsStandard@tv-basicstudies"===t.id&&(0===t.inputs.length?(e.inputs={kind:"Traditional",showHistoricalPivots:!0},t.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]):1===t.inputs.length&&(e.inputs={kind:"Traditional"},t.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]),void 0===e._hardCodedDefaultsVersion)){e._hardCodedDefaultsVersion=1;var s=e.color;delete e.color,e.levelsStyle={colors:{P:s,"S1/R1":s,"S2/R2":s,"S3/R3":s,"S4/R4":s,"S5/R5":s}}}"CMF"===t.shortId&&2===t.inputs.length&&(e.inputs={length:e.inputs["length fast"]},t.inputs=t.inputs.splice(0,1),t.inputs[0].id="length"),t.defaults&&void 0===t.defaults.precision&&r<d.VERSION_NEW_STUDY_PRECISION_FORMAT&&(-1!==["Volume@tv-basicstudies","VbPVisible@tv-volumebyprice","VbPSessions@tv-volumebyprice"].indexOf(t.id)?t.defaults.precision=0:t.defaults.precision=4);if(t.version<60)for(var o=["TV_DIVIDENDS","TV_SPLITS","TV_EARNINGS"],a="Script".length,l=0;l<o.length;l++)t.id.startsWith("Script$"+o[l]+"@tv-scripting")&&(t.fullId="ESD"+t.fullId.substring(a),t.id="ESD"+t.id.substring(a),t.name="ESD"+t.name.substring(a),t.shortId="ESD"+t.shortId.substring(a),t.productId="ESD"+t.productId.substring(a));var u={"ESD$TV_EARNINGS@tv-scripting":{fullId:"Earnings@tv-basicstudies-129!",id:"Earnings@tv-basicstudies",name:"Earnings@tv-basicstudies",shortId:"Earnings",productId:"tv-basicstudies"},"ESD$TV_SPLITS@tv-scripting":{fullId:"Splits@tv-basicstudies-129!",id:"Splits@tv-basicstudies",name:"Splits@tv-basicstudies",shortId:"Splits",productId:"tv-basicstudies"},"ESD$TV_DIVIDENDS@tv-scripting":{fullId:"Dividends@tv-basicstudies-129!",id:"Dividends@tv-basicstudies",name:"Dividends@tv-basicstudies",shortId:"Dividends",productId:"tv-basicstudies"}};if(t.id in u&&Object.assign(t,u[t.id]),r<d.VERSION_PINE_PROTECT_TV_4164){var f={"StrategyScript$STD;Consecutive%1Ups/Downs%1Strategy":{pineId:"STD;Consecutive%1Ups%1Downs%1Strategy",className:"StrategyScript"},Script$EDGR_NET_INCOME_FROM_CONTINUING_OPERATIONS_APPLICABLE_TO_COMMON_V2:{pineId:"Script$EDGR_NET_INCOME_FROM_CONTINUING_OPS_APPLICABLE_TO_COMMON_V2",className:"Script"}};if(t.shortId in f){var h=f[t.shortId].className+"$"+f[t.shortId].pineId,g={scriptIdPart:f[t.shortId].pineId,fullId:t.fullId.replace(t.shortId,h),id:t.id.replace(t.shortId,h),name:t.name.replace(t.shortId,h),
shortId:h};TradingView.merge(t,g),TradingView.merge(e,g)}var y=c(t.fullId),m=y&&y.match(/^(USER)(_\d+)(;)(.*)$/);if(m){var _=m[0],S=m[1]+m[3]+m[2]+m[4];g={scriptIdPart:S,fullId:t.fullId.replace(_,S),id:t.id.replace(_,S),name:t.name.replace(_,S),shortId:t.shortId.replace(_,S)};TradingView.merge(t,g),TradingView.merge(e,g)}}if("MA"===t.id){var I=new d({id:"MAExp",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgExp",type:"line"}],palettes:{}}),b=new d({id:"MASimple",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgSimple",type:"line"}],palettes:{}}),P=new d({id:"MAVolumeWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgVolumeWeighted",type:"line"}],palettes:{}}),w=new d({id:"MAWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgWeighted",type:"line"}],palettes:{}});switch(e.inputs.type){case"exp":t=I;break;case"simple":t=b;break;case"weighted":t=w;break;case"volume weighted":t=P}e.styles[t.plots[0].id]=e.styles.MovAvg,delete e.styles.MovAvg,delete e.inputs.type}return i.oldShowStudyLastValueProperty&&(e.oldShowLastValue=e.showLastValue),delete e.showLastValue,delete e.showStudyArguments,p(t,e),{propsState:e,metaInfo:t}}static mergeInputs(e,t){v.mergeInputsArrPart(e,t),v.mergeInputsObjPart(e,t)}static mergeInputsArrPart(e,t){var i=v.splitInputs(t);for(var n in i.arr){var r=v.findInputKeyById(e,i.arr[n].id);r?TradingView.merge(e[r],i.arr[n]):v.appendInputInfoToArr(e,i.arr[n])}}static mergeInputsObjPart(e,t){var i=v.splitInputs(t);TradingView.merge(e,i.obj)}static appendInputInfoToArr(e,t){var i=-1;for(var n in e){var r=parseInt(n,10);isNumber(r)&&(r>i&&(i=r))}e[i+1]=t}static splitInputs(e){var t={},i={};for(var n in e)isNumber(parseInt(n,10))?t[n]=e[n]:i[n]=e[n];return{arr:t,obj:i}}static findInputKeyById(e,t){var i=null;for(var n in e)if(isNumber(parseInt(n,10))&&e[n].id===t){i=n;break}return i}static getInputKeyById(e,t){var i=v.findInputKeyById(e,t);if(!i)throw new Error("Cannot find input with id: "+t);return i}}},782856:(e,t,i)=>{var n;i.d(t,{DataSourceDangerReason:()=>n}),function(e){e.Spread="spread",e.PineRepainting="pine-repainting",e.CryptoCap="cryptocap"}(n||(n={}))},168682:(e,t,i)=>{var n=i(552698).isStudyStateForAlertType,r=i(368135),s=i(29469).generateTitleForGui,o=i(201089).getLogger("Alerts.Band"),a=i(444331),l=i(31341),u=i(918208).lineToolsLocalizedNames;TradingView="object"==typeof i.g?i.g.TradingView:TradingView||{}
;var d={create:function(e){var t,i=e||{},r=i.type;if("MainSeries"===r)t=p;else if(n(r,!0))t=f;else if("Value"===r)t=v;else{if(!/^LineTool.*/i.test(r))return o.logError("Unknown alert band type "+r),null;t=h}return new t(i)}};function c(e){this._band=e||{}}function p(){c.apply(this,arguments)}function f(){c.apply(this,arguments)}function v(){c.apply(this,arguments)}function h(){c.apply(this,arguments)}c.prototype.id=function(){return this._band.id},c.prototype.type=function(){return this._band.type},c.prototype.title=function(){return this._band.title},c.prototype.isTVScript=function(){return this._band.isTVScript},c.prototype.scriptVersion=function(){return this._band.scriptVersion},c.prototype.hasPlots=function(){return this._band.plots&&this._band.plots.length},c.prototype.getActualSymbol=function(){return this._band.actualSymbol},c.prototype.getSymbolString=function(){return this._band.symbolString},c.prototype.getPlotTitle=function(e){return e.title?e.title:r.isOhlcOpenPlot(e)?e.ohlcTitle+" "+i.tf(null,void 0,i(539280)):r.isOhlcHighPlot(e)?e.ohlcTitle+" "+i.tf(null,void 0,i(330777)):r.isOhlcLowPlot(e)?e.ohlcTitle+" "+i.tf(null,void 0,i(608136)):r.isOhlcClosePlot(e)?e.ohlcTitle+" "+i.tf(null,void 0,i(931691)):"vol"===e.id?i.tf(null,void 0,i(101111)):"vol_ma"===e.id?i.tf(null,void 0,i(932998)):"open"===e.id?i.tf(null,void 0,i(539280)):"high"===e.id?i.tf(null,void 0,i(330777)):"low"===e.id?i.tf(null,void 0,i(608136)):"close"===e.id?i.tf(null,void 0,i(931691)):e.id},c.prototype.getPlots=function(e){var t=e||{};if(!this._band.plots||!this._band.plots.length)return this._band.plots;if("inputSelect"===t.format){var i=-1;return this._band.plots.map((function(e){return{value:++i,title:this.getPlotTitle(e)}}),this)}return this._band.plots},c.prototype.hasUsualPlots=function(){var e=this._band.plots;return!e||e.filter(r.isAlertConditionPlot).length<e.length},c.prototype.getInputs=function(){return{}},inherit(p,c),p.prototype.title=function(e){var t=i(59171),n=e||{},r=!!n.withInterval,o=this._band.actualSymbol;return t&&(o=t.shortName(o)),s({symbol:o,interval:r?this._band.interval:void 0,style:this._band.style,inputs:this._band.styleInputs||{},boxSize:this._band.boxSize,reversalAmount:this._band.reversalAmount,sessionDescription:n.sessionDescription})},p.prototype.getInterval=function(){return this._band.interval},p.prototype.getStyle=function(){return this._band.style},p.prototype.getStyleInputs=function(){return this._band.styleInputs},p.prototype.isRangeBasedStyle=function(){return a.isRangeBasedStyle(this._band.style)},p.prototype.isSpread=function(){return this._band.isSpread},p.prototype.sessionId=function(){return this._band.sessionId},p.prototype.sessionDescription=function(){return this._band.sessionDescription},p.prototype.getDividendsAdjustment=function(){return this._band.dividendsAdjustment},p.prototype.getBackAdjustment=function(){return this._band.backAdjustment},p.prototype.getSettlementAsClose=function(){return this._band.settlementAsClose},inherit(f,c),f.prototype.title=function(e){
var t,n,r,s=e||{},o=s.withPlotTitle,a=this._band;return s.short&&a.shortTitle?t=a.shortTitle:a.title?t=a.title:(t=a.shortDescription||"Study",n=[],Object.keys(a.inputs).forEach((function(e){var t=a.inputs[e]&&a.inputs[e].id;t&&!a.inputs[e].isHidden&&void 0!==a.inputs[t]&&n.push(a.inputs[t])})),n.length&&(t+=" ("+n.join(", ")+")")),o&&(r=this.selectedPlot())&&(t+=" "+(r.title||i.tf(null,void 0,i(886950)))),l.isRtl()&&(t=l.forceLTRStr(t)),t},f.prototype.selectedPlot=function(){var e=this._band;return void 0===e.plotIndex?null:this.getPlots().filter((function(t){return t.value===e.plotIndex}))[0]||null},f.prototype.getInputs=function(){return this._band.inputs||{}},f.prototype.isTVLibrary=function(){return this._band.isTVLibrary||!1},f.prototype.scriptIdPart=function(){return this._band.scriptIdPart},inherit(v,c),v.prototype.title=function(e){var t=this._band.value||0;return e.formatter?e.formatter.format(parseFloat(t)):parseFloat(t).toString()},inherit(h,c),h.prototype.title=function(){return u[this._band.type]||this.title()},e.exports.AlertBandAbstract=c,e.exports.AlertBandValue=v,e.exports.AlertBandStudy=f,e.exports.alertBandFactory=d},552698:(e,t,i)=>{var n;function r(e,t){let i="Study"===e||e===n.StudyLineTool||/^study_\w+/.test(e);return t&&(i=i||"StudyStrategy"===e),i}i.r(t),i.d(t,{StateForAlertType:()=>n,isStudyStateForAlertType:()=>r}),function(e){e.MainSeries="MainSeries",e.Study="Study",e.StudyLineTool="StudyLineTool",e.StudyStrategy="StudyStrategy"}(n||(n={}))},103221:(e,t,i)=>{function n(e){let t;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)t=e;else if(e instanceof Date)t=new Date(e.valueOf());else if(Array.isArray(e)){t=[];let i=0;const r=e.length;for(;i<r;i++)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=n(e[i]))}else{t={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=n(e[i]))}return t}i.d(t,{deepCopy:()=>n})}}]);