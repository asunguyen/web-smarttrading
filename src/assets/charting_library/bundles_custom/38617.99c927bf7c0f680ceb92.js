"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[38617],{749028:(e,t,s)=>{s.d(t,{isSignedExchangeAgreement:()=>o,saveExchangeAgreement:()=>a});var i=s(120780),r=s(526698);function a(e){return(0,i.fetch)("/exchange-agreement/",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)}).then((e=>e.ok?e.json():e.json().then((t=>{throw new r.AggregateError((0,r.accumulateErrors)(t.errors,e.status))}))))}const n={};async function o(e){let t="/is-signed-exchange-agreement/";if(e.exchange&&(t+=`?exchange=${e.exchange}`,n[e.exchange]))return n[e.exchange];const s=await(0,i.fetch)(t);if(!s.ok){const e=await s.json();throw Error(e.detail)}const r=await s.json();return e.exchange&&(n[e.exchange]=r),r}},875049:(e,t,s)=>{s.d(t,{default:()=>a});var i=s(345848);const r={filterNamesMap:{script_type:"Indicators and Strategies","script_type-indicators":"Indicators","script_type-strategies":"Strategies",stream:"All Markets","stream-stocks":"Stocks","stream-indices":"Indices","stream-commodities":"Commodities","stream-currencies":"Currencies","stream-bitcoin":"Bitcoin","interval-all":"All Intervals","interval-m":"Short Term","interval-h":"Medium Term","interval-dwm":"Long Term","sort-unmoderated":"Unmoderated","sort-trending":"Trending","sort-discussed":"Most Discussed","sort-viewed":"Most Viewed","sort-agreed":"Most Agreed","sort-suggested":"Suggested","sort-recent":"All Ideas","time-day":"Today","time-week":"This Week","time-month":"This Month","time-all":"All Time","by-everyone":"Everyone","by-following":"Following","by-me":"My Ideas"},goProFeaturesMap:{customIntervals:"Add Custom Interval",intradaySpread:"Inraday Spread",kagiRenko:"Japanese Intraday Chart",alerts:{prefix:"New Alerts Limit",widget:"Widget",chart:"Chart Header"},multipleCharts:"Multiple Charts Layout",savedChartsLimit:"Save Chart Limit",studyLimit:"Studies Limit",multipleWatchLists:{prefix:"Watchlists",new:"Create New List",rename:"Rename List",saveAs:"Save List As"},importWatchlist:"Watchlists Import Watchlist",exportWatchlist:"Watchlists Export Watchlist",BATSExchangePopup:"BATS Exchange Popup",DataQualityPopup:"Data Quality Popup",FreeDelayPopup:"Free Delay Popup",proRTProduct:"Volume Profile",studyOnStudy:"Unlimited Study on Study"},trackFeature:{savedChartsLimit:!0,BATSExchangePopup:!0,FreeDelayPopup:!0,DataQualityPopup:!0,intradaySpread:!0,studyOnStudy:!0},trackGoPro:function(e,t,s){s&&!t&&(t=s,s=null);var a=r.goProFeaturesMap[t];if(a){if(s){if("string"==typeof a)return;a="{0} {1}".format(a.prefix,a[s])}(0,i.trackEvent)(e,a)}}},a=r},405117:(e,t,s)=>{s.r(t),s.d(t,{trackGoProFeature:()=>r});var i=s(875049);function r(e,t){i.default.trackGoPro("Gopro Features",e,t)}},515625:(e,t,s)=>{s.d(t,{MarketStatusModel:()=>u});var i=s(650151),r=s(129025),a=s(44031),n=s(988124),o=s(444331);class l{constructor(e,t){this._utcTime=new r.WatchedValue(null),this._expired=new r.WatchedValue(!1),this._sessionSpec=new r.WatchedValue(null),this._sessionSpecCache=null,this._utcDayStart=new Date(0),this._timeoutId=null,
this._expiredBySymbolInfoTypespecs=!1,this._expiredByQuotesTypespecs=null,this._marketStatusSpawn=e.spawn(),this._quotesUpdate=t,this._quotesUpdate.subscribe(this,this._onQuotesUpdate)}destroy(){this._marketStatusSpawn.destroy(),this._clearTimeoutIfNeeded(),this._quotesUpdate.unsubscribeAll(this)}reset(){this._expiredBySymbolInfoTypespecs=!1,this._expiredByQuotesTypespecs=null,this._utcTime.setValue(null),this._expired.setValue(!1)}utcTime(){return this._utcTime.readonly()}expired(){return this._expired.readonly()}utcDayStart(){return this._utcDayStart}sessionSpec(){return this._sessionSpec.readonly()}setSymbolInfo(e){var t;if(this._clearTimeoutIfNeeded(),null===e||!(0,o.isFuturesContractSymbol)(e)||void 0===e.expiration)return this._utcTime.setValue(null),void this._expired.setValue(!1);null!==this._sessionSpecCache&&this._sessionSpecCache.timezone===e.timezone&&this._sessionSpecCache.session===e.session&&this._sessionSpecCache.corrections===e.corrections&&this._sessionSpecCache.holidays===e.session_holidays||(this._sessionSpecCache={timezone:e.timezone,session:e.session,corrections:e.corrections,holidays:e.session_holidays,spec:new a.SessionSpec(e.timezone,e.session,e.session_holidays,e.corrections)},this._sessionSpec.setValue(null));const s=this._sessionSpecCache.spec;this._utcDayStart=function(e){const t=Math.floor(e/1e4)%1e4,s=Math.floor(e/100)%100-1,i=e%100;return new Date(Date.UTC(t,s,i))}(e.expiration);const i=s.bordersOfDailyBar(this._utcDayStart);if(null===i)return this._utcTime.setValue(null),this._expired.setValue(!1),void this._sessionSpec.setValue(s);const r=(0,n.get_timezone)(e.timezone);this._utcTime.setValue((0,n.cal_to_utc)(r,i.to)+1e3),this._sessionSpec.setValue(s),this._expiredBySymbolInfoTypespecs=Boolean(null===(t=e.typespecs)||void 0===t?void 0:t.includes("expired")),this._updateExpired()}_updateExpired(){this._clearTimeoutIfNeeded();const e=this._utcTime.value();if(null===e)return;if(this._expiredByQuotesTypespecs||this._expiredBySymbolInfoTypespecs)return void this._expired.setValue(!0);const t=window.ChartApiInstance.serverTime();let s;switch(this._marketStatusSpawn.value()){case"out_of_session":case"holiday":s=e-3e5-t;break;case"market":case"pre_market":case"post_market":s=e+3e5-t;break;default:s=e-t}s>0&&(this._timeoutId=setTimeout((()=>this._updateExpired()),Math.min(2e9,s))),this._expired.setValue(s<=0)}_clearTimeoutIfNeeded(){null!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)}_onQuotesUpdate(e,t){var s,i;let r=!1;if(null===this._expiredByQuotesTypespecs)this._expiredByQuotesTypespecs=Boolean(null===(s=e.values.typespecs)||void 0===s?void 0:s.includes("expired")),r=this._expiredByQuotesTypespecs;else if(void 0!==t.values.typespecs){const e=Boolean(null===(i=t.values.typespecs)||void 0===i?void 0:i.includes("expired"));r=this._expiredByQuotesTypespecs!==e,this._expiredByQuotesTypespecs=e}r&&null!==this._utcTime.value()&&this._updateExpired()}}function h(){return window.ChartApiInstance.serverTime()/1e3}function d(e,t,s){
return e<=s?t<=s?1/0:t/1e3:Math.min(e,t)/1e3}class u{constructor(e){this._marketStatus=new r.WatchedValue(null),this._lastMarketStatus=null,this._sessionsSpec=null,this._nextSessionEdgeInternal=null,this._nextSessionEdge=new r.WatchedValue(null),this._recalcNextSessionEdgeTimerId=null,this._futuresContractExpirationTime=null,this._quotesProvider=e,e.quotesUpdate().subscribe(this,this._update.bind(this)),this._futuresContractExpirationTime=new l(this._marketStatus.readonly(),e.quotesUpdate()),e.quoteSymbolChanged().subscribe(this,(()=>{(0,i.ensureNotNull)(this._futuresContractExpirationTime).reset(),this._nextSessionEdgeInternal=null,this._recalculateNextSessionEdge()})),e.quoteSymbolChanged().subscribe(this,this._resetStatus)}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.quoteSymbolChanged().unsubscribeAll(this),null!==this._recalcNextSessionEdgeTimerId&&clearTimeout(this._recalcNextSessionEdgeTimerId),(0,i.ensureNotNull)(this._futuresContractExpirationTime).destroy()}futuresContractExpirationTime(){return this._futuresContractExpirationTime}setSymbolInfo(e){var t,s,r,n,o;if((0,i.ensureNotNull)(this._futuresContractExpirationTime).setSymbolInfo(e),this._nextSessionEdgeInternal=null,null===e)return void(this._sessionsSpec=null);const l=new a.SessionSpec(e.timezone,null!==(t=e.session_display)&&void 0!==t?t:e.session,e.session_holidays,e.corrections);let h,d;const u=null===(s=e.subsessions)||void 0===s?void 0:s.find((e=>"premarket"===e.id)),c=null===(r=e.subsessions)||void 0===r?void 0:r.find((e=>"postmarket"===e.id));void 0!==u&&(h=new a.SessionSpec(e.timezone,null!==(n=u["session-display"])&&void 0!==n?n:u.session,e.session_holidays,u["session-correction"])),void 0!==c&&(d=new a.SessionSpec(e.timezone,null!==(o=c["session-display"])&&void 0!==o?o:c.session,e.session_holidays,c["session-correction"])),this._sessionsSpec={general:l,preMarket:h,postMarket:d},this._recalculateNextSessionEdge()}status(){return this._marketStatus}nextSessionEdge(){return this._nextSessionEdge}_resetStatus(){this._lastMarketStatus=null,this._marketStatus.setValue(null)}_update(e){void 0!==e&&void 0!==e.values.current_session&&(this._lastMarketStatus=e.values.current_session),null!==this._lastMarketStatus?this._marketStatus.setValue(this._lastMarketStatus):this._resetStatus()}_getNextSessionEdgeInternal(){var e;if(null===this._sessionsSpec||"24x7"===this._sessionsSpec.general.spec())return null;const t=1e3*h();if(null===this._nextSessionEdgeInternal||(null!==(e=this._nextSessionEdgeInternal.timestamp)&&void 0!==e?e:1/0)<=t/1e3){const{general:e,preMarket:s,postMarket:i}=this._sessionsSpec,r=(0,n.get_timezone)(e.timezone()),a=(0,n.utc_to_cal)(r,t),o=d((0,n.cal_to_utc)(r,e.alignToNearestSessionStart(a,1)),(0,n.cal_to_utc)(r,e.alignToNearestSessionEnd(a,1)),t),l=d(void 0!==s?(0,n.cal_to_utc)(r,s.alignToNearestSessionStart(a,1)):1/0,void 0!==s?(0,n.cal_to_utc)(r,s.alignToNearestSessionEnd(a,1)):1/0,t),u=d(void 0!==i?(0,n.cal_to_utc)(r,i.alignToNearestSessionStart(a,1)):1/0,void 0!==i?(0,
n.cal_to_utc)(r,i.alignToNearestSessionEnd(a,1)):1/0,t);let c=Math.min(o,l,u);if(c===1/0){const t=h(),s=6e4,i=new Date(Math.round(new Date(1e3*t).getTime()/s)*s).getTime()+s,a=(0,n.utc_to_cal)(r,i),o=d((0,n.cal_to_utc)(r,e.alignToNearestSessionStart(a,1)),(0,n.cal_to_utc)(r,e.alignToNearestSessionEnd(a,1)),i),_=Math.min(o,l,u);_!==1/0?(this._nextSessionEdgeInternal={timestamp:c},c=_):this._nextSessionEdgeInternal={timestamp:null}}this._nextSessionEdgeInternal=c===u?{timestamp:c,status:"post_market"}:c===l?{timestamp:c,status:"pre_market"}:{timestamp:c}}return this._nextSessionEdgeInternal}_recalculateNextSessionEdge(){const e=this._getNextSessionEdgeInternal();if(null===e||null===e.timestamp)return void this._nextSessionEdge.setValue(null);const t={status:e.status,remainingSeconds:Math.max(0,e.timestamp-h())};if(null===this._recalcNextSessionEdgeTimerId){const e=Number.isFinite(t.remainingSeconds)?Math.ceil(t.remainingSeconds%60):1;this._recalcNextSessionEdgeTimerId=setTimeout((()=>this._recalculateNextSessionEdgeByTimer()),1e3*e)}this._nextSessionEdge.setValue(t)}_recalculateNextSessionEdgeByTimer(){this._recalcNextSessionEdgeTimerId=null,this._recalculateNextSessionEdge()}}},683748:(e,t,s)=>{s.d(t,{isBats:()=>a});var i=s(59171),r=s.n(i);function a(e){return r().hasBatsSymbols(e.full_name)}},147675:(e,t,s)=>{s.d(t,{CRUCIAL_REALTIME_BATS:()=>u,DELAY_WITHOUT_AGREEMENT:()=>c,firstReplacedByBatsExchange:()=>_,getExchange:()=>v,isDelay:()=>m,isDelayForGuest:()=>y,isDelayWithoutMarketAgreement:()=>g,isEod:()=>p,isTickByTick:()=>S,witoutRealtime:()=>b});var i=s(650151),r=s(59171),a=s.n(r),n=s(833813),o=s(740254),l=s(519073);const h=["DJ","JSE","BELEX"],d=["NZX"],u=["AMEX","NASDAQ","NYSE"],c=["ICESG","TURQUOISE","TAIFEX"];function _(e){const t=a().getExchanges(e.pro_name),s=a().getExchanges(e.full_name);for(let e=0;e<s.length;++e)if("BATS"===s[e].toUpperCase())return t[e];return null}function p(e,t){return a().hasEodSymbols(e.full_name)||6===t}function m(e){return void 0!==e&&e>0}function b(e){return"index"===e.type&&h.includes(e.listed_exchange)||"futures"===e.type&&d.includes(e.listed_exchange)}function S(e,t){return!((0,o.enabled)(n.ProductFeatures.TICK_BY_TICK_PUSH_DATA)||m(e.delay)||p(e,t)||(0,l.hasCryptoTypespec)(e.typespecs||[]))}function y(e,t){return t.listed_exchange===e&&!window.is_authenticated}function g(e){return c.includes(e.listed_exchange)}async function v(e){{const t=(0,i.ensureDefined)(window.pro);await new Promise((e=>{t.runOrUpdate(e)}));const s=t.getProduct(function(e){return`exchange-${e.pro_perm}`}(e)),r=function(e){let t;if(!window.pro)throw new Error("Pro module not defined");t=window.pro.getProductsByType(window.pro.PRODUCT_TYPES.exchange).find((t=>{var s;return Boolean(null===(s=t.included_exchanges)||void 0===s?void 0:s.includes(e))}));return t||null}(s.exchange||"");return r&&["cme-full","us-stocks"].includes(r.exchange)?s:r||s}}},736029:(e,t,s)=>{s.d(t,{extrapolateBarsFrontByCount:()=>a,extrapolateBarsFrontToTime:()=>r});var i=s(987571);function r(e,t,s,i,a=!1){if(t>s){const n=r(e,s,t,i,a)
;return n.count=-n.count,n}return n(e,t,1,((e,t)=>t>s||0!==i&&e>i),a)}function a(e,t,s,i=!1){const r=s<0?-1:1;return n(e,t,r,((e,t)=>e>=s*r),i)}function n(e,t,s,r,a){let n=0,o=t;e.moveTo(o);let l=0,h=Number.MAX_VALUE,d=!1,u=t;const c=[];for(;!r(n,o);){if(l>15)throw new Error("Internal error 0x10 while extrapolating.");const r=e.indexOfBar(o);if(r===i.SessionStage.PRE_SESSION&&1===s)o=e.startOfBar(0),e.moveTo(o);else if(r===i.SessionStage.PRE_SESSION&&-1===s)o=e.startOfBar(i.SessionStage.PRE_SESSION),e.moveTo(o);else if(r===i.SessionStage.POST_SESSION&&1===s)o=e.startOfBar(i.SessionStage.POST_SESSION),e.moveTo(o);else{if(r===i.SessionStage.POST_SESSION&&-1===s)throw new Error("Internal error 0x12 while extrapolating.");{const _=e.startOfBar(r);if(_>t&&s>0||t>_&&s<0){if(d&&h===_)throw new Error("Internal error 0x11 while extrapolating.");d=!0,h=_,l=0,n++,u=_,a&&c.push(u)}if(0===r&&-1===s)o=_-1;else{o=e.startOfBar(r+s);const t=e.startOfBar(i.SessionStage.POST_SESSION);o>t&&(e.moveTo(t),o=e.startOfBar(0))}}}l++}return{time:u,times:c,count:n}}},490753:(e,t,s)=>{function i(e){return e<10?`0${e}`:e.toString()}s.d(t,{addLeadingZero:()=>i})},761698:(e,t,s)=>{s.d(t,{SeriesBase:()=>Ds});var i,r=s(650151),a=s(638456),n=s(345848),o=s(251954),l=s(201089),h=s(268222),d=s(974655),u=s(544421),c=s(195447),_=s(534741),p=s(291784),m=s(190973),b=s(444331);!function(e){e.Regular="regular",e.Extended="extended",e.PreMarket="premarket",e.PostMarket="postmarket"}(i||(i={}));var S=s(402084),y=s(339315),g=s(833642),v=s(444372),f=s(77122),w=s(665570),P=s(985715),x=s(29469);const C=v.t(null,void 0,s(389659)),I=f.enabled("hide_unresolved_symbols_in_legend");class V extends P.StatusProviderBase{constructor(e,t,s,i){super(t),this._series=e,this._statusViewProperties=s,this._options=i||{}}text(){return(0,x.generateTitleForGui)(this._getTitleGenerationOptions())}getSplitTitle(){return(0,x.generateSplitTitleForGui)(this._getTitleGenerationOptions())}bold(){return!1}size(){return this._statusViewProperties.childs().fontSize.value()+"px"}errorStatus(){const e=this._series.seriesErrorMessage();return null!==e?{error:e,title:C}:null}_getTitleGenerationOptions(){const e=this._series.symbolInfo(),t=this._statusViewProperties.childs(),s=this._series.symbolTextSourceProxyProperty().value();let i;t.showExchange.value()&&e&&(i=(0,b.getSymbolExchange)(e));const r=null!==null?null:void 0;return{description:A(s,e),exchange:i,symbol:I&&null===e?"":this._series.symbol(),interval:t.showInterval.value()&&!this._options.hideResolution?this._series.interval():void 0,style:this._series.properties().childs().style.value(),inputs:this._series.getInputsProperties().state(),boxSize:this._series.data().boxSize,reversalAmount:this._series.data().reversalAmount,ticker:T(s,e),priceSource:r}}}function T(e,t){return"ticker-and-description"!==e?"":null!==t?t.name:void 0}function A(e,t){if(null!==t)return"ticker"===e?t.name:"long-description"===e&&void 0!==t.long_description?t.long_description:(0,w.getTranslatedSymbolDescription)({pro_name:t.pro_name||void 0,
short_name:t.name||void 0,description:t.description||void 0,short_description:t.short_description||void 0,local_description:t.local_description||void 0,language:t.language||void 0})}class D extends g.StatusView{constructor(e,t,s,i){super(new V(e,t,s,i)),this._invalidated=!0,this._series=e,this._series.onRestarted().subscribe(this,this.update),this._series.dataEvents().symbolResolved().subscribe(this,this.update),this._series.dataEvents().completed().subscribe(this,this.update),this._series.boxSizeValue().subscribe(this.update.bind(this)),s.childs().symbolTextSource.listeners().subscribe(this,this.update)}getSeriesPrecision(){let e=4;const t=this._series.symbolInfo();return t&&t.pricescale&&(e=Math.round(Math.log(t.pricescale)/Math.log(10))),e}round(e){const t=this.getSeriesPrecision(),s=Math.round(e*Math.pow(10,t))/Math.pow(10,t);return s?s.toString():""}update(){this._invalidated=!0}text(){return this._updateImpl(),super.text()}color(){return this._updateImpl(),super.color()}bold(){return this._updateImpl(),super.bold()}size(){return this._updateImpl(),super.size()}getSplitTitle(){return this._updateImpl(),this._statusProvider.getSplitTitle()}_updateImpl(){this._invalidated&&(this._bold=this._statusProvider.bold(),this._size=this._statusProvider.size(),this._text=this._statusProvider.text(),this._invalidated=!1)}}var M=s(761843),R=s(748844);const B={open:v.t(null,{context:"in_legend"},s(978155)),high:v.t(null,{context:"in_legend"},s(556723)),low:v.t(null,{context:"in_legend"},s(304292)),close:v.t(null,{context:"in_legend"},s(977297)),hl2:v.t(null,{context:"in_legend"},s(605801)),hlc3:v.t(null,{context:"in_legend"},s(698865)),ohlc4:v.t(null,{context:"in_legend"},s(242659))};class E extends R.SeriesValuesProvider{constructor(e,t){super(e,t);const s=t.properties().childs().paneProperties.childs().legendProperties.childs();this._showBarChange=s.showBarChange,this._showLastDayChange=s.showLastDayChange,this._showSeriesOHLC=s.showSeriesOHLC,this._showVolume=s.showVolume,this._seriesStyle=e.properties().childs().style;const i=this._emptyValues[0],r=this._emptyValues[1],a=this._emptyValues[2];i.title=B.open,r.title=B.high,a.title=B.low,i.unimportant=!0,r.unimportant=!0,a.unimportant=!0,this._emptyValues[3].title=B.close,this._emptyValues[6].title="",this._emptyValues[8].title="",this._emptyValues[4].title=""}getValues(e){var t,s,i;const r=super.getValues(e),a=this._series.style(),n=12!==a,o=this._showSeriesOHLC.value(),l=n&&this._showBarChange.value(),h=n&&this._showLastDayChange.value();if(this._showLastPriceAndChangeOnly()){const e=r[5];return e.visible=e.visible&&o,(t=r[8]).visible&&(t.visible=l),r[6].visible=!1,r}const d=12!==a&&16!==a,u=12!==a,c=r[7];c.visible=c.visible&&this._showVolume.value();const _=(0,b.isPriceSourceStyle)(this._seriesStyle.value()),p=o&&!_,m=o&&_;if(r[0].visible=p&&d,r[1].visible=p,r[2].visible=p,r[3].visible=p&&u,r[4].visible=m,(s=r[6]).visible&&(s.visible=l),(i=r[8]).visible&&(i.visible=h),16===a){const e=this._series.properties().childs().hlcAreaStyle.childs()
;r[1].color=e.highLineColor.value(),r[2].color=e.lowLineColor.value(),r[3].color=e.closeLineColor.value()}return r}}var k=s(837032);const L=v.t(null,void 0,s(313468));class W extends M.SeriesDataWindowView{constructor(e,t){super(e,t),this._backgroundColorSpawn=t.backgroundTopColor().spawn(),this._backgroundColorSpawn.subscribe(this.update.bind(this));const s=t.properties().childs().paneProperties.childs().legendProperties.childs();this._visibilityProperty=(0,k.combineProperty)(((e,t,s,i)=>e||t||s||i),s.showBarChange.weakReference(),s.showSeriesOHLC.weakReference(),s.showVolume.weakReference(),s.showLastDayChange.weakReference()),this._visibilityProperty.subscribe(this,this.update)}areValuesVisible(){return this._visibilityProperty.value()}additional(){const e=this._series.dataPoweredBy();return null!==e&&e.length>0?v.t(null,void 0,s(493345))+" "+e:null}marketTitle(){const e=this._series.marketStatusModel().status().value();return this._showLastPriceAndChangeOnly()&&("pre_market"===e||"post_market"===e)?`${L}:`:""}destroy(){this._backgroundColorSpawn.destroy(),this._visibilityProperty.destroy()}_createValuesProvider(e,t){return new E(e,t)}}var F=s(515625),N=s(261066),O=s(223699),U=s(547944),j=s(736029),z=s(541558);let q=0;class H{constructor(e,t){this._extrapolatedData=[],this._cacheForFuture=!1,this._modelId=q++,this._builderCache=null,this._uniqueId=(0,z.randomHashN)(6),this._resolution=t,this._symbolInfo=e,this._valid=Boolean(e.timezone)&&Boolean(e.session),this._session=new U.SessionInfo(e.timezone,e.session,e.session_holidays,e.corrections)}syncSourceTarget(){return{uniqueId:this._uniqueId,resolution:this._resolution,symbolInfo:this._symbolInfo,session:this._session.state()}}getSymbolInfo(){return this._symbolInfo}getSession(){return this._session}getResolution(){return this._resolution}uniqueId(){return this._modelId}distance(e,t){if(!this.isValid())return{success:!1};if(e>t)return{success:!1};if(e===t)return{success:!0,result:0};let s=this._extrapolatedData.length,i=0!==s?this._extrapolatedData[0]:null,r=null!==i?this._extrapolatedData[s-1]:null;const a=e<t;if(1e3*e===i&&this._cacheForFuture===a||(this._extrapolatedData=[1e3*e],s=1,i=null,r=null),null===i||null!==r&&1e3*t>r){const i=(0,j.extrapolateBarsFrontToTime)(this._barBuilder(),r||1e3*e,1e3*t,2e3,!0);this._extrapolatedData=this._extrapolatedData.concat(i.times),s=this._extrapolatedData.length,this._cacheForFuture=a}if(r=this._extrapolatedData[s-1],r<1e3*t)return{success:!1};const n=this._extrapolatedData.indexOf(1e3*t);return-1===n?{success:!1}:{success:!0,result:n}}projectTime(e,t){if(!this.isValid())return e;let s=this._extrapolatedData.length,i=s>0?this._extrapolatedData[0]:null,r=null!==i?this._extrapolatedData[s-1]:null;const a=t>=0;1e3*e===i&&this._cacheForFuture===a||(this._extrapolatedData=[1e3*e],s=1,i=null,r=null);const n=Math.abs(t);if(null===i||n>=s){const i=(0,j.extrapolateBarsFrontByCount)(this._barBuilder(),r||1e3*e,Math.sign(t)*(n-s+1),!0);this._extrapolatedData=this._extrapolatedData.concat(i.times),s=this._extrapolatedData.length,
this._cacheForFuture=a}return s<n?e:this._extrapolatedData[n]/1e3}isValid(){return this._valid}dataSize(){return this._extrapolatedData.length}createNewModelWithResolution(e){return new H(this._symbolInfo,e)}_barBuilder(){return null===this._builderCache&&(this._builderCache=(0,U.newBarBuilder)(this._resolution,this._session,this._session)),this._builderCache}}var G=s(938550),$=s(824837),X=s(147675),Q=s(807655),Y=s(749028);async function Z(e){var t,s;if(window.user.declared_status!==Q.UserStatus.Pro)return!1;if(await(null===(t=window.pro)||void 0===t?void 0:t.updateShopConf())){const t=null===(s=window.pro)||void 0===s?void 0:s.getPaidExchangesForProfessional().map((e=>e.exchange.toUpperCase()));if(!(null==t?void 0:t.includes(e.listed_exchange)))return!1}return async function(e){try{return(await(0,Y.isSignedExchangeAgreement)({exchange:e.pro_perm})).response}catch(e){return!1}}(e)}var J=s(683748),K=s(928691);const ee=(0,l.getLogger)("Chart.Definitions.Series");function te(e,t){return"TickByTick"===e?{mode:e,updatePeriod:t}:{mode:e}}async function se(e,t,s){const i=[];return(0,X.isDelay)(e.delay)?async function(e){const t=[];return(0,X.witoutRealtime)(e)?t.push(te("DelayNoRealtime")):(0,X.isDelayForGuest)("MOEX",e)?t.push(te("MOEXDelayForGuest")):(0,X.isDelayForGuest)("TFEX",e)?t.push(te("TFEXDelayForGuest")):(0,X.isDelayForGuest)("CHIXAU",e)?t.push(te("CHIXAuDelayForGuest")):(0,X.isDelayForGuest)("NGM",e)?t.push(te("NGMDelayForGuest")):(0,X.isDelayForGuest)("ICESG",e)?t.push(te("ICESGDelayForGuest")):(0,X.isDelayForGuest)("TAIFEX",e)?t.push(te("TAIFEXDelayForGuest")):(0,X.isDelayForGuest)("TURQUOISE",e)?t.push(te("TURQUOISEDelayForGuest")):(0,X.isDelayForGuest)("ADX",e)?t.push(te("ADXDelayForGuest")):(0,X.isDelayForGuest)("LUXSE",e)?t.push(te("LUXSEDelayForGuest")):(0,X.isDelayForGuest)("NSENG",e)?t.push(te("NSENGDelayForGuest")):(0,X.isDelayForGuest)("TRADEGATE",e)?t.push(te("TRADEGATEDelayForGuest")):["BER","DUS","HAM","HAN","MUN"].some((t=>(0,X.isDelayForGuest)(t,e)))?t.push(te("DEForGuest")):["MIL"].some((t=>(0,X.isDelayForGuest)(t,e)))?t.push(te("MILDelayForGuest")):await Z(e)?t.push(te("DelayToRealtime")):(0,X.isDelayWithoutMarketAgreement)(e)?t.push(te("DelayWithoutMarketAgreement")):t.push(te("DelayToRealtime")),t}(e):(0,X.isEod)(e,t)?(i.push(te("EOD")),i):((0,X.isTickByTick)(e,t)&&0!==s&&i.push(te("TickByTick",s)),(0,J.isBats)(e)&&i.push(te("BATSToRealtime")),i)}class ie{constructor(e,t,s,i){this._dataUpdatedInfoStatus=new G.WatchedObject(null),this._symbolInfo=(0,$.createWVFromGetterAndSubscription)(e.getter,e.onChange),this._status=(0,$.createWVFromGetterAndSubscription)(t.getter,t.onChange),this._updatePeriod=(0,$.createWVFromGetterAndSubscription)(s.getter,s.onChange),this._symbolInfo.subscribe(this._update.bind(this)),this._status.subscribe(this._update.bind(this)),this._updatePeriod.subscribe(this._update.bind(this)),this._resetSubscription=i,this._resetSubscription.subscribe(this,this._resetStatus)}destroy(){this._symbolInfo.destroy(),this._status.destroy(),this._updatePeriod.destroy(),
this._resetSubscription.unsubscribeAll(this)}status(){return this._dataUpdatedInfoStatus.readonly()}symbolName(){const e=this._symbolInfo.value();return null!==e?e.name:""}time(){const e=this._symbolInfo.value(),t=null!==e&&e.delay&&e.delay>0?e.delay:900;return Math.round(t/60)}listedExchange(){const e=this._symbolInfo.value();return null!==e?e.listed_exchange:""}async description(){const e=this._symbolInfo.value();if(null===e)return"";let t={};try{t=(0,r.ensureNotNull)(await(0,X.getExchange)(e))}catch(e){ee.logWarn(`Cannot get exchange ${(0,K.errorToString)(e)}`)}return t.description||e.listed_exchange}exchange(){const e=this._symbolInfo.value();return null!==e?e.exchange:""}proName(){const e=this._symbolInfo.value();return null!==e?e.pro_name:""}country(){var e;return(null===(e=this._symbolInfo.value())||void 0===e?void 0:e.country)||""}proPerm(){const e=this._symbolInfo.value();return null!==e?e.pro_perm:""}firstReplacedByBatsExchange(){const e=this._symbolInfo.value();return e&&(0,X.firstReplacedByBatsExchange)(e)}isSpread(){const e=this._symbolInfo.value();return null!==e&&"spread"===e.type}_resetStatus(){this._dataUpdatedInfoStatus.setValue(null)}async _update(){const e=this._symbolInfo.value();if(null===e)return void this._dataUpdatedInfoStatus.setValue(null);const t=this._status.value();if("string"==typeof t)return void this._dataUpdatedInfoStatus.setValue(null);if(2===t||1===t)return;const s=await se(e,t,this._updatePeriod.value());0!==s.length?this._dataUpdatedInfoStatus.setValue(s):this._dataUpdatedInfoStatus.setValue(null)}}var re=s(120780),ae=s(466931),ne=s(389137),oe=s(262078);const le=(0,l.getLogger)("Chart.DataProblemModel");class he{constructor(e,t){this._mainDataProblem=new G.WatchedObject(null),this._supportPortalProblems=new G.WatchedObject([]),this._allDataProblems=new G.WatchedObject([]),this._pushStreamHandler=null,this._destroyed=!1,this._quotesProvider=e,this._quotesProvider.quotesUpdate().subscribe(this,this._update.bind(this)),this._resetSubscription=t,this._resetSubscription.subscribe(this,this._resetStatus),this._mainDataProblem.subscribe((()=>this._updateAllDataProblems())),this._supportPortalProblems.subscribe((()=>this._updateAllDataProblems())),this._requestSupportPortalProblems()}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._resetSubscription.unsubscribeAll(this),null!==this._pushStreamHandler&&oe.pushStreamMultiplexer.off("support-portal-problem",this._pushStreamHandler),this._destroyed=!0}dataProblems(){return this._allDataProblems}_resetStatus(){this._mainDataProblem.setValue(null)}_update(e){void 0===e.values||void 0===e.values.data_problem?this._resetStatus():this._mainDataProblem.setValue((0,ne.clone)(e.values.data_problem))}_updateAllDataProblems(){const e=this._mainDataProblem.value(),t=this._supportPortalProblems.value();this._allDataProblems.setValue(null===e?t:[e,...t])}async _requestSupportPortalProblems(){{const e=await(0,re.fetch)(`${ae.supportPortalProblemsHost}/support/support-portal-problems/?language=${window.locale}`)
;if(this._destroyed)return;if(!e.ok)return void le.logWarn("Couldn't load support portal problems");const t=(await e.json()).issues,s=()=>{const e=t.filter((e=>e.show_on_chart&&!1!==e.is_active&&(void 0===e.language||e.language.some((e=>e===window.locale||"all"===e))))).map((e=>({severity:"low",title:e.title,text:e.description})));this._supportPortalProblems.setValue(e)};s(),this._pushStreamHandler=e=>{switch(e.action){case"created":t.push(e.data);break;case"modified":{const s=t.findIndex((t=>t.id===e.data.id));-1!==s?t[s]={...t[s],...e.data}:t.push(e.data);break}case"deleted":{const s=t.findIndex((t=>t.id===e.data.id));-1!==s&&t.splice(s,1);break}}s()},oe.pushStreamMultiplexer.on("support-portal-problem",this._pushStreamHandler)}}}var de=s(356747),ue=s(246733),ce=s(229765),_e=s(909598),pe=s(988124),me=s(490753);function be(e,t=Date.now()/1e3){let s=Math.ceil(e-t);if(s<=0)return"";if(s<3600){const e=Math.floor(s/60),t=Math.ceil(s%60);return`${(0,me.addLeadingZero)(e)}:${(0,me.addLeadingZero)(t)}`}if(s<86400){const e=Math.floor(s/3600);s%=3600;const t=Math.floor(s/60);s%=60;const i=Math.ceil(s);return`${(0,me.addLeadingZero)(e)}:${(0,me.addLeadingZero)(t)}:${(0,me.addLeadingZero)(i)}`}{const i=new Date(1e3*e),r=new Date(1e3*t),a=pe.get_year(i),n=pe.get_year(r),o=pe.get_month(i),l=pe.get_month(r),h=pe.get_day_of_month(r),d=Se(i)-Se(r)>=0?0:-1;let u=12*(a-n)+(o-l)+d;if(u>0){const t=pe.get_days_in_month(l,n);!function(e,t){const s=pe.get_day_of_month(e);e.setUTCMonth(pe.get_month(e)+t),pe.get_day_of_month(e)!==s&&e.setUTCDate(0)}(r,u);const s=pe.get_days_in_month(pe.get_month(r),pe.get_year(r)),i=h!==t&&s===pe.get_day_of_month(r)?t-h:0;let a=Math.ceil((e-r.getTime()/1e3)/86400)+i;return a>=s&&(u++,a=0),`${u}M ${a}d`}if(-1===d){if(pe.get_days_in_month(l,n)-s/86400<1/24)return"1M 0d"}let c=Math.floor(s/86400);s%=86400;let _=Math.ceil(s/3600);return 24===_&&(_=0,c+=1),c===pe.get_days_in_month(o,a)?"1M 0d":`${c}d ${_}h`}}function Se(e){return 86400*e.getUTCDate()+3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()}var ye=s(740086),ge=s(964824);const ve=f.enabled("force_exchange_as_title"),fe=f.enabled("chart_style_hilo_last_price"),we=[0,1,2,14,15,3,16,9,8,10];fe&&we.push(12);const Pe={alwaysShowGlobalLast:!1,visibleOnHistoryOnly:!1,showCountdown:!0,showSymbolLabel:!0,useSolidBodyColor:!0};class xe extends ce.PriceAxisView{constructor(e,t,s){super(),this._previousCountdown="",this._source=e,this._model=t,this._options={...Pe,...s}}updateCountdown(){this._countdownText()!==this._previousCountdown&&(this.update((0,ge.sourceChangeEvent)(this._source.id())),this._model.updateSourcePriceScale(this._source))}_getSource(){return this._source}_getModel(){return this._model}_isCountdownEnabled(){return this._options.showCountdown}_countdownText(){{const e=this._source.barCloseTime();return null===e?"":be(e,this._currentTime()/1e3)}}_updateRendererData(e,t,s){var i;if(e.visible=!1,t.visible=!1,!this._source.isVisible())return;const a=this._source.properties().childs();if(!fe&&12===a.style.value())return
;const n=this._model.timeScale().visibleBarsStrictRange(),o=this._source.data().last();if(null===n||null===o)return;if(this._options.visibleOnHistoryOnly&&n.contains(o.index))return;const l=this._model.properties().childs().scalesProperties.childs();let h=l.showSeriesLastValue.value(),d=this._isCountdownEnabled()&&a.showCountdown.value()&&we.includes(a.style.value())&&(this._options.alwaysShowGlobalLast||n.contains(o.index)),u=this._options.showSymbolLabel&&l.showSymbolLabels.value();const c=l.seriesLastValueMode.value()===_e.PriceAxisLastValueMode.LastPriceAndPercentageValue,_=this._source.lastValueData(void 0,this._options.alwaysShowGlobalLast);if(_.noData)return;const p=8===a.style.value();if((h||d||u)&&p&&a.haStyle.childs().showRealLastPrice.value()){const e=this._source.lastValueData(void 0,!1),t=this._source.lastValueData(void 0,!0);e.noData||t.noData||e.index!==t.index||(h=!1,d=!1,u=!1)}const m=(0,ue.resetTransparency)(this._source.priceLineColor(_.color));if(this._options.useSolidBodyColor?(s.background=m,s.borderColor=void 0):(s.background=this._model.backgroundColorAtYPercentFromTop((null!==(i=s.fixedCoordinate)&&void 0!==i?i:s.coordinate)/(0,r.ensureNotNull)(this._model.paneForSource(this._source)).height()),s.borderColor=m),s.coordinate=_.coordinate,s.floatCoordinate=_.floatCoordinate,h||d){const t=this._axisFirstLineText(_,h);e.text=t,this._options.useSolidBodyColor?(s.textColor=this.generateTextColor(s.background),e.borderVisible=!1):(e.borderVisible=!0,s.textColor=m),e.textColor=s.textColor;const i=h&&c?(0,ye.getOppositeModePriceText)(this._source.priceScale(),_):"";e.secondLine=i,s.secondLineTextColor=s.textColor;const r=d?this._countdownText():"";this._previousCountdown=r,e.thirdLine=r,s.thirdLineTextColor=(0,ue.generateColor)(s.textColor,25),0===t.length&&0===i.length&&0===r.length||(e.visible=!0)}u&&(t.text=this._paneText(u),t.visible=t.text.length>0)}_paneText(e){let t="";const s=this._source.symbolInfo();return ve?t=(0,b.displayedSymbolExchange)(s):e&&(t=(0,b.displayedSymbolName)(s)),t}_axisFirstLineText(e,t){return t?(0,ye.getCurrentModePriceText)(this._source.priceScale(),e):""}_currentTime(){return window.ChartApiInstance.serverTime()}}var Ce=s(177126),Ie=s(125226),Ve=s(175203),Te=s(96080),Ae=s(855611),De=s(30574),Me=s(782856);function Re(e){const[t]=function(e){const t=new Set;e.isSpread()&&t.add(Me.DataSourceDangerReason.Spread);const s=e.symbolInfo();return"CRYPTOCAP"===(null==s?void 0:s.exchange)&&t.add(Me.DataSourceDangerReason.CryptoCap),t}(e);return null!=t?t:null}var Be=s(710455);const Ee={0:{background:"rgba(242, 54, 69, 0.15)",line:"#F23645"},1:{background:"rgba(255, 152, 0, 0.15)",line:"#FF9800"},2:{background:"rgba(8, 153, 129, 0.15)",line:"#089981"}};class ke extends Be.MediaCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(){return null}_drawImpl(e){if(null===this._data)return;const t=Ee[this._data.predictionCode],s=e.context;s.fillStyle=t.background,
s.fillRect(Math.max(0,this._data.startX),0,e.mediaSize.width,e.mediaSize.height),s.strokeStyle=t.line,s.beginPath(),s.lineWidth=1;const i=Math.round(this._data.startX);s.moveTo(i,0),s.lineTo(i,e.mediaSize.height),s.stroke()}}class Le{constructor(e,t,s,i){this._renderer=new ke,this._startX=0,this._series=t,this._timeScale=e,this._lastKnownBarIndex=s,this._direction=i}update(){this._startX=this._timeScale.indexToCoordinate(this._lastKnownBarIndex)+.5*this._timeScale.barSpacing()+1}renderer(){const e=(0,u.barFunction)("close"),t=this._series.data().bars(),s=e((0,r.ensureNotNull)(t.valueAt(this._lastKnownBarIndex))),i=e((0,r.ensureNotNull)(t.last()).value);let a=0;i>s?a=1:i<s&&(a=2);let n=1;return 0!==this._direction&&(n=this._direction===a?2:0),this._renderer.setData({startX:this._startX,predictionCode:n}),this._renderer}}var We=s(674981);class Fe{constructor(){this._invalidatedFromIndex=0,this._maxIndexWithWeight=null,this._items=[],this._weightsMap=new Map}setWeight(e,t){this._invalidatedFromIndex=Math.min(this._invalidatedFromIndex,e),this._weightsMap.set(e,t),null===this._maxIndexWithWeight?this._maxIndexWithWeight=e:this._maxIndexWithWeight=Math.max(this._maxIndexWithWeight,e)}deleteItemByIndex(e){this._weightsMap.delete(e)&&(this._invalidatedFromIndex=Math.min(this._invalidatedFromIndex,e))}totalWeight(e){if(null===this._maxIndexWithWeight)return e;const t=e%1>=.5?Math.ceil(e):Math.floor(e),s=e-t;if(t>=this._invalidatedFromIndex){const e=this._invalidatedFromIndex;let s=this._items[e-1];const i=Math.min(this._maxIndexWithWeight,t);this._createItems(i);for(let t=e;t<=i;++t)s=this._fillItem(t,s);this._invalidatedFromIndex=i+1}if(t>this._maxIndexWithWeight){return this._items[this._maxIndexWithWeight].barEndWeight+(t-this._maxIndexWithWeight-.5)+s}const i=this._items[t];return i.barCenterWeight+i.weight*s}index(e){if(null===this._maxIndexWithWeight)return e;if(0!==this._invalidatedFromIndex&&this._items[this._invalidatedFromIndex-1].barEndWeight-.001>=e){const t=(0,We.lowerbound)(this._items,e,((e,t)=>e.barEndWeight-.001<t),0,this._invalidatedFromIndex),s=this._items[t];return t+(e-s.barCenterWeight)/s.weight}if(this._invalidatedFromIndex<=this._maxIndexWithWeight){const t=this._invalidatedFromIndex;let s=this._items[t-1];this._createItems(this._maxIndexWithWeight);for(let i=t;i<=this._maxIndexWithWeight;++i)if(s=this._fillItem(i,s),s.barEndWeight>e)return this._invalidatedFromIndex=i+1,i+(e-s.barCenterWeight)/s.weight;this._invalidatedFromIndex=this._maxIndexWithWeight+1}const t=this._items[this._maxIndexWithWeight];return this._maxIndexWithWeight+.5+e-t.barEndWeight}_createItems(e){const t=e-(this._items.length-1);t>0&&(this._items=this._items.concat(Array.from({length:t},(()=>({barCenterWeight:1,weight:1,barEndWeight:1})))))}_fillItem(e,t){var s;const i=this._items[e],r=null!==(s=this._weightsMap.get(e))&&void 0!==s?s:1;return i.weight=r,i.barCenterWeight=void 0===t?0:t.barCenterWeight+t.weight/2+r/2,i.barEndWeight=i.barCenterWeight+r/2,i}}class Ne extends class{constructor(){this._baseIndex=0,
this._preBaseIndexWeights=new Fe,this._postBaseIndexWeights=new Fe,this._weightsMap=new Map}setBaseIndex(e){this._baseIndex=e,this._preBaseIndexWeights=new Fe,this._postBaseIndexWeights=new Fe;for(const[e,t]of this._weightsMap)this.setWeight(e,t)}indexToWeight(e){const t=e-this._baseIndex;return t<0?-this._preBaseIndexWeights.totalWeight(-t):this._postBaseIndexWeights.totalWeight(t)}weightToIndex(e){return e<0?this._baseIndex-this._preBaseIndexWeights.index(-e):this._baseIndex+this._postBaseIndexWeights.index(e)}clear(){this._preBaseIndexWeights=new Fe,this._postBaseIndexWeights=new Fe,this._weightsMap.clear()}setWeight(e,t){const s=e-this._baseIndex;s<=0&&this._preBaseIndexWeights.setWeight(-s,t),s>=0&&this._postBaseIndexWeights.setWeight(s,t),this._weightsMap.set(e,t)}moveData(e){const t=new Map;for(const s of e){const e=this._weightsMap.get(s.old);if(void 0!==e){t.set(s.new,e),this._weightsMap.delete(s.old);const i=s.old-this._baseIndex;i<=0&&this._preBaseIndexWeights.deleteItemByIndex(-i),i>=0&&this._postBaseIndexWeights.deleteItemByIndex(i)}}for(const[e,s]of t)this.setWeight(e,s)}}{constructor(e){super(),this._minVolume=e}setVolume(e,t){this.setWeight(e,1+Math.log2(Math.max(t,this._minVolume/2)/this._minVolume))}}var Oe=s(811630),Ue=s(234271);class je extends ce.PriceAxisView{constructor(e,t){super(),this._source=e,this._model=t}_updateRendererData(e,t,s){e.visible=!1;const i=this._source;if(!this._model.properties().childs().scalesProperties.childs().showSeriesPrevCloseValue.value())return;if(i.isDWM())return;const r=i.prevClose();if(null===r)return;const a=(0,ue.resetTransparency)(this._source.properties().childs().prevClosePriceLineColor.value());s.background=a,s.textColor=this.generateTextColor(a),s.coordinate=r.coordinate,e.text=(0,ye.getCurrentModePriceText)(i.priceScale(),r),e.visible=!0}}var ze=s(456757),qe=s(458963);class He extends ze.SeriesHorizontalLinePaneView{constructor(e){super(e),this._lineRendererData.linestyle=qe.LINESTYLE_DOTTED}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.properties().childs();if(!e.showPrevClosePriceLine.value())return;if(this._series.isDWM())return;const t=this._series.prevClose();null!==t&&(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=e.prevClosePriceLineColor.value(),this._lineRendererData.linewidth=e.prevClosePriceLineWidth.value())}}var Ge=s(969419),$e=s(956725),Xe=s(239589),Qe=s(86441),Ye=s(63316),Ze=s(315801);class Je{constructor(e,t){this._bars=[],this._invalidated=!0,this._isMarkersEnabled=(0,f.enabled)("source_selection_markers"),this._selectionData=null,this._blockSize=0,this._series=e,this._model=t,this._selectionIndexer=new Ye.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}nearestIndex(e,t){var s,i;return null!==(i=null===(s=this.bars().search(e,t))||void 0===s?void 0:s.index)&&void 0!==i?i:null}items(){return this._bars}_updateImpl(){if(this._bars=[],6===this._series.properties().childs().style.value()&&!this._series.data().boxSize)return
;const e=this._series.priceScale(),t=this._model.timeScale();if(t.isEmpty()||!e||e.isEmpty())return;const s=t.visibleStrictDataRange(this.bars());if(null===s)return;if(0===this.bars().size())return;if(this._series.data().bars().isEmpty())return;let i=s.firstBar();const a=s.lastBar(),n=this._series.firstValue();if(null===n)return;for(;i<=a;i++){if(null!==this.bars().valueAt(i))break}if(i>a)return;const o=this.bars().range(i,a),l={},h=this._series.properties().childs().style.value(),d=6===h?(0,r.ensureDefined)(this._series.data().boxSize):0;if(o.each(((e,t)=>{l.value=t;const s=this._barItem(l,t,e);return null===s||(l.previousValue=t,this._bars.push(s)),!1})),6===h&&(this._blockSize=(e.priceToCoordinate(0,n)-e.priceToCoordinate(500,n))/500*d),e.barPricesToCoordinates(this._bars,n),t.barIndexesToCoordinates(this._bars),this._model.selection().isSelected(this._series)){const s=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,barSpacing:t.barSpacing(),hittestResult:Ze.HitTarget.Regular};const i=(0,r.ensureNotNull)(this._model.paneForSource(this._series)).height();this._selectionData.hittestResult=Ze.HitTarget.Regular;for(let r=0;r<s.length;r++){const a=s[r],o=this._series.bars().valueAt(a);if(null===o)continue;const l=o[1],h=o[4];if(null==l||null==h)continue;const d=.5*(l+h),u=t.indexToCoordinate(a),c=e.priceToCoordinate(d,n);this._selectionData.points.push(new Qe.Point(u,c)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(c/i))}}else this._selectionIndexer.clear()}_barItem(e,t,s){const i=t[1],r=t[2],a=t[3],n=t[4];if(void 0===i||void 0===r||void 0===a||void 0===n||null===i||null===r||null===a||null===n)return null;const o=this._series.barColorer(),l=this.isProjection(),h=o.barStyle(s,l,e);return{time:Math.round(s),open:i,high:r,low:a,close:n,color:h.barColor,borderColor:h.barBorderColor,isUp:h.isBarUp,hollow:null}}}class Ke extends Je{bars(){return this._series.bars()}isProjection(){return!1}}class et extends Je{bars(){return this._series.nsBars()}isProjection(){return!0}}class tt extends et{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s=this._series.properties().childs(),i=s.rangeStyle.childs(),r={bars:this._bars,barSpacing:this._model.timeScale().barSpacing(),thinBars:i.thinBars.value(),dontDrawOpen:s.barStyle.childs().dontDrawOpen.value()};return new Ge.PaneRendererBars(r)}}class st extends et{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s=this._series.priceScale();if(!s)return null;const i=this._model.timeScale().barSpacing(),r={bars:this._bars,barWidth:(0,Xe.optimalBarWidth)(i),barSpacing:this._model.timeScale().barSpacing(),bodyVisible:!0,borderVisible:!0,wickVisible:!0,isPriceScaleInverted:s.isInverted()};return new $e.PaneRendererCandles(r)}_barItem(e,t,s){const i=super._barItem(e,t,s);if(null===i)return null;const r=this._series.barColorer().barStyle(s,!0,e);return i.wickColor=r.wickColor,i.hollow=null,i}}var it=s(506387);class rt extends xe{lastPrice(){
return this._getSource().data().lastProjectionPrice}_updateRendererData(e,t,s){e.visible=!1,t.visible=!1;const i=this._getModel(),a=this._getSource(),n=a.priceScale(),o=i.timeScale(),l=this.lastPrice();if(o.isEmpty()||n.isEmpty()||void 0===l)return;const h=o.visibleBarsStrictRange();if(null===h)return;const d=h.firstBar(),u=h.lastBar(),c=a.data(),p=c.search(u,_.PlotRowSearchMode.NearestLeft);if(null===p)return;const m=a.nearestIndex(d,_.PlotRowSearchMode.NearestRight);if(void 0===m)return;const b=a.model().properties().childs().scalesProperties.childs(),S=(0,r.ensureNotNull)(c.valueAt(m))[4];let y=s.background,g=b.showSeriesLastValue.value(),v=!1,f=!1,w=!1;const P=a.lastValueData(4,!1),x=a.properties().childs();if(8===x.style.value()&&x.haStyle.childs().showRealLastPrice.value()){const e=a.lastValueData(4,!0);if(e.noData||e.color===s.background||(y=(0,ue.resetTransparency)(e.color)),!e.noData&&!P.noData){const t=e.index===P.index;v=t&&b.showSymbolLabels.value(),f=b.seriesLastValueMode.value()===_e.PriceAxisLastValueMode.LastPriceAndPercentageValue,g=g&&t,w=t&&this._isCountdownEnabled()&&x.showCountdown.value()}}else{const e=a.barColorer().barStyle(p.index,!0);y=(0,ue.resetTransparency)(e.barColor)}if(s.background=y,s.textColor=this.generateTextColor(y),s.secondLineTextColor=s.textColor,s.thirdLineTextColor=(0,ue.generateColor)(s.textColor,25),s.coordinate=n.priceToCoordinate(l,S),e.visible=g||w,!P.noData){const s=a.priceScale().isPercentage();P.formattedPriceAbsolute=n.formatPriceAbsolute(l),P.formattedPricePercentage=n.formatPricePercentage(l,S,!0),P.text=s?P.formattedPricePercentage:P.formattedPriceAbsolute,e.text=this._axisFirstLineText(P,g),e.secondLine=g&&f?s?P.formattedPriceAbsolute:P.formattedPricePercentage:"",e.thirdLine=w?this._countdownText():"",t.text=this._paneText(v)}t.visible=v}}var at=s(742391),nt=s(955831),ot=s(149511);const lt={light:{lineStyle:qe.LINESTYLE_DOTTED,lineWidth:1,backgroundColor:ot.colorsPalette["color-tv-blue-50"],lineColor:ot.colorsPalette["color-cold-gray-500"]},dark:{lineStyle:qe.LINESTYLE_DOTTED,lineWidth:1,backgroundColor:ot.colorsPalette["color-tv-blue-a800"],lineColor:ot.colorsPalette["color-cold-gray-500"]}};function ht(e){return e?lt.dark:lt.light}class dt extends nt.HorizontalLinePaneView{constructor(e,t,s){super(),this._model=e,this._isVisible=t.lineVisible,this._lineColor=t.lineColor,this._lineWidth=t.lineWidth,this._getValue=s}_updateImpl(){const e=this._lineRendererData;if(e.visible=!1,!this._isVisible.value())return;const t=this._model.mainSeries(),s=t.priceScale(),i=t.firstValue(),r=this._getValue();if(null===i||null===r)return;const a=ht(this._model.dark().value()),n=this._lineColor.value()||a.lineColor,o=this._lineWidth.value()||a.lineWidth;e.visible=!0,e.y=s.priceToCoordinate(r,i),e.linestyle=a.lineStyle,e.linewidth=o,e.color=n}}class ut extends ce.PriceAxisView{constructor(e,t,s,i){super(),this._model=e,this._label=t,this._isVisible=s.labelVisible,this._backgroundColor=s.lineColor,this._getValue=i}_updateRendererData(e,t,s){if(e.visible=!1,t.visible=!1,
!this._isVisible.value())return;const i=this._model.mainSeries(),r=i.priceScale(),a=i.firstValue(),n=this._getValue();if(null===a||null===n)return;const o=ht(this._model.dark().value()),l=(0,ue.resetTransparency)(this._backgroundColor.value()||o.backgroundColor);e.visible=!0,t.visible=!0,e.text=r.formatPriceAbsolute(n),t.text=this._label,s.coordinate=r.priceToCoordinate(n,a),s.background=l,s.textColor=this.generateTextColor(l)}}class ct extends it.PriceLineAxisView{constructor(e,t,s){super(),this._model=e,this._isLineVisible=t,this._getValue=s}_isVisible(){return this._isLineVisible.value()}_lineWidth(){return ht(this._model.dark().value()).lineWidth}_lineStyle(){return ht(this._model.dark().value()).lineStyle}_priceLineColor(e){return ht(this._model.dark().value()).lineColor}_value(){const e=this._model.mainSeries(),t=e.priceScale(),s=e.firstValue(),i=this._getValue();if(null===s||null===i)return{noData:!0};const r=t.priceToCoordinate(i,s);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",formattedPriceIndexedTo100:"",text:"",index:0}}}const _t=v.t(null,void 0,s(330777)),pt=v.t(null,void 0,s(608136));function mt(e,t,s,i){const r=new dt(e,s,i),a=new ut(e,s.label,s,i);return{paneView:r,panePriceAxisView:new at.PanePriceAxisView(a,t,e),priceAxisView:a,priceLineAxisView:new ct(e,s.lineVisible,i)}}var bt=s(707957),St=s(502141),yt=s(919892),gt=s(168883);class vt{constructor(){this._data=null}setData(e){this._data=e}data(){return this._data}draw(e,t){const s=this._data;if(null===s)return;const i=t.pixelRatio;e.save();const r=Math.max(1,Math.floor(i)),a=r%2/2,n=Math.round(s.center.x*i)+a,o=s.center.y*i;e.fillStyle=s.seriesLineColor,e.beginPath();const l=Math.max(2,1.5*s.seriesLineWidth)*i;e.arc(n,o,l,0,2*Math.PI,!1),e.fill(),e.fillStyle=s.fillColor,e.beginPath(),e.arc(n,o,s.radius*i,0,2*Math.PI,!1),e.fill(),e.lineWidth=r,e.strokeStyle=s.strokeColor,e.beginPath(),e.arc(n,o,s.radius*i+r/2,0,2*Math.PI,!1),e.stroke(),e.restore()}hitTest(e,t){return null}}function ft(e){return e}const wt=[{start:0,end:.25,startRadius:4,endRadius:10,startFillAlpha:.25,endFillAlpha:0,startStrokeAlpha:.4,endStrokeAlpha:.8,easing:ft},{start:.25,end:.525,startRadius:10,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:.8,endStrokeAlpha:0,easing:ft},{start:.525,end:1,startRadius:14,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:0,endStrokeAlpha:0,easing:ft}];function Pt(e,t,s,i){const r=s+(i-s)*t;return(0,ue.applyTransparency)(e,(0,ue.alphaToTransparency)(r))}function xt(e,t){const s=e%2600/2600;let i;for(const e of wt)if(s>=e.start&&s<=e.end){i=e;break}if(void 0===i)throw new Error("Last price animation internal logic error");const r=i.easing((s-i.start)/(i.end-i.start));return{fillColor:Pt(t,r,i.startFillAlpha,i.endFillAlpha),strokeColor:Pt(t,r,i.startStrokeAlpha,i.endStrokeAlpha),radius:(a=r,n=i.startRadius,o=i.endRadius,n+(o-n)*a)};var a,n,o}class Ct{constructor(e){this._renderer=new vt,this._invalidated=!0,this._stageInvalidated=!0,
this._startTime=performance.now(),this._endTime=this._startTime-1,this._series=e}update(e){if(this._invalidated=!0,"data-source-change"===e.type&&e.sourceId===this._series.id()&&e.realtime&&this._series.seriesLoaded()){const e=performance.now(),t=this._endTime-e;if(t>0)return void(t<650&&(this._endTime+=2600));this._startTime=e,this._endTime=e+2600}}invalidateStage(){this._stageInvalidated=!0}animationActive(){return performance.now()<=this._endTime}stopAnimation(){this._endTime=this._startTime-1}renderer(e,t){return this._invalidated?(this._updateImpl(e,t),this._invalidated=!1,this._stageInvalidated=!1):this._stageInvalidated&&(this._updateRendererDataStage(),this._stageInvalidated=!1),this._renderer}_updateImpl(e,t){this._renderer.setData(null);const s=this._series.model().timeScale(),i=s.visibleBarsStrictRange(),r=this._series.firstValue(),a=this._series.lastValueData(void 0,!0,!0);if(null===i||null===r||void 0===a.index||void 0===a.price||!i.contains(a.index))return;const n=new Qe.Point(s.indexToCoordinate(a.index),this._series.priceScale().priceToCoordinate(a.price,r)),o=a.color,l=this._series.properties().childs();let h;switch(this._series.style()){case 3:h=l.areaStyle.childs().linewidth.value();break;case 10:const t=l.baselineStyle,s=Math.round(e*(Math.abs(100-t.childs().baseLevelPercentage.value())/100));h=n.y<=s?t.childs().topLineWidth.value():t.childs().bottomLineWidth.value();break;case 14:h=l.lineWithMarkersStyle.childs().linewidth.value();break;case 15:h=l.steplineStyle.childs().linewidth.value();break;default:h=l.lineStyle.childs().linewidth.value()}const d=xt(this._duration(),o);this._renderer.setData({seriesLineColor:o,seriesLineWidth:h,fillColor:d.fillColor,strokeColor:d.strokeColor,radius:d.radius,center:n})}_updateRendererDataStage(){const e=this._renderer.data();if(null!==e){const t=xt(this._duration(),e.seriesLineColor);e.fillColor=t.fillColor,e.strokeColor=t.strokeColor,e.radius=t.radius}}_duration(){return this.animationActive()?performance.now()-this._startTime:2599}}var It=s(572230),Vt=s(129025),Tt=s(787630),At=s(826989),Dt=s(731042);const Mt=f.enabled("chart_style_hilo_last_price");class Rt extends ze.SeriesHorizontalLinePaneView{constructor(e){super(e),this._lineRendererData.linestyle=qe.LINESTYLE_DOTTED}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.properties().childs();if(!e.showPriceLine.value())return;if(!Mt&&12===e.style.value())return;const t=this._series.lastValueData(void 0,!0);t.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=t.coordinate,this._lineRendererData.color=this._series.priceLineColor(t.color),this._lineRendererData.linewidth=e.priceLineWidth.value())}}var Bt=s(147664),Et=s(262550),kt=s(142119),Lt=s(230058),Wt=s(756930),Ft=s(787123);class Nt extends Wt.PaneRendererSeriesBase{constructor(e){super(),this._barSpacing=1,this._barWidth=1,this._bars=e.bars,this._barSpacing=e.barSpacing}_drawImpl(e){const{context:t,horizontalPixelRatio:s,verticalPixelRatio:i}=e;t.save(),this._barWidth=Math.round(this._barSpacing*s),
this._drawWicks(t,s,i),this._drawBorder(t,s,i),this._drawBars(t,s,i)}_getTolerance(){return(0,Xe.interactionTolerance)().series+.5}_getBarSpacing(){return this._barSpacing}_drawBars(e,t,s){let i="",r=null;const a=this._calculateBorderWidth(t);for(const n of this._bars){if(this._barWidth<=2*a)continue;let o=Math.round(Math.min(n.open,n.close)*s),l=Math.round(Math.max(n.open,n.close)*s),h=Math.round(n.time*t)-Math.floor(.5*this._barWidth),d=h+this._barWidth-1;if(n.color!==i){const t=n.color;e.fillStyle=t,i=t}null!==r&&(h=Math.max(r+1,h-1),h=Math.min(h,d)),r=d,h+=a,o+=a,d-=a,l-=a,o>l||e.fillRect(h,o,d-h+1,l-o+1)}}_drawBorder(e,t,s){const i=this._calculateBorderWidth(t);let r="",a=null;for(const n of this._bars){n.borderColor!==r&&(e.fillStyle=n.borderColor,r=n.borderColor);let o=Math.round(n.time*t)-Math.floor(.5*this._barWidth);const l=o+this._barWidth-1,h=Math.round(Math.min(n.open,n.close)*s),d=Math.round(Math.max(n.open,n.close)*s);if(null!==a&&(o=Math.max(a+1,o-1),o=Math.min(o,l)),this._barSpacing*t>2*i)(0,Ft.fillRectInnerBorder)(e,o,h,l-o+1,d-h+1,i);else{const t=l-o+1;e.fillRect(o,h,t,d-h+1)}a=l}}_drawWicks(e,t,s){const i=this._bars;let r=Math.min(Math.floor(t),Math.floor(this._barSpacing*t));r=Math.max(Math.floor(t),Math.min(r,this._barWidth));const a=Math.floor(.5*r);for(const n of i){e.fillStyle=n.borderColor;const i=Math.round(Math.min(n.open,n.close)*s),o=Math.round(Math.max(n.open,n.close)*s),l=Math.round(n.high*s),h=Math.round(n.low*s),d=Math.round(t*n.time)-a,u=d+r-1-d+1;e.fillRect(d,l,u,i-l),h!==o&&e.fillRect(d,o+1,u,h-o-1)}}_calculateBorderWidth(e){let t=Math.floor(e);this._barWidth<=2*t&&(t=Math.floor(.5*(this._barWidth-1)));const s=Math.max(Math.floor(e),t);return this._barWidth<=2*s?Math.floor(e):s}}class Ot extends Ke{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()},i=new kt.CompositeRenderer;return i.append(new Nt(s)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&i.append(new Lt.SelectionRenderer(this._selectionData)),i}}class Ut extends et{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()};return new Nt(s)}}class jt extends Ke{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:.9*this._model.timeScale().barSpacing()},i=new kt.CompositeRenderer;return i.append(new Nt(s)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&i.append(new Lt.SelectionRenderer(this._selectionData)),i}}class zt extends et{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:.9*this._model.timeScale().barSpacing()};return new Nt(s)}}var qt,Ht=s(203308);class Gt extends Wt.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._barLineWidth=Math.max(1,(0,
Xe.optimalBarWidth)(e.barSpacing,1))}_drawImpl(e){const{context:t,horizontalPixelRatio:s,verticalPixelRatio:i}=e;let r,a,n;t.save(),t.lineCap="square";const o=Math.floor(s)%2?1:0;for(const e of this._bars){const l=Math.round(s*this._barLineWidth*.5),h=Math.round(s*e.time-l),d=void 0===a||e.isUp?Math.round(i*e.high-l):a,u=2*l;let c;if(e.isTwoColorBar){const s=Math.round(i*e.additionalPrice-i*e.high+l),a=d+s,n=Math.round(i*e.low-i*e.additionalPrice+l),_=void 0!==r&&e.isUp?r:a+n;t.fillStyle=e.upColor,t.fillRect(h,d,u+o,s),t.fillStyle=e.downColor,t.fillRect(h,a,u+o,_+l-a+1),c=_}else{const s=Math.round(i*e.low-i*e.high+l),a=void 0!==r&&e.isUp?r:d+s;t.fillStyle=e.color,t.fillRect(h,d,u+o,a+l-d+1),c=a}if(!e.combinedWithProjection){e.isTwoColorBar?t.fillStyle=e.isUp?e.downColor:e.upColor:t.fillStyle=e.color;const r=void 0===n?Math.round((e.time-this._barSpacing)*s+l):n+2*l,h=Math.round(e.time*s-l)-r+1,d=2*l+o;if(e.isUp)t.fillRect(r,c-l+1-o,h,d);else{const s=void 0===a?Math.round(e.open*i-l):a;t.fillRect(r,s,h,d)}}n=h,r=c,a=d}t.restore()}_getTolerance(){return(0,Xe.interactionTolerance)().series+this._barLineWidth/4}_getBarSpacing(){return this._barLineWidth}}function $t(e,t){const s={};return s.upColor=e.upColor,s.downColor=e.downColor,s.isTwoColorBar=e.isTwoColorBar,(0,Ht.default)(t)&&(s.additionalPrice=t),s}class Xt extends Ke{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()},i=new kt.CompositeRenderer;return i.append(new Gt(s)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&i.append(new Lt.SelectionRenderer(this._selectionData)),i}_barItem(e,t,s){const i=super._barItem(e,t,s);if(null===i)return null;const r=$t(this._series.barColorer().barStyle(s,!1,e),t[6]);return{...i,...r}}}class Qt extends et{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()};return new Gt(s)}_barItem(e,t,s){const i=super._barItem(e,t,s);if(null===i)return null;const a=this._series.barColorer().barStyle(s,!0,e),n=t[6],o=$t(a,n);return(0,Ht.default)(n)&&i.time===(0,r.ensureNotNull)(this.bars().lastIndex())&&(o.combinedWithProjection=!0),{...i,...o}}}!function(e){e[e.EllipseWidth=.9]="EllipseWidth",e[e.EllipseRadius=.95]="EllipseRadius",e[e.SimplifiedEllipseWidth=.86]="SimplifiedEllipseWidth"}(qt||(qt={}));class Yt extends Wt.PaneRendererSeriesBase{constructor(e){super(),this._bars=e.bars,this._barSpacing=e.barSpacing,this._barWidth=e.barSpacing}_drawImpl(e){const{context:t,horizontalPixelRatio:s,verticalPixelRatio:i}=e;if(0===this._bars.length)return;t.save();const r=this._bars.reduce(((e,t)=>Math.max(e,(t.low-t.high)/t.additionalNum)),0);this._barSpacing>1&&r>=1?this._drawFillSigns(t,s,i):this._drawSimplified(t,s,i),t.restore()}_getTolerance(){return(0,Xe.interactionTolerance)().series+this._barWidth/8}_getBarSpacing(){return this._barSpacing}_drawBarCross(e,t,s,i){!function(e,t,s,i,r){e.moveTo(t,s),
e.lineTo(t+i,s+r),e.moveTo(t+i,s),e.lineTo(t,s+r)}(e,t.time-.5*this._barWidth,t.high+i*s,this._barWidth,s)}_drawBarEllipse(e,t,s,i){!function(e,t,s,i,r){e.save(),e.translate(t+i/2,s+r/2),e.scale(i/2,r/2),e.moveTo(1,0),e.arc(0,0,qt.EllipseRadius,0,2*Math.PI,!1),e.restore()}(e,t.time-this._barWidth*qt.EllipseWidth*.5,t.high+i*s,this._barWidth*qt.EllipseWidth,s)}_drawFillSigns(e,t,s){e.scale(t,s),e.lineCap="butt",e.lineWidth=1;for(const t of this._bars){const s=(t.low-t.high)/t.additionalNum;if(t.isMergedBar&&(e.beginPath(),t.isUp?this._drawBarEllipse(e,t,s,t.additionalNum-1):this._drawBarCross(e,t,s,0),e.strokeStyle=t.isUp?t.downColor:t.upColor,e.stroke()),e.beginPath(),t.isUp)for(let i=t.additionalNum-1-(t.isMergedBar?1:0);i>-1;i--)this._drawBarCross(e,t,s,i);else for(let i=t.isMergedBar?1:0;i<t.additionalNum;i++)this._drawBarEllipse(e,t,s,i);e.strokeStyle=t.color,e.stroke()}}_drawSimplified(e,t,s){for(const i of this._bars){const r=i.isUp?1:qt.SimplifiedEllipseWidth,a=(i.time-.5*this._barWidth*r)*t,n=(i.time+.5*this._barWidth*r)*t,o=Math.max(1,n-a);let l=i.high*s;const h=i.low*s,d=i.high*s;let u=Math.max(1,h-d);if(i.isMergedBar){e.fillStyle=i.isUp?i.downColor:i.upColor;const t=(i.low-i.high)/i.additionalNum,s=Math.max(1,Math.round(t));i.isUp?(e.fillRect(a,l,o,s),l+=s):(e.fillRect(a,l+o-s,o,s),u-=s)}e.fillStyle=i.color,e.fillRect(a,l,o,u)}}}function Zt(e,t,s,i){const r={};return r.low=i-.5*t,r.high=s+.5*t,r.upColor=e.upColor,r.downColor=e.downColor,r.isMergedBar=e.isMergedBar,r.additionalNum=Math.round(1+(s-i)/t),r}class Jt extends Ke{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()},i=new kt.CompositeRenderer;return i.append(new Yt(s)),this._model.selection().isSelected(this._series)&&this._isMarkersEnabled&&this._selectionData&&i.append(new Lt.SelectionRenderer(this._selectionData)),i}_barItem(e,t,s){const i=super._barItem(e,t,s);if(null===i)return null;const a=Zt(this._series.barColorer().barStyle(s,!1,e),(0,r.ensureDefined)(this._series.data().boxSize),i.high,i.low);return{...i,isUp:(0,r.ensureDefined)(i.isUp),...a}}}class Kt extends et{renderer(e,t){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const s={bars:this._bars,barSpacing:this._model.timeScale().barSpacing()};return new Yt(s)}_barItem(e,t,s){const i=super._barItem(e,t,s);if(null===i)return null;const a=Zt(this._series.barColorer().barStyle(s,!0,e),(0,r.ensureDefined)(this._series.data().boxSize),i.high,i.low);return{...i,isUp:(0,r.ensureDefined)(i.isUp),...a}}}var es=s(72731),ts=s(825278),ss=s(245242),is=s(936258),rs=s(904891),as=s(579950);class ns extends ss.SeriesCandlesPaneView{renderer(e,t){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const s=this._source.priceScale();if(!s)return null;const i=this._source.properties().childs().haStyle.childs(),r=this._model.timeScale().barSpacing(),a={bars:this._bars,barSpacing:r,bodyVisible:i.drawBody.value(),borderVisible:i.drawBorder.value(),borderColor:i.borderColor.value(),
wickColor:i.wickColor.value(),barWidth:(0,Xe.optimalBarWidth)(r),wickVisible:i.drawWick.value(),isPriceScaleInverted:s.isInverted()},n=new kt.CompositeRenderer;return n.append(new $e.PaneRendererCandles(a)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&n.append(new Lt.SelectionRenderer(this._selectionData)),n}}var os=s(41117),ls=s(255799),hs=s(548587),ds=s(711757),us=s(373017),cs=(s(551775),s(519073)),_s=s(488530),ps=s(982217),ms=s(707621);const bs=f.enabled("price_scale_always_last_bar_value"),Ss=f.enabled("display_data_mode"),ys=a.CheckMobile.any(),gs=!f.enabled("hide_series_legend_item"),vs=f.enabled("hide_price_scale_global_last_bar_value"),fs=f.enabled("no_bars_status"),ws=f.enabled("charting_library_debug_mode"),Ps=f.enabled("chart_style_hilo_last_price"),xs=(0,Ie.isFeatureEnabled)("weighted_time_points"),Cs=(0,l.getLogger)("Chart.Series");let Is=!1;const Vs={countdownEnabled:!0,lastPriceAnimationEnabled:!0};function Ts(e,t,s){return void 0===t?null:`${e}=${t} (${s?"changed":"unchanged"})`}function As(e){const t=e.state();return t.data.forEach((e=>e.value.splice(7,1))),t}class Ds extends d.PriceDataSource{constructor(e,t,a,n){super(e,"_seriesId"),this.requestingTicksWhenNotSupported=new bt.Delegate,this.requestingIntradayWhenNotSupported=new bt.Delegate,this.requestingStyleIsNotSupported=new bt.Delegate,this.requestingStyleSupportRecovered=new bt.Delegate,this.requestingResolutionLessThanFrequency=new bt.Delegate,this._paneView=null,this._futureBarsPaneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=null,this._gotoDateView=null,this._baseHorizontalLineView=null,this._priceStep=null,this._symbolInfo=null,this._isPrePostMarketPricesAvailableProperty=new m.default(!1),this._isBackAdjustmentForbiddenProperty=new m.default(!0),this._isSettlementAsCloseForbiddenProperty=new m.default(!0),this._highLowPriceCache=new Map,this._averagePriceCache=new Map,this._prevClosePriceAxisView=null,this._priceScaleAboutToBeChanged=new bt.Delegate,this._onRestarted=new bt.Delegate,this._onStatusChanged=new bt.Delegate,this._tagsChanged=new bt.Delegate,this._intervalChanged=new bt.Delegate,this._sessionIdChanged=new bt.Delegate,this._requestMoreDataAvailable=!0,this._lineStyleLastPriceCirclePaneView=new Ct(this),this._prevClosePriceLineView=null,this._dataPoweredBy=null,this._symbolResolvingActive=new Vt.WatchedValue(!1),this._predictBars=0,this._syncModel=null,this._data=null,this._lastCompleteFlags=null,this._haStyle={studyId:(0,r.ensureNotNull)((0,b.chartStyleStudyId)(8,!0))},this._renkoStyle={studyId:(0,r.ensureNotNull)((0,b.chartStyleStudyId)(4,!0))},this._pbStyle={studyId:(0,r.ensureNotNull)((0,b.chartStyleStudyId)(7,!0))},this._kagiStyle={studyId:(0,r.ensureNotNull)((0,b.chartStyleStudyId)(5,!0))},this._pnfStyle={studyId:(0,r.ensureNotNull)((0,b.chartStyleStudyId)(6,!0))},this._rangeStyle={studyId:(0,r.ensureNotNull)((0,b.chartStyleStudyId)(11,!0))},this._barColorerCache=null,this._boxSizeValue=new Vt.WatchedValue,this._base=100,
this._pointValue=1,this._formattingDeps=null,this._formatter=new S.PriceFormatter(this._base),this._ignoreMinMoveFormatter=new S.PriceFormatter(this._base),this._ignoreMinMovePriceStep=null,this._lastBarCloseTime=null,this._onSessionIdPropertyChangedBound=this._onSessionIdPropertyChanged.bind(this),this._ignoreSessionIdProxyPropertyChanges=!1,this._textSourceIsAlwaysTickerRestrictionEnabled=!1,this._lastPriceAnimationActive=!1,this._currentSession="out_of_session",this._onStyleChanged=new bt.Delegate,this._intervalObj=null,this._obsoleteZOrder=0,this._seriesErrorMessage=null,this._seriesAlwaysFalseHibernatedVW=new Vt.WatchedValue(!1),this._styleToRecover=null,this._precomputedBarStyles=new WeakMap,this._doNotShowLastAvailableBar=!1,this._gotoDateResultCleared=!1,this._endOfDataPaneView=null,this._pendingTimeRange=null,this._replaySubscriber=null,this._symbolIntervalChanged=new bt.Delegate,this._isReplayResolutionAvailableForUser=null,this._onInReplayStateChanged=new bt.Delegate,this._replayExitedDueUnsupportedInterval=new bt.Delegate,this._replayExitedDueUnavailableForUserInterval=new bt.Delegate,this._onTimeFrameApplied=new bt.Delegate,this._loading=!0,this._seriesLoaded=!1,this._seriesCompleted=!1,this._status=0,this._prevRequestedInterval="",this._isActingAsSymbolSource=new Vt.WatchedValue(!0),this._deferredDestroyed=(0,h.createDeferredPromise)(),this._volumePointWeights=null,this._footprintStudy=null,this._updateTimeScaleTimePointWeights=()=>{this._model.timeScale().setTimePointWeights((0,b.isVolumeWeightedStyle)(this.style())&&this.properties().childs().useVolumeWeightBars.value()?this._volumePointWeights:null)},this._seriesSource=new Tt.SeriesDataSource(e.chartApi(),"s",n);const o=this._seriesSource.dataEvents();o.symbolResolved().subscribe(this,this._onSymbolResolved),o.symbolError().subscribe(this,this._onSymbolError),o.seriesTimeFrame().subscribe(this,this._onSeriesTimeFrame),o.seriesError().subscribe(this,this._onSeriesError),o.loading().subscribe(this,this._onSeriesLoading),o.completed().subscribe(this,this._onSeriesCompleted),o.dataUpdated().subscribe(this,this._onDataUpdated),o.barReceived().subscribe(this,this._onBarReceived),this._quotesProvider=new de.QuotesProvider,this._quotesProvider.quotesUpdate().subscribe(this,this._onQuotesUpdate);const l=t.childs();if(t.hasChild("extendedHours")){(0,r.ensureDefined)(l.extendedHours).value()&&!t.hasChild("sessionId")&&t.addChild("sessionId",new m.default("extended")),t.removeProperty("extendedHours")}t.hasChild("sessionId")||t.addChild("sessionId",new m.default(i.Regular)),(0,ms.allChartStyles)().includes(l.style.value())||l.style.setValueSilently(2);const d=l.lineStyle.childs();if(l.lineStyle.hasChild("styleType")){let e,t;const s=d.styleType.value();0===s&&(t=14,e=l.lineWithMarkersStyle.childs()),1===s&&(t=15,e=l.steplineStyle.childs()),e&&(e.color.setValueSilently(d.color.value()),e.linestyle.setValueSilently(d.linestyle.value()),e.linewidth.setValueSilently(d.linewidth.value()),e.priceSource.setValueSilently(d.priceSource.value())),
void 0!==t&&2===l.style.value()&&l.style.setValue(t),l.lineStyle.removeProperty("styleType")}this._setProperties(t),this._sessionIdProxyProperty=new m.default(l.sessionId.value()),l.sessionId.subscribe(this,(()=>this._updateSessionIdProxyProperty())),this._sessionIdProxyProperty.subscribe(this,this._onSessionIdProxyPropertyChanged),this._symbolTextSourceProxyProperty=new m.default,this._recalcSymbolTextSourceProxyProperty(),l.statusViewStyle.childs().symbolTextSource.subscribe(this,this._recalcSymbolTextSourceProxyProperty),this._symbolTextSourceProxyProperty.subscribe(this,(()=>e.lightUpdate())),this._options=(0,ne.merge)((0,ne.clone)(Vs),a),this._prevChartStyle=l.style.value(),this._priceAxisView=new xe(this,e,{alwaysShowGlobalLast:!vs,showCountdown:a.countdownEnabled});let u=null;bs||vs||(u=new xe(this,e,{visibleOnHistoryOnly:!0,showSymbolLabel:!1,showCountdown:!1,alwaysShowGlobalLast:!1,useSolidBodyColor:!1})),this._priceLinePriceAxisView=new it.SeriesPriceLineAxisView(this),this._priceLineAxisViews=[this._priceLinePriceAxisView];const c=new rt(this,e,{showCountdown:a.countdownEnabled});this._priceAxisViews=[this._priceAxisView,c],null!==u&&this._priceAxisViews.push(u),this._prevClosePriceAxisView=new je(this,e),this._priceAxisViews.unshift(this._prevClosePriceAxisView),this._prevClosePriceLineView=new He(this),this._panePriceAxisView=new at.PanePriceAxisView(this._priceAxisView,this,e),this._historyPricePanePriceAxisView=null!==u?new at.PanePriceAxisView(u,this,e):null,this._projectionPriceAxisView=new at.PanePriceAxisView(c,this,e),this._labelPaneViews=[this._panePriceAxisView,this._projectionPriceAxisView],null!==this._historyPricePanePriceAxisView&&this._labelPaneViews.push(this._historyPricePanePriceAxisView),this._highLowAvgPaneViews=[],this._averagePaneViews=[],this._createHighLowAvgViews(),this._subscribeRestartToSessionIdChange(),l.visible.subscribe(this,this._updateLastPriceAnimationActive),this._updateLastPriceAnimationActive(),l.minTick.subscribe(this,this._onMinTickChanged),this._dataWindowView=new M.SeriesDataWindowView(this,e),this._legendView=new W(this,e),this._statusView=new D(this,this._model.properties().childs().scalesProperties.childs().textColor,l.statusViewStyle),this._marketStatusModel=new F.MarketStatusModel(this._quotesProvider),this._dataUpdatedModeModel=Ss?new ie({getter:this.symbolInfo.bind(this),onChange:o.symbolResolved()},{getter:this.status.bind(this),onChange:this._onStatusChanged},{getter:()=>{var e;return null===(e=this._lastCompleteFlags)||void 0===e?void 0:e.rt_update_period},onChange:o.completed()},l.symbol.listeners()):null,this._dataProblemModel=new he(this._quotesProvider,l.symbol.listeners()),l.backAdjustment.subscribe(this,(()=>{this.isStarted()&&this.restart()})),l.settlementAsClose.subscribe(this,(()=>{this.isDWM()&&this.isStarted()&&this.restart()})),xs&&l.useVolumeWeightBars.subscribe(this,this._updateTimeScaleTimePointWeights),this._symbolResolvingActive.subscribe((()=>e.realignLineTools())),this._intervalChanged.subscribe(this,(()=>e.realignLineTools())),
f.enabled("widget")||Promise.all([s.e(22666),s.e(62253),s.e(92191),s.e(9817),s.e(92108),s.e(66639),s.e(26855),s.e(92706),s.e(962),s.e(745),s.e(66849)]).then(s.bind(s,271804)).then((e=>{this._endOfDataPaneView=new e.EndOfDataLollipopPaneView(this)})),this._syncFootprintStudy(),Oe.alertsAvailable&&this._symbolResolvingActive.subscribe(this._updateAlertCreationAvailable.bind(this))}setId(e){var t;super.setId(e),null===(t=(0,Ue.getPersistentLogger)())||void 0===t||t.addPersistentLogEntry(`Set series Id to ${e}`,l.LOGLEVEL.INFO,"chart.series")}supportsPressedChunks(){return!0}pressedChunks(e,t){return this.data().pressedChunks(e,t)}seriesErrorMessage(){return this._seriesErrorMessage}destroy(){this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),this.clearGotoDateResult(),this._legendView.destroy(),this._marketStatusModel.destroy(),null!==this._dataUpdatedModeModel&&this._dataUpdatedModeModel.destroy(),this._dataProblemModel.destroy(),this._paneView&&this._paneView.destroy&&this._paneView.destroy(),this._seriesSource.destroy(),this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),this._model.timeScale().visibleBarsStrictRangeChanged().unsubscribeAll(this),this._unsubscribeRestartToSessionIdChange(),this._replayExitedDueUnsupportedInterval.destroy(),this._replayExitedDueUnavailableForUserInterval.destroy(),this._onTimeFrameApplied.destroy(),this._deferredDestroyed.resolve(),super.destroy()}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}barColorer(){if(this._barColorerCache)return this._barColorerCache;let e=null;const t=this._model.dataSources();for(let s=t.length-1;s>=0;s--){const i=t[s];if((0,us.isStudy)(i)&&i.hasBarColorer()&&!i.isSourceHidden()){const t=(0,r.ensureNotNull)(i.barColorer());null===e?e=t:e.pushBackBarColorer(t)}}return null===e?e=new ds.SeriesBarColorer(this):e.pushBackBarColorer(new ds.SeriesBarColorer(this)),this._barColorerCache=e,e}createPaneView(){this._paneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=this.hasClosePrice()?new Rt(this):null;const e=this._properties.childs().style.value();switch(e){case 0:this._paneView=new ts.SeriesBarsPaneView(this,this._model);break;case 17:case 1:this._paneView=new ss.SeriesCandlesPaneView(this,this._model,1===e?1:.2);break;case 2:case 14:case 15:this._paneView=new is.SeriesLinePaneView(this,this._model);break;case 3:this._paneView=new rs.SeriesAreaPaneView(this,this._model);break;case 16:this._paneView=new as.SeriesHLCAreaPaneView(this,this._model);break;case 8:this._paneView=new ns(this,this._model);break;case 9:this._paneView=new os.SeriesHollowCandlesPaneView(this,this._model);break;case 13:this._paneView=new es.SeriesColumnsPaneView(this,this._model);break;case 10:{this._paneView=new ls.SeriesBaselinePaneView(this,this._model);const e=this._properties.childs().baselineStyle.childs();this._waterlineView=new Bt.SeriesWaterlinePaneView({paneHeight:()=>this.priceScale().height(),color:()=>e.baselineColor.value(),
baseLevelPercentage:()=>e.baseLevelPercentage.value()});break}case 12:this._paneView=new Et.SeriesHiLoPaneView(this,this._model)}switch(e){case 4:this._paneView=new Ot(this,this._model),this._projectionBarsPaneView=new Ut(this,this._model);break;case 7:this._paneView=new jt(this,this._model),this._projectionBarsPaneView=new zt(this,this._model);break;case 5:this._paneView=new Xt(this,this._model),this._projectionBarsPaneView=new Qt(this,this._model);break;case 6:this._paneView=new Jt(this,this._model),this._projectionBarsPaneView=new Kt(this,this._model)}if(11===e&&(this._properties.childs().rangeStyle.childs().barStyle.value()===_s.RangeBarStyle.Bars?(this._paneView=new ts.SeriesBarsPaneView(this,this._model),this._projectionBarsPaneView=new tt(this,this._model)):(this._paneView=new ss.SeriesCandlesPaneView(this,this._model),this._projectionBarsPaneView=new st(this,this._model))),null===this._paneView)throw Error("Unknown chart style assigned: "+e)}properties(){return this._properties}zorder(){return 0}quotesProvider(){return this._quotesProvider}currentSession(){return this._currentSession}syncModel(){if(!this._syncModel){const e=this.symbolInfo(),t=this.interval();if(!e||!t)return null;this._syncModel=new H(e,t)}return this._syncModel}labelPaneViews(){return this._labelPaneViews}topPaneViews(){const e=[];if(null!==this._gotoDateView&&e.push(this._gotoDateView),this._lastPriceAnimationActive){const t=this._lineStyleLastPriceCirclePaneView;t.animationActive()&&setTimeout((()=>this._model.invalidate(It.InvalidationMask.cursor())),0),t.invalidateStage(),e.push(t)}return 0!==e.length?e:null}paneViews(e){if(!this.properties().childs().visible.value())return null;const t=[(0,r.ensureNotNull)(this._baseHorizontalLineView),(0,r.ensureNotNull)(this._paneView)];if(this._footprintStudy){const s=this._footprintStudy.paneViews(e);s&&t.push(...s)}return this._endOfDataPaneView&&t.push(this._endOfDataPaneView),this._futureBarsPaneView&&t.push(this._futureBarsPaneView),this._projectionBarsPaneView&&t.push(this._projectionBarsPaneView),null!==this._waterlineView&&t.push(this._waterlineView),t.push((0,r.ensureNotNull)(this._prevClosePriceLineView)),null!==this._priceLineView&&t.push(this._priceLineView),window.TradingView.printing&&this._lastPriceAnimationActive&&(this._lineStyleLastPriceCirclePaneView.stopAnimation(),t.push(this._lineStyleLastPriceCirclePaneView)),t.push(...this._highLowAvgPaneViews),t.push(...this._averagePaneViews),t}priceAxisViews(e,t){return e.findTargetPriceAxisViews(this,t,this._priceAxisViews,this._priceLineAxisViews)}clearHighLowPriceCache(){this._highLowPriceCache.clear()}clearAveragePriceCache(){this._averagePriceCache.clear()}priceScale(){return(0,r.ensureNotNull)(this._priceScale)}setPriceScale(e){this._priceScale!==e&&(this._priceScaleAboutToBeChanged.fire(),this._priceScale=e,this._properties.removeProperty("priceAxisProperties"),this._properties.addChild("priceAxisProperties",e.properties()),this._properties.childs().priceAxisProperties.childChanged(null,""),(0,
o.emit)("series_event","price_scale_changed"),this._priceScaleChanged.fire(e))}priceScaleChanged(){return this._priceScaleChanged}priceScaleAboutToBeChanged(){return this._priceScaleAboutToBeChanged}applyPreferences(e){const t=(0,ne.clone)(e);this.priceScale().setMode({autoScale:t.priceAxisProperties.autoScale,percentage:t.priceAxisProperties.percentage,log:t.priceAxisProperties.log,lockScale:t.priceAxisProperties.lockScale}),this.setChartStyleWithIntervalIfNeeded(t.style);const{style:s,interval:i,...r}=t;this._properties.mergePreferences(r),this._properties.saveDefaults(),this.createPaneView(),this.invalidateBarStylesCache()}disconnect(){this._seriesSource.stop(),this._predictBars=0,this._status=0,this._model.isSnapshot()||(this._symbolInfo=null)}isStarted(){return this._seriesSource.isStarted()}isCompleted(){return this._seriesCompleted}restart(){if(5===this._status)return;this._loading=!0,this._seriesLoaded=!1,this._seriesCompleted=!1,this._lastCompleteFlags=null,this._onRestarted.fire(),this._setStatus(1),this._updateSymbolInfo(null);let e=this._properties.childs().interval.value();O.Interval.isEqual(e,this._prevRequestedInterval)&&this._notifyIntervalChanged(e);let t=null;this._pendingTimeRange&&(t=this._pendingTimeRange,this._pendingTimeRange=null),this._removeReplaySubscriber(),this._onBeforeModifySeries(this.getSymbolString(),e),this._onTimeFrameApplied.fire(t),e=(0,Dt.getServerInterval)(e),this._data=null,this.model().recalcVisibleRangeStudies(!0),this._seriesSource.modifySeries(this._getResolvingSymbolObject(),e,t),this._seriesSource.isStarted()||this._seriesSource.start(),this._prevRequestedInterval=this.interval(),this.updateAllViews((0,ge.sourceChangeEvent)(this.id())),this._model.lightUpdate()}isSymbolInvalid(){return 4===this._status}getSymbolString(){return(0,yt.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject())}invalidateBarStylesCache(e){Cs.logDebug("Invalidate style cache starting from "+e),this._clearStylePlot(this.bars(),e),this._clearStylePlot(this.nsBars())}isLoading(){return this._loading}isFailed(){return 12===this.status()||4===this.status()||10===this.status()}isStatusError(){return 12===this.status()}actualSymbol(){return(0,b.actualSymbol)(this.symbolInfo(),this.symbol())}proSymbol(){return(0,b.proSymbol)(this.symbolInfo(),this.symbol())}onStyleChanged(){return this._onStyleChanged}style(){return this.properties().childs().style.value()}setStyle(e){this.setSymbolParams({style:e})}isRangeBasedStyle(){return(0,b.isRangeBasedStyle)(this.style())}symbolSameAsCurrent(e){return this.symbol()===e||(0,St.symbolSameAsCurrent)(e,this._symbolInfo)}symbolSameAsResolved(e){return this._seriesSource.symbolSameAsResolved(e)}status(){return this._status}symbol(){return this.properties().childs().symbol.value()}symbolChanged(){return this.properties().childs().symbol.listeners()}seriesSource(){return this._seriesSource}symbolInfo(){return this._symbolInfo}symbolResolved(){return this.dataEvents().symbolResolved()}symbolResolvingActive(){return this._symbolResolvingActive}
symbolHibernated(){return this._seriesAlwaysFalseHibernatedVW}getSymbolName(){return this._symbolInfo?this._symbolInfo.name:""}firstValue(){const e=this.firstBar();return null===e?null:this._barFunction(e,0)}firstBar(){const e=this.model().timeScale().visibleBarsStrictRange();if(null===e)return null;const t=e.firstBar(),s=this.data().search(t,_.PlotRowSearchMode.NearestRight);return null!==s?s.value:null}formatter(e=!0){return e?this._formatter:this._ignoreMinMoveFormatter}priceStep(e=!0){return e?this._priceStep:this._ignoreMinMovePriceStep}bars(){return this.data().bars()}nsBars(){return this.data().nsBars()}interval(){return this.properties().childs().interval.value()}setInterval(e){this.setSymbolParams({interval:e})}intervalObj(){const e=this.interval();if(null!==this._intervalObj&&this._intervalObj.resolutionString===e)return this._intervalObj.interval;const t=O.Interval.parse(e);return this._intervalObj={resolutionString:e,interval:t},t}prevClose(){const e=this.priceScale();if(e.isEmpty()||this.data().isEmpty())return null;const t=this.quotes(),s=this.firstValue();if(null===t||null===s)return null;const i=t.prev_close_price;return void 0===i?null:{coordinate:e.priceToCoordinate(i,s),floatCoordinate:e.priceToCoordinate(i,s),formattedPricePercentage:e.formatPricePercentage(i,s,!0),formattedPriceAbsolute:e.formatPriceAbsolute(i),formattedPriceIndexedTo100:e.formatPriceIndexedTo100(i,s)}}priceLineColor(e){return this.properties().childs().priceLineColor.value()||e}hasClosePrice(){return Ps||12!==this.properties().childs().style.value()}lastValueData(e,t,s){var i;const r={noData:!0},a=this.priceScale();if(this.model().timeScale().isEmpty()||a.isEmpty()||this.data().isEmpty())return r;const n=this.model().timeScale().visibleBarsStrictRange(),o=this.firstValue();if(null===n||null===o)return r;let l,h;if(t){const e=this.data().bars().last();if(null===e)return r;l=e.value,h=e.index}else{const e=this.data().bars().search(n.lastBar(),_.PlotRowSearchMode.NearestLeft);if(null===e)return r;l=e.value,h=e.index}const d=null!==(i=void 0!==e?l[e]:this._barFunction(l,2))&&void 0!==i?i:NaN,u=this.barColorer().barStyle(h,!1),c=a.priceToCoordinate(d,o),p={...a.getFormattedValues(d,o,!0),noData:!1,color:u.barColor,floatCoordinate:c,coordinate:c,index:h};return s&&(p.price=d),p}isDWM(){return this.intervalObj().isDWM()}data(){var e;return null!==(e=this._data)&&void 0!==e?e:this._seriesSource.data()}clearData(){(0,r.assert)(null===this._data,"Cannot clear loaded data"),this._seriesSource.clearData()}nearestData(e,t){var s;return null!==(s=this.data().search(e,t))&&void 0!==s?s:void 0}nearestIndex(e,t){var s;return null===(s=this.nearestData(e,t))||void 0===s?void 0:s.index}nearestValue(e,t,s){var i;const r=this.nearestData(e,s);return null!==(i=null==r?void 0:r.value[t])&&void 0!==i?i:void 0}onSymbolIntervalChanged(){return this._symbolIntervalChanged}onIntervalChanged(){return this._intervalChanged}onStatusChanged(){return this._onStatusChanged}onRestarted(){return this._onRestarted}fixLastBar(e){if(!this._futureBarsPaneView){
const t=this.bars().lastIndex();t&&(this._futureBarsPaneView=new Le(this.model().timeScale(),this,t,e))}}requestMoreData(e){if(3!==this._status&&7!==this._status&&8!==this._status&&9!==this._status&&6!==this._status&&11!==this._status)return;if(this._model.timeScale().isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;if(0===this.bars().size())return;const s=t.lastBar()-(0,r.ensureNotNull)(this.data().last()).index;if(this._predictBars<s&&(this._predictBars=s,this._seriesSource.requestMoreTickmarks(s)),!this._requestMoreDataAvailable)return;const i=(0,r.ensureNotNull)(this.bars().firstIndex()),a=e||i-t.firstBar();a<=0||(Number.isFinite(a)?(this._requestMoreDataAvailable=!1,this._loading=!0,this._seriesSource.requestMoreData(a),this._setStatus(2)):Cs.logWarn("requestMoreData: invalid bar count: "+a+", visible bars: ["+t.firstBar()+", "+t.lastBar()+"], last index: "+(0,r.ensureNotNull)(this.data().last()).index+", predicted bars: "+this._predictBars+", required bars:"+e))}isNeedRestart(e){return 5!==this._status&&(void 0===e&&(e=this.properties().childs().style.value()),(0,b.styleChangeRequiresRestart)(this._prevChartStyle,e))}isStyleSupported(e){return!this.isInReplay()||this.isStyleSupportedForReplay(e)}isStyleSupportedForReplay(e){return 8!==e&&(0,b.isTimeBasedStyle)(e)}sessionId(){return this.properties().childs().sessionId.value()}sessionIdChanged(){return this._sessionIdChanged}priceRange(e,t){var s,i;const a=this._priceScale;if(this.data().isEmpty()||!a)return null;if(a.isLockScale()){const e=this._model.mainSeriesScaleRatio();if(null!==e){const s=a.internalHeight()/(this.model().timeScale().barSpacing()/e),i=(0,r.ensureNotNull)(this.data().search(t,_.PlotRowSearchMode.NearestLeft)).value,n=((0,r.ensure)(i[2])+(0,r.ensure)(i[3]))/2;return new p.PriceRange(n-.5*s,n+.5*s)}}const n=this.priceSource();let o,l,h;if(null!==n?(o=this.data().bars().minMaxOnRangeCached(e,t,[{name:n,offset:0}]),l=this.data().nsBars().minMaxOnRangeCached(e,t,[{name:n,offset:0}])):(o=this.data().bars().minMaxOnRangeCached(e,t,[{name:"low",offset:0},{name:"high",offset:0}]),l=this.data().nsBars().minMaxOnRange(e,t,[{name:"low",offset:0},{name:"high",offset:0}])),o=(0,c.mergeMinMax)(o,l),null===o)h=new p.PriceRange(-.5,.5);else if(o.min===o.max){const e=5/(null!==(i=null===(s=this._symbolInfo)||void 0===s?void 0:s.pricescale)&&void 0!==i?i:100);h=new p.PriceRange(o.min-e,o.max+e)}else h=new p.PriceRange(o.min,o.max);return a.isLog()?new p.PriceRange(a.priceToLogical(h.minValue()),a.priceToLogical(h.maxValue())):h}autoScaleInfo(e,t){const s=this.priceRange(e,t);if(null===this._paneView)return{range:s};const i=this._paneView;return{range:s,topPixelMargin:i.topPixelMargin?i.topPixelMargin():void 0,bottomPixelMargin:i.bottomPixelMargin?i.bottomPixelMargin():void 0}}onChartStyleChanged(){var e;this._updateBarFunction(),this.isNeedRestart()&&(this.data().clear(),this.model().timeScale().scrollToRealtime(!1),this.isInReplay()&&!this.isStyleSupportedForReplay(this.style())&&this._removeReplaySubscriber(),
this.restart());const t=this.properties();this._prevChartStyle=t.childs().style.value(),this._onStyleChanged.fire(t.childs().style.value()),this.invalidateBarStylesCache(),this._updateLastPriceAnimationActive(),(null===(e=this._styleToRecover)||void 0===e?void 0:e.originalStyle)!==this.style()&&(this._styleToRecover=null),xs&&this._updateTimeScaleTimePointWeights(),this._syncFootprintStudy()}setChartStyleWithIntervalIfNeeded(e,t){const s=this.interval(),i=null!=t?t:(0,Dt.getResolutionByChartStyle)(e,s,this._model.defaultResolutions()),r=O.Interval.isEqual(i,s);this.setSymbolParams({interval:r?void 0:i,style:e})}idForAlert(){return(0,Te.hash)(this.getSymbolString()+O.Interval.normalize(this.interval())).toString()}hasStateForAlert(){return super.hasStateForAlert()&&!(0,b.isEconomicSymbol)(this._symbolInfo)}stateForAlert(){var e;const t=this.idForAlert(),s=Ae.FormattersSerializer.serialize(this._formatter);let r;const a=this.isDWM()?i.Regular:this.sessionIdProxyProperty().value();if(this._symbolInfo&&this._symbolInfo.subsessions&&this._symbolInfo.subsessions.length>1){const t=null===(e=this._symbolInfo.subsessions)||void 0===e?void 0:e.find((e=>e.id===a));t&&(r=(0,De.translateSessionExtendedDescription)(t.description))}const n=this.properties().childs(),o={id:t,uniqueId:t,type:"MainSeries",proSymbol:this.proSymbol(),actualSymbol:this.actualSymbol(),symbolString:this.getSymbolString(),interval:this.interval(),style:n.style.value(),styleInputs:this.getInputsProperties().state(),sessionId:a,sessionDescription:r,dividendsAdjustment:n.dividendsAdjustment.value(),backAdjustment:n.backAdjustment.value()&&!this.isBackAdjustmentForbiddenProperty().value(),settlementAsClose:n.settlementAsClose.value()&&!this.isSettlementAsCloseForbiddenProperty().value(),boxSize:this.data().boxSize,reversalAmount:this.data().reversalAmount,isSpread:this.isSpread(),formatter:s},l=Re(this);return l&&(o.dangerReason=l),o}styleStudyInfos(){return{haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle}}dataEvents(){return this._seriesSource.dataEvents()}isSpread(){var e;return"spread"===(null===(e=this._symbolInfo)||void 0===e?void 0:e.type)}isYield(){return null!==this._symbolInfo&&(0,cs.isYield)(this._symbolInfo)}dividendsAdjustmentProperty(){return this._properties.childs().dividendsAdjustment}sessionIdProxyProperty(){return this._sessionIdProxyProperty}symbolTextSourceProxyProperty(){return this._symbolTextSourceProxyProperty}setTextSourceIsAlwaysTickerRestrictionEnabled(e){this._textSourceIsAlwaysTickerRestrictionEnabled=e,this._recalcSymbolTextSourceProxyProperty()}isPrePostMarketPricesAvailableProperty(){return this._isPrePostMarketPricesAvailableProperty}isSettlementAsCloseForbiddenProperty(){return this._isSettlementAsCloseForbiddenProperty}isBackAdjustmentForbiddenProperty(){return this._isBackAdjustmentForbiddenProperty}invalidateBarColorerCache(){this._barColorerCache=null,this.invalidateBarStylesCache()}replayExitedDueUnsupportedInterval(){
return this._replayExitedDueUnsupportedInterval}replayExitedDueUnavailableForUserInterval(){return this._replayExitedDueUnavailableForUserInterval}onTimeFrameApplied(){return this._onTimeFrameApplied}onInReplayStateChanged(){return this._onInReplayStateChanged}dataWindowView(){return this._dataWindowView}statusView(){return gs?this._statusView:null}legendView(){return this._legendView}marketStatusModel(){return this._marketStatusModel}isMainSeries(){return!0}dataUpdatedModeModel(){return this._dataUpdatedModeModel}dataProblemModel(){return this._dataProblemModel}setDefaultTimeframe(e){this._pendingTimeRange=e}loadDataTo(e){const t=this._properties.childs().interval.value();this._onTimeFrameApplied.fire(e),this._seriesSource.modifySeries(this._getResolvingSymbolObject(),(0,Dt.getServerInterval)(t),e)}isInReplay(){return null!==this._replaySubscriber}quotes(){return this.data().isEmpty()?null:this._quotesProvider.quotes()}base(){return this._base}pointValue(){return this._pointValue}barCloseTime(){return this._lastBarCloseTime}priceSource(){let e=null;const t=this._properties.childs();switch(t.style.value()){case 2:e=t.lineStyle.childs().priceSource.value();break;case 14:e=t.lineWithMarkersStyle.childs().priceSource.value();break;case 15:e=t.steplineStyle.childs().priceSource.value();break;case 3:e=t.areaStyle.childs().priceSource.value();break;case 10:e=t.baselineStyle.childs().priceSource.value();break;case 13:e=t.columnStyle.childs().priceSource.value()}return e}updateAllViews(e){var t,s,i,r,a,n,o,l,h,d;null===(t=this._paneView)||void 0===t||t.update(e),this._dataWindowView.update(),this._legendView.update(),this._statusView.update(),this._averagePaneViews.forEach((t=>t.update(e))),this._highLowAvgPaneViews.forEach((t=>t.update(e))),this._labelPaneViews.forEach((t=>t.update(e))),this._priceAxisViews.forEach((t=>t.update(e))),this._priceLineAxisViews.forEach((t=>t.update(e))),null===(s=this._futureBarsPaneView)||void 0===s||s.update(e),null===(i=this._projectionBarsPaneView)||void 0===i||i.update(e),null===(r=this._waterlineView)||void 0===r||r.update(e),null===(a=this._prevClosePriceLineView)||void 0===a||a.update(e),null===(n=this._priceLineView)||void 0===n||n.update(e),null===(o=this._gotoDateView)||void 0===o||o.update(e),null===(l=this._endOfDataPaneView)||void 0===l||l.update(e),null===(h=this._baseHorizontalLineView)||void 0===h||h.update(e);const u=this._model.activeStrategySource().value();null==u||u.updateAllViews(e),this._lineStyleLastPriceCirclePaneView.update(e),null===(d=this._footprintStudy)||void 0===d||d.updateAllViews(e)}styleStudyInfo(e){return this.styleStudyInfos()[e]}barFunction(){return this._barFunction}precomputedBarStyle(e){return this._precomputedBarStyles.get(e)}setPrecomputedBarStyle(e,t){this._precomputedBarStyles.set(e,t)}symbolParams(){return(0,St.symbolParams)(this)}compareSymbolParams(e){return(0,St.compareSymbolParams)(this,e,this._model.unitConversionEnabled(),(e=>this.getSupportedResolution(e,!1)))}setSymbolParams(e){
const{symbol:t,currency:s,unit:i,style:a}=e,{symbolChanged:n,intervalChanged:o,currencyChanged:l,unitChanged:h,styleChanged:d,correctedInterval:u}=this.compareSymbolParams(e),c=null!=u?u:e.interval;void 0!==u&&Cs.logWarn(`Change interval value from ${e.interval} to ${u} because first is not supported`);const _=[Ts("symbol",t,n),Ts("interval",c,o),Ts("currency",s,l),Ts("unit",i,h),Ts("style",a,d)].filter((e=>null!==e)).join("; ");Cs.logInfo(`Applying series symbol params: ${_}`);const p=this.properties().childs();void 0!==t&&p.symbol.setValue(t),void 0!==s&&p.currencyId.setValue(s),void 0!==i&&p.unitId.setValue(i),o&&p.interval.setValue((0,r.ensureDefined)(c)),void 0!==a&&d&&p.style.setValue(a);let m=!1;d&&(m=this.isNeedRestart(),this.onChartStyleChanged()),!m&&(n||o||l||h)&&this._applySymbolParamsChanges({symbolChanged:n,currencyChanged:l,unitChanged:h,intervalChanged:o,styleChanged:d}),(n||l||h)&&this.model().checkLineToolSelection()}setSymbol(e){this.setSymbolParams({symbol:e})}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,b.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}measureUnitId(){return(0,b.measureUnitId)(this.symbolInfo())}isConvertedToOtherUnit(){return(0,b.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}valueAt(e,t){var s,i;return null!==(i=null===(s=this.data().search(e))||void 0===s?void 0:s.value[t])&&void 0!==i?i:null}symbolSource(){return this}barsProvider(){return this}title(e){return this.symbolTitle(e)}name(){return this.symbolTitle(ps.TitleDisplayTarget.StatusLine)}symbolTitle(e,t,s,i="exchange"){let r=this.properties().childs().symbol.value();const a=this.symbolInfo();if(null!==a){const{type:e}=a;r=(0,b.symbolTitle)(a,t,"forex"===e?"exchange":i)}return s?r:`${r}, ${(0,gt.translatedIntervalString)(this.properties().childs().interval.value())}`}setObsoleteZOrder(e){this._obsoleteZOrder=e}obsoleteZOrder(){return this._obsoleteZOrder}valuesProvider(){return new E(this,this.model())}statusProvider(e){return new V(this,this._model.properties().childs().scalesProperties.childs().textColor,this.properties().childs().statusViewStyle,e)}moveItem(e,t,s){if(10===this.style()&&0===t){const t=this.priceScale(),s=this.properties().childs().baselineStyle,i=t.height(),r=100-e.y/i*100,a=r<0?0:Math.round(10*r)/10;s.childs().baseLevelPercentage.setValue(Math.max(Math.min(a,100),0))}}rerequestData(){this._applySymbolParamsChanges({force:!0})}switchToReplay(e,t){this._replaySubscriber=e,this._isReplayResolutionAvailableForUser=t,this._onInReplayStateChanged.fire(),this._replaySubscriber.modifySeries(this.getSymbolString(),this._properties.childs().interval.value()),this.rerequestData()}switchToRealtime(){this.isInReplay()&&(this._removeReplaySubscriber(),this.rerequestData())}requestMoreDataAvailable(){return this._requestMoreDataAvailable}seriesLoaded(){
return this._seriesLoaded}endOfData(){var e;return void 0!==(null===(e=this._lastCompleteFlags)||void 0===e?void 0:e.data_completed)}endOfDataType(){var e,t;return null!==(t=null===(e=this._lastCompleteFlags)||void 0===e?void 0:e.data_completed)&&void 0!==t?t:null}dataPoweredBy(){return this._dataPoweredBy}boxSizeValue(){return this._boxSizeValue}isUserDeletable(){return!1}changeTimeFrame(){(0,n.trackEvent)("GUI","Change timeframe")}onTagsChanged(){return this._tagsChanged}state(e){var t;const s=this.obsoleteZOrder();let i={type:"MainSeries",id:this.id(),zorder:s,haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle,formattingDeps:this._formattingDeps};const r=this.properties().state();if(r.symbol=(0,b.symbolToSaveInState)(null!==(t=this._symbolInfo)&&void 0!==t?t:this._model.chartApi().lastSymbolResolveInfo(r.symbol),r.symbol),this._model.unitConversionEnabled()||(r.unitId=null),i.state=r,e){let e=this.bars();const t=this._model.timeScale().visibleExtendedDataRange(e,0);null!==t&&(e=e.range(t.firstBar(),t.lastBar())),i={...i,bars:As(e),nsBars:As(this.nsBars()),symbolInfo:this._symbolInfo,rtPrice:this.data().lastProjectionPrice,boxSize:this.data().boxSize,reversalAmount:this.data().reversalAmount}}return i}restoreState(e,t){if(t&&this._setStatus(5),!this._model.unitConversionEnabled()&&e.state&&delete e.state.unitId,this._properties.mergeAndFire(e.state),this._properties.hasChild("esdBreaksStyle")&&this._properties.removeProperty("esdBreaksStyle"),this._prevChartStyle=this.properties().childs().style.value(),this.createPaneView(),t){const t=e;this.restoreData(t.bars,t.nsBars,t.symbolInfo,t.rtPrice,t.boxSize,t.reversalAmount)}e.formattingDeps&&(this._formattingDeps=e.formattingDeps,this._recreatePriceFormattingDependencies()),this._syncFootprintStudy()}restoreData(e,t,s,i,r,a){this._status=5,this._data=new u.SeriesData,this._data.bars().restoreState(e),this._data.nsBars().restoreState(t),this._updateSymbolInfo(s),this._data.lastProjectionPrice=i,this._data.boxSize=r;const n=this.properties().childs();r||(6===n.style.value()?this._data.boxSize=n.pnfStyle.childs().inputs.childs().boxSize.value():4===n.style.value()&&(this._data.boxSize=n.renkoStyle.childs().inputs.childs().boxSize.value())),this._data.reversalAmount=a,a||5===n.style.value()&&(this._data.reversalAmount=n.kagiStyle.childs().inputs.childs().reversalAmount.value()),this._loading=!1}async setGotoDateResult(e,t){this._gotoDateResultCleared=!1;const i=await s.e(4079).then(s.bind(s,228579));this._gotoDateResultCleared||(this._gotoDateView=new i.GotoDateView(this,e,t),this._gotoDateView.doNotShowLastAvailableBar(this._doNotShowLastAvailableBar),this._model.updateSource(this))}clearGotoDateResult(){this._gotoDateView=null,this._gotoDateResultCleared=!0}doNotShowLastAvailableBar(e){var t;this._doNotShowLastAvailableBar=e,null===(t=this._gotoDateView)||void 0===t||t.doNotShowLastAvailableBar(e)}dataUpdated(){return this.dataEvents().dataUpdated()}moveData(e){
this._seriesSource.moveData(e),xs&&null!==this._volumePointWeights&&this._volumePointWeights.moveData(e)}getSupportedResolution(e,t=!0){if(null===this._symbolInfo||!(0,St.symbolSameAsCurrent)(this.symbol(),this._symbolInfo))return e;if(O.Interval.isRange(e)&&(0,b.isCloseBasedSymbol)(this._symbolInfo)){const t=this.interval();if(!O.Interval.isRange(t))return t;e="1D"}const s=this._symbolInfo.data_frequency;if(void 0!==s){let i=(0,Dt.getApplicableIntervalForFrequency)(s,e);if(i!==e){const e=this._model.defaultResolutions();if(!(e.includes(i)||window.is_authenticated&&window.user.is_pro)){const t=e.find((e=>(0,Dt.compareResolutions)(e,i)>=0));i=null!=t?t:e[e.length-1]}return t&&this.requestingResolutionLessThanFrequency.fire(s,i),i}}if(O.Interval.isIntraday(e)&&!this._symbolInfo.has_intraday)return t&&this.requestingIntradayWhenNotSupported.fire(),"D";if(O.Interval.isTicks(e)&&!this._symbolInfo["is-tickbars-available"])return t&&this.requestingTicksWhenNotSupported.fire(),"D";if(this._symbolInfo.hasOwnProperty("supported_resolutions")){const t=O.Interval.normalize(e),s=this._symbolInfo.supported_resolutions;if(null!==t&&-1===s.indexOf(t))return s[0]}return e}async seriesCreated(){const e=this._seriesSource.instanceId();if(null!==e)return e;const t=await Promise.race([this._deferredDestroyed.promise,new Promise((e=>{this.dataEvents().created().subscribe(this,e,!0)}))]);if(null==t)throw new Error("Series has been destroyed");return t}_updateBarFunction(){this._barFunction=(0,hs.barFunctionByStyle)(this.style(),this.priceSource())}_setProperties(e){e.hasChild("timeframe")||e.merge({timeframe:""}),e.hasChild("shortName")||e.merge({shortName:""}),e.hasChild("currencyId")||e.addChild("currencyId",new m.default(null)),e.hasChild("unitId")||e.addChild("unitId",new m.default(null)),this._properties=e;const t=e.childs();t.currencyId.subscribe(this,this._onCurrencyChanged),t.unitId.subscribe(this,this._onUnitChanged),t.timeframe.subscribe(this,this.changeTimeFrame),e.subscribe(this,this._onPropertiesChanged)}_updateSessionIdProxyProperty(e){const t=this._properties.childs().sessionId.value();let s=t;if(e){const e=this.symbolInfo();null!==e&&(s=e.subsession_id||t)}this._ignoreSessionIdProxyPropertyChanges=!0,this._sessionIdProxyProperty.setValue(s),this._ignoreSessionIdProxyPropertyChanges=!1}_onSessionIdProxyPropertyChanged(){this._ignoreSessionIdProxyPropertyChanges||this._properties.childs().sessionId.setValue(this._sessionIdProxyProperty.value()),this._updateLastPriceAnimationActive()}_onSymbolResolved(e){this._seriesErrorMessage=null,this._updateSymbolInfo(e),this._model.updateSource(this),this._model.onWidget()||((0,n.trackEvent)("Symbol",e.listed_exchange,e.name),(0,n.trackEvent)("Symbol Type",e.type,e.listed_exchange));const t=e.minmov/e.pricescale,s=this.properties().childs();4===s.style.value()&&s.renkoStyle.childs().inputs.childs().boxSize.value()<t?s.renkoStyle.childs().inputs.merge({boxSize:t}):6===s.style.value()&&s.pnfStyle.childs().inputs.childs().boxSize.value()<t?s.pnfStyle.childs().inputs.merge({boxSize:t
}):5===s.style.value()&&s.kagiStyle.childs().inputs.childs().reversalAmount.value()<t&&s.kagiStyle.childs().inputs.merge({reversalAmount:t});const i=this.interval(),r=this.getSupportedResolution(i);i!==r&&this.setSymbolParams({interval:r}),this._checkChartStyle(),this._formattingDeps={format:e.format,pricescale:e.pricescale,minmov:e.minmov,fractional:e.fractional,minmove2:e.minmove2,variable_tick_size:e.variable_tick_size}}_onSymbolError(e){this._setStatus(4),this._loading=!1,this._properties.childs().shortName.setValue(this._properties.childs().symbol.value()),this._model.clearAllStudies(),this.updateAllViews((0,ge.sourceChangeEvent)(this.id())),this._model.updateSource(this),e!==At.permissionDenied&&this._model.resetTimeScale(),this._sendTelemetryCounter("symbol_error",this._getTelemetryAdditionalData(e,!1)),this._symbolResolvingActive.setValue(!1)}_sendTelemetryCounter(e,t){void 0===t&&(t=this._getTelemetryAdditionalData());const s=Object.assign({count:1},{additional:t});Ve.telemetry.sendChartReport(e,s)}_getTelemetryAdditionalData(e,t){t=void 0===t||t;const s={symbol:this.actualSymbol()};return t&&(s.resolution=this.interval()),void 0!==e&&(s.reason=e),s}_onSeriesError(e){this._loading=!1;let t=e.error;const s=e.ctx;if(s){const e={};Object.keys(s).forEach((t=>{e[t]=s[t].toString()})),t=t.format(e)}ws&&Cs.logNormal("Error reason: "+t),this._seriesErrorMessage=t;const i=fs&&this._symbolInfo?10:4;this._setStatus(i),this._seriesLoaded=!0,this._sendTelemetryCounter("series_error",this._getTelemetryAdditionalData(t)),this._enablePriceRangeReady()}_onSeriesLoading(e){this._loading=!0,this._setStatus(2)}_onDataUpdated(e,t,s,i){var a;if(xs&&i&&this._symbolInfo){let e=1/0;if((0,b.hasVolume)(this._symbolInfo))for(const t of this.bars().fullRangeIterator()){const s=t.value[5];0!==s&&(e=Math.min(e,s))}Number.isFinite(e)?this._volumePointWeights=new Ne(e):this._volumePointWeights=null,this._updateTimeScaleTimePointWeights()}if(xs&&null!==this._volumePointWeights){const e=t?this.bars().fullRangeIterator():s?this.bars().rangeIterator(s.index,(0,r.ensureNotNull)(this.bars().lastIndex())):null;if(null!==e)for(const t of e)this._volumePointWeights.setVolume(t.index,t.value[5])}t?this._requestMoreDataAvailable=!0:this._lastPriceAnimationActive&&this._seriesLoaded&&this._lineStyleLastPriceCirclePaneView.update((0,ge.sourceChangeEvent)(this.id())),this._lastBarCloseTime=e&&e.closeTime||null,this._boxSizeValue.setValue(this.data().boxSize),this._statusView.update(),this.clearAveragePriceCache(),this.clearHighLowPriceCache();const n=this.model(),o=(0,r.ensureNotNull)(n.paneForSource(this));n.recalculatePane(o,(0,ge.sourceChangeEvent)({sourceId:this.id(),realtime:!t,firstUpdatedTimePointIndex:null!==(a=null==s?void 0:s.index)&&void 0!==a?a:void 0})),n.updateSource(this)}_setStatus(e){this._status=e,this._statusView.update(),this.model().updateSource(this),this._onStatusChanged.fire()}_onBarReceived(e){this.model().recalcVisibleRangeStudies(!0)}_recreateFormatter(){var e,t;this._formatter=(0,
b.createSeriesFormatter)(null!==(e=this.symbolInfo())&&void 0!==e?e:this._formattingDeps,this.properties().childs().minTick.value()),this._ignoreMinMoveFormatter=(0,b.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value(),!0),null===(t=this._priceScale)||void 0===t||t.updateFormatter(),this._formatterChanged.fire()}_recreatePriceStep(){const{minMove:e,priceScale:t}=(0,b.getSeriesPriceFormattingState)(this.symbolInfo()),s=e/t;this._ignoreMinMovePriceStep=1/t,this._priceStep!==s&&(this._priceStep=s,this._priceStepChanged.fire())}_recreatePriceFormattingDependencies(){this._recreateFormatter(),this._recreatePriceStep()}_onQuotesUpdate(e,t){if(ys){const e=void 0!==t.values.change||void 0!==t.values.change_percent;e&&this._legendView.update();const s=void 0!==t.values.prev_close_price;s&&((0,r.ensureNotNull)(this._prevClosePriceLineView).update((0,ge.sourceChangeEvent)(this.id())),(0,r.ensureNotNull)(this._prevClosePriceAxisView).update((0,ge.sourceChangeEvent)(this.id()))),(e||s)&&this.model().updateSource(this)}void 0!==e.values.current_session&&e.values.current_session!==this._currentSession&&(this._currentSession=e.values.current_session,this._updateLastPriceAnimationActive())}_updateIsPrePostMarketPricesForbiddenProperty(){const e=(0,b.symbolHasPreOrPostMarket)(this._symbolInfo)&&(this.isDWM()||(0,b.isRegularSessionId)(this.sessionIdProxyProperty().value()));this._isPrePostMarketPricesAvailableProperty.setValue(e)}_updateSettlementAsCloseForbiddenProperty(){var e;const t=this.isDWM()&&Boolean(null===(e=this._symbolInfo)||void 0===e?void 0:e.has_settlement);this._isSettlementAsCloseForbiddenProperty.setValue(!t)}_updateBackAdjustmentForbiddenProperty(){var e;const t=Boolean(null===(e=this._symbolInfo)||void 0===e?void 0:e.has_backadjustment);this._isBackAdjustmentForbiddenProperty.setValue(!t)}_removeReplaySubscriber(){{if(!this.isInReplay())return;const e=this._replaySubscriber;this._replaySubscriber=null,this._isReplayResolutionAvailableForUser=null,this._onInReplayStateChanged.fire(),null==e||e.destroy()}}_getSymbolForApi(){return this.symbol()}_getSymbolObject(e){const t=this._getExtendedSymbolObject(e);if(y.SYMBOL_STRING_DATA.hasOwnProperty(this.properties().childs().style.value())){return{symbol:t,type:this.styleStudyInfo(this.getStyleShortName()+"Style").studyId+"!",inputs:this.getInputsProperties().state()}}return t}_getExtendedSymbolObject(e){const t={symbol:null!=e?e:this._getSymbolForApi()},s=this.properties().childs();null!==this.currency()&&(t["currency-id"]=this.currency());const i=this.unit();return this._model.unitConversionEnabled()&&null!==i&&(t["unit-id"]=i),this.isDWM()||(t.session=s.sessionId.value()),t.adjustment=s.dividendsAdjustment.value()?"dividends":"splits",s.backAdjustment.value()&&(t.backadjustment="default"),s.settlementAsClose.value()||(t["settlement-as-close"]=!1),t}_checkChartStyle(){const e=this.style();(0,b.isCloseBasedSymbol)(this.symbolInfo())?(0,b.isSingleValueBasedStyle)(e)||(this.requestingStyleIsNotSupported.fire(),this._styleToRecover={
correctedStyle:this.style(),originalStyle:e}):null!==this._styleToRecover&&(this.requestingStyleSupportRecovered.fire(this._styleToRecover.originalStyle),this._styleToRecover=null)}_updateSymbolInfo(e){if(this._symbolInfo=e,e){const t=this._properties.childs();t.shortName.setValue(e.name);const s=(0,b.extractSymbolNameFromSymbolInfo)(e,this.symbol());s&&t.symbol.setValue(s);const i=(0,b.symbolCurrency)(e),r=(0,b.symbolUnit)(e,this._model.unitConversionEnabled());"alwaysOff"===(0,N.currencyUnitVisibilityProperty)().value()||i===t.currencyId.value()&&r===t.unitId.value()||this._model.fullUpdate(),t.currencyId.setValue(i),t.unitId.setValue(r),this._updateSessionIdProxyProperty(!0)}this._base=e?e.pricescale/e.minmov:100,this._pointValue=e&&e.pointvalue||1;const t=(0,yt.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getExtendedSymbolObject());this._quotesProvider.setQuotesSessionSymbol(t),this._marketStatusModel.setSymbolInfo(e),e&&this._recreatePriceFormattingDependencies(),this._statusView.update(),this.priceScale().updateFormatter(),this._symbolResolvingActive.setValue(!e),this._updateIsPrePostMarketPricesForbiddenProperty(),this._dataPoweredBy=(0,Ce.getDataVendorString)(e),this._updateBackAdjustmentForbiddenProperty(),this._updateSettlementAsCloseForbiddenProperty()}_createHighLowAvgViews(){const e=this.properties().childs().highLowAvgPrice,t=this._getHighLowPrice.bind(this),s=function(e,t,s,i){const r=s.childs(),a=mt(e,t,{label:_t,labelVisible:r.highLowPriceLabelsVisible,lineVisible:r.highLowPriceLinesVisible,lineColor:r.highLowPriceLinesColor,lineWidth:r.highLowPriceLinesWidth},(()=>i(0))),n=mt(e,t,{label:pt,labelVisible:r.highLowPriceLabelsVisible,lineVisible:r.highLowPriceLinesVisible,lineColor:r.highLowPriceLinesColor,lineWidth:r.highLowPriceLinesWidth},(()=>i(1)));return{paneViews:[a.paneView,n.paneView],panePriceAxisViews:[a.panePriceAxisView,n.panePriceAxisView],priceAxisViews:[a.priceAxisView,n.priceAxisView],priceLineAxisViews:[a.priceLineAxisView,n.priceLineAxisView]}}(this._model,this,e,t);this._highLowAvgPaneViews.push(...s.paneViews),this._labelPaneViews.push(...s.panePriceAxisViews),this._priceAxisViews.push(...s.priceAxisViews),this._priceLineAxisViews.push(...s.priceLineAxisViews)}_createAverageViews(){}_getHighLowPrice(e){if(!this._highLowPriceCache.has(e)){const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return null;const t=function(e,t,s){return e.minMaxOnRangeCached(t,s,[{name:"low",offset:0},{name:"high",offset:0}])}(this._model.mainSeries().bars(),e.firstBar(),e.lastBar());if(null===t)return null;this._highLowPriceCache.set(1,t.min),this._highLowPriceCache.set(0,t.max)}return this._highLowPriceCache.get(e)}_getAveragePrice(e){return null}_onSeriesCompleted(e){var t;this._sendTelemetryCounter("series_loaded",this._getTelemetryAdditionalData()),this._loading=!1,this._seriesErrorMessage=null;let i=e.updateMode;switch("pulsed"===i&&(i="delayed"),i){case"streaming":this._setStatus(3);break;case"endofday":this._setStatus(6);break;case"delayed":this._setStatus(8);break
;case"replay":this._setStatus(11)}i.match(/delayed_streaming/)&&this._setStatus(9),this._lastCompleteFlags=null!==(t=e.flags)&&void 0!==t?t:null;const a=(0,r.ensureNotNull)(this._model.paneForSource(this));a.recalculatePriceScale(this.priceScale(),(0,ge.sourceChangeEvent)(this.id()));const n=It.InvalidationMask.full();if(null!==this._model.appliedTimeFrame().value()&&n.lockVisibleTimeRangeOnResize(),this._model.invalidate(n),!this.priceScale().isLockScale()||this.model().timeScale().isEmpty()||this._seriesLoaded||(this.model().timeScale().correctOffset(),this.model().timeScale().correctBarSpacing(),this.model().resetPriceScale(a,this.priceScale())),this._seriesLoaded=!0,this._seriesCompleted=!0,this.model().recalcVisibleRangeStudies(!0),this.model().recalcStudyBasedLineTools(),!Is){Is=!0;(0,s(975420).trackTiming)("Chart","Time to series",window.performance.now())}this.requestMoreData(),this._enablePriceRangeReady()}_notifyIntervalChanged(e){var t,s;const i={timeframe:null!==(t=this._pendingTimeRange)&&void 0!==t?t:void 0};this._intervalChanged.fire(e,i),this._pendingTimeRange=null!==(s=i.timeframe)&&void 0!==s?s:null}_onCurrencyChanged(){this._currencyChanged.fire()}_onUnitChanged(){this._unitChanged.fire()}_applySymbolParamsChanges(e){this._lastCompleteFlags=null,this.clearGotoDateResult();const t=this.interval(),s=this.currency(),i=this.unit(),a=O.Interval.isRange(t);a&&this._properties.childs().rangeStyle.childs().inputs.childs().range.setValue(O.Interval.parse(t).multiplier());const{symbolChanged:n,intervalChanged:o,currencyChanged:l,unitChanged:h,force:d}=e,u=o&&O.Interval.parse(t).isDWM()!=O.Interval.parse(t).isDWM();if((null!==s&&l||null!==i&&h)&&this.isInReplay()){const e=this.symbolInfo();(null===e||null!==s&&e.original_currency_id!==s||null!==i&&e.original_unit_id!==i)&&this._removeReplaySubscriber()}if(this._syncModel=null,this._prevRequestedInterval=t,5!==this._status&&(!this._seriesSource.isStarted()||n||l||h||u)&&this._updateSymbolInfo(null),this.isInReplay()){const e=()=>this._removeReplaySubscriber();n?e():o&&(a||O.Interval.isTicks(t)?e():(0,r.ensureNotNull)(this._isReplayResolutionAvailableForUser)(t)?this._isIntervalSupported(t)||(e(),this._replayExitedDueUnsupportedInterval.fire()):(e(),this._replayExitedDueUnavailableForUserInterval.fire()))}if(5===this._status)return void this._model.realignLineTools();this._loading=!0,this._setStatus(1),this._updateIsPrePostMarketPricesForbiddenProperty(),this._updateBackAdjustmentForbiddenProperty(),this._updateSettlementAsCloseForbiddenProperty(),this._symbolIntervalChanged.fire(),o&&this._notifyIntervalChanged(t),this._onRestarted.fire(),this._seriesLoaded=!1,this._seriesCompleted=!1,this._lineStyleLastPriceCirclePaneView.stopAnimation();let c=null;this._pendingTimeRange&&(c=this._pendingTimeRange,this._pendingTimeRange=null),this._onTimeFrameApplied.fire(c),this._onBeforeModifySeries(this.getSymbolString(),t);const _=this._shouldDefineNumberOfBarsForModifySeries(e)&&this._visibleBarsCount()||null;this.model().recalcVisibleRangeStudies(!0),this._data=null,
this._seriesSource.modifySeries(this._getResolvingSymbolObject(),(0,Dt.getServerInterval)(t),c,d,_),this._seriesSource.isStarted()||(this._predictBars=0,this._seriesSource.start()),(n||l||h)&&this.disablePriceRangeReady(),this.updateAllViews((0,ge.sourceChangeEvent)(this.id())),this._model.lightUpdate()}_isIntervalSupported(e){return!this.isInReplay()||(0,r.ensureNotNull)(this._replaySubscriber).canChangeResolution(e)}_onBeforeModifySeries(e,t){this._replaySubscriber&&this._replaySubscriber.modifySeries(e,t)}_getResolvingSymbolObject(){let e=this._getSymbolObject(this._symbolForResolve());return this._replaySubscriber&&(e=this._replaySubscriber.generateReplaySymbol(e)),e}_onSessionIdPropertyChanged(){this._sessionIdChanged.fire(),this.isDWM()||(this.restart(),this._updateLastPriceAnimationActive())}_subscribeRestartToSessionIdChange(){this.properties().childs().sessionId.subscribe(this,this._onSessionIdPropertyChangedBound)}_unsubscribeRestartToSessionIdChange(){this.properties().childs().sessionId.unsubscribe(this,this._onSessionIdPropertyChangedBound)}_updateLastPriceAnimationActive(){if(!this._options.lastPriceAnimationEnabled)return;const e=this._lastPriceAnimationActive,t=this.properties().childs(),s=t.style.value(),i=3===s||10===s||2===s||14===s||15===s;if(!this._model.isSnapshot()&&t.visible.value()&&i){const e=this.currentSession(),t=!(0,b.isRegularSessionId)(this.sessionIdProxyProperty().value())&&!this.isDWM();this._lastPriceAnimationActive="market"===e||t&&("pre_market"===e||"post_market"===e)}else this._lastPriceAnimationActive=!1;this._lastPriceAnimationActive&&e!==this._lastPriceAnimationActive&&this.model().invalidate(It.InvalidationMask.cursor())}_onPropertiesChanged(e){const t=this._properties.childs();e!==t.symbol&&e!==t.interval&&e!==t.timeframe&&(this._tagsChanged.fire(),this.createPaneView(),this.updateAllViews((0,ge.sourceChangeEvent)(this._id)),this.model().updateSource(this),(0,o.emit)("series_properties_changed",this._id))}_recalcSymbolTextSourceProxyProperty(){this._textSourceIsAlwaysTickerRestrictionEnabled?this._symbolTextSourceProxyProperty.setValue("ticker"):this._symbolTextSourceProxyProperty.setValue(this._properties.childs().statusViewStyle.childs().symbolTextSource.value())}_clearStylePlot(e,t){if(0===e.size())return;if(void 0===t&&e!==this.nsBars())return void(this._precomputedBarStyles=new WeakMap);const s=null!=t?t:(0,r.ensureNotNull)(e.firstIndex()),i=(0,r.ensureNotNull)(e.lastIndex())+1;e.range(s,i).each(((e,t)=>(this._precomputedBarStyles.delete(t),!1)))}_visibleBarsCount(){const e=this._model.timeScale().visibleBarsStrictRange();return null==e?void 0:e.count()}_symbolForResolve(){var e;const t=this.symbol();return this._seriesSource.symbolSameAsResolved(t)&&null!==(e=this._seriesSource.resolvedSymbol())&&void 0!==e?e:t}_shouldDefineNumberOfBarsForModifySeries(e){return!1}_syncFootprintStudy(){var e,t,i;17===this.style()?s.e(55133).then(s.bind(s,205838)).then((e=>{e.createVolumeFootprintStudy(this._model).then((e=>{var t,s,i
;null===(t=this._footprintStudy)||void 0===t||t.stop(),null===(i=null===(s=this._footprintStudy)||void 0===s?void 0:s.destroy)||void 0===i||i.call(s),this._footprintStudy=e,17===this.style()&&this._footprintStudy.start()}))})):(null===(e=this._footprintStudy)||void 0===e||e.stop(),null===(i=null===(t=this._footprintStudy)||void 0===t?void 0:t.destroy)||void 0===i||i.call(t),this._footprintStudy=null)}_onMinTickChanged(){this._recreateFormatter(),this._model.fullUpdate()}}},440617:(e,t,s)=>{TradingView.DEFAULT_BAR_COUNT=300,TradingView.TIME_PLOT=0,TradingView.OPEN_PLOT=1,TradingView.HIGH_PLOT=2,TradingView.LOW_PLOT=3,TradingView.CLOSE_PLOT=4,TradingView.ADT_PLOT=6;var i=s(761698).SeriesBase,r=s(190973).default,a=s(345848).trackEvent,n=s(339315),o=s(195543).SeriesHorizontalBaseLinePaneView,l=s(315347).TIMEFRAMETYPE,h=s(444331).isSingleValueBasedStyle;class d extends i{constructor(e,t,s,i){t.removeProperty("currencyId"),super(e,t,s,i),this.createPaneView(),this._properties.addExclusion&&(this._properties.addExclusion("visible"),this._properties.addExclusion("currencyId")),this._futureBarsPaneView=null,this._priceLineView=null,this._baseHorizontalLineView=new o(this),this.bindStyleChange(),this.bindJapChartsInputs(),this._createIsDWMProperty(),this.createDividendsAdjustmentProperty(),this.dividendsAdjustment.listeners().subscribe(this,(function(){this.restart()})),this._dataPoweredBy=null,this.properties().showCountdown.listeners().subscribe(this,d.prototype._onChangeShowCountdown),this._onChangeShowCountdown(this.properties().showCountdown),this._recreatePriceFormattingDependencies(),this.properties().lineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().lineWithMarkersStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().steplineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().areaStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().baselineStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this.properties().columnStyle.priceSource.listeners().subscribe(this,this._updateBarFunction),this._updateBarFunction()}_onChangeShowCountdown(e){var t=this;e.value()?this._countdownUpdateTimer=this._model.setInterval((function(){t._priceAxisView.updateCountdown()}),500):(this._model.clearInterval(this._countdownUpdateTimer),delete this._countdownUpdateTimer)}_createIsDWMProperty(){this._isDWMProperty=new r(this.isDWM()),this._onRestarted.subscribe(this,(function(){this._isDWMProperty.setValue(this.isDWM())}))}isDWMProperty(){return this._isDWMProperty}_onSeriesTimeFrame(e,t,s,i,r){var a=h(this.style())?e+.5:e,n=t;if(void 0===r)null!==s&&s.type!==l.PeriodBack||(n+=this._model.studyAwareDefaultRightOffset());else if(r.applyDefaultRightMargin)n+=this._model.studyAwareDefaultRightOffset();else if(r.percentRightMargin){var o=t-a+1,d=Math.max(0,Math.min(.99,r.percentRightMargin/100));n+=d*o/(1-d)}this._model.setTimeViewport(a,n)}purgeSymbolInfo(){this._symbolInfo=null}
bindStyleChange(){var e=this;Object.keys(d.STYLE_SHORT_NAMES).map((function(e){return d.STYLE_SHORT_NAMES[e]+"Style"})).forEach((function(t){e._properties[t].listeners().subscribe(e,d.prototype.invalidateBarStylesCache)}))}bindJapChartsInputs(){this._properties.renkoStyle.inputs.boxSize.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.wicks.listeners().subscribe(this,this.onInputChanged),this._properties.renkoStyle.inputs.sources.listeners().subscribe(this,this.onInputChanged),this._properties.pbStyle.inputs.lb.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.reversalAmount.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.kagiStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.boxSize.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.reversalAmount.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.sources.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.style.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.atrLength.listeners().subscribe(this,this.onInputChanged),this._properties.pnfStyle.inputs.oneStepBackBuilding.listeners().subscribe(this,this.onInputChanged),this._properties.rangeStyle.inputs.phantomBars.listeners().subscribe(this,this.onInputChanged)}createDividendsAdjustmentProperty(){var e=this;e.dividendsAdjustment=new r;var t=function(){var t=e._properties.dividendsAdjustment.value();e.dividendsAdjustment.setValue(t),a("Dividends adjust",!0===t?"On":"Off")};e._properties.dividendsAdjustment.listeners().subscribe(null,t),t()}onInputChanged(){this.restart()}getStyleShortName(){var e=this._properties.style.value();if(d.STYLE_SHORT_NAMES.hasOwnProperty(e))return d.STYLE_SHORT_NAMES[e];throw new Error("Missed short name for style "+e)}getStyleProperties(){return this._properties[this.getStyleShortName()+"Style"]}getInputsProperties(){return this.getStyleProperties().inputs||new r}getInputsInfoProperties(){return this.getStyleProperties().inputInfo||new r}getSourceIcon(){return{type:"loadSvg",svgId:"series."+this.properties().style.value()}}}Object.assign(d,n),TradingView.Series=d,t.Series=d,t.isSeries=function(e){return e instanceof d}},761843:(e,t,s)=>{s.d(t,{SeriesDataWindowView:()=>p});var i=s(150335),r=s(782086),a=s(168883),n=s(638456),o=s(885482),l=s(444331),h=s(77122),d=s(748844),u=s(616117);const c=n.CheckMobile.any(),_=h.enabled("hide_resolution_in_legend");class p extends r.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._series=e,this._model=t,this._valuesProvider=this._createValuesProvider(e,t),
this._items=this._valuesProvider.getItems().map((e=>new r.DataWindowItem(e.id,e.title,"",e.unimportant))),this.update()}update(){this._invalidated=!0}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}series(){return this._series}_updateImpl(){var e,t;const s=this._series.symbolInfo();if(s){const e=[s.name];if(_||e.push((0,a.translatedIntervalString)(this._series.interval())),(0,l.isEconomicSymbol)(s)){const t=(0,l.getSourceForEconomySymbol)(s);null!==t&&e.push(t)}else e.push((0,n.onWidget)()||"forex"===s.type?s.exchange:s.listed_exchange);this._header=e.join(` ${l.symbolTitleSeparator} `),this._title=s.description}else this._header=this._series.symbol();let r=this._model.crossHairSource().appliedIndex();h.enabled("use_last_visible_bar_value_in_legend")&&!(0,i.isNumber)(r)&&(r=null!==(t=null===(e=this._model.timeScale().visibleBarsStrictRange())||void 0===e?void 0:e.lastBar())&&void 0!==t?t:NaN);const o=this._valuesProvider.getValues(r);for(let e=0;e<o.length;++e){const t=o[e],s=this._items[e];s.setValue(t.value),s.setVisible(t.visible),s.setColor(t.color)}}_createValuesProvider(e,t){return new d.SeriesValuesProvider(e,t)}_showLastPriceAndChangeOnly(){return c&&(null===this._model.crossHairSource().pane||(0,u.isLineToolName)(o.tool.value())||null!==this._model.lineBeingEdited())}}},195543:(e,t,s)=>{s.d(t,{SeriesHorizontalBaseLinePaneView:()=>r});var i=s(456757);class r extends i.SeriesHorizontalLinePaneView{constructor(e){super(e)}_updateImpl(){this._lineRendererData.visible=!1;const e=this._series.priceScale().mode();if(!e.percentage&&!e.indexedTo100)return;const t=this._series.firstValue();null!==t&&(this._lineRendererData.visible=!0,this._lineRendererData.y=this._series.priceScale().priceToCoordinate(t,t),this._lineRendererData.color=this._series.properties().childs().baseLineColor.value())}}},456757:(e,t,s)=>{s.d(t,{SeriesHorizontalLinePaneView:()=>r});var i=s(955831);class r extends i.HorizontalLinePaneView{constructor(e){super(),this._series=e,this._model=e.model()}}},30574:(e,t,s)=>{s.d(t,{translateSessionDescription:()=>a,translateSessionExtendedDescription:()=>l,translateSessionShortDescription:()=>o});var i=s(444372);const r=new Map([["Premarket",i.t(null,{context:"sessions"},s(156935))],["Postmarket",i.t(null,{context:"sessions"},s(798801))],["Regular Trading Hours",i.t(null,{context:"sessions"},s(824380))],["Extended Trading Hours",i.t(null,{context:"sessions"},s(897442))],["Electronic Trading Hours",i.t(null,{context:"sessions"},s(475610))]]);function a(e){var t;return null!==(t=r.get(e))&&void 0!==t?t:e}const n=new Map([["Premarket",i.t(null,{context:"sessions"},s(556137))],["Postmarket",i.t(null,{context:"sessions"},s(332929))],["Regular Trading Hours",i.t(null,{context:"sessions"},s(663798))],["Extended Trading Hours",i.t(null,{context:"sessions"},s(333021))],["Electronic Trading Hours",i.t(null,{context:"sessions"},s(333021))]]);function o(e){var t;return null!==(t=n.get(e))&&void 0!==t?t:e}function l(e){var t;return null!==(t=r.get(e))&&void 0!==t?t:e}},
937994:(e,t,s)=>{function i(e=0){return e<1e3?e:e/1e3}function r(e,t){if(e.length>t){const s=/[\W]+$/g,i=e.substring(0,t),r=i.replace(s,"");return`${r.length?r:i.substring(0,t-1)}`}return e}s.d(t,{cutString:()=>r,ensureDurationInSeconds:()=>i})},234271:(e,t,s)=>{s.d(t,{getPersistentLogger:()=>r,setPersistentLogger:()=>a});let i=null;function r(){return i}function a(e){i=e}},466931:(e,t,s)=>{s.d(t,{supportPortalProblemsHost:()=>i});let i=""}}]);