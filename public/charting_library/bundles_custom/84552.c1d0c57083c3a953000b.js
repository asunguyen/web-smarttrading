(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[84552],{129586:(t,e,r)=>{"use strict";function n(t){return"object"==typeof t&&"metaInfo"in t}function i(t){return null==t}var o;r.d(e,{TelemetryGroup:()=>o,hasMetaInfo:()=>n,isAbsentParam:()=>i}),function(t){t.Fast="fast",t.Medium="medium",t.Slow="slow"}(o||(o={}))},971417:(t,e,r)=>{"use strict";function n(t){return t===i(t)}function i(t){const e=t.indexOf("$"),r=t.indexOf("@");return e<0&&r>=0?null:t.substring(Math.max(e+1,0),r>=0?r:t.length)}function o(t){return t.startsWith("PUB;")}function s(t){return t.startsWith("USER;")}function a(t){return t.startsWith("STD;")}function u(t){return t.includes("Candlestick%1Pattern%1")}function l(t){return t.startsWith("EDGR_")}r.d(e,{extractPineId:()=>i,isCandleStickId:()=>u,isCustomPineId:()=>s,isEdgrPineId:()=>l,isPineIdString:()=>n,isPublishedPineId:()=>o,isStandardPineId:()=>a})},566119:(t,e,r)=>{"use strict";r.d(e,{convertScript:()=>R,deletePine:()=>j,getPineFacadeUrl:()=>d,getPineSourceCode:()=>U,isAuthToGetPineSourceCode:()=>B,isAuthToWritePineScript:()=>$,isPubPineInfo:()=>E,isSavedPineInfo:()=>w,isScriptLibrary:()=>O,isScriptStrategy:()=>C,parseScriptTitleAsync:()=>k,renamePine:()=>H,requestBuiltinScripts:()=>G,requestUserScripts:()=>F,saveNew:()=>M,saveNewDraft:()=>x,saveNext:()=>W,saveNextDraft:()=>D,translateScriptAsync:()=>b,translateScriptAsync2:()=>L});var n=r(345848),i=r(541558);class o{constructor(){this._cache=new Map,window.loginStateChange&&window.loginStateChange.subscribe(this,this.clear)}get(t){return this._cache.get(t)}set(t,e){this._cache.set(t,e)}delete(t){return this._cache.delete(t)}clear(){this._cache.clear()}}var s=r(251954),a=r(226722),u=r(791488),l=r(129586);function c(){return window.user&&window.user.username}function d(){const t=new URL(window.PINE_URL,location.origin);return t.pathname.endsWith("/")||(t.pathname+="/"),t.href}function p(t){if("object"==typeof t.reason)return t.reason;if(t.reason2)return t.reason2;const e={errors:[],warnings:[]};if((0,l.hasMetaInfo)(t.result)){const r=t.result&&t.result.metaInfo;r&&void 0!==r.warnings&&r.warnings.forEach((t=>e.warnings.push({message:t})))}if(t.reason){(Array.isArray(t.reason)?t.reason:t.reason.split("\n")).forEach((t=>{const r=t.match(u.RE_MESSAGE_LINE_WITH_DIGITS),n=r&&r.length&&Number(r[1]),i={message:t};if("number"==typeof n){i.start={line:n,column:0};const t=i.message.split(": ");t.shift(),i.message=t.join(": ")}e.errors.push(i)}))}return e}function f(t){if(t.success)return t.result;if(t.error)throw t.error;throw p(t)}function h(t){if(t.success)return{success:t.success,metaInfo:t.result.metaInfo,compileErrors:p(t)};if(t.error)throw t.error;throw p(t)}function y(t){if(t.error)throw t.error;return{success:t.success,metaInfo:t.result.metaInfo,compileErrors:p(t)}}function S(t,e,r){const n={scriptMetaInfo:t,scriptVersionToUpdate:e,fullSourceIdentifier:r};a.TVXWindowEvents.emit(u.TV_SCRIPT_MODIFIED,JSON.stringify(n)),s.emit(u.TV_SCRIPT_MODIFIED,n),setTimeout((()=>{var t
;null===(t=window.scriptUpdater)||void 0===t||t.onTVScriptModified({...n,isSelfCall:!0})}))}var g=r(971417),_=r(294142),m=r(120780),P=r(175203);function v(t,e){const r=new URL(function(t){return t.split("/").map((t=>encodeURIComponent(t))).join("/")}(t),d());for(const t in e){const n=e[t];(0,l.isAbsentParam)(n)||r.searchParams.set(t,String(n))}return r.toString()}function T(t,e,r=!1){const n={method:t,mode:"cors"};return"POST"===t&&e&&(n.body=function(t){const e=new FormData;for(const r of Object.keys(t))e.append(r,t[r]);return e}(e)),r||(n.credentials="include"),n}async function I({urlPath:t,urlParams:e,data:r,withoutCredentials:n,method:i="GET"}){const o=v(t,e),s=T(i,r,n),a=function(t){_.log.logNormal(`Requesting pine facade scripts, url: ${t}`);const e=t.split("/")[0],r=u.pineTelemetryGroups.get(e),n=Date.now();return e=>{const i=Date.now()-n;if(P.telemetry.sendReport("pine",`${r}_group_time_frame`,{value:i}),e)return P.telemetry.sendReport("pine",`${r}_group_ok`),void _.log.logNormal(`Requesting pine facade scripts finished, url: ${t}`);P.telemetry.sendReport("pine",`${r}_group_error`),_.log.logError(`Requesting pine facade scripts failed, url: ${t}`)}}(t);try{const t=await(0,m.fetch)(o,s),e=await t.json();if(!t.ok)throw p(e);return a(!0),e}catch(t){throw a(!1),t}}function w(t){return"scriptTitle"in t&&"modified"in t}function E(t){return"userId"in t&&"scriptAccess"in t}function C(t){return"strategy"===t.kind}function O(t){return"library"===t.kind}const V=new o,N=new o,A=new class extends o{constructor(){super(),this._key=(0,i.guid)()}reset(t){super.set(this._key,t)}get(){return super.get(this._key)}clear(){super.clear()}};async function L(t,e){(0,n.trackEvent)("Pine","ScriptLib.translateScript");const r={};(0,g.isCustomPineId)(t)||(r.user_name=c());try{const n=h(await I({urlPath:`translate/${t}/${e}`,urlParams:r}));return+e<0&&(V.delete(t),N.delete(t),A.clear(),function(t){const e={scriptMetaInfo:t};a.TVXWindowEvents.emit(u.TV_SCRIPT_LEGACY_PINE_PROCESSED,JSON.stringify(e)),s.emit(u.TV_SCRIPT_LEGACY_PINE_PROCESSED,e),setTimeout((()=>{var t;null===(t=window.scriptUpdater)||void 0===t||t.onTVScriptLegacyPineProcessed(e)}))}(n.metaInfo)),n}catch(t){throw t}}async function b(t,e,r={},i=!1){return(0,n.trackEvent)("Pine","ScriptLib.translateScript"),I({method:"POST",urlPath:`translate_source/${e}`,urlParams:{is_pine_ex:i},data:{user_name:c(),source:t,inputs:JSON.stringify(r)}}).then((t=>h(t)))}function R(t,e){return I({method:"POST",urlPath:"convert",data:{source:t,version_to:String(e)}}).then((t=>{if(t.reason)throw t.reason;return f(t)}))}function D(t,e,r=!1){return(0,n.trackEvent)("Pine","ScriptLib.saveNextDraft"),e?I({method:"POST",urlPath:`save/next_draft/${t}`,urlParams:{user_name:c(),allow_create_new:r},data:{source:e}}).then((t=>y(t))):Promise.reject(u.EMPTY_SOURCE_CODE)}function x(t){return(0,n.trackEvent)("Pine","ScriptLib.saveNewDraft"),t?I({method:"POST",urlPath:"save/new_draft",urlParams:{user_name:c(),allow_use_existing_draft:!0},data:{source:t}}).then((t=>y(t))):Promise.reject(u.EMPTY_SOURCE_CODE)}
function M({scriptSource:t,scriptName:e,allowOverwrite:r,currentVersion:i}){if((0,n.trackEvent)("Pine","ScriptLib.saveNew"),!t)return Promise.reject(u.EMPTY_SOURCE_CODE);const o={name:e,user_name:c()};return r&&(o.allow_overwrite=!0),I({method:"POST",urlPath:"save/new",urlParams:o,data:{source:t}}).then((t=>{A.clear();const e=y(t);return S(e.metaInfo,i),e}))}function W({scriptIdPart:t,scriptSource:e,currScriptVersion:r,isLegacyScript:i,fullSourceIdentifier:o,scriptName:s}){if((0,n.trackEvent)("Pine","ScriptLib.saveNext"),!e)return Promise.reject(u.EMPTY_SOURCE_CODE);const a={user_name:c(),allow_create_new:i},l={source:e};return void 0!==s&&(a.name=s),I({method:"POST",urlPath:`save/next/${t}`,urlParams:a,data:l}).then((t=>{A.clear();const e=y(t);return S(e.metaInfo,r,o),e}))}function k(t){return(0,n.trackEvent)("Pine","ScriptLib.parseScriptTitle"),t?I({method:"POST",urlPath:"parse_title",data:{user_name:c(),source:t}}).then((t=>f(t))):Promise.reject(u.EMPTY_SOURCE_CODE)}function $(t){if((0,g.isCustomPineId)(t))return Promise.resolve(!0);const e=N.get(t);if(e)return e;(0,n.trackEvent)("Pine","ScriptLib.isAuthToWritePineScript");const r=I({urlPath:`is_auth_to_write/${t}`});return N.set(t,r),r}function B(t,e){const r=V.get(t);if(r)return r;(0,n.trackEvent)("Pine","ScriptLib.isAuthToGetPineSourceCode");const i=I({urlPath:`is_auth_to_get/${t}/${e}`});return V.set(t,i),i}function U(t,e,r){return(0,n.trackEvent)("Pine","ScriptLib.getPineSourceCode"),I({urlPath:`get/${t}/${e}`,urlParams:{no_4xx:r}})}function F(){if((0,n.trackEvent)("Pine","ScriptLib.requestUserScripts"),!window.is_authenticated)return Promise.resolve([]);const t=A.get();if(t)return t;const e=I({urlPath:"list",urlParams:{filter:"saved"}});return A.reset(e),e}async function G(){(0,n.trackEvent)("Pine","ScriptLib.requestBuiltinScripts");try{_.log.logNormal("Request built-in scripts");const t=await I({urlPath:"list",urlParams:{filter:"standard"},withoutCredentials:!0});return _.log.logNormal("Request built-in scripts finished"),t}catch(t){throw _.log.logWarn("Request built-in scripts finished with fail"),t}}function j(t){return(0,n.trackEvent)("Pine","ScriptLib.deletePine"),I({method:"POST",urlPath:`delete/${t}`,urlParams:{user_name:c()}}).then((e=>(V.delete(t),N.delete(t),A.clear(),function(t){const e={scriptIdPart:t};a.TVXWindowEvents.emit(u.TV_SCRIPT_DELETED,JSON.stringify(e)),s.emit(u.TV_SCRIPT_DELETED,e),setTimeout((()=>{var t;null===(t=window.scriptUpdater)||void 0===t||t.onTVScriptDeleted({...e,isSelfCall:!0})}))}(t),e)))}function H(t,e,r=!1){return(0,n.trackEvent)("Pine","ScriptLib.renamePine"),I({method:"POST",urlPath:`rename/${e}`,urlParams:{name:t,user_name:c(),force:r}}).then((r=>(A.clear(),function(t,e){const r={scriptIdPart:t,scriptName:e};a.TVXWindowEvents.emit(u.TV_SCRIPT_RENAMED,JSON.stringify(r)),s.emit(u.TV_SCRIPT_RENAMED,r),setTimeout((()=>{var t;null===(t=window.scriptUpdater)||void 0===t||t.onTVScriptRenamed({...r,isSelfCall:!0})}))}(e,t),r)))}!function(t,e,r){a.TVXWindowEvents.on(u.TV_SCRIPT_MODIFIED,(t=>{var e;r.clear(),
null===(e=window.scriptUpdater)||void 0===e||e.onTVScriptModified(JSON.parse(t))})),a.TVXWindowEvents.on(u.TV_SCRIPT_DELETED,(n=>{var i;t.clear(),e.clear(),r.clear(),null===(i=window.scriptUpdater)||void 0===i||i.onTVScriptDeleted(JSON.parse(n))})),a.TVXWindowEvents.on(u.TV_SCRIPT_RENAMED,(t=>{var e;r.clear(),null===(e=window.scriptUpdater)||void 0===e||e.onTVScriptRenamed(JSON.parse(t))})),a.TVXWindowEvents.on(u.TV_SCRIPT_LEGACY_PINE_PROCESSED,(t=>{var e;r.clear(),null===(e=window.scriptUpdater)||void 0===e||e.onTVScriptLegacyPineProcessed(JSON.parse(t))}))}(V,N,A)},791488:(t,e,r)=>{"use strict";r.d(e,{EMPTY_SOURCE_CODE:()=>u,RE_MESSAGE_LINE_WITH_DIGITS:()=>l,TV_SCRIPT_DELETED:()=>o,TV_SCRIPT_LEGACY_PINE_PROCESSED:()=>a,TV_SCRIPT_MODIFIED:()=>i,TV_SCRIPT_RENAMED:()=>s,pineTelemetryGroups:()=>c});var n=r(129586);const i="TVScriptModified",o="TVScriptDeleted",s="TVScriptRenamed",a="TVScriptLegacyPineProcessed",u="Cannot save empty source code",l=/[l|L]ines? (\d*)/,c=new Map([["delete",n.TelemetryGroup.Fast],["get",n.TelemetryGroup.Fast],["is_auth_to_get",n.TelemetryGroup.Fast],["is_auth_to_write",n.TelemetryGroup.Fast],["parse_title",n.TelemetryGroup.Fast],["rename",n.TelemetryGroup.Fast],["lib_list",n.TelemetryGroup.Fast],["list",n.TelemetryGroup.Medium],["eval_pine_ex",n.TelemetryGroup.Medium],["translate_light",n.TelemetryGroup.Medium],["process_legacy",n.TelemetryGroup.Slow],["publish",n.TelemetryGroup.Slow],["save",n.TelemetryGroup.Slow],["translate",n.TelemetryGroup.Slow],["translate_source",n.TelemetryGroup.Slow],["gen_alert",n.TelemetryGroup.Slow]])},854798:(t,e,r)=>{"use strict";r.d(e,{Version:()=>i});var n=r(650151);class i{constructor(t,e){this._major=t,this._minor=e}major(){return this._major}minor(){return this._minor}isZero(){return 0===this._major&&0===this._minor}toString(){return this._major+"."+this._minor}compareTo(t){return this._major<t._major?-1:this._major>t._major?1:this._minor<t._minor?-1:this._minor>t._minor?1:0}isLess(t){return this.compareTo(t)<0}isLessOrEqual(t){return this.compareTo(t)<=0}isEqual(t){return 0===this.compareTo(t)}isGreater(t){return this.compareTo(t)>0}isGreaterOrEqual(t){return this.compareTo(t)>=0}static parse(t){if(t instanceof i)return new i(t.major(),t.minor());if("number"==typeof t)return(0,n.assert)(Math.floor(t)===t,"Version should not be a float number"),new i(t,0);if("string"==typeof t){const e=t.split(".");if(1===e.length){const r=parseInt(e[0],10);return(0,n.assert)(!isNaN(r),"Bad version string: "+t),new i(r,0)}if(2===e.length){const r=parseInt(e[0],10);(0,n.assert)(!isNaN(r),"Bad version string: "+t);const o=parseInt(e[1],10);return(0,n.assert)(!isNaN(o),"Bad version string: "+t),new i(r,o)}throw new Error("Bad version string (one dot expected): "+t)}throw new Error("Bad version: "+t)}}i.ZERO=new i(0,0)},368135:(t,e,r)=>{"use strict";var n,i,o;function s(t){return"line"===t.type}function a(t){return"shapes"===t.type}function u(t){return"chars"===t.type}function l(t){return"arrows"===t.type}function c(t){return"data"===t.type}function d(t){
return"dataoffset"===t.type}function p(t){return"ohlc_open"===t.type}function f(t){return"ohlc_high"===t.type}function h(t){return"ohlc_low"===t.type}function y(t){return"ohlc_close"===t.type}function S(t){return p(t)||f(t)||h(t)||y(t)}function g(t){return"colorer"===t.type&&"palette"in t}function _(t){return"colorer"===t.type&&!("palette"in t)}function m(t){return"colorer"===t.type}function P(t){return"bar_colorer"===t.type}function v(t){return"bg_colorer"===t.type}function T(t){return"text_colorer"===t.type}function I(t){return"ohlc_colorer"===t.type}function w(t){return"wick_colorer"===t.type}function E(t){return"border_colorer"===t.type}function C(t){return"up_colorer"===t.type}function O(t){return"down_colorer"===t.type}function V(t){return"alertcondition"===t.type}function N(t){return s(t)||a(t)||u(t)||l(t)}function A(t){return"Plot"!==t}function L(t){return"ohlc_bars"===t.plottype}function b(t){return"ohlc_candles"===t.plottype}function R(t){return m(t)||P(t)||v(t)||c(t)||d(t)||I(t)||V(t)||C(t)||O(t)||E(t)||w(t)||T(t)}function D(t){return m(t)||T(t)||P(t)||c(t)||d(t)||I(t)||w(t)||E(t)||C(t)||O(t)||V(t)}r.r(e),r.d(e,{LineStudyPlotStyle:()=>n,PlotSymbolSize:()=>o,STUDYPLOTDISPLAYTARGET:()=>i,isAlertConditionPlot:()=>V,isArrowsPlot:()=>l,isBarColorerPlot:()=>P,isBgColorerPlot:()=>v,isCandleBorderColorerPlot:()=>E,isCandleWickColorerPlot:()=>w,isCharsPlot:()=>u,isColorerPlot:()=>m,isDataOffsetPlot:()=>d,isDataPlot:()=>c,isDownColorerPlot:()=>O,isLinePlot:()=>s,isNonVisualPlot:()=>D,isOhlcClosePlot:()=>y,isOhlcColorerPlot:()=>I,isOhlcHighPlot:()=>f,isOhlcLowPlot:()=>h,isOhlcOpenPlot:()=>p,isOhlcPlot:()=>S,isOhlcPlotStyleBars:()=>L,isOhlcPlotStyleCandles:()=>b,isPaletteColorerPlot:()=>g,isPlotSupportDisplay:()=>N,isPlotTitleDefined:()=>A,isPlotWithTechnicalValues:()=>R,isRgbaColorerPlot:()=>_,isShapesPlot:()=>a,isTextColorerPlot:()=>T,isUpColorerPlot:()=>C}),function(t){t[t.Line=0]="Line",t[t.Histogram=1]="Histogram",t[t.Cross=3]="Cross",t[t.Area=4]="Area",t[t.Columns=5]="Columns",t[t.Circles=6]="Circles",t[t.LineWithBreaks=7]="LineWithBreaks",t[t.AreaWithBreaks=8]="AreaWithBreaks",t[t.StepLine=9]="StepLine",t[t.StepLineWithDiamonds=10]="StepLineWithDiamonds",t[t.StepLineWithBreaks=11]="StepLineWithBreaks"}(n||(n={})),function(t){t[t.None=0]="None",t[t.Pane=1]="Pane",t[t.DataWindow=2]="DataWindow",t[t.PriceScale=4]="PriceScale",t[t.StatusLine=8]="StatusLine",t[t.All=15]="All"}(i||(i={})),function(t){t.Auto="auto",t.Tiny="tiny",t.Small="small",t.Normal="normal",t.Large="large",t.Huge="huge"}(o||(o={}))},62745:(t,e,r)=>{"use strict";r.d(e,{ChartColorDependentStudyInputNames:()=>o,InputDisplayFlags:()=>n,RangeDependentStudyInputNames:()=>i,areStudyInputsEqual:()=>d,editableStudyInputs:()=>h,getInputValue:()=>l,isExtendedInput:()=>a,isExtendedInputSource:()=>u,isStudyInputDependsOnChart:()=>S,isStudyInputDependsOnChartColors:()=>y,isStudyInputOptionsInfo:()=>c,isTimeOrPriceNotHiddenInput:()=>f,rangeDependentStudyInputsToTimeRange:()=>p});var n,i,o,s=r(598279);function a(t){return(0,s.default)(t)}function u(t){
return"source"===t.t}function l(t){return a(t)?t.v:t}function c(t){return["text","integer","float","price","session","resolution"].includes(t.type)&&t.hasOwnProperty("options")}function d(t,e,r){for(const n of t)if(e[n.id]!==r[n.id])return!1;return!0}function p(t){return{from:Math.round(t.first_visible_bar_time/1e3),to:Math.round(t.last_visible_bar_time/1e3)}}function f(t){return("time"===t.type||"price"===t.type)&&!0!==t.isHidden}function h(t){const e=t.filter(f);if(0===e.length)return[];const r=new Map,n=[];e.forEach((t=>{var e;const{group:i,inline:o}=t;if(void 0===o)return void n.push(t);const s=o+(i||"");if(r.has(s))null===(e=r.get(s))||void 0===e||e.push(t);else{const e=[t];r.set(s,e),n.push(e)}}));const i=[];for(let t=0;t<n.length;t++){const e=n[t];Array.isArray(e)?2===e.length&&e[0].type!==e[1].type?i.push(e):i.push(...e):i.push(e)}return i}function y(t){return Object.values(o).map((t=>t)).includes(t.id)}function S(t){return!!y(t)||Object.values(i).map((t=>t)).includes(t.id)}!function(t){t[t.None=0]="None",t[t.DataWindow=2]="DataWindow",t[t.StatusLine=8]="StatusLine",t[t.All=15]="All"}(n||(n={})),function(t){t.FirstBar="first_visible_bar_time",t.LastBar="last_visible_bar_time",t.Realtime="subscribeRealtime"}(i||(i={})),function(t){t.FgColor="__chart_fgcolor",t.BgColor="__chart_bgcolor"}(o||(o={}))},428784:(t,e,r)=>{"use strict";r.d(e,{applyOverridesToStudy:()=>d,applyOverridesToStudyDefaults:()=>p});var n=r(650151),i=r(368135),o=r(201089);const s={line:i.LineStudyPlotStyle.Line,histogram:i.LineStudyPlotStyle.Histogram,cross:i.LineStudyPlotStyle.Cross,area:i.LineStudyPlotStyle.Area,columns:i.LineStudyPlotStyle.Columns,circles:i.LineStudyPlotStyle.Circles,line_with_breaks:i.LineStudyPlotStyle.LineWithBreaks,area_with_breaks:i.LineStudyPlotStyle.AreaWithBreaks,step_line:i.LineStudyPlotStyle.StepLine,step_line_with_breaks:i.LineStudyPlotStyle.StepLineWithBreaks,step_line_with_diamonds:i.LineStudyPlotStyle.StepLineWithDiamonds},a=(0,o.getLogger)("Chart.Model.StudyPropertiesOverrider");var u,l;function c(t,e,r,n){const i=r.split(".");if(0===i.length||0===i[0].length)return;const o=function(t){const e=t.split(":");return{name:e[0],type:2===e.length?e[1]:null}}(i[0]),s=o.name,c=o.type,d=null!==c,p=!d||"band"===c,f=!d||"area"===c,h=!d||"input"===c,y=!d||"plot"===c?l.getPlotIdByTitle(t,s):null,S=p?l.getBandIndexByName(t,s):null,g=f?l.getFilledAreaIdByTitle(t,s):null,_=h?l.getInputByName(t,s):null,m=e.hasOwnProperty(s);if((null!==y?1:0)+(null!==S?1:0)+(null!==g?1:0)+(null!==_?1:0)+(m?1:0)>1)return void a.logWarn(`Study '${t.description}' has ambiguous identifier '${s}'`);const P=i[1];if(null!==y){if(1===i.length)return void a.logWarn(`Path of sub-property of '${s}' plot for study '${t.description}' must be not empty`);const r=i.slice(1);u.applyPlotProperty(t,e,y,r,n)}else if(null!==_)u.applyInputValue(e,_,n);else if(null!==S){if(void 0===P)return void a.logWarn(`Property name of '${s}' band for study '${t.description}' must be set`);u.applyBandProperty(e,S,P,n)}else if(null!==g){
if(void 0===P)return void a.logWarn(`Property name of '${s}' area for study '${t.description}' must be set`);u.applyFilledAreaProperty(e,g,P,n)}else m?u.setRootProperty(e,i,n):a.logWarn(`Study '${t.description}' has no plot or input '${s}'`)}function d(t,e){const r=t.properties(),n=r.state();for(const r in e)e.hasOwnProperty(r)&&c(t.metaInfo(),n,r,e[r]);r.mergeAndFire(n)}function p(t,e,r){for(const n in t){if(!t.hasOwnProperty(n))continue;const i=n.indexOf(".");if(-1===i)continue;const o=n.substring(0,i),s=l.getMetaInfoByDescription(e,o);if(null===s){a.logWarn(`There is no such study ${o}`);continue}const u=r(s);null!==u?c(s,u,n.substring(i+1),t[n]):a.logWarn(`Cannot apply overrides for study ${o}`)}}!function(t){t.applyPlotProperty=function(t,e,r,o,u){if(void 0===e.styles)return void a.logWarn("Study does not have styles");const l=o[0];if("color"===l){const s=function(t,e,r){if(void 0===t.plots)return null;for(const n of t.plots){if(!(0,i.isPaletteColorerPlot)(n)||void 0===e.palettes)continue;const t=e.palettes[n.palette];if(n.target===r&&void 0!==t)return t}return null}(t,e,r);return void function(t,e,r,i,o){var s;void 0!==t.styles?null===e&&!isNaN(i)&&i>0?a.logWarn(`Study plot does not have color #${i}`):((0===i||isNaN(i))&&((0,n.ensureDefined)(t.styles[r]).color=String(o),i=0),null!==e&&((0,n.ensureDefined)(null===(s=e.colors)||void 0===s?void 0:s[i]).color=String(o))):a.logWarn("Study does not have styles")}(e,s,r,o.length>1?parseInt(o[1]):NaN,u)}const c=e.styles[r];if(void 0!==c&&c.hasOwnProperty(l)){if("plottype"===l){const t=s[String(u)];if(void 0===t)return void a.logWarn(`Unsupported plot type for plot: ${u}`);u=t}c[l]=u}else a.logWarn(`Study plot does not have property '${l}'`)},t.applyBandProperty=function(t,e,r,n){if(void 0===t.bands)return void a.logWarn("Study does not have bands");const i=t.bands[e];if(void 0!==i&&i.hasOwnProperty(r)){if("plottype"===r){const t=s[String(n)];if(void 0===t)return void a.logWarn(`Unsupported plot type for band: ${n}`);n=t}i[r]=n}else a.logWarn(`Study band does not have property '${r}'`)},t.applyFilledAreaProperty=function(t,e,r,n){if(void 0===t.filledAreasStyle)return void a.logWarn("Study does not have areas");const i=t.filledAreasStyle[e];void 0!==i&&i.hasOwnProperty(r)?i[r]=n:a.logWarn(`Study area does not have property '${r}'`)},t.applyInputValue=function(t,e,r){void 0!==t.inputs&&t.inputs.hasOwnProperty(e)?t.inputs[e]=r:a.logWarn(`Study does not have input '${e}'`)},t.setRootProperty=function(t,e,r){if(0===e.length)return;let n=t;for(const t of e.slice(0,-1)){if(null==n||!n.hasOwnProperty(t))break;n=n[t]}const i=e[e.length-1];null!=n&&n.hasOwnProperty(i)?n[i]=r:a.logWarn(`Study does not have property ${e.join(".")}`)}}(u||(u={})),function(t){t.getInputByName=function(t,e){if(void 0===t.inputs)return null;e=e.toLowerCase();for(const r of t.inputs)if(r.name.toLowerCase()===e)return r.id;return null},t.getPlotIdByTitle=function(t,e){if(void 0===t.styles)return null;e=e.toLowerCase();for(const r in t.styles){const n=t.styles[r]
;if((void 0!==n&&void 0!==n.title?n.title:r).toLowerCase()===e)return r}return null},t.getFilledAreaIdByTitle=function(t,e){if(void 0===t.filledAreas)return null;e=e.toLowerCase();for(const r of t.filledAreas)if(r.title.toLowerCase()===e)return r.id;return null},t.getBandIndexByName=function(t,e){if(void 0===t.bands)return null;e=e.toLowerCase();for(let r=0;r<t.bands.length;++r)if(t.bands[r].name.toLowerCase()===e)return r;return null},t.getMetaInfoByDescription=function(t,e){e=e.toLowerCase();for(const r of t)if(r.description.toLowerCase()===e||r.shortDescription.toLowerCase()===e)return r;return null}}(l||(l={}))},626240:(t,e,r)=>{"use strict";var n=r(854798).Version,i=r(201089).getLogger("Chart.StudyMigration");function o(t){this._studyId=t,this._maxToVers=n.ZERO,this._maxFromVers=n.ZERO,this._migrs=[]}o.prototype.addMigration=function(t,e,r){var i=n.parse(t),o=n.parse(e);i.isGreater(this._maxFromVers)&&(this._maxFromVers=i),o.isGreater(this._maxToVers)&&(this._maxToVers=o),this._migrs.push({fromVers:i,toVers:o,rules:r})},o.prototype.updateInputs=function(t,e,r){if(!r)return r;for(var n=TradingView.clone(r),o=t;o.isLess(e);){var s=this._findMigration(o);if(null==s)break;if(i.logNormal("Migrating study inputs from "+s.fromVers+" to "+s.toVers+" version, studyId: "+this._studyId+", migration: "+JSON.stringify(s)+", inputs: "+JSON.stringify(r)),n=this._applyMigration(n,s),!o.isLess(s.toVers))throw new Error("Problems in study migration process... Possible infinite cycle has been detected and stopped.");o=s.toVers}return o>t&&i.logNormal("Study inputs migration is done, studyId: "+this._studyId+", inputs: "+JSON.stringify(n)),n},o.prototype._findMigration=function(t){for(var e=-1,r=this._maxFromVers,n=0;n<this._migrs.length;n++){var i=this._migrs[n];i.fromVers.isLess(t)||i.fromVers.isLessOrEqual(r)&&(r=i.fromVers,e=n)}return e<0?null:this._migrs[e]},o.prototype._applyMigration=function(t,e){for(var r=t,n=0;n<e.rules.length;n++){var i=e.rules[n];r=this._getApplyRuleFun(i.type)(r,i)}return r},o.prototype._getApplyRuleFun=function(t){if("inputRemoved"===t)return o._applyInputRemovedRule;if("inputChangedType"===t)return o._applyInputChangedTypeRule;if("inputChangedMinMax"===t)return o._applyInputChangedMinMaxRule;if("inputChangedOptions"===t)return o._applyInputChangedOptionsRule;throw new Error("Unknown migration rule type: "+t)},o._applyInputRemovedRule=function(t,e){if(!(e.inputId in t))return t;if("removeVal"!==e.action)throw new Error("Unexpected rule.action="+e.action+" in rule.type="+e.type);var r=t[e.inputId];return delete t[e.inputId],i.logNormal("Input "+e.inputId+"="+r+" removed"),t},o._applyInputChangedTypeRule=function(t,e){var r=t[e.inputId];if("resetToDefVal"===e.action)return t[e.inputId]=e.defVal,i.logNormal("Input "+e.inputId+"="+r+" reset to default value "+e.defVal),t;if("convertVal"===e.action){if(null==r)return t;if("float"===e.inputTypeFrom&&"integer"===e.inputType)return t[e.inputId]=Math.round(t[e.inputId]),i.logNormal("Input "+e.inputId+"="+r+" converted to value "+t[e.inputId]),t
;if("integer"===e.inputTypeFrom&&"float"===e.inputType)return t;if("text"===e.inputTypeFrom&&"source"===e.inputType)return o._isValidSource(r,e.options)||(t[e.inputId]=e.defVal),t;throw new Error("Cannot convertVal from "+e.inputTypeFrom+" to "+e.inputType)}throw new Error("Unknown action "+e.action+" for rule with type "+e.type)},o._isValidSource=function(t,e){return t.indexOf("$")>=0||e.indexOf(t)>=0},o._applyInputChangedMinMaxRule=function(t,e){if("adjustValIfNeeded"!==e.action)throw new Error("Unknown action "+e.action+" for rule with type "+e.type);var r=t[e.inputId];return r<e.minVal?t[e.inputId]=e.minVal:r>e.maxVal&&(t[e.inputId]=e.maxVal),i.logNormal("Input "+e.inputId+"="+r+" adjusted to value "+t[e.inputId]),t},o._applyInputChangedOptionsRule=function(t,e){if(!(["text"].indexOf(e.inputType)>=0&&"resetToDefValIfNeeded"===e.action))throw new Error("Unexpected rule.inputType="+e.inputType+" in rule.action="+e.action);var r=t[e.inputId];return e.options.indexOf(r)<0&&(t[e.inputId]=e.defVal,i.logNormal("Input "+e.inputId+"="+r+" reset to default value "+e.defVal)),t},t.exports=o},294142:(t,e,r)=>{"use strict";r.d(e,{StudyVersioningBase:()=>s,log:()=>o});var n=r(626240),i=r.n(n);const o=(0,r(201089).getLogger)("Chart.Study.Versioning");class s{constructor(t,e){if(this._migrations={},!t)throw new Error("No studies metainfo");if(this._studiesMetainfo=t,!e)throw new Error("No studies migrations");this._studiesMigrations=e;for(let t=0;t<this._studiesMigrations.length;t++){const e=this._studiesMigrations[t],r=e.versFrom,n=e.versTo;for(let t=0;t<e.studyMigrations.length;t++){const s=e.studyMigrations[t],a=s.studyId;if(0===s.rules.length){o.logError("Study Migration should have at least one convertion rule");continue}const u=a in this._migrations?this._migrations[a]:new(i())(a);u.addMigration(r,n,s.rules),this._migrations[a]=u}}this._clientMigrations=[(t,e)=>{if(0===this._studiesMetainfo.length||!t.isTVScript||t.version>=22)return e;const r={};let n=0,i=0,o=e[i];for(;void 0!==o;){const t=e[o.id];o.isFake&&(o.id="in_"+n++),r[i]=o,r[o.id]=t,i++,o=e[i]}return r}]}}},883161:(t,e,r)=>{"use strict";r.d(e,{StudyMetaInfoBase:()=>f});var n=r(827147),i=r(650151),o=r(62745),s=r(922814);const a=new Set(["CorrelationCoefficient@tv-basicstudies","Correlation - Log@tv-basicstudies-1"]),u=new Set([]),l=new Set(["line"]),c=new Map([["AnchoredVWAP@tv-basicstudies","linetoolanchoredvwap"],["RegressionTrend@tv-basicstudies","linetoolregressiontrend"],["VbPAnchored@tv-basicstudies","linetoolanchoredvp"]]),d=/^([^\$]+)\$\d+$/,p=["bool","color","time","text_area"];class f{static getSourceIdsByInputs(t,e){if(!Array.isArray(t)||!e)return[];const r=[];for(const i of t)if(f.isSourceInput(i)&&(0,n.default)(e[i.id])){const t=e[i.id];t.includes("$")&&r.push(t.split("$")[0])}return r}static isSourceInput(t){return Boolean(t.id&&(("source"===t.id||"src"===t.id)&&("text"===t.type||"source"===t.type)||"source"===t.type))}static getSourceInputIds(t){const e=[];for(const r of t.inputs)f.isSourceInput(r)&&e.push(r.id);return e}
static setChildStudyMetaInfoPropertiesSourceId(t,e,r){for(const n of t.inputs){if(!f.isSourceInput(n))continue;const t=r.childs().inputs&&r.childs().inputs.childs()[n.id];if(t){const r=t.value(),n=d.exec(r);if(2===(null==n?void 0:n.length)){if("{pid}"===n[1]){const n=r.replace(/^[^\$]+/,e);t.setValue(n)}}}}}static patchSoSInputs(t,e){const r=t=>{const r=d.exec(t);if(2===(null==r?void 0:r.length)){const n=r[1],o=`${(0,i.ensureNotNull)(e(n))}`;return t.replace(/^[^\$]+/,o)}return t};for(const e in t)if(/in_[\d+]/.test(e)||"source"===e){const i=t[e];(0,n.default)(i)?t[e]=r(i):(0,o.isExtendedInput)(i)&&(0,o.isExtendedInputSource)(i)&&(i.v=r(i.v))}}static canBeChild(t){if((0,n.default)(t))return!0;if(!t)return!1;if(t.extra&&!f.isAllowedSourceInputsCount(t.extra.sourceInputsCount)||!0===t.canNotBeChild||!1===t.canBeChild||a.has(t.id))return!1;let e=0;for(const r of t.inputs)f.isSourceInput(r)&&(e+=1);return f.isAllowedSourceInputsCount(e)}static isAllowedSourceInputsCount(t){return t>0||1===t}static canHaveChildren(t){if(t){if(t.isTVScriptStrategy||t.TVScriptSourceCode&&(0,s.isStrategy)(t.TVScriptSourceCode))return!1;if(t.id&&!u.has(t.id)&&Array.isArray(t.plots))for(const e of t.plots)if(l.has(e.type))return!0}return!1}static getChildSourceInputTitles(t,e,r){var n;const i={};if(e.plots&&e.plots.length&&t.options&&t.options.length)for(const o of t.options){const t=o?+o.split("$")[1]:NaN,s=isFinite(t)&&e.plots[t];s&&l.has(s.type)&&(i[o]=e.styles&&e.styles[s.id]&&(null===(n=e.styles[s.id])||void 0===n?void 0:n.title)||s.id,r&&(i[o]=r+": "+i[o]))}return i}static canPlotBeSourceOfChildStudy(t){return l.has(t)}static getStudyPropertyRootName(t){const e=c.get(t.id);if(void 0!==e)return e;let r="study_"+t.id;return t.pine&&t.pine.version&&(r+="_"+t.pine.version.replace(".","_")),r}static getStudyPropertyRootNameById(t){const e=c.get(t);return void 0!==e?e:"study_"+t}_updateInputDisplayDefaults(){this.inputs.filter((t=>void 0===t.display)).forEach((t=>{p.includes(t.type)?t.display=o.InputDisplayFlags.None:t.display=o.InputDisplayFlags.All}))}}},526075:(t,e,r)=>{"use strict";r.r(e),r.d(e,{StudyMetaInfo:()=>u});var n=r(201089).getLogger("Chart.Study.MetaInfo"),i=r(428784).applyOverridesToStudyDefaults,o=r(883161).StudyMetaInfoBase,s=r(566119).PineKind,a={};class u extends o{constructor(t){super(),TradingView.merge(this,{palettes:{},inputs:[],plots:[],graphics:{},defaults:{}}),TradingView.merge(this,t);var e=t.fullId||t.id;TradingView.merge(this,u.parseIdString(e)),this._updateInputDisplayDefaults()}static versionOf(t){var e="_metainfoVersion"in t&&isNumber(t._metainfoVersion)?t._metainfoVersion:0;return e<0&&n.logError("Metainfo format version cannot be negative: "+e),e}static parseIdString(t){var e={};if(-1===t.indexOf("@"))e.shortId=t,e.packageId="tv-basicstudies",e.id=t+"@"+e.packageId,e.version=1;else{var r=t.split("@");e.shortId=r[0];var n=r[1].split("-");if(3===n.length)e.packageId=n.slice(0,2).join("-"),e.id=e.shortId+"@"+e.packageId,e.version=n[2];else if(1===n.length&&"decisionbar"===n[0])e.packageId="les-"+n[0],
e.id=e.shortId+"@"+e.packageId,e.version=1;else{if(1!==n.length)throw new Error("unexpected study id:"+t);e.packageId="tv-"+n[0],e.id=e.shortId+"@"+e.packageId,e.version=1}}if(e.fullId=e.id+"-"+e.version,"tv-scripting"===e.packageId){var i=e.shortId;if(0===i.indexOf("Script$")||0===i.indexOf("StrategyScript$")){var o=i.indexOf("_");e.productId=o>=0?i.substring(0,o):e.packageId}else e.productId=e.packageId}else e.productId=e.packageId;return e}static getPackageName(t){return(/^[^@]+@([^-]+-[^-]+)/.exec(t||"")||[0,"tv-basicstudies"])[1]}static cutDollarHash(t){var e=t.indexOf("$"),r=t.indexOf("@");return-1===e?t:t.substring(0,e)+(r>=0?t.substring(r):"")}static hasUserIdSuffix(t){return/^USER;[\d\w]+;\d+$/.test(t)}static hasPubSuffix(t){return/^PUB;.+$/.test(t)}static hasStdSuffix(t){return/^STD;.+$/.test(t)}static isStandardPine(t){return/^(Strategy)?Script\$STD;.*@tv-scripting$/.test(t)}static getStudyIdWithLatestVersion(t){const e=u.cutDollarHash(t.id);let r=e;return e.indexOf("@tv-scripting")>=0?r+="-101!":e.endsWith("CP@tv-basicstudies")?r+="-"+Math.min(t.version,207):e.endsWith("CP@tv-chartpatterns")?r+="-"+Math.min(t.version,9):r+="-"+t.version,r}defaultInputs(){for(var t=[],e=0;e<this.inputs.length;e++)t.push(this.inputs[e].defval);return t}state(t){var e={};for(var r in this)this.hasOwnProperty(r)&&(e[r]=this[r],!0!==t&&"id"===r&&(e[r]+="-"+this.version));return e}symbolInputId(){var t=this.inputs.filter((function(t){return"symbol"===t.type}));return t.length>0?t[0].id:null}createDefaults(){if(this.defaults){var t=TradingView.clone(this.defaults);t.precision="default";var e=u.getStudyPropertyRootName(this);defaults.create(e,t)}}removeDefaults(){defaults.remove(u.getStudyPropertyRootName(this))}static findStudyMetaInfoByDescription(t,e){if(t){for(var r=0;r<t.length;++r)if(t[r].description.toLowerCase()===e.toLowerCase())return t[r];throw new Error("unexpected study id:"+e)}throw new Error("There is no studies metainfo")}static isParentSourceId(t){return"string"==typeof t&&/^[^\$]+\$\d+$/.test(t)}static overrideDefaults(t){0!==t.length&&i(a,t,(function(t){return TradingView.defaultProperties[u.getStudyPropertyRootName(t)]||null}))}static mergeDefaultsOverrides(t){TradingView.merge(a,t)}static isScriptStrategy(t){if(t.extra&&t.extra.kind)return t.extra.kind===s.Strategy;if(!0===t.isTVScriptStrategy)return!0;var e=t.TVScriptSourceCode||t.scriptSource;return!!e&&TVScript.isStrategy(e)}static getOrderedInputIds(t){for(var e=[],r=t.inputs,n=0;n<r.length;++n){var i=r[n];e.push(i.id)}return e}}u.VERSION_STUDY_ARG_SOURCE=41,u.METAINFO_FORMAT_VERSION_SOS_V2=42,u.VERSION_PINE_PROTECT_TV_4164=43,u.CURRENT_METAINFO_FORMAT_VERSION=52,u.VERSION_NEW_STUDY_PRECISION_FORMAT=46,u.FilledArea={},u.FilledArea.TYPE_PLOTS="plot_plot",u.FilledArea.TYPE_HLINES="hline_hline",TradingView.StudyMetaInfo=u},922814:(t,e,r)=>{var n;t=r.nmd(t),"undefined"!=typeof window&&(n=window.TVScript=window.TVScript||{}),(n=n||{}).Access={},n.Access.ACCESS_OPEN_NO_AUTH="open_no_auth",n.Access.ACCESS_CLOSED_NO_AUTH="closed_no_auth",
n.Access.ACCESS_CLOSED_NEEDS_AUTH="closed_needs_auth",n.Access.MAP_ID_TO_NAME={1:n.Access.ACCESS_OPEN_NO_AUTH,2:n.Access.ACCESS_CLOSED_NO_AUTH,3:n.Access.ACCESS_CLOSED_NEEDS_AUTH},n.Access.MAP_NAME_TO_ID={},Object.keys(n.Access.MAP_ID_TO_NAME).forEach((function(t){n.Access.MAP_NAME_TO_ID[n.Access.MAP_ID_TO_NAME[t]]=t})),n.PinePrefix={},n.PinePrefix.USER="USER;",n.PinePrefix.PUB="PUB;",n.PinePrefix.STD="STD;",n.PinePrefix.TV="TV_",n.PinePrefix.EDGR="EDGR_",n.PineType={},n.PineType.UserSaved="PineType_UserSaved",n.PineType.UserPublished="PineType_UserPublished",n.PineType.BuiltIn="PineType_BuiltIn",n.PineType.Addon="PineType_Addon",n.Type=n.Type||function(){},n.Type.VOID="void",n.Type.INTEGER="integer",n.Type.FLOAT="float",n.Type.STRING="string",n.Type.BOOL="bool",n.Type.COLOR="color",n.Type.SERIES="series",n.Type.PLOT="plot",n.Type.HLINE="hline",n.Type.BARCOLOR="barcolor",n.Type.BGCOLOR="bgcolor",n.Type.PLOTSHAPES="plotshape",n.Type.PLOTCHARS="plotchar",n.Type.PLOTARROWS="plotarrow",n.Type.NA="na",n.Type.ARRAY="array",n.TranslatorDefaultVersion=1,n.TranslatorReferenceVersioningIntroduced=4,n.TranslatorLastVersion=5,n.pineType=function(t){return t.startsWith(n.PinePrefix.USER)?n.PineType.UserSaved:t.startsWith(n.PinePrefix.PUB)?n.PineType.UserPublished:t.startsWith(n.PinePrefix.STD)||t.startsWith(n.PinePrefix.TV)||t.startsWith(n.PinePrefix.EDGR)?n.PineType.BuiltIn:n.PineType.Addon},n.patchILTemplate=function(t,e,r){var i=r||{};return n._patchTemplate(/<(in_\d+)>/g,t,e,i)},n.decorateQuotes=function(t){if(!t)return t;var e=/([^\\']+?)(')[^']*?/g,r="$1\\$2",n=t;return"'"==n.charAt(0)&&"'"==n.charAt(n.length-1)?"'"+(n=n.substr(1,n.length-2)).replace(e,r)+"'":n.replace(e,r)},n.patchInputs=function(t,e){var r={};for(var n in t)if(t.hasOwnProperty(n)){var i,o=t[n];i=o.isFake?{v:e[o.id],f:!0,t:o.type}:e[o.id],r[o.id]=i}return r},n._patchTemplate=function(t,e,r,i){var o=i||{};return e.replace(t,(function(t,e){for(var i=(e in o?o[e]:r.defaults.inputs[e]),s=0;s<r.inputs.length;++s)if(r.inputs[s].id===e)if("bool"===r.inputs[s].type)i=i?"1.0":"0.0";else if(["text","symbol","resolution","session"].indexOf(r.inputs[s].type)>=0)i="'"+n.decorateQuotes(i)+"'";else if("source"===r.inputs[s].type){var a=i.split("$");a[0]="'"+a[0]+"'",i="source("+a.join(",")+")"}return i}))},n.isStrategy=function(t){return/^\s*strategy\s*\(/m.test(t)};var i=/^\s*\/\/\s*?@version\s*?=\s*?(\S*?)\s*?$/gm,o=/^[0-9]+$/;n.extractVersion=function(t){i.lastIndex=0;var e=i.exec(t);if(null===e)return 1;var r=e[1],s=o.test(r)?Number(r):NaN;return isNaN(s)?1:Math.max(n.TranslatorDefaultVersion,Math.min(s,n.TranslatorLastVersion))},n.canUpgradeVersion=function(t){return t>=3&&t<n.TranslatorLastVersion},n.canDowngradeVersion=function(t){return t>=4&&t<=n.TranslatorLastVersion},t&&t.exports&&(t.exports=n)}}]);