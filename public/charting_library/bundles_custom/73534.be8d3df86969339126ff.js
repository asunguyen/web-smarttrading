"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[73534],{668268:(t,e,o)=>{o.d(e,{TradedGroupPaneRenderer:()=>_});var r=o(650151),i=o(422333),s=o(511131),l=o(315801),a=o(787123),n=o(507795),d=o(294162),c=o(210690),h=o(5280),u=o(583086),p=o(13278);class _{constructor(t,e){this._textWidthCache=new d.TextWidthCache,this._items=[],this._minMainTextWidthCache=new Map,this._itemsRectsInfoCache=null,this._font=(0,s.makeFont)(t,i.CHART_FONT_FAMILY,"","normal"),this._tradedGroupRenderersController=e}itemRenderers(){return this._items}clearCache(){this._itemsRectsInfoCache=null,this._items.forEach((t=>t.clearCache()))}clearTextCache(){this._textWidthCache.reset()}setData(t){this._data=t}clearItems(){this._items=[]}addItem(t){const e=function(t,e,o,r){if(t.type===c.ItemsRendererType.Position)return new p.PositionItemRenderer(t,e,o,r);if(t.type===c.ItemsRendererType.WithBracketButtons)return new h.TPSLItemRenderer(t,e,o,r);if(t.type===c.ItemsRendererType.Projection)return new u.ProjectionBracketItemRenderer(t,e,o,r);if(t.type===c.ItemsRendererType.Default)return new c.ItemRenderer(t,e,o,r);throw new Error("Unknown traded item renderer's type")}(t,this._textWidthCache,(0,r.ensureNotNull)(this._font),this._minTextWidth.bind(this));this._items.push(e)}applyHorizontalOffset(t,e){if(null!==this._itemsRectsInfoCache)return;const o=this._items.filter((t=>t.data().visible)).map((t=>t.rect(e)));if(0===o.length)return;let r,i,s=1/0,l=-1/0;for(const t of o){s=Math.min(s,t.yMid),l=Math.max(l,t.yMid);(0,h.isItemWithTPSLRendererRect)(t)&&(r=t.tp.left,i=t.sl.left)}let a,d,c=t.rightmostBorder,u=t.leftmostBorder;const p=c-u;if(this._data.horizontalAlignment===n.TradedGroupHorizontalAlignment.Left)c>e.physicalWidth&&(d=Math.max(e.physicalWidth-p,Math.round(12*e.pixelRatio)));else if(u<0){const t=Math.round(12*e.pixelRatio);a=e.physicalWidth-p>t?p:e.physicalWidth-t}if(void 0!==r&&void 0!==i){if(void 0!==d){const t=u-d;r-=t,i-=t}if(void 0!==a){const t=a-c;r+=t,i+=t}}void 0!==d&&(u=d),void 0!==a&&(c=a),this._itemsRectsInfoCache={rightmostBorder:c,leftmostBorder:u,leftmostForItemOffset:d,rightmostForItemOffset:a,yMin:s,yMax:l,projItemTpLeft:r,projItemSlLeft:i};for(const t of this._items)t.applyOffset(this._itemsRectsInfoCache)}hitTest(t,e){var o;if(!this._paneHasVisibleItems())return null;this._tradedGroupRenderersController.alignItems(e);for(let o=this._items.length-1;o>=0;o--){const r=this._items[o].hitTest(t,e);if(null!==r)return r}return(null===(o=this._data)||void 0===o?void 0:o.disableNoOverlap)?new l.HitTestResult(l.HitTarget.MovePointBackground,{clickHandler:this._data.disableNoOverlap,tapHandler:this._data.disableNoOverlap,contextMenuHandler:this._data.disableNoOverlap,touchContextMenuHandler:this._data.disableNoOverlap}):null}drawBackground(t,e){if(this._paneHasVisibleItems()){this._tradedGroupRenderersController.alignItems(e);for(const o of this._items)o.drawBackground(t,e)}}draw(t,e){var o,r,i,s;if(!this._paneHasVisibleItems())return;this._tradedGroupRenderersController.alignItems(e)
;for(const o of this._items)o.drawLine(t,e);const l=null!==(r=null===(o=this._itemsRectsInfoCache)||void 0===o?void 0:o.rightmostBorder)&&void 0!==r?r:null,a=null!==(s=null===(i=this._itemsRectsInfoCache)||void 0===i?void 0:i.leftmostBorder)&&void 0!==s?s:null,d=Math.round(e.cssWidth*e.pixelRatio),c=Math.round(12*e.pixelRatio),h=this._data.horizontalAlignment===n.TradedGroupHorizontalAlignment.Left,u=h?a:l,p=h?-1:1;if(null!==u&&u+p*c<=d){const o=h?0:d,r=Math.round(this._data.rightPadding*e.pixelRatio),i=u+p*(Math.min(r,o-p*u)/2);this._drawVertLine(t,e,i);for(const o of this._items)o.drawPointOnLine(t,e,i)}for(const o of this._items)o.draw(t,e)}clearMinTextWidthByItemId(t){this._minMainTextWidthCache.has(t)&&this._minMainTextWidthCache.delete(t)}clearMinTextWidthCache(){this._minMainTextWidthCache.clear()}_minTextWidth(t,e){var o;if(!t.text.text)return 0;e.save(),e.font=(0,r.ensureNotNull)(this._font);const i=Math.ceil(this._textWidthCache.measureText(e,t.text.text)),s=this._minMainTextWidthCache.get(t.id);if(void 0===s||i>s){const o=Math.ceil(this._textWidthCache.measureText(e,"0"));this._minMainTextWidthCache.set(t.id,i+o)}return e.restore(),null!==(o=this._minMainTextWidthCache.get(t.id))&&void 0!==o?o:0}_drawVertLine(t,e,o){const r=this._data.vertLine;if(null===r||null===this._itemsRectsInfoCache||this._itemsRectsInfoCache.yMax===this._itemsRectsInfoCache.yMin)return;const i=e.pixelRatio;t.strokeStyle=r.color,t.lineWidth=Math.max(1,Math.floor(r.thickness*i)),(0,a.setLineStyle)(t,r.style),(0,a.drawVerticalLine)(t,o,this._itemsRectsInfoCache.yMin,this._itemsRectsInfoCache.yMax)}_paneHasVisibleItems(){return this._items.filter((t=>t.data().visible)).length>0}}},516239:(t,e,o)=>{o.d(e,{TRADED_GROUP_JOINT_LINE_STYLE:()=>M,TradedGroupPaneView:()=>w});var r=o(650151),i=o(125226),s=o(77122),l=o(379048),a=o(288281),n=o(393724),d=o(668268),c=o(883990),h=o(739630),u=o(205827),p=o(444372),_=o(246733),y=o(922600),f=o(210690);const v=p.t(null,void 0,o(137172)),b=p.t(null,void 0,o(316075));class C extends y.BasePaneViewItem{rendererData(){const t=this._item===this._itemWithButtons(),e=(0,a.getDefaultStyleForOrderItem)(this._item,this._source,(()=>this._chartModel.dark().value())),o=(0,_.generateColor)(e.borderColor,85);let r;const i=this._renderDataForClose(e.close,o);return void 0!==i&&(r={...i,title:b}),{type:t?f.ItemsRendererType.WithBracketButtons:f.ItemsRendererType.Default,...this._renderDataGeneral(e),...this._renderDataForTPSLButtons(this._item),callbacks:this._callbacks(this._projectionBracketsForItem(this._item)),line:this._renderDataForLine(e),qty:{...this._renderDataForQty(e.qty,o),title:v},text:{...this._renderDataForText(e.text,o),title:this._item.profitLossTooltip()},point:this._renderDataForPoint(),close:r,confirm:this._renderDataForConfirm()}}_callbacks(t=[]){const e=this._source,o=super._callbacks(t),r={label:`[${this._modeGaLabel()}]`};return this._item.isMovingEnabled()&&!this._isNoOverlapMode&&(o.onMove=t=>e.onMove(this._item.id(),t),o.onFinishMove=()=>e.onFinishMove(this._item.id(),r)),
this._item.supportModify()&&(o.onModify=()=>this._item.onModify(r)),this._item.supportClose()&&this._isCloseVisible()&&(o.onClose=()=>this._item.onClose(r)),this._item.canQtyCalcModify()&&(o.onQtyModify=(t,e)=>this._item.toggleQtyModify(t,e,r)),o}}class m extends C{constructor(t,e,o,r,i,s){super(t,e,o,r,i,s),this._source=e}_callbacks(t=[]){const e=super._callbacks(t),o={label:`[${this._modeGaLabel()}]`};return this._item.supportClose()&&this._isCloseVisible()&&(e.onClose=async()=>this._source.onClose(o)),this._isNoOverlapMode||(this._item.isMovingEnabled()&&(e.onMove=t=>this._source.onMove(this._item.id(),t),e.onFinishMove=()=>this._source.onFinishMove(this._item.id(),o)),this._item.canSwitchType()&&(e.onText=(t,e)=>this._item.toggleType(t,e,o))),e}}var P=o(199356);class g extends y.BasePaneViewItem{rendererData(){const t=(0,a.getDefaultStyleForOrderItem)(this._item,this._source,(()=>this._chartModel.dark().value())),e=(0,_.generateColor)(t.borderColor,85);return{type:f.ItemsRendererType.Projection,...this._renderDataGeneral(t),drawWithTPOffset:this._item.bracketType()===P.BracketType.TakeProfit,drawWithSLOffset:this._item.bracketType()===P.BracketType.StopLoss||this._item.bracketType()===P.BracketType.TrailingStop,callbacks:this._callbacks(),line:this._renderDataForLine(t),qty:this._renderDataForQty(t.qty,e),text:{...this._renderDataForText(t.text,e),title:this._item.profitLossText(),active:{visible:!1,backgroundColor:t.qty.activeColor}},point:this._renderDataForPoint(),close:this._renderDataForClose(t.close,t.close.activeColor)}}}function T(t,e,o,r,i,s){if((0,c.isPositionItem)(t))return new u.PositionPaneViewItem(t,e,o,r,i,s);if((0,c.isPreOrderItem)(t))return new m(t,e,o,r,i,s);if((0,c.isProjectionBracketItem)(t))return new g(t,e,o,r,i,s);if((0,h.isOrderLikeItem)(t))return new C(t,e,o,r,i,s);throw new Error("Unknown traded item type")}const k=(0,i.isFeatureEnabled)("trading_sources_adaptive");var x;!function(t){t[t.Large=380]="Large",t[t.Small=280]="Small"}(x||(x={}));const M=l.LineStyle.Solid;class w{constructor(t,e,o){this._prevItemTokens=new Map,this._displayMode=2,this._invalidated=!0,this._chartModel=t,this._source=e,this._tradedGroupRenderersController=o,this._showOrderProperty=e.showOrderProperty(),this._showPositionProperty=e.showPositionProperty(),this._renderer=new d.TradedGroupPaneRenderer(13,this._tradedGroupRenderersController),this._tradedGroupRenderersController.registerRenderer(this._renderer),this._source.positionDisplayMode().subscribe(this._renderer,this._renderer.clearMinTextWidthCache),this._source.bracketsDisplayMode().subscribe(this._renderer,this._renderer.clearMinTextWidthCache)}destroy(){this._tradedGroupRenderersController.removeRenderer(this._renderer),this._source.positionDisplayMode().unsubscribe(this._renderer,this._renderer.clearMinTextWidthCache),this._source.bracketsDisplayMode().unsubscribe(this._renderer,this._renderer.clearMinTextWidthCache)}update(){this._invalidated=!0}makeSureIsUpdated(t,e){if(this._invalidated){const t=this._displayMode;this._calculateMode(e),
t!==this._displayMode&&this._renderer.clearMinTextWidthCache(),this._tradedGroupRenderersController.invalidateCache(),this._updateImpl(),this._invalidated=!1}}renderer(t,e){return this._renderer}priceToCoordinate(t){if(null===t)return null;const e=this._chartModel.mainSeries(),o=e.firstValue();return null===o?null:e.priceScale().priceToCoordinate(t,o)}_calculateMode(t){if(!s.enabled("adaptive_trading_sources"))return;const e=t<x.Large?t<x.Small&&k?0:1:2;this._displayMode=e}_mainItemStyle(){const t=this._source.mainItem();return void 0===t?(0,a.getStyleForOppositeDirection)(this._source.items().brackets[0],this._source,(()=>this._chartModel.dark().value())):(0,h.isPositionLikeItem)(t)?(0,n.getDefaultStyleForPositionItem)(t.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),t.lineStyle()):((0,r.assert)((0,h.isOrderLikeItem)(t),"Unexpected traded item type"),(0,a.getDefaultStyleForOrderItem)(t,this._source,(()=>this._chartModel.dark().value())))}_rightPadding(){return 2!==this._displayMode?40:64}_sortedItems(){var t,e,o;const r=[],i=this._source.items();let s=null,l=null,a=null;const n=i.brackets.slice();if(n.push(...i.projectionBrackets),void 0!==i.stopLimit&&n.push(i.stopLimit),void 0!==i.main&&n.push(i.main),this._tradedGroupRenderersController.isNoOverlapMode())return n;for(const i of n)(null===(t=this._source.movingItem())||void 0===t?void 0:t.id)===i.id()?a=i:(null===(e=this._source.hoveredItem())||void 0===e?void 0:e.id)===i.id()?l=i:(null===(o=this._source.selectedItem())||void 0===o?void 0:o.id)===i.id()?s=i:r.push(i);return null!==s&&r.push(s),null!==l&&r.push(l),null!==a&&r.push(a),r}_updateImpl(){if(this._renderer.clearItems(),!this._showOrderProperty.value()&&!this._showPositionProperty.value()||this._isNoData())return;const t=this._mainItemStyle(),e=this._source.isSelected(),o=e&&this._source.isHoveredOtherTradedGroup()?(0,r.ensureDefined)(t.disabledLineColor):t.lineColor,i=this._rightPadding(),s={vertLine:null,horizontalAlignment:this._source.horizontalAlignment(),rightPadding:i};(this._source.isHovered()||e)&&(s.vertLine={thickness:this._source.lineWidth(),style:M,color:o}),this._tradedGroupRenderersController.isNoOverlapMode()&&(s.disableNoOverlap=()=>this._tradedGroupRenderersController.setNoOverlapMode(!1)),this._renderer.setData(s);const l=new Map;for(const e of this._sortedItems()){const r=this.priceToCoordinate(e.price());if(null===r)continue;const s=T(e,this._source,this._chartModel,t,{isNoOverlapMode:this._tradedGroupRenderersController.isNoOverlapMode(),displayMode:this._displayMode,rightPadding:i,groupLineColor:o,y:r},{setNoOverlapMode:t=>this._tradedGroupRenderersController.setNoOverlapMode(t)}).rendererData();this._renderer.addItem(s),l.set(`${s.id} ${e.isBuyDirection()}`,s.id)}this._prevItemTokens.forEach(((t,e)=>{l.has(e)||this._renderer.clearMinTextWidthByItemId(t)})),this._prevItemTokens=l}_isNoData(){const t=this._source.items();return void 0===t.main&&void 0===t.stopLimit&&0===t.brackets.length}}},779298:(t,e,o)=>{o.d(e,{BaseItem:()=>C,plSign:()=>y})
;var r=o(650151),i=o(444372),s=o(333730),l=o(389137),a=o(707957),n=o(837032),d=o(507795),c=o(182436),h=o(31341),u=o(379048),p=o(199356),_=o(751366);function y(t,e){return`${t>0?"+":t<0?"−":""}${e?" ":""}`}const f={integerFormatter:new c.NumericFormatter(0),oneDecimalFormatter:new c.NumericFormatter(1),twoDecimalFormatter:new c.NumericFormatter(2)},v=i.t(null,void 0,o(618156)),b=i.t(null,void 0,o(392553));class C{constructor(t,e,o,r,i,s,l){this._contextMenu=null,this._profitLossChanged=new a.Delegate,this._mainSeries=o,this._source=e,this._symbolDataProvider=r,this._gaOrigin=i,this._infoGetters=s,this._itemCommands=l,this.setData(t)}destroy(){var t,e,o;null===(t=this._formatPlWV)||void 0===t||t.destroy(),null===(e=this._plColorWV)||void 0===e||e.destroy(),this._profitLossChanged.destroy(),null===(o=this._contextMenu)||void 0===o||o.hide()}data(){return this._data}price(){return this._data.price}setData(t){this._data=(0,l.clone)(t)}priceText(){return(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()).priceFormatter.format((0,r.ensureNotNull)(this.price()))}supportOnlyPairBrackets(){return!1}plColorWV(){return void 0===this._plColorWV&&(this._plColorWV=(0,n.createWVFromGetterAndSubscription)((()=>this.profitLossTextColor()),this._profitLossChanged)),this._plColorWV}formatPlWV(){return void 0===this._formatPlWV&&(this._formatPlWV=(0,n.createWVFromGetterAndSubscription)((()=>this.profitLossText()),this._profitLossChanged)),this._formatPlWV}hasContextMenu(){return this.supportModify()||this.supportClose()}useMinTickFormatter(){return!0}isBuyDirection(){return 1===this._data.side}isVisible(){return this._infoGetters.visibility()}fireProfitLossChange(){this._profitLossChanged.fire()}profitLossText(t){if(!this._data)return"";const e=this._potentialProfitLoss();if(null===e)return"";let o;switch(this._infoGetters.displayMode.value()){case d.PlDisplay.Money:o=this.moneyText(e,!0);break;case d.PlDisplay.Pips:o=this.pipsText(e,!0);break;case d.PlDisplay.Percentage:o=this.percentageText(e,!0)}return(0,h.startWithLTR)(o)}percentageText(t,e){var o;const r=y(t,e),i=this._source.baseItem(),l=null!==(o=null==i?void 0:i.price())&&void 0!==o?o:null;if(null===l)return"";const a=100*t/l*this._data.side;return`${r}${(0,s.splitThousands)(f.twoDecimalFormatter.format(Math.abs(a))," ")}%`}moneyText(t,e){const o=this._symbolDataProvider.pipValue();if(null===o||(0,l.isNaN)(o.sellPipValue)||(0,l.isNaN)(o.buyPipValue))return"";const i=y(t,e),s=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),a=t/(s.pipSize||s.minTick)*this._data.side,n=this.isBuyDirection()?o.buyPipValue:o.sellPipValue,d=Math.abs((0,_.pipsToRiskInCurrency)(a,this._data.qty,n,s.priceMagnifier,s.lotSize));return`${i}${f.twoDecimalFormatter.format(d)} ${this.currency()}`}pipsText(t,e){const l=y(t,e),a=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),n=isFinite(a.pipSize)&&a.pipSize!==a.minTick?f.oneDecimalFormatter:f.integerFormatter,d=parseFloat(n.format(t/(a.pipSize||a.minTick)))*this._data.side;switch(this._symbolDataProvider.pipValueType()){
case p.PipValueType.Pips:return`${l}${i.t(null,{plural:"{pips} pips",count:Math.abs(d)},o(777772)).replace("{pips}",(0,s.splitThousands)(Math.abs(d).toFixed(1)," "))}`;case p.PipValueType.Ticks:return`${l}${i.t(null,{plural:"{ticks} ticks",count:Math.abs(d)},o(564225)).replace("{ticks}",(0,s.splitThousands)(Math.abs(d).toFixed(0)," "))}`}return""}tryBasePlOnLast(){return!1}lineStyle(){return u.LineStyle.Solid}confirmText(t){const e=1===this._data.side?v:b;return t?e:`${e} ${this.qtyText()} @ ${this.priceText()}`}_trackEventGA(t){const{origin:e=this._gaOrigin,event:o,label:i}=t;(0,r.assert)(!!o,"GA Event shouldn' be empty"),this._itemCommands.trackEvent(e,o,i)}_quantityText(t){return(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()).quantityFormatter.format(t)}}},922600:(t,e,o)=>{o.d(e,{BasePaneViewItem:()=>_});var r=o(150335),i=o(650151),s=o(379048),l=o(246733),a=o(31341),n=o(333730),d=o(288281),c=o(119836),h=o(883990),u=o(739630),p=o(516239);class _{constructor(t,e,o,r,i,s){this._item=t,this._source=e,this._chartModel=o,this._mainItemStyle=r,this._isNoOverlapMode=i.isNoOverlapMode,this._displayMode=i.displayMode,this._rightPadding=i.rightPadding,this._groupLineColor=i.groupLineColor,this._y=i.y,this._externalCallbacks=s}_isProfitLossHidden(){return 0===this._displayMode}_isProfitLossShorten(){return 2!==this._displayMode}_isCloseVisible(){return 0!==this._displayMode}_minQtyWidth(){return 0===this._displayMode?30:0}_isHoveredItem(t){var e;return(null===(e=this._source.hoveredItem())||void 0===e?void 0:e.id)===t.id()}_isHoveredItemPart(t,e){var o;return this._isHoveredItem(t)&&(null===(o=this._source.hoveredItem())||void 0===o?void 0:o.part)===e}_isSelectedItem(t){var e;return(null===(e=this._source.selectedItem())||void 0===e?void 0:e.id)===t.id()}_isHoveredItemWithButtons(t){if(!t)return!1;const{takeProfit:e,stopLoss:o,trailingStop:r}=(0,c.bracketsByType)(this._source.items().projectionBrackets);return this._isHoveredItem(t)||Boolean(e&&this._isHoveredItem(e))||Boolean(o&&this._isHoveredItem(o))||Boolean(r&&this._isHoveredItem(r))}_isHoveredStopItemStopLimit(){const t=this._source.items().main,e=this._source.items().stopLimit;return!!(t&&e&&(0,h.isLimitPartStopLimitOrderItem)(e))&&this._isHoveredItem(t)}_isActiveSource(){return this._source.isHovered()||this._source.isSelected()}_itemWithButtons(){if(!this._isNoOverlapMode)return this._source.baseItem()}_projectionBracketsForItem(t){return t!==this._itemWithButtons()?[]:this._source.items().projectionBrackets}_renderDataForTPSLButtons(t){if(t!==this._itemWithButtons())return{};const e={borderStyle:this._source.isPlaced()?t.lineStyle():(0,i.ensureDefined)(this._source.mainItem()).lineStyle()},o={},{takeProfit:r,stopLoss:s,trailingStop:a}=(0,c.bracketsByType)(this._source.items().projectionBrackets);if(r){const t=null===r.price(),i=this._isHoveredItemPart(r,5),s=(0,d.getDefaultStyleForOrderItem)(r,this._source,(()=>this._chartModel.dark().value()),e);o.tp={id:r.id(),visibility:t&&this._isMainButtonsVisible()?1:0,text:r.qtyText(),title:r.tooltip(),
underlineText:!1,textColor:t?s.text.buttonTextColor:s.text.textColor,backgroundColor:s.text.backgroundColor,borderColor:s.borderColor,borderStyle:s.borderStyle,active:{visible:i,backgroundColor:s.text.backgroundColor}}}const n=s||a;if(n){const t=null===n.price(),r=this._isHoveredItemPart(n,6),i=(0,d.getDefaultStyleForOrderItem)(n,this._source,(()=>this._chartModel.dark().value()),e),s=(0,l.generateColor)(i.borderColor,85);o.sl={id:n.id(),visibility:t&&this._isMainButtonsVisible()?1:0,text:n.qtyText(),title:n.tooltip(),underlineText:this._source.isTrailingStopSupported(),textColor:t?i.text.buttonTextColor:i.text.textColor,backgroundColor:i.text.backgroundColor,borderColor:i.borderColor,borderStyle:i.borderStyle,active:{visible:r,backgroundColor:this._source.isTrailingStopSupported()?s:i.text.backgroundColor}}}return o}_renderDataForLine(t){return{drawOnTop:this._isActiveSource()&&!this._isNoOverlapMode,thickness:this._source.lineWidth(),style:t.lineStyle,color:t.lineColor,extend:this._source.isLineExtended()}}_renderDataForQty(t,e){return{text:(o=this._item.qtyText(),null===o?"0":((0,r.isNumber)(o)&&o<0&&(o=`− ${Math.abs(o)}`),(0,a.forceLTRStr)((0,n.splitThousands)(o," ")))),minTextWidth:this._minQtyWidth(),textColor:t.textColor,backgroundColor:t.backgroundColor,dividerColor:t.dividerColor,isDividerVisible:!0,active:{visible:this._isHoveredItemPart(this._item,1),backgroundColor:e}};var o}_renderDataForText(t,e){return{text:this._isProfitLossHidden()?"":this._item.profitLossText(this._isProfitLossShorten()),textColor:t.textColor,backgroundColor:t.backgroundColor,dividerColor:t.dividerColor,active:{visible:this._isHoveredItemPart(this._item,2),backgroundColor:e}}}_renderDataForPoint(){const{takeProfit:t,stopLoss:e,trailingStop:o}=(0,c.bracketsByType)(this._source.items().projectionBrackets),r=e||o,i=this._item===this._itemWithButtons(),s=i&&t&&null===t.price()&&this._isHoveredItem(t),l=i&&r&&null===r.price()&&this._isHoveredItem(r),a=this._isHoveredItem(this._item)||s||l?this._mainItemStyle.pointShadowColor:void 0;return{visible:this._isActiveSource(),backgroundColor:this._isSelectedItem(this._item)?this._groupLineColor:this._mainItemStyle.pointBackgroundColor,borderStyle:p.TRADED_GROUP_JOINT_LINE_STYLE,borderColor:this._groupLineColor,shadowColor:a}}_renderDataForClose(t,e){if(this._item.supportClose()&&this._isCloseVisible())return{backgroundColor:t.backgroundColor,iconColor:t.iconColor,active:{visible:this._isHoveredItemPart(this._item,3),backgroundColor:e}}}_renderDataForConfirm(){if(this._item!==this._itemWithConfirmButton()||!this._isMainButtonsVisible())return;(0,i.assert)((0,u.isOrderLikeItem)(this._item));const t=(0,d.getDefaultStyleForOrderItem)(this._item,this._source,(()=>this._chartModel.dark().value())),e=(0,i.ensureDefined)(t.confirm),o=this._isHoveredItemPart(this._item,7),r=!this._source.hasError(),l=r?e.backgroundColor:e.disableBackgroundColor,a=r?(0,i.ensureDefined)(e.borderColor):e.disableBackgroundColor,n=r?e.textColor:e.disableTextColor;return{text:this._confirmButtonText(),textColor:n,
backgroundColor:l,borderColor:a,borderStyle:s.LineStyle.Solid,active:{visible:o&&r,backgroundColor:e.activeColor,borderColor:e.activeColor}}}_renderDataGeneral(t){let e=0;const o=this._item.price();if(null!==o){e=(this._chartModel.mainSeries().priceScale().isInverted()?-1:1)*o}return{y:this._y,visible:this._item.isVisible(),sortingIndex:e,id:this._item.id(),disabled:this._source.disabled(),borderBackgroundColor:this._borderBackgroundColor(t),borderColor:t.borderColor,borderStyle:t.borderStyle,bodyAlignment:this._source.horizontalAlignment(),rightPadding:this._rightPadding}}_callbacks(t=[]){const e={},o={label:`[${this._modeGaLabel()}]`};this._item.hasContextMenu()&&(e.onContextMenu=t=>this._item.onContextMenu(t,o));const{takeProfit:r,stopLoss:i,trailingStop:s}=(0,c.bracketsByType)(t),l=i||s;return e.onCancelMove=()=>{var t,e,o;return null!==(o=null===(e=(t=this._source).cancelMove)||void 0===e?void 0:e.call(t))&&void 0!==o&&o},r&&(e.onMoveProjectionTP=t=>this._source.onMove(r.id(),t),e.onFinishMoveTP=()=>this._source.onFinishMoveProjectionBracket(r.id(),{...o,event:"Add bracket from button"})),l&&(e.onMoveProjectionSL=t=>this._source.onMove(l.id(),t),e.onFinishMoveSL=()=>this._source.onFinishMoveProjectionBracket(l.id(),{...o,event:"Add bracket from button"}),this._source.isTrailingStopSupported()&&(e.onClickSL=(t,e)=>l.toggleType(t,e,o))),this._isNoOverlapMode&&(e.allInteractionsHandler=()=>this._externalCallbacks.setNoOverlapMode(!1)),this._isMainButtonsVisible()&&(e.onConfirm=()=>this._source.onConfirm(this._item.id(),o)),e}_isMainButtonsVisible(){return!this._source.isPlaced()&&this._source.isActiveSource()||this._isHoveredItemWithButtons(this._item)||this._isHoveredStopItemStopLimit()||this._source.isSelected()}_borderBackgroundColor(t){return t.borderStyle===s.LineStyle.Solid?"transparent":t.borderBackgroundColor}_modeGaLabel(){switch(this._displayMode){case 2:return"Standard view";case 1:return"Medium view";case 0:return"Minimal view"}}_confirmButtonText(){return this._item.confirmText(2!==this._displayMode)}_itemWithConfirmButton(){if(!this._source.isPlaced()&&!this._source.isConfirmButtonOnDomWidget())return this._itemWithButtons()}}},367329:(t,e,o)=>{o.d(e,{ItemPriceAxisView:()=>s});var r=o(229765);const i=(0,o(125226).isFeatureEnabled)("do_not_round_price_scale_label");class s extends r.PriceAxisView{constructor(t,e,o,r){super(),this._model=t,this._data=e,this._priceScaleFormatter=o,this._styleGetter=r}itemId(){return this._data.id()}_updateRendererData(t,e,o){if(t.visible=!1,!this._data.isVisible())return;const r=this._model.mainSeries(),i=r.priceScale(),s=r.firstValue();if(null===s)return;const l=this._data.price();if(null===l)return;const a=this._styleGetter();o.background=a.qty.backgroundColor,o.borderColor=a.labelBorderVisible?a.borderColor:void 0,o.borderStyle=a.labelBorderVisible?a.borderStyle:void 0,o.textColor=a.qty.textColor,o.coordinate=i.priceToCoordinate(l,s),t.borderVisible=a.labelBorderVisible,t.text=this._formatPrice(l),t.tickColor=a.labelTickColor,t.visible=!0}_formatPrice(t){
const e=i&&!this._data.useMinTickFormatter();return this._priceScaleFormatter().format(t,void 0,void 0,void 0,void 0,e)}}},5280:(t,e,o)=>{o.d(e,{TPSLItemRenderer:()=>h,isItemWithTPSLRendererRect:()=>c});var r=o(650151),i=o(86441),s=o(315801),l=o(147354),a=o(787123),n=o(507795),d=o(210690);function c(t){return t.hasOwnProperty("tp")&&t.hasOwnProperty("sl")}class h extends d.ItemRenderer{constructor(){super(...arguments),this._wasTPMoved=!1,this._wasSLMoved=!1}hitTest(t,e){var o,a;const n=e.pixelRatio,c=this.rectWithOffsets(e),h=Math.round(t.x*n),u=Math.round(t.y*n),p=h>=c.left,_=h<=c.right,y=p&&_;if(!(u>=c.top&&u<=c.bottom)||!y)return null;const f={cursorType:l.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,d.activeItemToHitTestResultData)({id:this._data.id,part:8}),contextMenuHandler:this._data.callbacks.onContextMenu,touchContextMenuHandler:this._data.callbacks.onContextMenu};if(this._data.disabled)return new s.HitTestResult(s.HitTarget.Custom,f);const v=Math.round(c.top/n),b=void 0!==this._data.callbacks.onMoveProjectionTP&&1===(null===(o=this._data.tp)||void 0===o?void 0:o.visibility);if(b&&h>=c.tp.left&&h<c.tp.left+c.tp.width){const t=Math.round(c.tp.left/n),e=Math.round(c.tp.width/n),o=t=>{this._data.callbacks.onMoveProjectionTP&&this._data.callbacks.onMoveProjectionTP(t),this._wasTPMoved=!0},i=()=>{this._wasTPMoved&&this._data.callbacks.onFinishMoveTP&&this._data.callbacks.onFinishMoveTP(),this._wasTPMoved=!1};return new s.HitTestResult(s.HitTarget.Custom,{...f,cursorType:l.PaneCursorType.Pointer,...(0,d.activeItemToHitTestResultData)({id:(0,r.ensureDefined)(this._data.tp).id,part:5}),pressedMouseMoveHandler:o,touchMoveHandler:o,mouseUpHandler:i,touchEndHandler:i,cancelMoveHandler:this._data.callbacks.onCancelMove,tooltip:{extendMargin:!0,text:(0,r.ensureDefined)(this._data.tp).title,rect:{x:t,y:v,w:e,h:this._height}}})}const C=c.sl.left+c.sl.width,m=void 0!==this._data.callbacks.onMoveProjectionSL&&1===(null===(a=this._data.sl)||void 0===a?void 0:a.visibility);if(m&&h>=c.sl.left&&h<C){const t=Math.round(c.sl.width/n),e=Math.round(c.sl.left/n),o=Math.round(c.bottom/n),a=t=>{this._data.callbacks.onMoveProjectionSL&&this._data.callbacks.onMoveProjectionSL(t),this._wasSLMoved=!0},h=()=>{this._wasSLMoved&&this._data.callbacks.onFinishMoveSL&&this._data.callbacks.onFinishMoveSL(),this._wasSLMoved=!1};let u,p;const _=this._data.callbacks.onClickSL;if(void 0!==_){const r=r=>{const s=r.clientX-r.localX,l=r.clientY-r.localY,a=new i.Point(e+s,o+l);_((r=>r.x>e&&r.x<=e+t&&r.y>v&&r.y<=o),a)};u=r,p=t=>{t.preventDefault(),r(t)}}return new s.HitTestResult(s.HitTarget.Custom,{...f,cursorType:_?l.PaneCursorType.Default:l.PaneCursorType.Pointer,...(0,d.activeItemToHitTestResultData)({id:(0,r.ensureDefined)(this._data.sl).id,part:6}),pressedMouseMoveHandler:a,touchMoveHandler:a,mouseUpHandler:h,touchEndHandler:h,clickHandler:u,tapHandler:p,cancelMoveHandler:this._data.callbacks.onCancelMove,tooltip:{extendMargin:!0,text:(0,r.ensureDefined)(this._data.sl).title,rect:{x:e,y:v,w:t,h:this._height}}})}
const P=C-c.body.left<0?h>=C&&h<c.body.left:h>=c.body.right&&h<c.tp.left;if((b||m)&&P)return new s.HitTestResult(s.HitTarget.Custom,f);if(this._hasConfirmButton()&&(0,r.ensureDefined)(this._data.confirm)){const t=c.confirm.left+c.confirm.width;if(h>=c.confirm.left&&h<t){let t={};if(void 0!==this._data.callbacks.onMove){const e=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},o=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};t={pressedMouseMoveHandler:e,touchMoveHandler:e,mouseUpHandler:o,touchEndHandler:o,cancelMoveHandler:this._data.callbacks.onCancelMove}}return new s.HitTestResult(s.HitTarget.Custom,{...f,...t,...(0,d.activeItemToHitTestResultData)({id:this._data.id,part:7}),clickHandler:this._data.callbacks.onConfirm,tapHandler:this._data.callbacks.onConfirm})}const o=this._calcConfirmRect(e.pixelRatio,c.borderWidth).offset;if(t-c.body.left<0?h>=t&&h<c.tp.left:h>=c.confirm.left-o&&h<c.confirm.left)return new s.HitTestResult(s.HitTarget.Custom,f)}return super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e),i=o.bottom-o.top,s=o.yMid;this._isTPSLVisible()&&(0!==o.tp.width&&1===(0,r.ensureDefined)(this._data.tp).visibility&&this._drawButton(t,e,i,o.borderRadius,s,o.tp,this._data.tp),0!==o.sl.width&&1===(0,r.ensureDefined)(this._data.sl).visibility&&this._drawButton(t,e,i,o.borderRadius,s,o.sl,this._data.sl)),this._hasConfirmButton()&&this._drawButton(t,e,i,o.borderRadius,s,o.confirm,this._data.confirm)}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRectWithOffsets(t){let e=super._calculateCacheRectWithOffsets(t);return e={...e,tp:{...e.tp,left:this._calcCoordinateWithOffset(e.tp.left,e.tp.left+e.tp.width).left},sl:{...e.sl,left:this._calcCoordinateWithOffset(e.sl.left,e.sl.left+e.sl.width).left}},void 0!==e.confirm&&(e.confirm={...e.confirm,left:this._calcCoordinateWithOffset(e.confirm.left,e.confirm.left+e.confirm.width).left}),e}_calculateCacheRect(t){const e=super._calculateCacheRect(t),o=this._calcTPSLRect(t.pixelRatio,e.borderWidth),r=this._calcConfirmRect(t.pixelRatio,e.borderWidth);let i=0,s=0;const l=this._data.bodyAlignment===n.TradedGroupHorizontalAlignment.Left;l?(s=e.body.right+o.offset,i=s+o.tp-(o.tp>0?e.borderWidth:0)):(i=e.body.left-o.offset-o.sl,s=i-(o.tp>0?o.tp-e.borderWidth:0));let a=0;r.confirm>0&&(a=l?i+o.sl+r.offset:s-r.confirm-r.offset-e.borderWidth);let d=a||s,c=e.right;return l&&(d=e.left,c=a>0?a+r.confirm:i+o.sl),{...e,left:d,right:c,tp:{width:o.tp,left:s},sl:{width:o.sl,left:i},confirm:{width:r.confirm,left:a}}}_drawLine(t,e){var o,r;if(!this._data.callbacks.onFinishMoveSL&&!this._data.callbacks.onFinishMoveTP)return void super._drawLine(t,e);const i=e.pixelRatio,s=this.rectWithOffsets(e),l=Math.round(e.physicalWidth);if(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*i)),(0,
a.setLineStyle)(t,this._data.line.style),(0,a.drawHorizontalLine)(t,s.yMid,s.body.right,l),this._data.line.extend)(0,a.drawHorizontalLine)(t,s.yMid,0,s.body.left);else{const e=1===(null===(o=this._data.tp)||void 0===o?void 0:o.visibility),i=1===(null===(r=this._data.sl)||void 0===r?void 0:r.visibility);if(e||i){const e=i?s.sl.left+s.sl.width:s.tp.left+s.tp.width;(0,a.drawHorizontalLine)(t,s.yMid,e,s.body.left)}if(this._hasConfirmButton()){const e=s.confirm.left+s.confirm.width;(0,a.drawHorizontalLine)(t,s.yMid,e,s.body.left)}}t.restore()}_calcAllWidth(t,e,o,r,i,s){const l=super._calcAllWidth(t,e,o,r,i,s);if(!this._data.tp&&!this._data.sl&&!this._hasConfirmButton())return l;const a=this._calcTPSLRect(t,s),n=this._calcConfirmRect(t,s);return l+a.tp+a.sl+a.offset+n.confirm+n.offset}_calcConfirmRect(t,e){if(!this._hasConfirmButton())return{confirm:0,offset:0};const o=2*e,i=Math.round(11*t),s=this._textWidth(this._ctxInternal,(0,r.ensureDefined)(this._data.confirm).text);return{confirm:Math.round(s*t)+(s&&o)+(s&&i),offset:Math.round(10*t)}}_calcTPSLRect(t,e){const o=2*e,r=this._textWidth(this._ctxInternal,void 0!==this._data.tp?this._data.tp.text:""),i=Math.round(r*t)+(r&&o),s=this._textWidth(this._ctxInternal,void 0!==this._data.sl?this._data.sl.text:""),l=Math.round(s*t)+(s&&o);return{tp:i,sl:l,offset:l>0||i>0?Math.round(10*t):0}}_drawButton(t,e,o,r,i,s,l){if(void 0===l)return;const n=this.rectWithOffsets(e);(0,a.drawRoundRectWithInnerBorder)(t,s.left,n.top,s.width,o,l.backgroundColor,r),l.active.visible&&(0,a.drawRoundRectWithInnerBorder)(t,s.left,n.top,s.width,o,l.active.backgroundColor,r);const d=l.active.visible&&void 0!==l.active.borderColor?l.active.borderColor:l.borderColor;(0,a.drawRoundRectWithInnerBorder)(t,s.left,n.top,s.width,o,"transparent",r,n.borderWidth,d,l.borderStyle);const c=s.left+s.width/2;l.underlineText?this._drawUnderlinedText(t,e.pixelRatio,l.text,l.textColor,c,i):this._drawText(t,e.pixelRatio,l.text,l.textColor,c,i)}_isTPSLVisible(){return Boolean(this._data.tp)||Boolean(this._data.sl)}_hasConfirmButton(){return Boolean(this._data.callbacks.onConfirm&&this._data.confirm)}}},210690:(t,e,o)=>{o.d(e,{ItemRenderer:()=>y,ItemsRendererType:()=>r,activeItemToHitTestResultData:()=>_});var r,i=o(650151),s=o(86441),l=o(315801),a=o(147354),n=o(638456),d=o(787123),c=o(507795),h=o(833118);function u(t,e,o,r,i,s){t.save(),t.fillStyle=s,t.fillRect(e,o,r,i),t.restore()}!function(t){t[t.Position=0]="Position",t[t.WithBracketButtons=1]="WithBracketButtons",t[t.Projection=2]="Projection",t[t.Default=3]="Default"}(r||(r={}));const p=n.CheckMobile.any();function _(t){return{activeItem:t,equals:e=>!!e.activeItem&&e.activeItem.id===t.id&&e.activeItem.part===t.part}}class y{constructor(t,e,o,r){this._height=p?23:19,this._bodyBorderRadius=4,this._font=null,this._offsets=null,this._alignedTop=null,this._wasSourceMoved=!1,this._cache=null,this._cacheWithOffset=null,this._textWidthCache=e,this._minMainTextWidthGetter=r,this._data=t,this._font=o,this._initCtx()}data(){return this._data}clearCache(){this._cache=null,
this._cacheWithOffset=null}applyOffset(t){this._offsets=t}setAlignedTopCoordinate(t){this._alignedTop=t}hitTest(t,e){var o;const r=this.rectWithOffsets(e),n=e.pixelRatio,d=Math.round(t.x*n),c=Math.round(t.y*n),h=d>=r.body.left,u=d<=r.body.right,p=h&&u;if(!(c>=r.top&&c<=r.bottom)||!p)return null;const y={cursorType:a.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,..._({id:this._data.id,part:8})};if(this._data.disabled)return new l.HitTestResult(l.HitTarget.Custom,y);let f={};if(void 0!==this._data.callbacks.onMove){const t=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},e=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};f={cursorType:a.PaneCursorType.Pointer,pressedMouseMoveHandler:t,touchMoveHandler:t,mouseUpHandler:e,touchEndHandler:e,cancelMoveHandler:this._data.callbacks.onCancelMove}}const v=this._data.callbacks.onContextMenu,b=this._data.callbacks.onContextMenu,C={...y,...f,hasOwnShortcutsBehaviourFor:{shiftKey:!0},contextMenuHandler:v,touchContextMenuHandler:b},m=Math.round(r.body.left/n),P=Math.round(r.top/n);if(d>=r.close.left&&u&&void 0!==this._data.callbacks.onClose){const t=Math.round(r.body.right/n),e=Math.round(r.close.left/n);return new l.HitTestResult(l.HitTarget.Custom,{...C,..._({id:this._data.id,part:3}),cursorType:a.PaneCursorType.Default,clickHandler:this._data.callbacks.onClose,tapHandler:this._data.callbacks.onClose,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.close).title,rect:{x:e,y:P,w:t-e,h:this._height}}})}if(null===(o=this._data.callbacks)||void 0===o?void 0:o.allInteractionsHandler)return new l.HitTestResult(l.HitTarget.Custom,{...y,clickHandler:this._data.callbacks.allInteractionsHandler,tapHandler:this._data.callbacks.allInteractionsHandler,contextMenuHandler:this._data.callbacks.allInteractionsHandler,touchContextMenuHandler:this._data.callbacks.allInteractionsHandler});if(d>=r.text.left&&d<r.close.left){const t=Math.round(r.text.left/n),e=Math.round(r.bottom/n),o=Math.round(r.text.width/n),i=this._data.callbacks.onText;if(void 0!==i){const r=r=>{const l=r.clientX-r.localX,a=r.clientY-r.localY,n=new s.Point(t+l,e+a);i((r=>r.x>t&&r.x<=t+o&&r.y>P&&r.y<=e),n)},n=r,d=t=>{t.preventDefault(),r(t)};return new l.HitTestResult(l.HitTarget.Custom,{...C,..._({id:this._data.id,part:2}),cursorType:a.PaneCursorType.Default,clickHandler:n,tapHandler:d,tooltip:{extendMargin:!0,text:this._data.text.title,rect:{x:t,y:P,w:o,h:this._height}}})}const d=Math.round(r.close.left/n);return new l.HitTestResult(l.HitTarget.Custom,{...C,..._({id:this._data.id,part:2}),tooltip:{extendMargin:!0,text:this._data.text.title,rect:{x:t,y:P,w:d-t,h:this._height}}})}const g=this._data.callbacks.onQtyModify;if(d>r.qty.left&&d<r.text.left&&void 0!==g){const t=Math.round(r.qty.left/n),e=Math.round(r.bottom/n),o=Math.round(r.qty.width/n),d=r=>{const i=r.clientX-r.localX,l=r.clientY-r.localY,a=new s.Point(t+o+i,e+l);g((r=>r.x>t&&r.x<=t+o&&r.y>P&&r.y<=e),a)},c=d,h=t=>{t.preventDefault(),d(t)
},u=Math.round(r.text.left/n);return new l.HitTestResult(l.HitTarget.Custom,{...y,...f,..._({id:this._data.id,part:1}),cursorType:a.PaneCursorType.Default,clickHandler:c,tapHandler:h,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.qty).title,rect:{x:t,y:P,w:u-t,h:this._height}}})}if(h&&d<r.text.left&&void 0!==this._data.callbacks.onModify){const t=Math.round(r.text.left/n);return new l.HitTestResult(l.HitTarget.Custom,{...C,..._({id:this._data.id,part:1}),cursorType:a.PaneCursorType.Default,clickHandler:this._data.callbacks.onModify,tapHandler:this._data.callbacks.onModify,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.qty).title,rect:{x:m,y:P,w:t-m,h:this._height}}})}return new l.HitTestResult(l.HitTarget.Custom,C)}drawBackground(t,e){!this._data.line.drawOnTop&&this._data.visible&&this._drawLine(t,e)}drawLine(t,e){this._isDataVisibleInViewport(e)&&this._data.line.drawOnTop&&this._data.visible&&this._drawLine(t,e)}drawPointOnLine(t,e,o){if(!this._isDataVisibleInViewport(e)||!this._data.point.visible||!this._data.visible)return;const r=this.rectWithOffsets(e),i=Math.round(3*e.pixelRatio),s=Math.max(1,Math.floor(1*e.pixelRatio)),l=s/2,a=2.5*e.pixelRatio+l,n=o+(l%1==0?0:.5),h=r.yMid+(l%1==0?0:.5);this._data.line.extend||this._data.bodyAlignment!==c.TradedGroupHorizontalAlignment.Left||(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*e.pixelRatio)),(0,d.setLineStyle)(t,this._data.line.style),(0,d.drawHorizontalLine)(t,r.yMid,n,r.left),t.restore()),t.save(),t.lineWidth=s,(0,d.setLineStyle)(t,this._data.point.borderStyle),this._data.point.shadowColor&&!this._data.disabled&&(t.fillStyle=this._data.point.shadowColor,(0,d.createCircle)(t,n,h,a+i),t.fill()),t.strokeStyle=this._data.point.borderColor,t.fillStyle=this._data.point.backgroundColor,(0,d.createCircle)(t,n,h,a),t.fill(),t.stroke(),t.restore()}draw(t,e){if(!this._data.visible)return;const o=e.pixelRatio,r=this.rectWithOffsets(e);if(!this._isDataVisibleInViewport(e))return;const s=0!==r.qty.width,l=0!==r.text.width,a=0!==r.close.width,n=r.body.right-r.body.left,c=r.bottom-r.top,h=r.top+r.borderWidth,p=c-2*r.borderWidth,_=r.borderRadius-r.borderWidth;(0,d.drawRoundRectWithInnerBorder)(t,r.body.left,r.top,n,c,this._data.borderBackgroundColor,r.borderRadius,r.borderWidth,this._data.borderColor,this._data.borderStyle);let y=r.body.left+r.borderWidth;if(s){const e=(0,i.ensureDefined)(this._data.qty);this._drawQtyWithBackground(t,o,r,!0,!a&&!l),y+=r.qty.width,r.qty.rightDividerWidth&&(u(t,y,h,r.qty.rightDividerWidth,p,e.dividerColor),y+=r.qty.rightDividerWidth)}if(l&&(this._drawTextWithBackground(t,o,r,!s,!a),y+=r.text.width,r.text.rightDividerWidth&&(u(t,y,h,r.text.rightDividerWidth,p,this._data.text.dividerColor),y+=r.text.rightDividerWidth)),a){const e=(0,i.ensureDefined)(this._data.close),s=r.body.right-y-r.borderWidth;(0,d.drawRoundRectWithInnerBorder)(t,y,h,s,p,e.backgroundColor,[0,_,_,0]),e.active.visible&&(0,
d.drawRoundRectWithInnerBorder)(t,y,h,s,p,e.active.backgroundColor,[0,_,_,0]),this._drawCloseButton(t,o,y,r.top,r.close.width,c,r.borderWidth)}}rect(t){return null===this._cache&&(this._cache=this._calculateCacheRect(t)),this._cache}rectWithOffsets(t){return null===this._cacheWithOffset&&(this._cacheWithOffset=this._calculateCacheRectWithOffsets(t)),this._cacheWithOffset}_calculateCacheRect(t){var e;const o=t.pixelRatio,r=Math.round(t.cssWidth*o),i=Math.max(1,Math.floor(1*o)),s=this._bodyBorderRadius,l=Math.max(s,Math.floor(s*o)),a=this._quantityWidth(this._ctxInternal),n=Math.round(a*o),d=this._mainTextWidth(this._ctxInternal),h=Math.round(d*o),u=this._data.callbacks.onClose?this._closeWidth():0,p=Math.round(u*o);let _=0;const y=a&&(d||u),f=d&&u;_+=y&&1,_+=f&&1;const v=n+h+p+i*_+2*i;let b=Math.round(this._height*o);const C=Math.max(1,Math.floor(o));b%2!=C%2&&(b+=1);const m=Math.round(this._data.y*o),P=Math.floor(m+C/2-b/2)-Math.floor(.5*o),g=this._data.bodyAlignment===c.TradedGroupHorizontalAlignment.Center?Math.round(40*r/100):Math.round(this._data.rightPadding*o);let T=g;this._data.bodyAlignment===c.TradedGroupHorizontalAlignment.Left&&(T=r-g-v);const k=r-T,x=k-v,M=x+n+(n&&i)+(n&&i),w=M+h+(h&&i);return{borderWidth:i,borderRadius:l,yMid:m,top:P,bottom:P+b,left:x,right:k,body:{left:x,right:k},qty:{width:n,left:x+(n&&i),rightDividerWidth:y&&(null===(e=this._data.qty)||void 0===e?void 0:e.isDividerVisible)?i:0},text:{width:h,left:M,rightDividerWidth:f?i:0},close:{width:p,left:w}}}_calculateCacheRectWithOffsets(t){const e=this.rect(t),{left:o,right:r}=this._calcCoordinateWithOffset(e.left,e.right),{left:i,right:s}=this._calcCoordinateWithOffset(e.body.left,e.body.right);return{...e,left:o,right:r,top:this._alignedTop?this._alignedTop:e.top,bottom:this._alignedTop?this._alignedTop+(e.bottom-e.top):e.bottom,body:{...e.body,left:i,right:s},qty:{...e.qty,left:this._calcCoordinateWithOffset(e.qty.left,e.qty.left+e.qty.width).left},text:{...e.text,left:this._calcCoordinateWithOffset(e.text.left,e.text.left+e.text.width).left},close:{...e.close,left:this._calcCoordinateWithOffset(e.close.left,e.close.left+e.close.width).left}}}_calcCoordinateWithOffset(t,e){var o,r,i,s;if(null!==this._cache){const l=null!==(r=null===(o=this._offsets)||void 0===o?void 0:o.leftmostForItemOffset)&&void 0!==r?r:null;if(null!==l){const o=t-(this._cache.left-l);return{left:o,right:o+(e-t)}}const a=null!==(s=null===(i=this._offsets)||void 0===i?void 0:i.rightmostForItemOffset)&&void 0!==s?s:null;if(null!==a){const o=e+(a-this._cache.right);return{left:o-(e-t),right:o}}}return{left:t,right:e}}_calcAllWidth(t,e,o,r,i,s){return e+o+r+i+2*s}_isDataVisibleInViewport(t){const e=Math.ceil(this._height/2);return this._data.y>=-e&&this._data.y<=t.cssHeight+e}_mainTextWidth(t){return this._data.text.text?this._minMainTextWidthGetter(this._data,t)+14:0}_closeWidth(){return 23}_measureTextWidth(t,e){if(!e)return 0;const o=t.font;t.font=(0,i.ensureNotNull)(this._font);const r=Math.ceil(this._textWidthCache.measureText(t,e));return t.font=o,r}_textWidth(t,e){
const o=this._measureTextWidth(t,e);return o?Math.round(14+o):0}_quantityWidth(t){var e,o,r;const i=this._measureTextWidth(t,null===(e=this._data.qty)||void 0===e?void 0:e.text);return Math.round(Math.max(this._height,14+i,null!==(r=null===(o=this._data.qty)||void 0===o?void 0:o.minTextWidth)&&void 0!==r?r:0))}_drawLine(t,e){const o=e.pixelRatio,r=this.rectWithOffsets(e),i=Math.round(e.physicalWidth);t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*o)),(0,d.setLineStyle)(t,this._data.line.style),(0,d.drawHorizontalLine)(t,r.yMid,r.body.right,i),this._data.line.extend&&(0,d.drawHorizontalLine)(t,r.yMid,0,r.body.right),t.restore()}_drawQtyBackground(t,e,o,r,s){const l=(0,i.ensureDefined)(this._data.qty),a=o.bottom-o.top,n=o.top+o.borderWidth,c=a-2*o.borderWidth,h=o.borderRadius-o.borderWidth;let u=0;s?u=r?h:[0,h,h,0]:r&&(u=[h,0,0,h]),(0,d.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,c,l.backgroundColor,u),l.active.visible&&(0,d.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,c,l.active.backgroundColor,u)}_drawQtyWithBackground(t,e,o,r,s){const l=(0,i.ensureDefined)(this._data.qty);this._drawQtyBackground(t,e,o,r,s);const a=(o.top+o.bottom)/2,n=o.qty.left+o.qty.width/2;this._drawText(t,e,l.text,l.textColor,n,a)}_drawTextWithBackground(t,e,o,r,s){const l=o.bottom-o.top,a=o.top+o.borderWidth,n=l-2*o.borderWidth,c=o.borderRadius-o.borderWidth;let u=0;s?u=r?c:[0,c,c,0]:r&&(u=[c,0,0,c]),(0,d.drawRoundRectWithInnerBorder)(t,o.text.left,a,o.text.width,n,this._data.text.backgroundColor,u),this._data.text.active.visible&&(0,d.drawRoundRectWithInnerBorder)(t,o.text.left,a,o.text.width,n,this._data.text.active.backgroundColor,u);const p=o.top+l/2,_=o.text.left+o.text.width/2,y=(this._data.qty||this._data.text).text,f=this._getTextYMidCorrection(t,y)*e;(0,h.drawText)(t,e,this._data.text.text,_,p,f,this._data.text.textColor,(0,i.ensureNotNull)(this._font))}_drawText(t,e,o,r,s,l,a){const n=o.split("@").join("").toUpperCase(),d=this._getTextYMidCorrection(t,n)*e;(0,h.drawText)(t,e,o,s,l,d,r,(0,i.ensureNotNull)(this._font),a)}_drawUnderlinedText(t,e,o,r,s,l){const a=this._getTextYMidCorrection(t,o)*e,n=this._getTextMetrics(t,o);(0,h.drawUnderlinedText)(t,e,o,s,l,a,r,(0,i.ensureNotNull)(this._font),n)}_getTextYMidCorrection(t,e){const o=t.font;t.font=(0,i.ensureNotNull)(this._font);const r=this._textWidthCache.yMidCorrection(t,e);return t.font=o,r}_getTextMetrics(t,e){const o=t.font;t.font=(0,i.ensureNotNull)(this._font);const r=this._textWidthCache.getMetrics(t,e);return t.font=o,r}_drawCloseButton(t,e,o,r,l,a,n){const c=(0,i.ensureDefined)(this._data.close);t.save(),t.lineWidth=n,t.strokeStyle=c.iconColor;const h=r+a,u=Math.max(1,Math.ceil(7*e)),p=Math.round((l-u)/2),_=Math.round((a-u)/2);(0,d.drawPoly)(t,[new s.Point(o+p,r+_),new s.Point(o+p+u,h-_)],!0),(0,d.drawPoly)(t,[new s.Point(o+p+u,r+_),new s.Point(o+p,h-_)],!0),t.restore()}_initCtx(){const t=document.createElement("canvas");t.width=0,t.height=0,this._ctxInternal=(0,
i.ensureNotNull)(t.getContext("2d"))}}},30363:(t,e,o)=>{o.d(e,{OrderBaseItem:()=>D,cancelTitle:()=>w});var r=o(444372),i=o(167975),s=o(650151),l=o(150335),a=o(86441),n=o(389137),d=o(373571),c=o(379048),h=o(217504),u=o(507795),p=o(767162),_=o(199356),y=o(588929),f=o(17980),v=o(743377),b=o(166059);var C=o(793814),m=o(48524),P=o(119836),g=o(125226),T=o(739630),k=o(779298);const x=(0,g.isFeatureEnabled)("allow_trailing_stop_profit_loss"),M=(0,i.appendEllipsis)(r.t(null,void 0,o(305806))),w=r.t(null,void 0,o(709498)),S=r.t(null,void 0,o(555937)),B=r.t(null,void 0,o(937385));class D extends k.BaseItem{constructor(t,e,o,r,i,l,a,n="Chart Order"){super(t,e,o,r,n,i,l),this._inEdit=!1,this._isQtyModifyOpened=!1,this._handleQtyModifyClose=(t,e)=>{t(e)?this.applyQty(this.data().qty):this._handleQtyModifyDestroy()},this._handleQtyModifyDestroy=()=>{this.applyQty(this.data().qty),this._isQtyModifyOpened=!1,this._closeQtyCalc()},this._isBracket()&&this._source.bracketsDisplayMode().subscribe(this,this.fireProfitLossChange),a&&(this._qtyModifyCallbacks={onQtyApplyHandler:a.onQtyApplyHandler,onToggleQtyCalcHandler:a.onToggleQtyCalcHandler,qtyInfoGetter:a.qtyInfoGetter},this._qtyProvider=a.qtyProvider,this._suggestedQty=this._qtyProvider.suggestedQty().spawn(),this._suggestedQty.subscribe((0,s.ensureDefined)(this._qtyModifyCallbacks.onQtyApplyHandler)))}destroy(){var t,e;this._isQtyModifyOpened=!1,this._closeQtyCalc(),this._source.bracketsDisplayMode().unsubscribe(this,this.fireProfitLossChange),null===(t=this._contextMenu)||void 0===t||t.hide(),null===(e=this._suggestedQty)||void 0===e||e.destroy(),super.destroy()}supportBrackets(){return!this._isBracket()&&this._symbolDataProvider.supportOrderBrackets()}canQtyCalcModify(){return Boolean(this._qtyProvider)}toggleQtyModify(t,e,o={}){this.canQtyCalcModify()&&(this._isQtyModifyOpened=!this._isQtyModifyOpened,this._toggleQtyCalc(t,e,o))}modifyQty(t){this.canQtyCalcModify()&&(0,s.ensureDefined)(this._qtyModifyCallbacks).onQtyApplyHandler(t)}applyQty(t){var e;this.modifyQty(t),null===(e=this._qtyProvider)||void 0===e||e.applySuggestedQty(this._data.qty)}currency(){var t;return null!==(t=this._symbolDataProvider.orderCurrency())&&void 0!==t?t:""}canSwitchType(){return!1}id(){return this._id}setData(t){this._inEdit||(super.setData(t),this.fireProfitLossChange(),this._id=this._calcId())}setInEdit(t){this._inEdit=t}type(){return this._data.type}bracketType(){return this._isBracket()?(0,P.getBracketType)(this._data):null}qty(){return this._data.qty}profitLossText(t){var e;return this._data&&this._isBracket()&&(null===(e=this._source.isBracketsPLVisible())||void 0===e?void 0:e.value())&&(this.bracketType()!==_.BracketType.TrailingStop||x)?super.profitLossText(t):this._bracketTypeText(t)}profitLossTextColor(){if(!this._data)return"";const t=this.style();if(!this._isBracket())return t.text.textColor;const e=this._potentialProfitLoss();return null===e?t.text.textColor:(0,p.profitLossTextColor)(t,e,!1)}profitLossTooltip(){var t;const e=this._source.mainItem(),o=null==e?void 0:e.price()
;if(null==o||!this._isBracket())return"";const r=this._potentialProfitLoss();if(null===r)return`${this._bracketTypeText()}`;if(!(null===(t=this._source.isBracketsPLVisible())||void 0===t?void 0:t.value())||this.bracketType()===_.BracketType.TrailingStop&&!x)return"";switch(this._infoGetters.displayMode.value()){case u.PlDisplay.Money:return`${this._bracketTypeText()} ${this.percentageText(r)} ${this.pipsText(r)}`;case u.PlDisplay.Percentage:return`${this._bracketTypeText()} ${this.moneyText(r)} ${this.pipsText(r)}`;case u.PlDisplay.Pips:return`${this._bracketTypeText()} ${this.moneyText(r)} ${this.percentageText(r)}`;default:return`${this._bracketTypeText()} ${this.pipsText(r)} ${this.percentageText(r)} ${this.moneyText(r)}`}}lineStyle(){return this.isWorking()?c.LineStyle.Solid:c.LineStyle.Dotted}calcPriceDiff(t){const e=new a.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),r=this._mainSeries.firstValue();if(null===r)return null;const i=(0,s.ensureNotNull)(this.price());return o.coordinateToPrice(e.y,r)-i}applyPriceDiff(t){this._inEdit=!0,this._data.price=this._calcPriceByDiff(t)}onMove(t){const e=this.calcPriceDiff(t);null!==e&&(this.applyPriceDiff(e),t.isTouch&&(0,s.ensureDefined)(this._itemCommands.exitTrackingMode)())}async onFinishMove(t={},e={},o=!0,r,i=!0){var l,a,d;o&&this._source.setIsBlocked(!0);const c=(0,n.clone)(this._data),h=(0,s.ensureNotNull)(this.price());c.limitPrice=null!==(l=e.limitPrice)&&void 0!==l?l:c.limitPrice,c.takeProfit=null!==(a=e.takeProfit)&&void 0!==a?a:c.takeProfit,c.stopLoss=null!==(d=e.stopLoss)&&void 0!==d?d:c.stopLoss,c.stopPrice?c.stopPrice=h:c.limitPrice&&(c.limitPrice=h),this._addTrailingStopPipsData(c,e.trailingStop),this._trackEventGA(t);const u=await this._onFinishMoveOrder(c,r,i);return this._inEdit=!1,u}hasContextMenu(){return super.hasContextMenu()||this.isMovingEnabled()}async onContextMenu(t,e){this.fireProfitLossChange(),e=(0,m.mergeGaParams)(e,{origin:"Chart Order Context Menu"});const o=this._composeContextMenuActions(e),r={side:(0,f.sideToText)(this._data.side),qty:this.qtyText(),price:this.priceText(),orderType:(0,f.orderTypeToText)({orderType:this._data.type}),formatPlWV:this._isBracket()?this.formatPlWV():void 0},i=await async function(t,e){const o=[],r=await(0,b.createContextMenuTitle)("Trading.OrderTitle",e);r&&o.push(r);for(const{actionId:e,label:r,onExecute:i}of t)o.push(new d.Action({actionId:e,options:{label:r,onExecute:i}}));return o}(o,r),s=this._infoGetters.noOverlapAction(e,(t=>this._trackEventGA(t)));s&&(i.push(new d.Separator),i.push(s)),this._contextMenu=await(0,b.showContextMenu)(i,t,(()=>{this._contextMenu=null}),{detail:{type:"order",id:this.id().toString()}})}_composeContextMenuActions(t){const e=[];return this.supportModify()&&e.push({actionId:"Trading.EditOrder",label:this._source.isPlaced()?M:B,onExecute:()=>this.onModify(t)}),this.supportClose()&&e.push({actionId:"Trading.CancelOrder",label:this._source.isPlaced()?w:S,onExecute:()=>this.onClose(t)}),e}_calcPriceByDiff(t){const{minTick:e,variableMinTickData:o}=(0,
s.ensureNotNull)(this._symbolDataProvider.symbolData()),r=t+(0,s.ensureNotNull)(this.price()),i=(0,h.getMinTick)({minTick:e,price:r,variableMinTickData:o});return(0,l.fixComputationError)(i*Math.round(r/i))}_addTrailingStopPipsData(t,e){const o=this._source.mainItem();if(o){const{side:r,stopPrice:i,limitPrice:l}=o.data(),{pipSize:a}=(0,s.ensureNotNull)(this._symbolDataProvider.symbolData());if(void 0!==e){const o=(0,s.ensureDefined)(t.stopPrice||t.limitPrice);t.trailingStopPips=(0,v.calcPipsByPrice)(e,o,r,a)}else if((0,C.isBracketOrderRawData)(t)&&t.parentId&&t.stopType===y.StopType.TrailingStop){const{bid:e,ask:n}=(0,s.ensureNotNull)(this._symbolDataProvider.lastData());let d;if((0,T.isPositionLikeItem)(o))d=1===r?e:n;else{d=3===o.data().type?i:l}t.trailingStopPips=(0,v.calcPipsByPrice)((0,s.ensureDefined)(t.stopPrice||t.limitPrice),(0,s.ensureDefined)(d),r,a)}}return t}_bracketTypeText(t){if(!this._data)return"";if(this._isBracket()){const e=(0,P.getBracketTypeToText)(this._data.type,this._data.stopType,t);if(null!==e)return e}return t?(0,f.orderTypeToText)({orderType:this._data.type,uppercase:!0,shorten:!0}):`${(0,f.sideToText)(this._data.side)} ${(0,f.orderTypeToText)({orderType:this._data.type,uppercase:!1})}`}_potentialProfitLoss(){const t=this._source.baseItem();if(!this._data||!t)return null;const e=this.price(),{ask:o,bid:r}=this._symbolDataProvider.lastData()||{},i=t.tryBasePlOnLast()&&3===this._data.type&&this._data.stopType===y.StopType.TrailingStop;if(!(0,n.isNumber)(e))return null;const s=i?this.isBuyDirection()?o:r:t.price();return(0,n.isNumber)(s)?(s-e)*this._data.side:null}_isBracket(){const t=this.data();if(!(0,C.isBracketOrderRawData)(t))return!1;const e=this._source.mainItem();return 1!==t.parentType||void 0!==e&&e.data().side!==this._data.side}_closeQtyCalc(){this._toggleQtyCalc((()=>!1),new a.Point(0,0))}_toggleQtyCalc(t,e=new a.Point(0,0),o={}){if(!this.canQtyCalcModify())return;const{onToggleQtyCalcHandler:r,qtyInfoGetter:i}=(0,s.ensureDefined)(this._qtyModifyCallbacks);r(this._isQtyModifyOpened,e,i,(()=>this.data().qty),(t=>this.modifyQty(t)),(e=>this._handleQtyModifyClose(t,e)),this._handleQtyModifyDestroy)}}},99272:(t,e,o)=>{o.d(e,{OrderWithMenuItem:()=>l});var r=o(650151),i=o(86441),s=o(30363);class l extends s.OrderBaseItem{constructor(t,e,o,r,i,s,l,a){super(t,e,o,r,i,s,a),this._isTypeMenuOpened=!1,this._handleTypeMenuClose=(t,e)=>{t(e)||this._handleTypeMenuDestroy()},this._handleTypeMenuDestroy=()=>{this._isTypeMenuOpened=!1},this._typeMenuCallbacks=l}destroy(){var t;null===(t=this._typeMenuCallbacks)||void 0===t||t.closeDropdownMenuHandler(),super.destroy()}isMovingEnabled(){return!0}toggleType(t,e,o={}){this._typeMenuCallbacks&&(this._isTypeMenuOpened=!this._isTypeMenuOpened,this._toggleTypeMenu(t,e,o))}async onClose(t){}async onModify(t){return!1}async _onFinishMoveOrder(t,e,o=!0){return!0}_toggleTypeMenu(t,e=new i.Point(0,0),o={}){(0,
r.ensureDefined)(this._typeMenuCallbacks).onToggleTypeMenuHandler(this._isTypeMenuOpened,e,o,(e=>this._handleTypeMenuClose(t,e)),this._handleTypeMenuDestroy)}}},739630:(t,e,o)=>{function r(t){return"onReverse"in t}function i(t){return function(t){return"isMovingEnabled"in t&&"onMove"in t&&"onFinishMove"in t}(t)&&"bracketType"in t&&"isWorking"in t}function s(t){return"Position"===t.dataType}function l(t){return"PreOrder"===t.dataType}function a(t){return"Order"===t.dataType}o.d(e,{isOrderItemRawData:()=>a,isOrderLikeItem:()=>i,isPositionItemRawData:()=>s,isPositionLikeItem:()=>r,isPreOrderItemRawData:()=>l})},883990:(t,e,o)=>{o.d(e,{isLimitPartStopLimitOrderItem:()=>h,isOrderItem:()=>d,isPositionItem:()=>n,isPreOrderItem:()=>c,isProjectionBracketItem:()=>u});var r=o(834034),i=o(61215),s=o(917244),l=o(794546),a=o(516879);function n(t){return t instanceof l.PositionItem}function d(t){return t instanceof s.OrderItem}function c(t){return t instanceof a.PreOrderItem}function h(t){return t instanceof i.LimitPartStopLimitOrderItem}function u(t){return t instanceof r.ProjectionBracketItem}},61215:(t,e,o)=>{o.d(e,{LimitPartStopLimitOrderItem:()=>a});var r=o(650151),i=o(389137),s=o(17980),l=o(917244);class a extends l.OrderItem{isWorking(){return!1}async onFinishMove(t,e={},o=!0,s){this._source.setIsBlocked(o);const l=(0,i.clone)(this.data()),a=(0,r.ensureNotNull)(l.price);l.limitPrice=a,l.takeProfit=e.takeProfit||l.takeProfit,l.stopLoss=e.stopLoss||l.stopLoss,await this._addTrailingStopPipsData(l),void 0===s&&(s=1),this._trackEventGA(t);const n=await(0,r.ensureDefined)(this._data.callbacks.moveOrder)(l.id,l,s);return this._inEdit=!1,this._source.setIsBlocked(!1),this._source.syncData(),n}profitLossText(t){return this._source.isPlaced()?this._bracketTypeText(t):(0,s.orderTypeToText)({orderType:this.data().type,uppercase:t,shorten:t})}supportClose(){return!1}_calcId(){return this.data().type}}},917244:(t,e,o)=>{o.d(e,{OrderItem:()=>p});var r=o(650151),i=o(389137),s=o(77122),l=o(199356),a=o(48524),n=o(125226),d=o(30363),c=o(119836);const h=s.enabled("chart_hide_close_order_button"),u=(0,n.isFeatureEnabled)("allow_trailing_stop_profit_loss");class p extends d.OrderBaseItem{style(){return this._infoGetters.style(this)}isMovingEnabled(){return this._data.supportMove}supportClose(){return!h&&Boolean(this._data.callbacks.cancelOrder)}supportModify(){return Boolean(this._data.callbacks.modifyOrder)}isWorking(){return 6===this._data.status}qtyText(){return super._quantityText(this._data.considerFilledQty?this._data.qty-(this._data.filledQty||0):this._data.qty)}profitLossText(t){var e;return this._data&&this._isBracket()&&(null===(e=this._source.isBracketsPLVisible())||void 0===e?void 0:e.value())&&(this.bracketType()!==l.BracketType.TrailingStop||u)?super.profitLossText(t):this._bracketTypeText(t)}async onModify(t={},e,o){this._source.setIsBlocked(!0);const s=(0,i.clone)(this._data);await this._addTrailingStopPipsData(s),this._trackEventGA((0,a.mergeGaParams)(t,{event:"Edit Order"}));const l=await(0,
r.ensureDefined)(this._data.callbacks.modifyOrder)(s.id,s,e,o);return this._source.setIsBlocked(!1),this._source.syncData(),l}async onClose(t={}){this._source.isBlocked()||(this._source.setIsBlocked(!0),this._trackEventGA((0,a.mergeGaParams)(t,{event:"Cancel Order"})),await(0,r.ensureDefined)(this._data.callbacks.cancelOrder)(this._data.id),this._source.setIsBlocked(!1),this._source.syncData())}_onFinishMoveOrder(t,e,o=!0){return this._data.callbacks.moveOrder||this._data.supportModifyOrderPrice?(0,r.ensureDefined)(this._data.callbacks.moveOrder)(t.id,t,e):(0,r.ensureDefined)(this._data.callbacks.modifyOrder)(t.id,t,e,o)}_calcId(){return void 0!==this._data.parentId?(0,r.ensureNotNull)((0,c.getBracketType)(this._data)):this._data.id}}},675341:(t,e,o)=>{o.d(e,{buyActiveColor:()=>l,buyPointShadowColor:()=>c,darkTheme:()=>C,overlayColor:()=>_,sellActiveColor:()=>a,sellPointShadowColor:()=>h,stopLossActiveColor:()=>d,takeProfitActiveColor:()=>n});var r=o(149511),i=o(246733),s=o(528474);const l=(0,i.generateColor)(r.colorsPalette["color-tv-blue-500"],85),a=((0,i.generateColor)(r.colorsPalette["color-tv-blue-500"],80),(0,i.generateColor)(r.colorsPalette["color-ripe-red-500"],85)),n=((0,i.generateColor)(r.colorsPalette["color-ripe-red-500"],80),(0,i.generateColor)(r.colorsPalette["color-minty-green-500"],85)),d=((0,i.generateColor)(r.colorsPalette["color-minty-green-500"],80),(0,i.generateColor)(r.colorsPalette["color-tan-orange-500"],85)),c=((0,i.generateColor)(r.colorsPalette["color-tan-orange-500"],80),(0,i.generateColor)(r.colorsPalette["color-tv-blue-500"],70)),h=(0,i.generateColor)(r.colorsPalette["color-ripe-red-500"],70),u=(0,i.generateColor)(r.colorsPalette["color-minty-green-500"],70),p=(0,i.generateColor)(r.colorsPalette["color-tan-orange-500"],70),_=(0,i.generateColor)(r.colorsPalette["color-cold-gray-900"],50),y={pointShadowColor:c,labelTickColor:r.colorsPalette["color-tv-blue-500"],lineColor:r.colorsPalette["color-tv-blue-500"],borderBackgroundColor:r.colorsPalette["color-cold-gray-900"],borderColor:r.colorsPalette["color-tv-blue-500"],pointBackgroundColor:r.colorsPalette["color-cold-gray-900"],disabledLineColor:r.colorsPalette["color-tv-blue-a700"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-tv-blue-500"],dividerColor:r.colorsPalette["color-tv-blue-a800"],activeColor:l},text:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-tv-blue-500"],dividerColor:r.colorsPalette["color-tv-blue-a800"],buttonTextColor:r.colorsPalette["color-tv-blue-500"]},close:{backgroundColor:r.colorsPalette["color-cold-gray-900"],iconColor:r.colorsPalette["color-tv-blue-500"],activeColor:l},confirm:{disableBackgroundColor:r.colorsPalette["color-cold-gray-750"],backgroundColor:r.colorsPalette["color-tv-blue-500"],borderColor:r.colorsPalette["color-tv-blue-500"],textColor:r.colorsPalette["color-white"],
disableTextColor:r.colorsPalette["color-cold-gray-600"],activeColor:r.colorsPalette["color-tv-blue-600"]}},f={pointShadowColor:h,labelTickColor:r.colorsPalette["color-ripe-red-500"],lineColor:r.colorsPalette["color-ripe-red-500"],borderBackgroundColor:r.colorsPalette["color-cold-gray-900"],borderColor:r.colorsPalette["color-ripe-red-500"],pointBackgroundColor:r.colorsPalette["color-cold-gray-900"],disabledLineColor:r.colorsPalette["color-ripe-red-a800"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-ripe-red-500"],dividerColor:r.colorsPalette["color-ripe-red-a800"],activeColor:a},text:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-ripe-red-500"],dividerColor:r.colorsPalette["color-ripe-red-a800"],buttonTextColor:r.colorsPalette["color-ripe-red-500"]},close:{backgroundColor:r.colorsPalette["color-cold-gray-900"],iconColor:r.colorsPalette["color-ripe-red-500"],activeColor:a},confirm:{disableBackgroundColor:r.colorsPalette["color-cold-gray-750"],backgroundColor:r.colorsPalette["color-ripe-red-500"],borderColor:r.colorsPalette["color-ripe-red-500"],textColor:r.colorsPalette["color-white"],disableTextColor:r.colorsPalette["color-cold-gray-600"],activeColor:r.colorsPalette["color-ripe-red-600"]}},v={pointShadowColor:u,labelTickColor:r.colorsPalette["color-minty-green-500"],lineColor:r.colorsPalette["color-minty-green-500"],borderBackgroundColor:r.colorsPalette["color-cold-gray-900"],borderColor:r.colorsPalette["color-minty-green-500"],pointBackgroundColor:r.colorsPalette["color-cold-gray-900"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-minty-green-500"],dividerColor:"#0D3D41",activeColor:n},text:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-minty-green-500"],dividerColor:"#0D3D41",buttonTextColor:r.colorsPalette["color-minty-green-500"]},close:{backgroundColor:r.colorsPalette["color-cold-gray-900"],iconColor:r.colorsPalette["color-minty-green-500"],activeColor:n}},b={pointShadowColor:p,labelTickColor:r.colorsPalette["color-tan-orange-500"],lineColor:r.colorsPalette["color-tan-orange-500"],borderBackgroundColor:r.colorsPalette["color-cold-gray-900"],borderColor:r.colorsPalette["color-tan-orange-500"],pointBackgroundColor:r.colorsPalette["color-cold-gray-900"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-tan-orange-500"],dividerColor:"#453826",activeColor:d},text:{backgroundColor:r.colorsPalette["color-cold-gray-900"],textColor:r.colorsPalette["color-tan-orange-500"],dividerColor:"#453826",buttonTextColor:r.colorsPalette["color-tan-orange-500"]},close:{
backgroundColor:r.colorsPalette["color-cold-gray-900"],iconColor:r.colorsPalette["color-tan-orange-500"],activeColor:d}},C={buy:{normal:y,disabled:(0,s.generateBlendColors)(y,_)},sell:{normal:f,disabled:(0,s.generateBlendColors)(f,_)},takeProfit:{normal:v,disabled:(0,s.generateBlendColors)(v,_)},stopLoss:{normal:b,disabled:(0,s.generateBlendColors)(b,_)}}},59976:(t,e,o)=>{o.d(e,{buyPointShadowColor:()=>a,lightTheme:()=>f,overlayColor:()=>h,sellPointShadowColor:()=>n});var r=o(149511),i=o(246733),s=o(528474),l=o(675341);const a=(0,i.generateColor)(r.colorsPalette["color-tv-blue-500"],80),n=(0,i.generateColor)(r.colorsPalette["color-ripe-red-500"],80),d=(0,i.generateColor)(r.colorsPalette["color-minty-green-500"],80),c=(0,i.generateColor)(r.colorsPalette["color-tan-orange-500"],80),h=(0,i.generateColor)(r.colorsPalette["color-white"],50),u={pointShadowColor:a,labelTickColor:r.colorsPalette["color-tv-blue-500"],lineColor:r.colorsPalette["color-tv-blue-500"],borderBackgroundColor:r.colorsPalette["color-white"],borderColor:r.colorsPalette["color-tv-blue-500"],pointBackgroundColor:r.colorsPalette["color-white"],disabledLineColor:r.colorsPalette["color-tv-blue-100"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-tv-blue-500"],dividerColor:r.colorsPalette["color-tv-blue-50"],activeColor:l.buyActiveColor},text:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-tv-blue-500"],dividerColor:r.colorsPalette["color-tv-blue-50"],buttonTextColor:r.colorsPalette["color-tv-blue-500"]},close:{backgroundColor:r.colorsPalette["color-white"],iconColor:r.colorsPalette["color-tv-blue-500"],activeColor:l.buyActiveColor},confirm:{disableBackgroundColor:r.colorsPalette["color-cold-gray-150"],backgroundColor:r.colorsPalette["color-tv-blue-500"],borderColor:r.colorsPalette["color-tv-blue-500"],textColor:r.colorsPalette["color-white"],disableTextColor:r.colorsPalette["color-cold-gray-300"],activeColor:r.colorsPalette["color-tv-blue-600"]}},p={pointShadowColor:n,labelTickColor:r.colorsPalette["color-ripe-red-500"],lineColor:r.colorsPalette["color-ripe-red-500"],borderBackgroundColor:r.colorsPalette["color-white"],borderColor:r.colorsPalette["color-ripe-red-500"],pointBackgroundColor:r.colorsPalette["color-white"],disabledLineColor:r.colorsPalette["color-ripe-red-100"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-ripe-red-500"],dividerColor:r.colorsPalette["color-ripe-red-50"],activeColor:l.sellActiveColor},text:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-ripe-red-500"],dividerColor:r.colorsPalette["color-ripe-red-50"],buttonTextColor:r.colorsPalette["color-ripe-red-500"]},close:{backgroundColor:r.colorsPalette["color-white"],iconColor:r.colorsPalette["color-ripe-red-500"],
activeColor:l.sellActiveColor},confirm:{disableBackgroundColor:r.colorsPalette["color-cold-gray-150"],backgroundColor:r.colorsPalette["color-ripe-red-500"],borderColor:r.colorsPalette["color-ripe-red-500"],textColor:r.colorsPalette["color-white"],disableTextColor:r.colorsPalette["color-cold-gray-300"],activeColor:r.colorsPalette["color-ripe-red-600"]}},_={pointShadowColor:d,labelTickColor:r.colorsPalette["color-minty-green-500"],lineColor:r.colorsPalette["color-minty-green-500"],borderBackgroundColor:r.colorsPalette["color-white"],borderColor:r.colorsPalette["color-minty-green-500"],pointBackgroundColor:r.colorsPalette["color-white"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-minty-green-500"],dividerColor:r.colorsPalette["color-minty-green-50"],activeColor:l.takeProfitActiveColor},text:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-minty-green-500"],dividerColor:r.colorsPalette["color-minty-green-50"],buttonTextColor:r.colorsPalette["color-minty-green-500"]},close:{backgroundColor:r.colorsPalette["color-white"],iconColor:r.colorsPalette["color-minty-green-500"],activeColor:l.takeProfitActiveColor}},y={pointShadowColor:c,labelTickColor:r.colorsPalette["color-tan-orange-500"],lineColor:r.colorsPalette["color-tan-orange-500"],borderBackgroundColor:r.colorsPalette["color-white"],borderColor:r.colorsPalette["color-tan-orange-500"],pointBackgroundColor:r.colorsPalette["color-white"],positivePlColor:r.colorsPalette["color-minty-green-500"],negativePlColor:r.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-tan-orange-500"],dividerColor:r.colorsPalette["color-tan-orange-50"],activeColor:l.stopLossActiveColor},text:{backgroundColor:r.colorsPalette["color-white"],textColor:r.colorsPalette["color-tan-orange-500"],dividerColor:r.colorsPalette["color-tan-orange-50"],buttonTextColor:r.colorsPalette["color-tan-orange-500"]},close:{backgroundColor:r.colorsPalette["color-white"],iconColor:r.colorsPalette["color-tan-orange-500"],activeColor:l.stopLossActiveColor}},f={buy:{normal:u,disabled:(0,s.generateBlendColors)(u,h)},sell:{normal:p,disabled:(0,s.generateBlendColors)(p,h)},takeProfit:{normal:_,disabled:(0,s.generateBlendColors)(_,h)},stopLoss:{normal:y,disabled:(0,s.generateBlendColors)(y,h)}}},288281:(t,e,o)=>{o.d(e,{getDefaultStyleForOrderItem:()=>a,getStyleForOppositeDirection:()=>n});var r=o(379048),i=o(199356),s=o(59976),l=o(675341);function a(t,e,o,a={}){const n=o()?l.darkTheme:s.lightTheme;let d;const c=t.bracketType();d=null!==c?c===i.BracketType.TakeProfit?n.takeProfit:n.stopLoss:t.isBuyDirection()?n.buy:n.sell;const h=e.disabled()?d.disabled:d.normal,u=e.isPlaced()?t.lineStyle():r.LineStyle.Dashed;return{...h,lineStyle:u,borderStyle:u,labelBorderVisible:!0,...a}}function n(t,e,o){const i=o()?l.darkTheme:s.lightTheme,a=t.isBuyDirection()?i.sell:i.buy;return{
...e.disabled()?a.disabled:a.normal,lineStyle:t.isWorking()?e.lineStyle():r.LineStyle.Dotted,borderStyle:t.isWorking()?r.LineStyle.Solid:r.LineStyle.Dotted,labelBorderVisible:!0}}},260582:(t,e,o)=>{o.d(e,{contextMenuItems:()=>c});var r=o(444372),i=o(373571),s=o(167975),l=o(166059);const a=(0,s.appendEllipsis)(r.t(null,void 0,o(888310))),n=r.t(null,void 0,o(424356)),d=r.t(null,void 0,o(920848));async function c(t,e){const o=[],r=await(0,l.createContextMenuTitle)("Trading.PositionTitle",e);return r&&o.push(r),void 0!==t.modifyPosition&&o.push(new i.Action({actionId:"Trading.ModifyPosition",options:{label:a,onExecute:t.modifyPosition}})),void 0!==t.closePosition&&o.push(new i.Action({actionId:"Trading.ClosePosition",options:{label:n,onExecute:t.closePosition}})),void 0!==t.reversePosition&&o.push(new i.Action({actionId:"Trading.ReversePosition",options:{label:d,onExecute:t.reversePosition}})),o}},13278:(t,e,o)=>{o.d(e,{PositionItemRenderer:()=>h});var r=o(650151),i=o(315801),s=o(147354),l=o(507795),a=o(787123),n=o(833118),d=o(210690),c=o(5280);class h extends c.TPSLItemRenderer{constructor(){super(...arguments),this._bodyBorderRadius=4}hitTest(t,e){const o=e.pixelRatio,l=this.rectWithOffsets(e),a=Math.round(t.x*o),n=Math.round(t.y*o),c=a>=l.left,h=a<=l.right,u=c&&h,p=n>=l.top&&n<=l.bottom,_=Math.round(l.top/o);if(!p||!u)return null;const y={cursorType:s.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,d.activeItemToHitTestResultData)({id:this._data.id,part:8})};if(this._data.disabled)return new i.HitTestResult(i.HitTarget.Custom,y);const f=this._hasReverseButton()&&(0,r.ensureDefined)(this._data.reverse);if(f&&1===f.visibility){const t=l.reverse.left+l.reverse.width;if(a>=l.reverse.left&&a<t){const t=Math.round(l.reverse.left/o),e=Math.round(l.reverse.width/o);return new i.HitTestResult(i.HitTarget.Custom,{...(0,d.activeItemToHitTestResultData)({id:this._data.id,part:4}),cursorType:s.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,contextMenuHandler:this._data.callbacks.onContextMenu,touchContextMenuHandler:this._data.callbacks.onContextMenu,clickHandler:this._data.callbacks.onReverse,tapHandler:this._data.callbacks.onReverse,tooltip:{text:f.title,rect:{x:t,y:_,w:e,h:this._height}}})}const r=this._calcReverseRect(e.pixelRatio).offset;if(t-l.body.left<0?a>=t&&a<l.tp.left:a>=l.reverse.left-r&&a<l.reverse.left)return new i.HitTestResult(i.HitTarget.Custom,y)}return super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isReverseVisible()||!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e);this._drawReverseButton(t,e.pixelRatio,o.reverse.left,o.top,o.reverse.width,o.bottom-o.top,o.borderWidth,o.borderRadius)}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRectWithOffsets(t){const e=super._calculateCacheRectWithOffsets(t);return{...e,reverse:{...e.reverse,left:this._calcCoordinateWithOffset(e.reverse.left,e.reverse.left+e.reverse.width).left}}}_calculateCacheRect(t){var e;const o=super._calculateCacheRect(t)
;if(!(null===(e=this._data)||void 0===e?void 0:e.callbacks.onReverse)||!this._hasReverseButton())return{...o,reverse:{width:0,left:0}};const r=this._calcReverseRect(t.pixelRatio),i=this._data.bodyAlignment===l.TradedGroupHorizontalAlignment.Left,s=i?o.right+r.offset:o.left-r.width-r.offset,a=i?o.left:s,n=i?s+r.width:o.right;return{...o,left:a,right:n,reverse:{width:r.width,left:s}}}_calcAllWidth(t,e,o,r,i,s){var l;const a=super._calcAllWidth(t,e,o,r,i,s);if(!(null===(l=this._data)||void 0===l?void 0:l.callbacks.onReverse)||!this._hasReverseButton())return a;const n=this._calcReverseRect(t);return a+n.width+n.offset}_drawLine(t,e){var o;if(!(null===(o=this._data)||void 0===o?void 0:o.callbacks.onReverse))return void super._drawLine(t,e);const r=e.pixelRatio,i=this.rectWithOffsets(e),s=Math.round(e.physicalWidth),l=i.reverse.left+i.reverse.width;if(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*r)),(0,a.setLineStyle)(t,this._data.line.style),(0,a.drawHorizontalLine)(t,i.yMid,i.body.right,s),this._isReverseVisible()&&(0,a.drawHorizontalLine)(t,i.yMid,l,i.body.left),this._data.line.extend){const e=this._isReverseVisible()?i.reverse.left:i.body.left;(0,a.drawHorizontalLine)(t,i.yMid,0,e)}t.restore()}_calcReverseRect(t){return{width:Math.round(29*t),offset:Math.round(10*t)}}_drawReverseButton(t,e,o,i,s,l,d,c){const h=(0,r.ensureDefined)(this._data.reverse),u=h.active;t.save(),(0,a.drawRoundRectWithInnerBorder)(t,o,i,s,l,h.backgroundColor,c,d,this._data.borderColor),u.visible&&(0,a.drawRoundRectWithInnerBorder)(t,o,i,s,l,u.backgroundColor,c,d,"transparent");const p=Math.round(3*e),_=Math.round(3*e),y=Math.round(9*e),f=Math.round(o+(s-p)/2),v=Math.round(f+p),b=i+d+Math.round((l-y)/2-d),C=b+y,m=h.iconColor;t.lineWidth=d,(0,n.drawHalfArrow)(t,f,b,m,!1,y,_),(0,n.drawHalfArrow)(t,v,C,m,!0,y,_),t.restore()}_isReverseVisible(){return this._hasReverseButton()&&1===(0,r.ensureDefined)(this._data.reverse).visibility}_hasReverseButton(){return Boolean(this._data.callbacks.onReverse&&this._data.reverse)}}},794546:(t,e,o)=>{o.d(e,{PositionItem:()=>C});var r=o(650151),i=o(507795),s=o(373571),l=o(77122),a=o(389137),n=o(928691),d=o(201089),c=o(17980),h=o(166059),u=o(743377),p=o(48524),_=o(779298),y=o(260582),f=o(767162);const v=(0,d.getLogger)("Trading.Positions"),b=l.enabled("chart_hide_close_position_button");class C extends _.BaseItem{constructor(t,e,o,r,i,s){super(t,e,o,r,"Chart Position",i,s),this._source.positionDisplayMode().subscribe(this,this.fireProfitLossChange)}destroy(){this._source.positionDisplayMode().unsubscribe(this,this.fireProfitLossChange),super.destroy()}supportBrackets(){return this._symbolDataProvider.supportPositionBrackets()}currency(){var t;return null!==(t=this._symbolDataProvider.positionCurrency())&&void 0!==t?t:""}profitLossTextColor(){if(!this._data)return"";const t=this._potentialProfitLoss();return null===t?"":(0,f.profitLossTextColor)(this._infoGetters.style(this),t,this._infoGetters.displayMode.value()===i.PlDisplay.Money)}id(){
return this._data.id}setData(t){var e;const o=null===(e=this.data())||void 0===e?void 0:e.pl;super.setData(t),this.data().pl!==o&&this.fireProfitLossChange()}qtyText(){return super._quantityText(this._data.qtyBySide)}qty(){return this._data.qtyBySide}supportOnlyPairBrackets(){return this._data.supportOnlyPairBrackets}supportReverse(){return this._symbolDataProvider.supportPositionReverse()}async onReverse(t={}){t=(0,p.mergeGaParams)(t,{event:"Reverse Position"}),await this._doActionWithBlock("reversePosition",!0,t)}supportClose(){return!b&&this._data.supportClose}async onClose(t={}){t=(0,p.mergeGaParams)(t,{event:"Close Position"}),await this._doActionWithBlock("closePosition",!0,t)}supportModify(){return this.supportBrackets()}async onModify(t={}){return t=(0,p.mergeGaParams)(t,{event:"Edit Position"}),this._doActionWithBlock("modifyPosition",!0,t,void 0,void 0,!1)}useMinTickFormatter(){return!1}async onModifyWithBracket(t={},e={},o=!0,i,s=!0){var l,a;const n=this._symbolDataProvider.lastData(),d=null!==(l=null==n?void 0:n.bid)&&void 0!==l?l:null,c=null!==(a=null==n?void 0:n.ask)&&void 0!==a?a:null;if(void 0!==e.trailingStop&&d&&c){const t=1===this._data.side?d:c,{pipSize:o}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData());e.trailingStopPips=(0,u.calcPipsByPrice)(e.trailingStop,t,this._data.side,o),e.trailingStop=void 0}return this._doActionWithBlock("modifyPosition",o,t,e,i,s)}hasContextMenu(){return super.hasContextMenu()||this.supportReverse()}moneyText(t,e){return`${(0,_.plSign)(t,e)}${Math.abs(t).toFixed(2)} ${this.currency()}`}async onContextMenu(t,e){this.fireProfitLossChange();const o={};e=(0,p.mergeGaParams)(e,{origin:"Chart Position Context Menu"}),this.supportClose()&&(o.closePosition=this.onClose.bind(this,e)),this.supportReverse()&&(o.reversePosition=this.onReverse.bind(this,e)),this.supportModify()&&(o.modifyPosition=this.onModify.bind(this,e));const r={side:(0,c.sideToText)(this._data.side),qty:this.qtyText(),price:this.priceText(),formatPlWV:this.formatPlWV(),plColorWV:this.plColorWV()},i=await(0,y.contextMenuItems)(o,r),l=this._infoGetters.noOverlapAction(e,(t=>this._trackEventGA(t)));l&&(i.push(new s.Separator),i.push(l)),this._contextMenu=await(0,h.showContextMenu)(i,t,(()=>{this._contextMenu=null}),{detail:{type:"position",id:this.id()}})}tryBasePlOnLast(){return!0}_potentialProfitLoss(){var t;if(!this._source.isPositionPLVisible().value()||!this._data)return null;const{pl:e,side:o,price:r}=this._data;if(null===e)return null;if(this._infoGetters.displayMode.value()===i.PlDisplay.Money)return e;const{trade:s,ask:l,bid:n}=this._symbolDataProvider.lastData()||{},d=null!==(t=this._data.plBasedOnLast?s:this.isBuyDirection()?n:l)&&void 0!==t?t:r;return(0,a.isNumber)(d)?(d-r)*o:null}async _doActionWithBlock(t,e,o={},i={},s,l){if(void 0===this._data.callbacks[t])return!1;e&&this._source.setIsBlocked(!0),this._trackEventGA(o);let a=!1;try{a="modifyPosition"===t?await(0,r.ensureDefined)(this._data.callbacks.modifyPosition)(this._data.id,i,s,l):await(0,
r.ensureDefined)(this._data.callbacks[t])(this._data.id)}catch(e){v.logWarn(`Try to ${t}, but got error: ${(0,n.errorToString)(e)}`)}finally{e&&(this._source.setIsBlocked(!1),this._source.syncData())}return a}}},205827:(t,e,o)=>{o.d(e,{PositionPaneViewItem:()=>h,closeTitle:()=>c,reverseTitle:()=>d});var r=o(444372),i=o(167975),s=o(922600),l=o(210690),a=o(393724);const n=(0,i.appendEllipsis)(r.t(null,void 0,o(911810))),d=r.t(null,void 0,o(419780)),c=r.t(null,void 0,o(437431));class h extends s.BasePaneViewItem{rendererData(){const t=(0,a.getDefaultStyleForPositionItem)(this._item.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),this._item.lineStyle());let e;const o=this._renderDataForClose(t.close,t.close.activeColor);return void 0!==o&&(e={...o,title:c}),{type:l.ItemsRendererType.Position,...this._renderDataGeneral(t),...this._renderDataForTPSLButtons(this._item),callbacks:this._callbacks(this._projectionBracketsForItem(this._item)),line:this._renderDataForLine(t),qty:{...this._renderDataForQty(t.qty,t.qty.activeColor),title:n},text:{...this._renderDataForText(t.text,t.qty.activeColor),title:"",textColor:this._item.profitLossTextColor(),active:{visible:!1,backgroundColor:t.qty.activeColor}},point:this._renderDataForPoint(),close:e,reverse:this._renderDataForReverse(t.reverse)}}_callbacks(t=[]){const e=super._callbacks(t),o={label:`[${this._modeGaLabel()}]`};return this._item.supportClose()&&this._isCloseVisible()&&(e.onClose=()=>this._item.onClose(o)),this._shouldReverseShown()&&(e.onReverse=()=>this._item.onReverse(o)),this._item.supportModify()&&(e.onModify=()=>this._item.onModify(o)),e}_renderDataForReverse(t){if(!this._shouldReverseShown())return;const e=this._isHoveredItemWithButtons(this._item)||this._source.isSelected();return{title:d,visibility:e?1:0,backgroundColor:t.backgroundColor,iconColor:t.iconColor,active:{visible:this._isHoveredItemPart(this._item,4),backgroundColor:t.activeColor}}}_shouldReverseShown(){return this._item.supportReverse()&&this._source.isReverseVisible()&&this._isReverseVisible()}_isReverseVisible(){return 2===this._displayMode&&!this._isNoOverlapMode}}},393724:(t,e,o)=>{o.d(e,{getDefaultStyleForPositionItem:()=>_});var r=o(379048),i=o(149511),s=o(675341),l=o(528474);const a={pointShadowColor:s.buyPointShadowColor,lineColor:i.colorsPalette["color-tv-blue-500"],borderBackgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-tv-blue-500"],pointBackgroundColor:i.colorsPalette["color-cold-gray-900"],disabledLineColor:i.colorsPalette["color-tv-blue-a700"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-tv-blue-500"],activeColor:i.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:i.colorsPalette["color-cold-gray-900"],textColor:i.colorsPalette["color-cold-gray-600"],dividerColor:i.colorsPalette["color-tv-blue-a800"]},close:{
backgroundColor:i.colorsPalette["color-cold-gray-900"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:s.buyActiveColor},reverse:{backgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-tv-blue-500"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:s.buyActiveColor},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-750"],backgroundColor:i.colorsPalette["color-tv-blue-500"],borderColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-600"],activeColor:i.colorsPalette["color-tv-blue-600"]}},n={pointShadowColor:s.sellPointShadowColor,lineColor:i.colorsPalette["color-ripe-red-500"],borderBackgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-ripe-red-500"],pointBackgroundColor:i.colorsPalette["color-cold-gray-900"],disabledLineColor:i.colorsPalette["color-ripe-red-a800"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-ripe-red-500"],activeColor:i.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:i.colorsPalette["color-cold-gray-900"],textColor:i.colorsPalette["color-cold-gray-600"],dividerColor:i.colorsPalette["color-ripe-red-a800"]},close:{backgroundColor:i.colorsPalette["color-cold-gray-900"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:s.sellActiveColor},reverse:{backgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-ripe-red-500"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:s.sellActiveColor},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-750"],backgroundColor:i.colorsPalette["color-ripe-red-500"],borderColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-600"],activeColor:i.colorsPalette["color-ripe-red-600"]}},d={buy:{normal:a,disabled:(0,l.generateBlendColors)(a,s.overlayColor)},sell:{normal:n,disabled:(0,l.generateBlendColors)(n,s.overlayColor)}};var c=o(59976);const h={pointShadowColor:c.buyPointShadowColor,lineColor:i.colorsPalette["color-tv-blue-500"],borderBackgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-tv-blue-500"],pointBackgroundColor:i.colorsPalette["color-white"],disabledLineColor:i.colorsPalette["color-tv-blue-100"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-tv-blue-500"],activeColor:i.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:i.colorsPalette["color-white"],textColor:i.colorsPalette["color-cold-gray-300"],dividerColor:i.colorsPalette["color-tv-blue-50"]},close:{backgroundColor:i.colorsPalette["color-white"],
iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:s.buyActiveColor},reverse:{backgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-tv-blue-500"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:s.buyActiveColor},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-150"],backgroundColor:i.colorsPalette["color-tv-blue-500"],borderColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-300"],activeColor:i.colorsPalette["color-tv-blue-600"]}},u={pointShadowColor:c.sellPointShadowColor,lineColor:i.colorsPalette["color-ripe-red-500"],borderBackgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-ripe-red-500"],pointBackgroundColor:i.colorsPalette["color-white"],disabledLineColor:i.colorsPalette["color-ripe-red-100"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-ripe-red-500"],activeColor:i.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:i.colorsPalette["color-white"],textColor:i.colorsPalette["color-cold-gray-300"],dividerColor:i.colorsPalette["color-ripe-red-50"]},close:{backgroundColor:i.colorsPalette["color-white"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:s.sellActiveColor},reverse:{backgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-ripe-red-500"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:s.sellActiveColor},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-150"],backgroundColor:i.colorsPalette["color-ripe-red-500"],borderColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-300"],activeColor:i.colorsPalette["color-ripe-red-600"]}},p={buy:{normal:h,disabled:(0,l.generateBlendColors)(h,c.overlayColor)},sell:{normal:u,disabled:(0,l.generateBlendColors)(u,c.overlayColor)}};function _(t,e,o,i=r.LineStyle.Solid){const s=o()?d:p,l=t?s.buy:s.sell;return{...e?l.disabled:l.normal,lineStyle:i,borderStyle:i,labelBorderVisible:!1}}},516879:(t,e,o)=>{o.d(e,{PreOrderItem:()=>n});var r=o(444372),i=o(379048),s=o(17980),l=o(99272);const a=r.t(null,void 0,o(502861));class n extends l.OrderWithMenuItem{constructor(){super(...arguments),this._supportedOrderTypes=[]}qtyText(){return super._quantityText(this._data.qty)}style(){return this._infoGetters.style(this)}setSupportOrderType(t){this._supportedOrderTypes=t}canSwitchType(){return this._supportedOrderTypes.length>1}orderTypesItems(){return this._supportedOrderTypes.map((t=>({type:t,typeText:(0,s.orderTypeToText)({orderType:t})})))}isWorking(){return!0}profitLossText(t){return(0,s.orderTypeToText)({orderType:this.data().type,uppercase:t,shorten:t})}profitLossTooltip(){return a}lineStyle(){return i.LineStyle.Dashed}supportClose(){return!0}supportModify(){
return this._data.supportModify}async onClose(t){var e,o;null===(o=(e=this._source).onClose)||void 0===o||o.call(e,t)}async onModify(t){var e,o;return null===(o=(e=this._source).onModify)||void 0===o||o.call(e,t),!0}_calcId(){return"preOrder"}}},583086:(t,e,o)=>{o.d(e,{ProjectionBracketItemRenderer:()=>n});var r=o(650151),i=o(315801),s=o(147354),l=o(507795),a=o(210690);class n extends a.ItemRenderer{constructor(){super(...arguments),this._left=0}hitTest(t,e){const o=e.pixelRatio,r=this.rectWithOffsets(e),l=Math.round(t.x*o),n=Math.round(t.y*o),d=l>=r.left,c=l<=r.right,h=d&&c;if(!(n>=r.top&&n<=r.bottom)||!h)return null;const u={cursorType:s.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...(0,a.activeItemToHitTestResultData)({id:this._data.id})};return this._data.disabled?new i.HitTestResult(i.HitTarget.Custom,u):new i.HitTestResult(i.HitTarget.Custom,{...u,...(0,a.activeItemToHitTestResultData)({id:this._data.id,part:8})})}applyOffset(t){const e=(0,r.ensureDefined)(this._data.drawWithTPOffset?t.projItemTpLeft:this._data.drawWithSLOffset?t.projItemSlLeft:0);this._left!==e&&(this._left=e,this.clearCache())}_drawQtyWithBackground(t,e,o,i,s){const l=(0,r.ensureDefined)(this._data.qty),a=o.top+(o.bottom-o.top)/2,n=o.qty.left+o.qty.width/2;this._drawText(t,e,l.text,l.textColor,n,a)}_drawTextWithBackground(t,e,o,r,i){const s=o.top+(o.bottom-o.top)/2,l=o.text.left+o.text.width/2;this._drawText(t,e,this._data.text.text,this._data.text.textColor,l,s)}_calculateCacheRect(t){const e=t.pixelRatio;let o=super._calculateCacheRect(t);const r=2*o.borderWidth,i=this._mainTextWidth(this._ctxInternal),s=this._quantityWidth(this._ctxInternal),a=Math.round(i*e+s*e)+(i&&r)+(s&&o.borderWidth),n=this._left+a;return o={...o,left:this._left,right:n,body:{...o.body,left:this._left,right:n},text:{left:this._left+o.qty.width+o.borderWidth,width:o.text.width,rightDividerWidth:0},qty:{left:this._left,width:o.qty.width,rightDividerWidth:o.qty.rightDividerWidth}},this._data.bodyAlignment!==l.TradedGroupHorizontalAlignment.Left?o:{...o,top:o.top,bottom:o.bottom,body:{left:o.body.left-o.text.width-Number(o.qty.rightDividerWidth)-o.borderWidth,right:o.qty.left+o.qty.width+o.borderWidth},text:{left:o.body.left-o.text.width-Number(o.qty.rightDividerWidth),width:o.text.width+Number(o.qty.rightDividerWidth),rightDividerWidth:o.qty.rightDividerWidth},qty:{left:o.qty.left,width:o.qty.width-Number(o.qty.rightDividerWidth),rightDividerWidth:0}}}_calcAllWidth(t,e,o,r,i,s){const l=2*s;return Math.round(o*t)+(o&&l)}}},834034:(t,e,o)=>{o.d(e,{ProjectionBracketItem:()=>m,stopLossShortTitle:()=>p,stopLossTooltip:()=>v,takeProfitTitle:()=>y,takeProfitTooltip:()=>f});var r=o(650151),i=o(150335),s=o(86441),l=o(444372),a=o(389137),n=o(379048),d=o(199356),c=o(588929),h=o(99272),u=o(125226);const p=l.t(null,{context:"Stop loss"},o(653315)),_=l.t(null,{context:"Trailing stop"},o(668694)),y=l.t(null,{context:"Take profit"},o(645560)),f=l.t(null,void 0,o(223754)),v=l.t(null,void 0,o(46742)),b=l.t(null,void 0,o(416976)),C=(0,
u.isFeatureEnabled)("allow_trailing_stop_profit_loss");class m extends h.OrderWithMenuItem{style(){return this._infoGetters.style(this)}setPrice(t){const{minTick:e}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData());null!==t&&(t=(0,i.fixComputationError)(e*Math.round(t/e))),this.setData({...(0,a.clone)(this.data()),price:t})}data(){return super.data()}qtyText(){return this._bracketTypeText(!0)}tooltip(){switch(this.bracketType()){case d.BracketType.TakeProfit:return f;case d.BracketType.StopLoss:return v;case d.BracketType.TrailingStop:return b;default:throw new Error("Unknown bracket type")}}isWorking(){return!0}supportClose(){return!1}supportModify(){return!0}profitLossText(t){var e;return!(null===(e=this._source.isBracketsPLVisible())||void 0===e?void 0:e.value())||this.bracketType()===d.BracketType.TrailingStop&&!C?"":super.profitLossText(t)}isMinifyMode(){return null===this.price()}bracketType(){return this.data().bracketType}async onMove(t){const e=new s.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),i=this._mainSeries.firstValue();if(null===i)return;const l=o.coordinateToPrice(e.y,i);this.setPrice(l),t.isTouch&&(0,r.ensureDefined)(this._itemCommands.exitTrackingMode)()}lineStyle(){return n.LineStyle.Dashed}_isBracket(){return!0}_calcId(){return this._data.id}_bracketTypeText(t){return this._data?this.bracketType()===d.BracketType.TakeProfit?y:this._source.bracketStopType()===c.StopType.TrailingStop?_:p:""}}},743377:(t,e,o)=>{o.d(e,{calcPipsByPrice:()=>i});var r=o(960521);function i(t,e,o,i){return(0,r.Big)(t).minus(e).div(i).mul(1===o?-1:1).toNumber()}},48524:(t,e,o)=>{o.d(e,{mergeGaParams:()=>i});var r=o(650151);function i(t,e){(0,r.assert)(!(t.origin&&e.origin&&t.origin!==e.origin||t.event&&e.event&&t.event!==e.event),"origin and event should be only in one params object");const o={...t,...e};return t.label&&e.label&&(o.label=`${t.label} ${e.label}`),o}},119836:(t,e,o)=>{o.d(e,{bracketsByType:()=>f,buildProjectionBracketData:()=>v,getBracketType:()=>_,getBracketTypeToText:()=>y,getOrderPriceByType:()=>b});var r=o(650151),i=o(444372),s=o(199356),l=o(588929),a=o(739630);const n=i.t(null,void 0,o(86430)),d=i.t(null,void 0,o(241648)),c=i.t(null,void 0,o(129266)),h=i.t(null,{context:"Trailing stop"},o(668694)),u=i.t(null,{context:"Stop loss"},o(653315)),p=i.t(null,{context:"Take profit"},o(645560));function _(t){return 3===t.type?t.stopType===l.StopType.TrailingStop?s.BracketType.TrailingStop:s.BracketType.StopLoss:1===t.type?s.BracketType.TakeProfit:null}function y(t,e,o){return 3===t?e===l.StopType.TrailingStop?o?h:n:o?u:d:1===t?o?p:c:null}function f(t){let e,o,r;return t.forEach((t=>{switch((0,a.isOrderLikeItem)(t)?t.bracketType():_(t)){case s.BracketType.TakeProfit:e=t;break;case s.BracketType.TrailingStop:r=t;break;case s.BracketType.StopLoss:o=t}})),{takeProfit:e,trailingStop:r,stopLoss:o}}function v(t,e,o){const r=e===s.BracketType.TrailingStop?l.StopType.TrailingStop:void 0,i=e===s.BracketType.TakeProfit?1:3,a=-1===o.side?1:-1;return{dataType:"Order",
id:e===s.BracketType.TakeProfit?`${t}TakeProfit`:e===s.BracketType.StopLoss?`${t}StopLoss`:`${t}TrailingStop`,price:null,type:i,stopType:r,side:a,bracketType:e,qty:o.qty,status:6,symbol:o.symbol,plBasedOnLast:"plBasedOnLast"in o&&o.plBasedOnLast,considerFilledQty:!1,supportModify:!1,supportModifyOrderPrice:!1,supportMove:!0,supportCancel:!1,supportTrailingStop:!1,callbacks:{}}}function b(t){return 1===t.type?(0,r.ensureDefined)(t.limitPrice,"limit price for order"):(0,r.ensureDefined)(t.stopPrice,"stop price for order")}},166059:(t,e,o)=>{o.d(e,{createContextMenuTitle:()=>c,createNoOverlapMenuAction:()=>n,showContextMenu:()=>d});var r=o(444372),i=o(373571),s=o(783375);var l=o(48524);const a=r.t(null,void 0,o(376303));function n(t,e,o){const r=(0,l.mergeGaParams)(e,{event:"No overlap orders and positions"});return new i.Action({actionId:"Trading.NoOverlapMode",options:{label:a,onExecute:()=>{o(r),t.setNoOverlapMode(!0)},disabled:!t.isItemsOverlap()}})}async function d(t,e,o,r){return s.ContextMenuManager.createMenu(t,{},{...r,menuName:"TradingOrderContextMenu"},o).then((t=>(t.show(e),t)))}async function c(t,e){return async function(t,e){const{renderItemContextMenuTitle:r}=await Promise.all([o.e(87596),o.e(79704)]).then(o.bind(o,396410)),{side:s,qty:l,price:a,formatPlWV:n,orderType:d,plColorWV:c}=e,h=null==n?void 0:n.spawn(),u=null==c?void 0:c.spawn(),p=()=>`${s} ${l} @${a}${h?` (${h.value()})`:""}${void 0!==d?` ${d}`:""}`,_=()=>{if(u&&h)return[{text:`${s} ${l} @${a}`},{text:` (${h.value()})`,color:u.value()},{text:void 0!==d?` ${d}`:""}]},y={noInteractive:!0,doNotCloseOnClick:!0,onDestroy:()=>{null==h||h.destroy(),null==u||u.destroy()}},f=new i.Action({actionId:t,options:{...y,label:p(),styledLabel:_()},customActionOptions:{...y,jsxLabel:r(e)}}),v=()=>f.update({styledLabel:_(),label:p()});return null==h||h.subscribe(v),null==u||u.subscribe(v),f}(t,e)}},833118:(t,e,o)=>{o.d(e,{drawArrow:()=>l,drawHalfArrow:()=>n,drawOutlinedArrowHead:()=>a,drawOutlinedText:()=>h,drawText:()=>d,drawUnderlinedText:()=>c});var r=o(379048),i=o(787123),s=o(199471);function l(t,e,o,r,i,s,l,a,n){t.save();const d=t.lineWidth,c=t.lineWidth%2?.5:0;t.translate(e+c,o+c),s&&t.scale(1,-1);const h=Math.round(a/2),u=h,p=h;n&&(t.strokeStyle=i,t.lineWidth=2*t.lineWidth,t.lineCap="square",t.beginPath(),t.moveTo(0,h),t.lineTo(u,0),t.lineTo(a,h),t.stroke(),t.lineCap="butt",t.beginPath(),t.moveTo(p,l+(t.lineWidth-d)/2),t.lineTo(u,0),t.stroke()),t.lineWidth=d,t.strokeStyle=r,t.lineCap="square",t.beginPath(),t.moveTo(0,h),t.lineTo(u,0),t.lineTo(a,h),t.stroke(),t.lineCap="butt",t.beginPath(),t.moveTo(p,l),t.lineTo(u,0),t.stroke(),t.restore()}function a(t,e,o,r,i,s,l,a=90){t.save();const n=t.lineWidth,d=2*t.lineWidth,c=t.lineWidth%2?.5:0;t.translate(e+c+l/2-n,o+c),t.rotate(a*Math.PI/180);const h=Math.round(l/2);t.lineCap="square",t.lineWidth=d,t.strokeStyle=i,t.beginPath(),t.moveTo(0,h),t.lineTo(h,0),t.lineTo(l,h),t.stroke(),t.lineCap="square",t.lineWidth=n,t.strokeStyle=r,t.beginPath(),t.moveTo(0,h),t.lineTo(h,0),t.lineTo(l,h),t.stroke(),t.restore()}
function n(t,e,o,r,i,s,l){t.save(),t.strokeStyle=r,t.lineJoin="miter";const a=t.lineWidth%2?.5:0,n=Math.round(s/3);t.translate(e+a,o+a),i&&t.scale(-1,-1),t.beginPath(),t.moveTo(0,s),t.lineTo(0,0),t.lineTo(-l,n),t.stroke(),t.restore()}function d(t,e,o,r,i,l,a,n,d="center"){t.save(),t.textAlign=d,t.textBaseline="middle",t.fillStyle=a,t.font=n,t.translate(r,i+l),(0,s.drawScaled)(t,e,e,(()=>{t.fillText(o,0,0)})),t.restore()}function c(t,e,o,l,a,n,d,c,h){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=d,t.font=c;const u=1,p=1,_=(r.LineStyle.Dashed,Math.round(10*e)/2),y=Math.max(1,Math.floor(p*e)),f=h.width*e,v=Math.max(1,Math.floor(u*e)),b=Math.round(l-f/2),C=Math.round(a+_+v);t.strokeStyle=d,t.lineWidth=y;const m=Math.round(3*t.lineWidth),P=Math.round(3*t.lineWidth/2),g=Math.round(2*t.lineWidth);let T=Math.trunc(f/(m+g));const k=Math.trunc(f%(m+g)/2),x=[];for(x.push(P+k);T>1;)x.push(g,m),T--;x.push(g,P+k),t.setLineDash(x),(0,i.drawHorizontalLine)(t,C,b,b+Math.round(f)),t.translate(l,a+n),(0,s.drawScaled)(t,e,e,(()=>{t.fillText(o,0,0)})),t.restore()}function h(t,e,o,r,i,l,a,n,d){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=a,t.font=n,t.lineJoin="round",t.translate(r,i+l),(0,s.drawScaled)(t,e,e,(()=>{t.strokeStyle=d,t.strokeText(o,0,0),t.fillText(o,0,0)})),t.restore()}},564988:(t,e,o)=>{o.d(e,{isTradingObjVisibleOnScreenshot:()=>i});o(77122);var r=o(440058);function i(){{const t=r.forceTradingObjVisibilityOnScreenshot.value();return null!==t?t:r.showOnScreenshotProperty.value()}}}}]);